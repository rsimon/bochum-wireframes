function ca(e,t){for(var n=0;n<t.length;n++){const o=t[n];if(typeof o!="string"&&!Array.isArray(o)){for(const r in o)if(r!=="default"&&!(r in e)){const i=Object.getOwnPropertyDescriptor(o,r);i&&Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:()=>o[r]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function Yi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var io={exports:{}},Yt={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wr;function ua(){if(wr)return Yt;wr=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(o,r,i){var s=null;if(i!==void 0&&(s=""+i),r.key!==void 0&&(s=""+r.key),"key"in r){i={};for(var a in r)a!=="key"&&(i[a]=r[a])}else i=r;return r=i.ref,{$$typeof:e,type:o,key:s,ref:r!==void 0?r:null,props:i}}return Yt.Fragment=t,Yt.jsx=n,Yt.jsxs=n,Yt}var xr;function da(){return xr||(xr=1,io.exports=ua()),io.exports}var de=da(),so={exports:{}},Z={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Er;function fa(){if(Er)return Z;Er=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),s=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),d=Symbol.iterator;function f(w){return w===null||typeof w!="object"?null:(w=d&&w[d]||w["@@iterator"],typeof w=="function"?w:null)}var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,p={};function E(w,O,B){this.props=w,this.context=O,this.refs=p,this.updater=B||h}E.prototype.isReactComponent={},E.prototype.setState=function(w,O){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,O,"setState")},E.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function v(){}v.prototype=E.prototype;function g(w,O,B){this.props=w,this.context=O,this.refs=p,this.updater=B||h}var y=g.prototype=new v;y.constructor=g,m(y,E.prototype),y.isPureReactComponent=!0;var $=Array.isArray,S={H:null,A:null,T:null,S:null,V:null},I=Object.prototype.hasOwnProperty;function P(w,O,B,D,K,F){return B=F.ref,{$$typeof:e,type:w,key:O,ref:B!==void 0?B:null,props:F}}function L(w,O){return P(w.type,O,void 0,void 0,void 0,w.props)}function N(w){return typeof w=="object"&&w!==null&&w.$$typeof===e}function H(w){var O={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(B){return O[B]})}var j=/\/+/g;function R(w,O){return typeof w=="object"&&w!==null&&w.key!=null?H(""+w.key):O.toString(36)}function T(){}function x(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(T,T):(w.status="pending",w.then(function(O){w.status==="pending"&&(w.status="fulfilled",w.value=O)},function(O){w.status==="pending"&&(w.status="rejected",w.reason=O)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function A(w,O,B,D,K){var F=typeof w;(F==="undefined"||F==="boolean")&&(w=null);var q=!1;if(w===null)q=!0;else switch(F){case"bigint":case"string":case"number":q=!0;break;case"object":switch(w.$$typeof){case e:case t:q=!0;break;case u:return q=w._init,A(q(w._payload),O,B,D,K)}}if(q)return K=K(w),q=D===""?"."+R(w,0):D,$(K)?(B="",q!=null&&(B=q.replace(j,"$&/")+"/"),A(K,O,B,"",function(Ue){return Ue})):K!=null&&(N(K)&&(K=L(K,B+(K.key==null||w&&w.key===K.key?"":(""+K.key).replace(j,"$&/")+"/")+q)),O.push(K)),1;q=0;var ae=D===""?".":D+":";if($(w))for(var ne=0;ne<w.length;ne++)D=w[ne],F=ae+R(D,ne),q+=A(D,O,B,F,K);else if(ne=f(w),typeof ne=="function")for(w=ne.call(w),ne=0;!(D=w.next()).done;)D=D.value,F=ae+R(D,ne++),q+=A(D,O,B,F,K);else if(F==="object"){if(typeof w.then=="function")return A(x(w),O,B,D,K);throw O=String(w),Error("Objects are not valid as a React child (found: "+(O==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":O)+"). If you meant to render a collection of children, use an array instead.")}return q}function M(w,O,B){if(w==null)return w;var D=[],K=0;return A(w,D,"","",function(F){return O.call(B,F,K++)}),D}function k(w){if(w._status===-1){var O=w._result;O=O(),O.then(function(B){(w._status===0||w._status===-1)&&(w._status=1,w._result=B)},function(B){(w._status===0||w._status===-1)&&(w._status=2,w._result=B)}),w._status===-1&&(w._status=0,w._result=O)}if(w._status===1)return w._result.default;throw w._result}var C=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var O=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(O))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)};function U(){}return Z.Children={map:M,forEach:function(w,O,B){M(w,function(){O.apply(this,arguments)},B)},count:function(w){var O=0;return M(w,function(){O++}),O},toArray:function(w){return M(w,function(O){return O})||[]},only:function(w){if(!N(w))throw Error("React.Children.only expected to receive a single React element child.");return w}},Z.Component=E,Z.Fragment=n,Z.Profiler=r,Z.PureComponent=g,Z.StrictMode=o,Z.Suspense=c,Z.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,Z.__COMPILER_RUNTIME={__proto__:null,c:function(w){return S.H.useMemoCache(w)}},Z.cache=function(w){return function(){return w.apply(null,arguments)}},Z.cloneElement=function(w,O,B){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var D=m({},w.props),K=w.key,F=void 0;if(O!=null)for(q in O.ref!==void 0&&(F=void 0),O.key!==void 0&&(K=""+O.key),O)!I.call(O,q)||q==="key"||q==="__self"||q==="__source"||q==="ref"&&O.ref===void 0||(D[q]=O[q]);var q=arguments.length-2;if(q===1)D.children=B;else if(1<q){for(var ae=Array(q),ne=0;ne<q;ne++)ae[ne]=arguments[ne+2];D.children=ae}return P(w.type,K,void 0,void 0,F,D)},Z.createContext=function(w){return w={$$typeof:s,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:i,_context:w},w},Z.createElement=function(w,O,B){var D,K={},F=null;if(O!=null)for(D in O.key!==void 0&&(F=""+O.key),O)I.call(O,D)&&D!=="key"&&D!=="__self"&&D!=="__source"&&(K[D]=O[D]);var q=arguments.length-2;if(q===1)K.children=B;else if(1<q){for(var ae=Array(q),ne=0;ne<q;ne++)ae[ne]=arguments[ne+2];K.children=ae}if(w&&w.defaultProps)for(D in q=w.defaultProps,q)K[D]===void 0&&(K[D]=q[D]);return P(w,F,void 0,void 0,null,K)},Z.createRef=function(){return{current:null}},Z.forwardRef=function(w){return{$$typeof:a,render:w}},Z.isValidElement=N,Z.lazy=function(w){return{$$typeof:u,_payload:{_status:-1,_result:w},_init:k}},Z.memo=function(w,O){return{$$typeof:l,type:w,compare:O===void 0?null:O}},Z.startTransition=function(w){var O=S.T,B={};S.T=B;try{var D=w(),K=S.S;K!==null&&K(B,D),typeof D=="object"&&D!==null&&typeof D.then=="function"&&D.then(U,C)}catch(F){C(F)}finally{S.T=O}},Z.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},Z.use=function(w){return S.H.use(w)},Z.useActionState=function(w,O,B){return S.H.useActionState(w,O,B)},Z.useCallback=function(w,O){return S.H.useCallback(w,O)},Z.useContext=function(w){return S.H.useContext(w)},Z.useDebugValue=function(){},Z.useDeferredValue=function(w,O){return S.H.useDeferredValue(w,O)},Z.useEffect=function(w,O,B){var D=S.H;if(typeof B=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return D.useEffect(w,O)},Z.useId=function(){return S.H.useId()},Z.useImperativeHandle=function(w,O,B){return S.H.useImperativeHandle(w,O,B)},Z.useInsertionEffect=function(w,O){return S.H.useInsertionEffect(w,O)},Z.useLayoutEffect=function(w,O){return S.H.useLayoutEffect(w,O)},Z.useMemo=function(w,O){return S.H.useMemo(w,O)},Z.useOptimistic=function(w,O){return S.H.useOptimistic(w,O)},Z.useReducer=function(w,O,B){return S.H.useReducer(w,O,B)},Z.useRef=function(w){return S.H.useRef(w)},Z.useState=function(w){return S.H.useState(w)},Z.useSyncExternalStore=function(w,O,B){return S.H.useSyncExternalStore(w,O,B)},Z.useTransition=function(){return S.H.useTransition()},Z.version="19.1.1",Z}var Ar;function Wi(){return Ar||(Ar=1,so.exports=fa()),so.exports}var ao={exports:{}},$e={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sr;function pa(){if(Sr)return $e;Sr=1;var e=Wi();function t(c){var l="https://react.dev/errors/"+c;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)l+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+c+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var o={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");function i(c,l,u){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:d==null?null:""+d,children:c,containerInfo:l,implementation:u}}var s=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(c,l){if(c==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return $e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,$e.createPortal=function(c,l){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(t(299));return i(c,l,null,u)},$e.flushSync=function(c){var l=s.T,u=o.p;try{if(s.T=null,o.p=2,c)return c()}finally{s.T=l,o.p=u,o.d.f()}},$e.preconnect=function(c,l){typeof c=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,o.d.C(c,l))},$e.prefetchDNS=function(c){typeof c=="string"&&o.d.D(c)},$e.preinit=function(c,l){if(typeof c=="string"&&l&&typeof l.as=="string"){var u=l.as,d=a(u,l.crossOrigin),f=typeof l.integrity=="string"?l.integrity:void 0,h=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;u==="style"?o.d.S(c,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:d,integrity:f,fetchPriority:h}):u==="script"&&o.d.X(c,{crossOrigin:d,integrity:f,fetchPriority:h,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},$e.preinitModule=function(c,l){if(typeof c=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var u=a(l.as,l.crossOrigin);o.d.M(c,{crossOrigin:u,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&o.d.M(c)},$e.preload=function(c,l){if(typeof c=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var u=l.as,d=a(u,l.crossOrigin);o.d.L(c,u,{crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},$e.preloadModule=function(c,l){if(typeof c=="string")if(l){var u=a(l.as,l.crossOrigin);o.d.m(c,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:u,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else o.d.m(c)},$e.requestFormReset=function(c){o.d.r(c)},$e.unstable_batchedUpdates=function(c,l){return c(l)},$e.useFormState=function(c,l,u){return s.H.useFormState(c,l,u)},$e.useFormStatus=function(){return s.H.useHostTransitionStatus()},$e.version="19.1.1",$e}var $r;function ha(){if($r)return ao.exports;$r=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),ao.exports=pa(),ao.exports}var _=Wi();const ga=Yi(_),zi=ca({__proto__:null,default:ga},[_]);var or=ha();const dp=Yi(or),ma={namespaces:{tei:"http://www.tei-c.org/ns/1.0",teieg:"http://www.tei-c.org/ns/Examples",rng:"http://relaxng.org/ns/structure/1.0"},tei:{eg:["<pre>","</pre>"],ptr:['<a href="$rw@target">$@target</a>'],ref:[["[target]",['<a href="$rw@target">',"</a>"]]],graphic:function(e){let t=e.ownerDocument.createElement("img");return t.src=this.rw(e.getAttribute("url")),e.hasAttribute("width")&&t.setAttribute("width",e.getAttribute("width")),e.hasAttribute("height")&&t.setAttribute("height",e.getAttribute("height")),t},list:[["[type=gloss]",function(e){const t=e.ownerDocument;let n=t.createElement("dl");for(let o of Array.from(e.children))if(o.nodeType==1){if(o.localName=="tei-label"){let r=t.createElement("dt");r.innerHTML=o.innerHTML,n.appendChild(r)}if(o.localName=="tei-item"){let r=t.createElement("dd");r.innerHTML=o.innerHTML,n.appendChild(r)}}return n}]],note:[["[place=end]",function(e){const t=e.ownerDocument;this.noteIndex?this.noteIndex++:this.noteIndex=1;let n="_note_"+this.noteIndex,o=t.createElement("a");o.setAttribute("id","src"+n),o.setAttribute("href","#"+n),o.innerHTML=this.noteIndex;let r=t.createElement("sup");r.appendChild(o);let i=t.querySelector("ol.notes");i||(i=t.createElement("ol"),i.setAttribute("class","notes"),this.dom.appendChild(i));let s=t.createElement("li");return s.id=n,s.innerHTML=e.innerHTML,i.appendChild(s),r}],["_",["(",")"]]],teiHeader:function(e){this.hideContent(e,!1)},title:[["tei-titlestmt>tei-title",function(e){const t=e.ownerDocument;let n=t.createElement("title");n.innerHTML=e.innerText,t.querySelector("head").appendChild(n)}]]},teieg:{egXML:function(e){const t=e.ownerDocument;let n=t.createElement("pre"),o=t.createElement("code");n.appendChild(o);let r=this.serialize(e,!0).replace(/</g,"&lt;"),i=r.match(/^[\t ]+/);return i&&(r=r.replace(new RegExp("^"+i[0],"mg"),"")),o.innerHTML=r,n}}};function ya(e,t){let n=1,o=e;for(;o&&o.previousElementSibling!==null&&(!t||o.previousElementSibling.localName==t)&&(n++,o=o.previousElementSibling,!!o.previousElementSibling););return n}function Gi(e){const t=e.ownerDocument;let n=o=>{let r;switch(o.nodeType){case 1:r=t.createElement(o.nodeName);break;case 9:r=t.implementation.createDocument();break;case 11:r=t.createDocumentFragment();break;default:r=o.cloneNode(!0)}if(o.attributes)for(let i of Array.from(o.attributes))i.name!=="data-processed"&&r.setAttribute(i.name,i.value);for(let i of Array.from(o.childNodes))if(i.nodeType==1)if(i.hasAttribute("data-original")){for(let s of Array.from(i.childNodes)){let a=r.appendChild(n(s));a.nodeType===1&&a.hasAttribute("data-origid")&&(a.setAttribute("id",a.getAttribute("data-origid")),a.removeAttribute("data-origid"))}return r}else i.hasAttribute("data-origname")&&r.appendChild(n(i));else r.appendChild(i.cloneNode());return r};return n(e)}function Ji(e){return e.replace(/ .*$/,"")}function Zi(e,t=!0){const n=e.ownerDocument;if(e.childNodes.length>0){let o=n.createElement("cetei-original");e.appendChild(o),o.setAttribute("hidden",""),o.setAttribute("data-original",""),o.setAttribute("role","none");for(let r of Array.from(e.childNodes))if(r!==o){if(r.nodeType===1){r.setAttribute("data-processed","");for(let i of r.querySelectorAll("*"))i.setAttribute("data-processed","")}o.appendChild(e.removeChild(r))}if(t)for(let r of Array.from(o.querySelectorAll("*")))r.hasAttribute("id")&&(r.setAttribute("data-origid",r.getAttribute("id")),r.removeAttribute("id"))}}function va(e){return this.rw(this.first(e))}function ba(e,t){let n="";for(let o=0;o<t;o++)n+=e;return n}function wa(e){let t=this.prefixDefs[e.substring(0,e.indexOf(":"))];return e.replace(new RegExp(t.matchPattern),t.replacementPattern)}function xa(e){return this.prefixDefs[e]}function Ea(e){return e.trim().match(/^(?:http|mailto|file|\/|#).*$/)?e:this.base+Ji(e.trim())}function Aa(e,t,n){return In(Gi(e),t,n)}function In(e,t,n){let o="";const r=i=>!/[^\t\n\r ]/.test(i);if((e.nodeType===9||e.nodeType===11)&&(o+=`<?xml version="1.0" encoding="UTF-8"?>
`),!t&&e.nodeType==1){typeof n=="string"&&n!==""?o+=`
`+n+"<":o+="<",o+=e.getAttribute("data-origname");let i=e.hasAttribute("data-origatts")?e.getAttribute("data-origatts").split(" "):[];for(let s of Array.from(e.attributes))!s.name.startsWith("data-")&&!s.name.startsWith("tei-")&&!s.name.startsWith("aria-")&&!["id","lang","class"].includes(s.name)&&(o+=" "+i.find(function(a){return a.toLowerCase()==s.name})+'="'+s.value+'"'),s.name=="data-xmlns"&&(o+=' xmlns="'+s.value+'"'),s.name.startsWith("tei-")&&(o+=" "+i.find(function(a){return a.toLowerCase()==s.name.replace("tei-","")})+'="'+s.value+'"');e.childNodes.length>0?o+=">":o+="/>"}for(let i of Array.from(e.childNodes))switch(i.nodeType){case 1:typeof n=="string"?o+=In(i,!1,n+"  "):o+=In(i,!1,n);break;case 7:o+=`<?${i.nodeName} ${i.nodeValue}?>`,(e.nodeType===9||e.nodeType===11)&&(o+=`
`);break;case 8:o+=`<!--${i.nodeValue}-->`,(e.nodeType===9||e.nodeType===11)&&(o+=`
`);break;default:if(t&&r(i.nodeValue)&&(o+=i.nodeValue.replace(/^\s*\n/,"")),typeof n=="string"&&r(i.nodeValue))break;o+=i.nodeValue}return!t&&e.nodeType==1&&e.childNodes.length>0&&(typeof n=="string"?o+=`
`+n+"</":o+="</",o+=e.getAttribute("data-origname")+">"),(e.nodeType===9||e.nodeType===11)&&(o+=`
`),o}function Vo(e,t,n){const o=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];let r="";const i=s=>!/[^\t\n\r ]/.test(s);if(!t&&e.nodeType==1){typeof n=="string"&&n!==""?r+=`
`+n+"<":r+="<",r+=e.nodeName;for(let s of Array.from(e.attributes))r+=" "+s.name+'="'+s.value+'"';r+=">"}for(let s of Array.from(e.childNodes))switch(s.nodeType){case 1:typeof n=="string"?r+=Vo(s,!1,n+"  "):r+=Vo(s,!1,n);break;case 7:r+=`<?${s.nodeName} ${s.nodeValue}?>`,(e.nodeType===9||e.nodeType===11)&&(r+=`
`);break;case 8:r+=`<!--${s.nodeValue}-->`,(e.nodeType===9||e.nodeType===11)&&(r+=`
`);break;default:if(t&&i(s.nodeValue)&&(r+=s.nodeValue.replace(/^\s*\n/,"")),typeof n=="string"&&i(s.nodeValue))break;r+=s.nodeValue.replace(/</g,"&lt;")}return o.includes(e.nodeName)||!t&&e.nodeType==1&&(typeof n=="string"?r+=`
${n}</`:r+="</",r+=`${e.nodeName}>`),(e.nodeType===9||e.nodeType===11)&&(r+=`
`),r}function Sa(e){return e.replace(/&gt;/,">").replace(/&quot;/,'"').replace(/&apos;/,"'").replace(/&amp;/,"&")}function Dn(e){return e.includes(":"),e.replace(/:/,"-").toLowerCase()}function Qi(e,t=null,n=!1){try{window.customElements.define(Dn(e),class extends HTMLElement{constructor(){super(),this.matches(":defined")||t&&(t.call(this),this.setAttribute("data-processed",""))}connectedCallback(){this.hasAttribute("data-processed")||t&&(t.call(this),this.setAttribute("data-processed",""))}})}catch(o){n&&(console.log(Dn(e)+" couldn't be registered or is already registered."),console.log(o))}}const lo=Object.freeze(Object.defineProperty({__proto__:null,copyAndReset:Gi,defineCustomElement:Qi,first:Ji,getOrdinality:ya,getPrefixDef:xa,hideContent:Zi,normalizeURI:va,repeat:ba,resetAndSerialize:Aa,resolveURI:wa,rw:Ea,serialize:In,serializeHTML:Vo,tagName:Dn,unEscapeEntities:Sa},Symbol.toStringTag,{value:"Module"}));function $a(e){if(e.namespaces)for(let t of Object.keys(e.namespaces))!this.namespaces.has(e.namespaces[t])&&!Array.from(this.namespaces.values()).includes(t)&&this.namespaces.set(e.namespaces[t],t);for(let t of this.namespaces.values())if(e[t])for(let n of Object.keys(e[t]))this.behaviors[`${t}:${n}`]=e[t][n];if(e.functions)for(let t of Object.keys(e.functions))this.utilities[t]=e.functions[t].bind(this.utilities);e.handlers&&console.log("Behavior handlers are no longer used."),e.fallbacks&&console.log("Fallback behaviors are no longer used.")}function Ta(e,t,n){let o;if(e===Object(e))for(let r of Object.keys(e))this.namespaces.has(e[r])||(this.namespaces.set(e[r],r),o=r);else o=e;this.behaviors[`${o}:${t}`]=n}function Ra(e,t){let n;if(e===Object(e))for(let o of Object.keys(e))this.namespaces.has(e[o])||(this.namespaces.set(e[o],o),n=o);else n=e;delete this.behaviors[`${n}:${t}`]}function Ca(e,t){const n=e.documentElement;let o=1,r=function(s){return t.has(s.namespaceURI?s.namespaceURI:"")||t.set(s.namespaceURI,"ns"+o++),t.get(s.namespaceURI?s.namespaceURI:"")+":"+s.localName};const i=new Set(Array.from(n.querySelectorAll("*"),r));return i.add(r(n)),i}function Oa(e){return new Set(Array.from(e.querySelectorAll("*[data-origname]"),t=>t.localName.replace(/(\w+)-.+/,"$1:")+t.getAttribute("data-origname")))}class on{constructor(t){this.options=t||{},this.document=this.options.documentObject?this.options.documentObject:void 0,this.document===void 0&&(typeof window<"u"&&window.document?this.document=window.document:typeof global<"u"&&global.document&&(this.document=global.document)),this.addBehaviors=$a.bind(this),this.addBehavior=Ta.bind(this),this.removeBehavior=Ra.bind(this),this.utilities={};for(const n of Object.keys(lo))["getPrefixDef","rw","resolveURI"].includes(n)?this.utilities[n]=lo[n].bind(this):this.utilities[n]=lo[n];if(this.els=[],this.namespaces=new Map,this.behaviors={},this.hasStyle=!1,this.prefixDefs=[],this.debug=this.options.debug===!0,this.discardContent=this.options.discardContent===!0,this.options.base)this.base=this.options.base;else try{window&&(this.base=window.location.href.replace(/\/[^\/]*$/,"/"))}catch{this.base=""}this.options.omitDefaultBehaviors||this.addBehaviors(ma),this.options.ignoreFragmentId&&window&&window.removeEventListener("ceteiceanload",on.restorePosition)}async getHTML5(t,n,o){window&&window.location.href.startsWith(this.base)&&t.indexOf("/")>=0&&(this.base=t.replace(/\/[^\/]*$/,"/"));try{const r=await fetch(t);if(r.ok){const i=await r.text();return this.makeHTML5(i,n,o)}else console.log(`Could not get XML file ${t}.
Server returned ${r.status}: ${r.statusText}`)}catch(r){console.log(r)}}makeHTML5(t,n,o){return this.XML_dom=new DOMParser().parseFromString(t,"text/xml"),this.domToHTML5(this.XML_dom,n,o)}preprocess(t,n,o){this.els=Ca(t,this.namespaces);let r=i=>{let s;if(this.namespaces.has(i.namespaceURI?i.namespaceURI:"")){let a=this.namespaces.get(i.namespaceURI?i.namespaceURI:"");s=this.document.createElement(`${a}-${i.localName.toLowerCase()}`)}else s=this.document.importNode(i,!1);for(let a of Array.from(i.attributes))a.name=="xmlns"?s.setAttribute("data-xmlns",a.value):["role"].includes(a.name)||s.setAttribute(a.name,a.value),a.name=="xml:id"&&s.setAttribute("id",a.value),a.name=="xml:lang"&&s.setAttribute("lang",a.value),a.name=="rendition"&&s.setAttribute("class",a.value.replace(/#/g,"")),a.name=="role"&&s.setAttribute("tei-role",a.value);if(s.setAttribute("data-origname",i.localName),i.hasAttributes()&&s.setAttribute("data-origatts",i.getAttributeNames().join(" ")),i.childNodes.length==0&&s.setAttribute("data-empty",""),i.localName=="head"&&i.namespaceURI=="http://www.tei-c.org/ns/1.0"){let a=function(c){let l=0,u=c.parentElement;for(;u;){let d=u.children,f=0;for(;f<d.length;){if(d[f].tagName.toLowerCase()==="head"&&d[f].namespaceURI==="http://www.tei-c.org/ns/1.0"){l++;break}f++}u=u.parentElement}return l};s.setAttribute("data-level",a(i))}if(i.localName=="tagsDecl"){let a=this.document.createElement("style");for(let c of Array.from(i.childNodes))if(c.nodeType==1&&c.localName=="rendition"&&c.getAttribute("scheme")=="css"){let l="";c.hasAttribute("selector")?(l+=c.getAttribute("selector").replace(/([^#, >]+\w*)/g,"tei-$1").replace(/#tei-/g,"#")+`{
`,l+=c.textContent):(l+="."+c.getAttribute("xml:id")+`{
`,l+=c.textContent),l+=`
}
`,a.appendChild(this.document.createTextNode(l))}a.childNodes.length>0&&(s.appendChild(a),this.hasStyle=!0)}i.localName=="prefixDef"&&(this.prefixDefs.push(i.getAttribute("ident")),this.prefixDefs[i.getAttribute("ident")]={matchPattern:i.getAttribute("matchPattern"),replacementPattern:i.getAttribute("replacementPattern")}),i.localName=="TEI"&&s.setAttribute("role","main"),["body","front","back","div"].includes(i.localName)&&(s.setAttribute("role","region"),s.setAttribute("aria-label",i.getAttribute("xml:id")||i.getAttribute("n")||i.localName));for(let a of Array.from(i.childNodes))a.nodeType==1?s.appendChild(r(a)):s.appendChild(a.cloneNode());return o&&o(s,i),s};this.dom=this.document.createDocumentFragment();for(let i of Array.from(t.childNodes))i.nodeType==1&&this.dom.appendChild(r(i)),i.nodeType==7&&this.dom.appendChild(this.document.importNode(i,!0)),i.nodeType==8&&this.dom.appendChild(this.document.importNode(i,!0));if(this.utilities.dom=this.dom.firstElementChild,n)n(this.dom,this),window&&window.dispatchEvent(Wt);else return typeof window<"u"&&window.dispatchEvent(Wt),this.dom}domToHTML5(t,n,o){if(this.preprocess(t,null,o),this.applyBehaviors(),this.done=!0,n)n(this.dom,this),window&&window.dispatchEvent(Wt);else return typeof window<"u"&&window.dispatchEvent(Wt),this.dom}processPage(){this.els=Oa(this.document),this.applyBehaviors(),window&&window.dispatchEvent(Wt)}unsetNamespace(t){this.namespaces.delete(t)}setBaseUrl(t){this.base=t}append(t,n){let o=this;if(n&&!n.hasAttribute("data-processed")){let r=t.call(o.utilities,n);r&&o.appendBasic(n,r)}else return function(){if(!this.hasAttribute("data-processed")){let r=t.call(o.utilities,this);r&&o.appendBasic(this,r)}}}appendBasic(t,n){this.discardContent?t.innerHTML="":Zi(t,!0),t.appendChild(n)}bName(t){return t.tagName.substring(0,t.tagName.indexOf("-")).toLowerCase()+":"+t.getAttribute("data-origname")}childExists(t,n){return t&&t.nodeName==n?!0:t&&t.nextElementSibling&&this.childExists(t.nextElementSibling,n)}decorator(t){if(Array.isArray(t)&&t.length==0)return function(o){};if(Array.isArray(t)&&!Array.isArray(t[0]))return this.applyDecorator(t);let n=this;return function(o){for(let r of t)if(o.matches(r[0])||r[0]==="_")return Array.isArray(r[1])?n.decorator(r[1]).call(this,o):r[1].call(this,o)}}applyDecorator(t){let n=this;return function(o){let r=[];for(let i=0;i<t.length;i++)r.push(n.template(t[i],o));return n.insert(o,r)}}getFallback(t,n){if(t[n])return t[n]instanceof Function?t[n]:this.decorator(t[n])}getHandler(t,n){if(t[n])return t[n]instanceof Function?this.append(t[n]):this.append(this.decorator(t[n]))}insert(t,n){let o=this.document.createElement("cetei-content");for(let r of Array.from(t.childNodes))r.nodeType===1&&!r.hasAttribute("data-processed")&&this.processElement(r);if(n[0].match("<[^>]+>")&&n[1]&&n[1].match("<[^>]+>"))o.innerHTML=n[0]+t.innerHTML+(n[1]?n[1]:"");else{o.innerHTML=n[0],o.setAttribute("data-before",n[0].replace(/<[^>]+>/g,"").length);for(let r of Array.from(t.childNodes))o.appendChild(r.cloneNode(!0));n.length>1&&(o.innerHTML+=n[1],o.setAttribute("data-after",n[1].replace(/<[^>]+>/g,"").length))}return o.childNodes.length<2?o.firstChild:o}processElement(t){if(t.hasAttribute("data-origname")&&!t.hasAttribute("data-processed")){let n=this.getFallback(this.bName(t));n&&(this.append(n,t),t.setAttribute("data-processed",""))}for(let n of Array.from(t.childNodes))n.nodeType===1&&this.processElement(n)}template(t,n){let o=t;if(t.search(/\$(\w*)(@([a-zA-Z:]+))/)){let r=/\$(\w*)@([a-zA-Z:]+)/g,i;for(;i=r.exec(t);)n.hasAttribute(i[2])?i[1]&&this.utilities[i[1]]?o=o.replace(i[0],this.utilities[i[1]](n.getAttribute(i[2]))):o=o.replace(i[0],n.getAttribute(i[2])):o=o.replace(i[0],"")}return o}applyBehaviors(){typeof window<"u"&&window.customElements?this.define.call(this,this.els):this.fallback.call(this,this.els)}define(t){for(let n of t){const o=this.getHandler(this.behaviors,n);Qi(n,o,this.debug)}}fallback(t){for(let n of t){let o=this.getFallback(this.behaviors,n);if(o)for(let r of Array.from((this.dom&&!this.done?this.dom:this.document).querySelectorAll(Dn(n))))r.hasAttribute("data-processed")||(this.append(o,r),r.setAttribute("data-processed",""))}}static savePosition(){window.sessionStorage.setItem(window.location+"-scroll",window.scrollY)}static restorePosition(){if(window.location.hash)setTimeout(function(){let t=this.document.querySelector(window.decodeURI(window.location.hash));t&&t.scrollIntoView()},100);else{let t;(t=window.sessionStorage.getItem(window.location+"-scroll"))&&(window.sessionStorage.removeItem(window.location+"-scroll"),setTimeout(function(){window.scrollTo(0,t)},100))}}}try{if(typeof window<"u"){window.CETEI=on,window.addEventListener("beforeunload",on.savePosition);var Wt=new Event("ceteiceanload");window.addEventListener("ceteiceanload",on.restorePosition)}}catch(e){console.log(e)}const zn=_.createContext({anno:void 0,setAnno:void 0,annotations:[],selection:{selected:[]}}),La=(e,t)=>{const{event:n,...o}=e,{event:r,...i}=t;return JSON.stringify(o)!==JSON.stringify(i)?!1:(n==null?void 0:n.timeStamp)===(r==null?void 0:r.timeStamp)};_.forwardRef((e,t)=>{const[n,o]=_.useState(null),[r,i]=_.useState([]),[s,a]=_.useState({selected:[],previous:[]}),c=_.useRef([]);return _.useImperativeHandle(t,()=>n),_.useEffect(()=>{if(n){const{selection:l,store:u}=n.state;u.all().length>0&&i(u.all());const d=()=>i(()=>u.all());u.observe(d);let f;const h=l.subscribe(({selected:m,...p})=>{f&&u.unobserve(f);const E=(m||[]).map(({id:v,editable:g})=>({annotation:u.getAnnotation(v),editable:g}));a(v=>{const g={selected:E,previous:v.selected,...p};return La(v,g)?v:(c.current=v.selected,g)}),f=v=>{const{updated:g}=v.changes;a(y=>({...y,selected:y.selected.map(({annotation:$,editable:S})=>{const I=g.find(P=>P.oldValue.id===$.id);return I?{annotation:I.newValue,editable:S}:{annotation:$,editable:S}})}))},u.observe(f,{annotations:m.map(({id:v})=>v)})});return()=>{u.unobserve(d),h()}}},[n]),de.jsx(zn.Provider,{value:{anno:n,setAnno:o,annotations:r,selection:s},children:e.children})});const es=()=>{const{anno:e}=_.useContext(zn);return e},ka=()=>{const e=es();return e==null?void 0:e.state.store},Ma=()=>{const{selection:e}=_.useContext(zn);return e};var _a=Object.defineProperty,Pa=(e,t,n)=>t in e?_a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Tr=(e,t,n)=>Pa(e,typeof t!="symbol"?t+"":t,n);function bt(){}function Fo(e,t){for(const n in t)e[n]=t[n];return e}function ts(e){return e()}function Rr(){return Object.create(null)}function He(e){e.forEach(ts)}function me(e){return typeof e=="function"}function Ht(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Na(e){return Object.keys(e).length===0}function Ia(e,t,n,o){if(e){const r=ns(e,t,n,o);return e[0](r)}}function ns(e,t,n,o){return e[1]&&o?Fo(n.ctx.slice(),e[1](o(t))):n.ctx}function Da(e,t,n,o){if(e[2]&&o){const r=e[2](o(n));if(t.dirty===void 0)return r;if(typeof r=="object"){const i=[],s=Math.max(t.dirty.length,r.length);for(let a=0;a<s;a+=1)i[a]=t.dirty[a]|r[a];return i}return t.dirty|r}return t.dirty}function Ba(e,t,n,o,r,i){if(r){const s=ns(t,n,o,i);e.p(s,r)}}function ja(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let o=0;o<n;o++)t[o]=-1;return t}return-1}function Cr(e){const t={};for(const n in e)n[0]!=="$"&&(t[n]=e[n]);return t}function Or(e){return e??""}function ue(e,t){e.appendChild(t)}function Q(e,t,n){e.insertBefore(t,n||null)}function J(e){e.parentNode&&e.parentNode.removeChild(e)}function Gn(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function z(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function os(e){return document.createTextNode(e)}function Re(){return os(" ")}function bn(){return os("")}function oe(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function b(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Ha(e){return Array.from(e.childNodes)}function Lr(e,t,n){e.classList.toggle(t,!!n)}function Ua(e,t,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:o})}let un;function rn(e){un=e}function rs(){if(!un)throw new Error("Function called outside component initialization");return un}function is(e){rs().$$.on_mount.push(e)}function rr(){const e=rs();return(t,n,{cancelable:o=!1}={})=>{const r=e.$$.callbacks[t];if(r){const i=Ua(t,n,{cancelable:o});return r.slice().forEach(s=>{s.call(e,i)}),!i.defaultPrevented}return!0}}function ye(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(o=>o.call(this,t))}const Rt=[],kr=[];let kt=[];const Mr=[],ss=Promise.resolve();let Xo=!1;function as(){Xo||(Xo=!0,ss.then(cs))}function ls(){return as(),ss}function Ko(e){kt.push(e)}const co=new Set;let Et=0;function cs(){if(Et!==0)return;const e=un;do{try{for(;Et<Rt.length;){const t=Rt[Et];Et++,rn(t),Va(t.$$)}}catch(t){throw Rt.length=0,Et=0,t}for(rn(null),Rt.length=0,Et=0;kr.length;)kr.pop()();for(let t=0;t<kt.length;t+=1){const n=kt[t];co.has(n)||(co.add(n),n())}kt.length=0}while(Rt.length);for(;Mr.length;)Mr.pop()();Xo=!1,co.clear(),rn(e)}function Va(e){if(e.fragment!==null){e.update(),He(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ko)}}function Fa(e){const t=[],n=[];kt.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),kt=t}const Pn=new Set;let vt;function Nt(){vt={r:0,c:[],p:vt}}function It(){vt.r||He(vt.c),vt=vt.p}function re(e,t){e&&e.i&&(Pn.delete(e),e.i(t))}function fe(e,t,n,o){if(e&&e.o){if(Pn.has(e))return;Pn.add(e),vt.c.push(()=>{Pn.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function ht(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Xe(e){e&&e.c()}function Ie(e,t,n){const{fragment:o,after_update:r}=e.$$;o&&o.m(t,n),Ko(()=>{const i=e.$$.on_mount.map(ts).filter(me);e.$$.on_destroy?e.$$.on_destroy.push(...i):He(i),e.$$.on_mount=[]}),r.forEach(Ko)}function De(e,t){const n=e.$$;n.fragment!==null&&(Fa(n.after_update),He(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Xa(e,t){e.$$.dirty[0]===-1&&(Rt.push(e),as(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ut(e,t,n,o,r,i,s=null,a=[-1]){const c=un;rn(e);const l=e.$$={fragment:null,ctx:[],props:i,update:bt,not_equal:r,bound:Rr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:Rr(),dirty:a,skip_bound:!1,root:t.target||c.$$.root};s&&s(l.root);let u=!1;if(l.ctx=n?n(e,t.props||{},(d,f,...h)=>{const m=h.length?h[0]:f;return l.ctx&&r(l.ctx[d],l.ctx[d]=m)&&(!l.skip_bound&&l.bound[d]&&l.bound[d](m),u&&Xa(e,d)),f}):[],l.update(),u=!0,He(l.before_update),l.fragment=o?o(l.ctx):!1,t.target){if(t.hydrate){const d=Ha(t.target);l.fragment&&l.fragment.l(d),d.forEach(J)}else l.fragment&&l.fragment.c();t.intro&&re(e.$$.fragment),Ie(e,t.target,t.anchor),cs()}rn(c)}let Vt=class{constructor(){Tr(this,"$$"),Tr(this,"$$set")}$destroy(){De(this,1),this.$destroy=bt}$on(t,n){if(!me(n))return bt;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(t){this.$$set&&!Na(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};const Ka="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ka);var ze=(e=>(e.ELLIPSE="ELLIPSE",e.MULTIPOLYGON="MULTIPOLYGON",e.POLYGON="POLYGON",e.POLYLINE="POLYLINE",e.RECTANGLE="RECTANGLE",e.LINE="LINE",e))(ze||{}),qa={exports:{}};(function(e){(function(){function t(a,c){var l=a.x-c.x,u=a.y-c.y;return l*l+u*u}function n(a,c,l){var u=c.x,d=c.y,f=l.x-u,h=l.y-d;if(f!==0||h!==0){var m=((a.x-u)*f+(a.y-d)*h)/(f*f+h*h);m>1?(u=l.x,d=l.y):m>0&&(u+=f*m,d+=h*m)}return f=a.x-u,h=a.y-d,f*f+h*h}function o(a,c){for(var l=a[0],u=[l],d,f=1,h=a.length;f<h;f++)d=a[f],t(d,l)>c&&(u.push(d),l=d);return l!==d&&u.push(d),u}function r(a,c,l,u,d){for(var f=u,h,m=c+1;m<l;m++){var p=n(a[m],a[c],a[l]);p>f&&(h=m,f=p)}f>u&&(h-c>1&&r(a,c,h,u,d),d.push(a[h]),l-h>1&&r(a,h,l,u,d))}function i(a,c){var l=a.length-1,u=[a[0]];return r(a,0,l,c,u),u.push(a[l]),u}function s(a,c,l){if(a.length<=2)return a;var u=c!==void 0?c*c:1;return a=l?a:o(a,u),a=i(a,u),a}e.exports=s,e.exports.default=s})()})(qa);const Ft=(e,t)=>t,ct=e=>{let t=1/0,n=1/0,o=-1/0,r=-1/0;return e.forEach(([i,s])=>{t=Math.min(t,i),n=Math.min(n,s),o=Math.max(o,i),r=Math.max(r,s)}),{minX:t,minY:n,maxX:o,maxY:r}},Bn=e=>{let t=0,n=e.length-1;for(let o=0;o<e.length;o++)t+=(e[n][0]+e[o][0])*(e[n][1]-e[o][1]),n=o;return Math.abs(.5*t)},jn=(e,t,n)=>{let o=!1;for(let r=0,i=e.length-1;r<e.length;i=r++){const s=e[r][0],a=e[r][1],c=e[i][0],l=e[i][1];a>n!=l>n&&t<(c-s)*(n-a)/(l-a)+s&&(o=!o)}return o},Ya=(e,t=!0)=>{let n="M ";return e.forEach(([o,r],i)=>{i===0?n+=`${o},${r}`:n+=` L ${o},${r}`}),t&&(n+=" Z"),n},Wa=(e,t)=>{const n=Math.abs(t[0]-e[0]),o=Math.abs(t[1]-e[1]);return Math.sqrt(Math.pow(n,2)+Math.pow(o,2))},za={area:e=>Math.PI*e.geometry.rx*e.geometry.ry,intersects:(e,t,n)=>{const{cx:o,cy:r,rx:i,ry:s}=e.geometry,a=0,c=Math.cos(a),l=Math.sin(a),u=t-o,d=n-r,f=c*u+l*d,h=l*u-c*d;return f*f/(i*i)+h*h/(s*s)<=1}};Ft(ze.ELLIPSE,za);const Ga={area:e=>0,intersects:(e,t,n,o=2)=>{const[[r,i],[s,a]]=e.geometry.points,c=Math.abs((a-i)*t-(s-r)*n+s*i-a*r),l=Wa([r,i],[s,a]);return c/l<=o}};Ft(ze.LINE,Ga);const Ja={area:e=>{const{polygons:t}=e.geometry;return t.reduce((n,o)=>{const[r,...i]=o.rings,s=Bn(r.points),a=i.reduce((c,l)=>c+Bn(l.points),0);return n+s-a},0)},intersects:(e,t,n)=>{const{polygons:o}=e.geometry;for(const r of o){const[i,...s]=r.rings;if(jn(i.points,t,n)){let a=!1;for(const c of s)if(jn(c.points,t,n)){a=!0;break}if(!a)return!0}}return!1}},uo=e=>{const t=e.reduce((n,o)=>[...n,...o.rings[0].points],[]);return ct(t)},At=e=>e.rings.map(t=>Ya(t.points)).join(" "),Za=e=>e.polygons.reduce((t,n)=>[...t,...n.rings.reduce((o,r)=>[...o,...r.points],[])],[]);Ft(ze.MULTIPOLYGON,Ja);const Qa={area:e=>{const t=e.geometry.points;return Bn(t)},intersects:(e,t,n)=>{const o=e.geometry.points;return jn(o,t,n)}};Ft(ze.POLYGON,Qa);const el={area:e=>{const t=e.geometry;if(!t.closed||t.points.length<3)return 0;const n=_r(t.points,t.closed);return Bn(n)},intersects:(e,t,n,o=2)=>{const r=e.geometry;if(r.closed){const i=_r(r.points,r.closed);return jn(i,t,n)}else return tl(r,[t,n],o)}},_r=(e,t=!1)=>{const n=[];for(let o=0;o<e.length;o++){const r=e[o],i=e[(o+1)%e.length];if(n.push(r.point),(o<e.length-1||t)&&(r.type==="CURVE"||i.type=="CURVE")){const s=us(r.point,r.type==="CURVE"&&r.outHandle||r.point,i.type==="CURVE"&&i.inHandle||i.point,i.point,10);n.push(...s.slice(1))}}return n},us=(e,t,n,o,r=10)=>{const i=[];for(let s=0;s<=r;s++){const a=s/r,c=Math.pow(1-a,3)*e[0]+3*Math.pow(1-a,2)*a*t[0]+3*(1-a)*Math.pow(a,2)*n[0]+Math.pow(a,3)*o[0],l=Math.pow(1-a,3)*e[1]+3*Math.pow(1-a,2)*a*t[1]+3*(1-a)*Math.pow(a,2)*n[1]+Math.pow(a,3)*o[1];i.push([c,l])}return i},tl=(e,t,n)=>{for(let o=0;o<e.points.length-1;o++){const r=e.points[o],i=e.points[o+1];if(r.type==="CURVE"||i.type==="CURVE"){const s=us(r.point,r.type==="CURVE"&&r.outHandle||r.point,i.type==="CURVE"&&i.inHandle||i.point,i.point,20);for(let a=0;a<s.length-1;a++)if(Pr(t,s[a],s[a+1])<=n)return!0}else if(Pr(t,r.point,i.point)<=n)return!0}return!1},Pr=(e,t,n)=>{const[o,r]=e,[i,s]=t,[a,c]=n,l=a-i,u=c-s,d=Math.sqrt(l*l+u*u);if(d===0)return Math.sqrt((o-i)*(o-i)+(r-s)*(r-s));const f=((o-i)*l+(r-s)*u)/(d*d);return f<=0?Math.sqrt((o-i)*(o-i)+(r-s)*(r-s)):f>=1?Math.sqrt((o-a)*(o-a)+(r-c)*(r-c)):Math.abs((c-s)*o-(a-i)*r+a*s-c*i)/d};Ft(ze.POLYLINE,el);const nl={area:e=>e.geometry.w*e.geometry.h,intersects:(e,t,n)=>t>=e.geometry.x&&t<=e.geometry.x+e.geometry.w&&n>=e.geometry.y&&n<=e.geometry.y+e.geometry.h};Ft(ze.RECTANGLE,nl);const ol=[];for(let e=0;e<256;++e)ol.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const rl=[];for(let e=0;e<256;++e)rl.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const il="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let sl=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=il[n[e]&63];return t};sl();const ir=(e,t=0)=>{const{minX:n,minY:o,maxX:r,maxY:i}=e;return{x:n-t,y:o-t,w:r-n+2*t,h:i-o+2*t}},ft=typeof window>"u"||typeof navigator>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,al=e=>({}),Nr=e=>({grab:e[0]});function ll(e){let t,n,o,r;const i=e[8].default,s=Ia(i,e,e[7],Nr);return{c(){t=z("g"),s&&s.c(),b(t,"class","a9s-annotation selected")},m(a,c){Q(a,t,c),s&&s.m(t,null),n=!0,o||(r=[oe(t,"pointerup",e[2]),oe(t,"pointermove",e[1])],o=!0)},p(a,[c]){s&&s.p&&(!n||c&128)&&Ba(s,i,a,a[7],n?Da(i,a[7],c,al):ja(a[7]),Nr)},i(a){n||(re(s,a),n=!0)},o(a){fe(s,a),n=!1},d(a){a&&J(t),s&&s.d(a),o=!1,He(r)}}}function cl(e,t,n){let{$$slots:o={},$$scope:r}=t;const i=rr();let{shape:s}=t,{editor:a}=t,{transform:c}=t,{svgEl:l}=t,u,d,f;const h=E=>v=>{if(u=E,l){const{left:g,top:y}=l.getBoundingClientRect(),$=v.clientX-g,S=v.clientY-y;d=c.elementToImage($,S)}else{const{offsetX:g,offsetY:y}=v;d=c.elementToImage(g,y)}f=s,v.target.setPointerCapture(v.pointerId),i("grab",v)},m=E=>{if(u){const[v,g]=c.elementToImage(E.offsetX,E.offsetY),y=[v-d[0],g-d[1]];n(3,s=a(f,u,y)),i("change",s)}},p=E=>{E.target.releasePointerCapture(E.pointerId),u=void 0,f=s,i("release",E)};return e.$$set=E=>{"shape"in E&&n(3,s=E.shape),"editor"in E&&n(4,a=E.editor),"transform"in E&&n(5,c=E.transform),"svgEl"in E&&n(6,l=E.svgEl),"$$scope"in E&&n(7,r=E.$$scope)},[h,m,p,s,a,c,l,r,o]}class sr extends Vt{constructor(t){super(),Ut(this,t,cl,ll,Ht,{shape:3,editor:4,transform:5,svgEl:6})}}function ul(e){let t,n,o,r,i,s,a,c,l=e[3]&&Ir(e);return{c(){t=z("g"),n=z("circle"),l&&l.c(),r=z("circle"),b(n,"class","a9s-handle-buffer svelte-qtyc7s"),b(n,"cx",e[0]),b(n,"cy",e[1]),b(n,"r",o=e[5]+6/e[2]),b(n,"role","button"),b(n,"tabindex","0"),b(r,"class",i=Or(`a9s-handle-dot${e[3]?" selected":""}`)+" svelte-qtyc7s"),b(r,"cx",e[0]),b(r,"cy",e[1]),b(r,"r",e[5]),b(t,"class",s=`a9s-handle ${e[8].class||""}`.trim())},m(u,d){Q(u,t,d),ue(t,n),l&&l.m(t,null),ue(t,r),a||(c=[oe(n,"dblclick",e[12]),oe(n,"pointerenter",e[13]),oe(n,"pointerleave",e[14]),oe(n,"pointerdown",e[15]),oe(n,"pointerdown",e[6]),oe(n,"pointerup",e[16]),oe(n,"pointerup",e[7])],a=!0)},p(u,d){d&1&&b(n,"cx",u[0]),d&2&&b(n,"cy",u[1]),d&36&&o!==(o=u[5]+6/u[2])&&b(n,"r",o),u[3]?l?l.p(u,d):(l=Ir(u),l.c(),l.m(t,r)):l&&(l.d(1),l=null),d&8&&i!==(i=Or(`a9s-handle-dot${u[3]?" selected":""}`)+" svelte-qtyc7s")&&b(r,"class",i),d&1&&b(r,"cx",u[0]),d&2&&b(r,"cy",u[1]),d&32&&b(r,"r",u[5]),d&256&&s!==(s=`a9s-handle ${u[8].class||""}`.trim())&&b(t,"class",s)},d(u){u&&J(t),l&&l.d(),a=!1,He(c)}}}function dl(e){let t,n,o,r,i,s,a,c,l;return{c(){t=z("g"),n=z("circle"),r=z("circle"),s=z("circle"),b(n,"cx",e[0]),b(n,"cy",e[1]),b(n,"r",o=e[5]*10),b(n,"class","a9s-touch-halo"),Lr(n,"touched",e[4]),b(r,"cx",e[0]),b(r,"cy",e[1]),b(r,"r",i=e[5]+10/e[2]),b(r,"class","a9s-handle-buffer svelte-qtyc7s"),b(r,"role","button"),b(r,"tabindex","0"),b(s,"class","a9s-handle-dot"),b(s,"cx",e[0]),b(s,"cy",e[1]),b(s,"r",a=e[5]+2/e[2]),b(t,"class","a9s-touch-handle")},m(u,d){Q(u,t,d),ue(t,n),ue(t,r),ue(t,s),c||(l=[oe(r,"dblclick",e[9]),oe(r,"pointerdown",e[10]),oe(r,"pointerdown",e[6]),oe(r,"pointerup",e[11]),oe(r,"pointerup",e[7])],c=!0)},p(u,d){d&1&&b(n,"cx",u[0]),d&2&&b(n,"cy",u[1]),d&32&&o!==(o=u[5]*10)&&b(n,"r",o),d&16&&Lr(n,"touched",u[4]),d&1&&b(r,"cx",u[0]),d&2&&b(r,"cy",u[1]),d&36&&i!==(i=u[5]+10/u[2])&&b(r,"r",i),d&1&&b(s,"cx",u[0]),d&2&&b(s,"cy",u[1]),d&36&&a!==(a=u[5]+2/u[2])&&b(s,"r",a)},d(u){u&&J(t),c=!1,He(l)}}}function Ir(e){let t,n;return{c(){t=z("circle"),b(t,"class","a9s-handle-selected"),b(t,"cx",e[0]),b(t,"cy",e[1]),b(t,"r",n=e[5]+8/e[2])},m(o,r){Q(o,t,r)},p(o,r){r&1&&b(t,"cx",o[0]),r&2&&b(t,"cy",o[1]),r&36&&n!==(n=o[5]+8/o[2])&&b(t,"r",n)},d(o){o&&J(t)}}}function fl(e){let t;function n(r,i){return ft?dl:ul}let o=n()(e);return{c(){o.c(),t=bn()},m(r,i){o.m(r,i),Q(r,t,i)},p(r,[i]){o.p(r,i)},i:bt,o:bt,d(r){r&&J(t),o.d(r)}}}function pl(e,t,n){let o,{x:r}=t,{y:i}=t,{scale:s}=t,{selected:a=void 0}=t,c=!1;const l=y=>{y.pointerType==="touch"&&n(4,c=!0)},u=()=>n(4,c=!1);function d(y){ye.call(this,e,y)}function f(y){ye.call(this,e,y)}function h(y){ye.call(this,e,y)}function m(y){ye.call(this,e,y)}function p(y){ye.call(this,e,y)}function E(y){ye.call(this,e,y)}function v(y){ye.call(this,e,y)}function g(y){ye.call(this,e,y)}return e.$$set=y=>{n(8,t=Fo(Fo({},t),Cr(y))),"x"in y&&n(0,r=y.x),"y"in y&&n(1,i=y.y),"scale"in y&&n(2,s=y.scale),"selected"in y&&n(3,a=y.selected)},e.$$.update=()=>{e.$$.dirty&4&&n(5,o=4/s)},t=Cr(t),[r,i,s,a,c,o,l,u,t,d,f,h,m,p,E,v,g]}class Lt extends Vt{constructor(t){super(),Ut(this,t,pl,fl,Ht,{x:0,y:1,scale:2,selected:3})}}function hl(e){let t,n,o,r,i,s,a;return{c(){t=z("g"),n=z("circle"),r=z("circle"),i=z("circle"),b(n,"class","a9s-polygon-midpoint-buffer svelte-12ykj76"),b(n,"cx",e[0]),b(n,"cy",e[1]),b(n,"r",o=1.75*e[2]),b(r,"class","a9s-polygon-midpoint-outer svelte-12ykj76"),b(r,"cx",e[0]),b(r,"cy",e[1]),b(r,"r",e[2]),b(i,"class","a9s-polygon-midpoint-inner svelte-12ykj76"),b(i,"cx",e[0]),b(i,"cy",e[1]),b(i,"r",e[2]),b(t,"class","a9s-polygon-midpoint svelte-12ykj76")},m(c,l){Q(c,t,l),ue(t,n),ue(t,r),ue(t,i),s||(a=[oe(n,"pointerdown",e[5]),oe(n,"pointerdown",e[3])],s=!0)},p(c,l){l&1&&b(n,"cx",c[0]),l&2&&b(n,"cy",c[1]),l&4&&o!==(o=1.75*c[2])&&b(n,"r",o),l&1&&b(r,"cx",c[0]),l&2&&b(r,"cy",c[1]),l&4&&b(r,"r",c[2]),l&1&&b(i,"cx",c[0]),l&2&&b(i,"cy",c[1]),l&4&&b(i,"r",c[2])},d(c){c&&J(t),s=!1,He(a)}}}function gl(e){let t;return{c(){t=z("circle"),b(t,"cx",e[0]),b(t,"cy",e[1]),b(t,"r",e[2])},m(n,o){Q(n,t,o)},p(n,o){o&1&&b(t,"cx",n[0]),o&2&&b(t,"cy",n[1]),o&4&&b(t,"r",n[2])},d(n){n&&J(t)}}}function ml(e){let t;function n(r,i){return ft?gl:hl}let o=n()(e);return{c(){o.c(),t=bn()},m(r,i){o.m(r,i),Q(r,t,i)},p(r,[i]){o.p(r,i)},i:bt,o:bt,d(r){r&&J(t),o.d(r)}}}function yl(e,t,n){let o,{x:r}=t,{y:i}=t,{scale:s}=t;const a=l=>{l.pointerType};function c(l){ye.call(this,e,l)}return e.$$set=l=>{"x"in l&&n(0,r=l.x),"y"in l&&n(1,i=l.y),"scale"in l&&n(4,s=l.scale)},e.$$.update=()=>{e.$$.dirty&16&&n(2,o=4/s)},[r,i,o,a,s,c]}class ds extends Vt{constructor(t){super(),Ut(this,t,yl,ml,Ht,{x:0,y:1,scale:4})}}function fo(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function Dr(e,t,n){const o=e.slice();return o[28]=t[n],o[30]=n,o}function po(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function ho(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function Br(e){let t,n,o,r;return{c(){t=z("circle"),b(t,"cx",n=e[28][0]),b(t,"cy",o=e[28][1]),b(t,"r",r=dn/e[3]),b(t,"class","svelte-1h2slbm")},m(i,s){Q(i,t,s)},p(i,s){s[0]&1088&&n!==(n=i[28][0])&&b(t,"cx",n),s[0]&1088&&o!==(o=i[28][1])&&b(t,"cy",o),s[0]&8&&r!==(r=dn/i[3])&&b(t,"r",r)},d(i){i&&J(t)}}}function jr(e){let t,n,o,r,i,s,a,c,l,u;return{c(){t=z("mask"),n=z("rect"),a=z("circle"),b(n,"x",o=e[9].x),b(n,"y",r=e[9].y),b(n,"width",i=e[9].w),b(n,"height",s=e[9].h),b(n,"class","svelte-1h2slbm"),b(a,"cx",c=e[28][0]),b(a,"cy",l=e[28][1]),b(a,"r",u=dn/e[3]),b(a,"class","svelte-1h2slbm"),b(t,"id",`${e[19]}-inner`),b(t,"class","a9s-polygon-editor-mask svelte-1h2slbm")},m(d,f){Q(d,t,f),ue(t,n),ue(t,a)},p(d,f){f[0]&512&&o!==(o=d[9].x)&&b(n,"x",o),f[0]&512&&r!==(r=d[9].y)&&b(n,"y",r),f[0]&512&&i!==(i=d[9].w)&&b(n,"width",i),f[0]&512&&s!==(s=d[9].h)&&b(n,"height",s),f[0]&1088&&c!==(c=d[28][0])&&b(a,"cx",c),f[0]&1088&&l!==(l=d[28][1])&&b(a,"cy",l),f[0]&8&&u!==(u=dn/d[3])&&b(a,"r",u)},d(d){d&&J(t)}}}function Hr(e){let t,n;return t=new Lt({props:{class:"a9s-corner-handle",x:e[28][0],y:e[28][1],scale:e[3],selected:e[8].includes(e[30])}}),t.$on("pointerenter",e[11]),t.$on("pointerleave",e[12]),t.$on("pointerdown",e[15]),t.$on("pointerdown",function(){me(e[27](`HANDLE-${e[30]}`))&&e[27](`HANDLE-${e[30]}`).apply(this,arguments)}),t.$on("pointerup",e[16](e[30])),{c(){Xe(t.$$.fragment)},m(o,r){Ie(t,o,r),n=!0},p(o,r){e=o;const i={};r[0]&32&&(i.x=e[28][0]),r[0]&32&&(i.y=e[28][1]),r[0]&8&&(i.scale=e[3]),r[0]&256&&(i.selected=e[8].includes(e[30])),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){De(t,o)}}}function Ur(e){let t,n;return t=new ds({props:{x:e[28][0],y:e[28][1],scale:e[3]}}),t.$on("pointerdown",function(){me(e[18](e[6]))&&e[18](e[6]).apply(this,arguments)}),{c(){Xe(t.$$.fragment)},m(o,r){Ie(t,o,r),n=!0},p(o,r){e=o;const i={};r[0]&1088&&(i.x=e[28][0]),r[0]&1088&&(i.y=e[28][1]),r[0]&8&&(i.scale=e[3]),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){De(t,o)}}}function vl(e){let t,n,o,r,i,s,a,c,l,u,d,f,h,m,p,E,v,g,y,$,S,I=e[6]!==void 0&&!e[7]&&Br(ho(e)),P=e[6]!==void 0&&!e[7]&&jr(po(e)),L=ht(e[5].points),N=[];for(let R=0;R<L.length;R+=1)N[R]=Hr(Dr(e,L,R));const H=R=>fe(N[R],1,1,()=>{N[R]=null});let j=e[6]!==void 0&&!e[7]&&Ur(fo(e));return{c(){t=z("defs"),n=z("mask"),o=z("rect"),c=z("polygon"),I&&I.c(),P&&P.c(),u=Re(),d=z("polygon"),h=Re(),m=z("polygon"),E=Re();for(let R=0;R<N.length;R+=1)N[R].c();v=Re(),j&&j.c(),g=bn(),b(o,"x",r=e[9].x),b(o,"y",i=e[9].y),b(o,"width",s=e[9].w),b(o,"height",a=e[9].h),b(o,"class","svelte-1h2slbm"),b(c,"points",l=e[5].points.map(Vr).join(" ")),b(c,"class","svelte-1h2slbm"),b(n,"id",`${e[19]}-outer`),b(n,"class","a9s-polygon-editor-mask svelte-1h2slbm"),b(d,"class","a9s-outer"),b(d,"mask",`url(#${e[19]}-outer)`),b(d,"points",f=e[5].points.map(Fr).join(" ")),b(m,"class","a9s-inner a9s-shape-handle"),b(m,"mask",`url(#${e[19]}-inner)`),b(m,"style",e[1]),b(m,"points",p=e[5].points.map(Xr).join(" "))},m(R,T){Q(R,t,T),ue(t,n),ue(n,o),ue(n,c),I&&I.m(n,null),P&&P.m(t,null),Q(R,u,T),Q(R,d,T),Q(R,h,T),Q(R,m,T),Q(R,E,T);for(let x=0;x<N.length;x+=1)N[x]&&N[x].m(R,T);Q(R,v,T),j&&j.m(R,T),Q(R,g,T),y=!0,$||(S=[oe(d,"pointerup",e[14]),oe(d,"pointerdown",function(){me(e[27]("SHAPE"))&&e[27]("SHAPE").apply(this,arguments)}),oe(m,"pointermove",e[13]),oe(m,"pointerup",e[14]),oe(m,"pointerdown",function(){me(e[27]("SHAPE"))&&e[27]("SHAPE").apply(this,arguments)})],$=!0)},p(R,T){if(e=R,(!y||T[0]&512&&r!==(r=e[9].x))&&b(o,"x",r),(!y||T[0]&512&&i!==(i=e[9].y))&&b(o,"y",i),(!y||T[0]&512&&s!==(s=e[9].w))&&b(o,"width",s),(!y||T[0]&512&&a!==(a=e[9].h))&&b(o,"height",a),(!y||T[0]&32&&l!==(l=e[5].points.map(Vr).join(" ")))&&b(c,"points",l),e[6]!==void 0&&!e[7]?I?I.p(ho(e),T):(I=Br(ho(e)),I.c(),I.m(n,null)):I&&(I.d(1),I=null),e[6]!==void 0&&!e[7]?P?P.p(po(e),T):(P=jr(po(e)),P.c(),P.m(t,null)):P&&(P.d(1),P=null),(!y||T[0]&32&&f!==(f=e[5].points.map(Fr).join(" ")))&&b(d,"points",f),(!y||T[0]&2)&&b(m,"style",e[1]),(!y||T[0]&32&&p!==(p=e[5].points.map(Xr).join(" ")))&&b(m,"points",p),T[0]&134322472){L=ht(e[5].points);let x;for(x=0;x<L.length;x+=1){const A=Dr(e,L,x);N[x]?(N[x].p(A,T),re(N[x],1)):(N[x]=Hr(A),N[x].c(),re(N[x],1),N[x].m(v.parentNode,v))}for(Nt(),x=L.length;x<N.length;x+=1)H(x);It()}e[6]!==void 0&&!e[7]?j?(j.p(fo(e),T),T[0]&192&&re(j,1)):(j=Ur(fo(e)),j.c(),re(j,1),j.m(g.parentNode,g)):j&&(Nt(),fe(j,1,1,()=>{j=null}),It())},i(R){if(!y){for(let T=0;T<L.length;T+=1)re(N[T]);re(j),y=!0}},o(R){N=N.filter(Boolean);for(let T=0;T<N.length;T+=1)fe(N[T]);fe(j),y=!1},d(R){R&&(J(t),J(u),J(d),J(h),J(m),J(E),J(v),J(g)),I&&I.d(),P&&P.d(),Gn(N,R),j&&j.d(R),$=!1,He(S)}}}function bl(e){let t,n;return t=new sr({props:{shape:e[0],transform:e[2],editor:e[17],svgEl:e[4],$$slots:{default:[vl,({grab:o})=>({27:o}),({grab:o})=>[o?134217728:0]]},$$scope:{ctx:e}}}),t.$on("change",e[20]),t.$on("grab",e[21]),t.$on("release",e[22]),{c(){Xe(t.$$.fragment)},m(o,r){Ie(t,o,r),n=!0},p(o,r){const i={};r[0]&1&&(i.shape=o[0]),r[0]&4&&(i.transform=o[2]),r[0]&16&&(i.svgEl=o[4]),r[0]&134219754|r[1]&1&&(i.$$scope={dirty:r,ctx:o}),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){De(t,o)}}}const wl=250,xl=1e3,El=12,dn=4.5,Vr=e=>e.join(","),Fr=e=>e.join(","),Xr=e=>e.join(",");function Al(e,t,n){let o,r,i;const s=rr();let{shape:a}=t,{computedStyle:c}=t,{transform:l}=t,{viewportScale:u=1}=t,{svgEl:d}=t,f,h=!1,m,p=[];const E=()=>n(7,h=!0),v=()=>n(7,h=!1),g=x=>{if(p.length>0||!r.some(O=>O.visible)){n(6,f=void 0);return}const[A,M]=l.elementToImage(x.offsetX,x.offsetY),k=O=>Math.pow(O[0]-A,2)+Math.pow(O[1]-M,2),C=o.points.reduce((O,B)=>k(B)<k(O)?B:O),U=r.filter(O=>O.visible).reduce((O,B)=>k(B.point)<k(O.point)?B:O),w=Math.pow(xl/u,2);k(C)<w||k(U.point)<w?n(6,f=r.indexOf(U)):n(6,f=void 0)},y=()=>{document.activeElement!==d&&d.focus()},$=()=>{n(8,p=[]),y()},S=x=>{n(7,h=!0),x.preventDefault(),x.stopPropagation(),m=performance.now()},I=x=>A=>{if(!m||ft||performance.now()-m>wl)return;const M=p.includes(x);A.metaKey||A.ctrlKey||A.shiftKey?M?n(8,p=p.filter(k=>k!==x)):n(8,p=[...p,x]):M&&p.length>1?n(8,p=[x]):M?n(8,p=[]):n(8,p=[x]),y()},P=(x,A,M)=>{y();let k;const C=x.geometry;p.length>1?k=C.points.map(([w,O],B)=>p.includes(B)?[w+M[0],O+M[1]]:[w,O]):A==="SHAPE"?k=C.points.map(([w,O])=>[w+M[0],O+M[1]]):k=C.points.map(([w,O],B)=>A===`HANDLE-${B}`?[w+M[0],O+M[1]]:[w,O]);const U=ct(k);return{...x,geometry:{points:k,bounds:U}}},L=x=>async A=>{A.stopPropagation();const M=[...o.points.slice(0,x+1),r[x].point,...o.points.slice(x+1)],k=ct(M);s("change",{...a,geometry:{points:M,bounds:k}}),await ls();const C=[...document.querySelectorAll(".a9s-handle")][x+1];if(C!=null&&C.firstChild){const U=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:A.clientX,clientY:A.clientY,pointerId:A.pointerId,pointerType:A.pointerType,isPrimary:A.isPrimary,buttons:A.buttons});C.firstChild.dispatchEvent(U)}},N=()=>{if(o.points.length-p.length<3)return;const x=o.points.filter((M,k)=>!p.includes(k)),A=ct(x);s("change",{...a,geometry:{points:x,bounds:A}}),n(8,p=[])};is(()=>{if(ft)return;const x=A=>{(A.key==="Delete"||A.key==="Backspace")&&(A.preventDefault(),N())};return d.addEventListener("pointermove",g),d.addEventListener("keydown",x),()=>{d.removeEventListener("pointermove",g),d.removeEventListener("keydown",x)}});const H=`polygon-mask-${Math.random().toString(36).substring(2,12)}`;function j(x){ye.call(this,e,x)}function R(x){ye.call(this,e,x)}function T(x){ye.call(this,e,x)}return e.$$set=x=>{"shape"in x&&n(0,a=x.shape),"computedStyle"in x&&n(1,c=x.computedStyle),"transform"in x&&n(2,l=x.transform),"viewportScale"in x&&n(3,u=x.viewportScale),"svgEl"in x&&n(4,d=x.svgEl)},e.$$.update=()=>{e.$$.dirty[0]&1&&n(5,o=a.geometry),e.$$.dirty[0]&40&&n(10,r=ft?[]:o.points.map((x,A)=>{const M=A===o.points.length-1?o.points[0]:o.points[A+1],k=(x[0]+M[0])/2,C=(x[1]+M[1])/2,U=Math.sqrt(Math.pow(M[0]-k,2)+Math.pow(M[1]-C,2))>El/u;return{point:[k,C],visible:U}})),e.$$.dirty[0]&40&&n(9,i=ir(o.bounds,dn/u))},[a,c,l,u,d,o,f,h,p,i,r,E,v,g,$,S,I,P,L,H,j,R,T]}class Sl extends Vt{constructor(t){super(),Ut(this,t,Al,bl,Ht,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}function $l(e){let t,n,o,r,i,s,a,c,l,u,d,f,h,m,p,E,v,g,y,$,S,I,P,L,N,H,j,R,T,x,A,M,k,C,U,w,O,B,D,K,F,q,ae,ne,Ue,be,Ye,W,ee,G,se,ie,X,Oe,Te;return be=new Lt({props:{class:"a9s-corner-handle-topleft",x:e[5].x,y:e[5].y,scale:e[3]}}),be.$on("pointerdown",function(){me(e[12]("TOP_LEFT"))&&e[12]("TOP_LEFT").apply(this,arguments)}),W=new Lt({props:{class:"a9s-corner-handle-topright",x:e[5].x+e[5].w,y:e[5].y,scale:e[3]}}),W.$on("pointerdown",function(){me(e[12]("TOP_RIGHT"))&&e[12]("TOP_RIGHT").apply(this,arguments)}),G=new Lt({props:{class:"a9s-corner-handle-bottomright",x:e[5].x+e[5].w,y:e[5].y+e[5].h,scale:e[3]}}),G.$on("pointerdown",function(){me(e[12]("BOTTOM_RIGHT"))&&e[12]("BOTTOM_RIGHT").apply(this,arguments)}),ie=new Lt({props:{class:"a9s-corner-handle-bottomleft",x:e[5].x,y:e[5].y+e[5].h,scale:e[3]}}),ie.$on("pointerdown",function(){me(e[12]("BOTTOM_LEFT"))&&e[12]("BOTTOM_LEFT").apply(this,arguments)}),{c(){t=z("defs"),n=z("mask"),o=z("rect"),c=z("rect"),h=Re(),m=z("rect"),y=Re(),$=z("rect"),N=Re(),H=z("rect"),x=Re(),A=z("rect"),U=Re(),w=z("rect"),K=Re(),F=z("rect"),Ue=Re(),Xe(be.$$.fragment),Ye=Re(),Xe(W.$$.fragment),ee=Re(),Xe(G.$$.fragment),se=Re(),Xe(ie.$$.fragment),b(o,"class","rect-mask-bg svelte-1njczvj"),b(o,"x",r=e[6].x),b(o,"y",i=e[6].y),b(o,"width",s=e[6].w),b(o,"height",a=e[6].h),b(c,"class","rect-mask-fg svelte-1njczvj"),b(c,"x",l=e[5].x),b(c,"y",u=e[5].y),b(c,"width",d=e[5].w),b(c,"height",f=e[5].h),b(n,"id",e[8]),b(n,"class","a9s-rectangle-editor-mask svelte-1njczvj"),b(m,"class","a9s-outer"),b(m,"mask",`url(#${e[8]})`),b(m,"x",p=e[5].x),b(m,"y",E=e[5].y),b(m,"width",v=e[5].w),b(m,"height",g=e[5].h),b($,"class","a9s-inner a9s-shape-handle"),b($,"style",e[1]),b($,"x",S=e[5].x),b($,"y",I=e[5].y),b($,"width",P=e[5].w),b($,"height",L=e[5].h),b(H,"class","a9s-edge-handle a9s-edge-handle-top"),b(H,"x",j=e[5].x),b(H,"y",R=e[5].y),b(H,"height",1),b(H,"width",T=e[5].w),b(A,"class","a9s-edge-handle a9s-edge-handle-right"),b(A,"x",M=e[5].x+e[5].w),b(A,"y",k=e[5].y),b(A,"height",C=e[5].h),b(A,"width",1),b(w,"class","a9s-edge-handle a9s-edge-handle-bottom"),b(w,"x",O=e[5].x),b(w,"y",B=e[5].y+e[5].h),b(w,"height",1),b(w,"width",D=e[5].w),b(F,"class","a9s-edge-handle a9s-edge-handle-left"),b(F,"x",q=e[5].x),b(F,"y",ae=e[5].y),b(F,"height",ne=e[5].h),b(F,"width",1)},m(Y,V){Q(Y,t,V),ue(t,n),ue(n,o),ue(n,c),Q(Y,h,V),Q(Y,m,V),Q(Y,y,V),Q(Y,$,V),Q(Y,N,V),Q(Y,H,V),Q(Y,x,V),Q(Y,A,V),Q(Y,U,V),Q(Y,w,V),Q(Y,K,V),Q(Y,F,V),Q(Y,Ue,V),Ie(be,Y,V),Q(Y,Ye,V),Ie(W,Y,V),Q(Y,ee,V),Ie(G,Y,V),Q(Y,se,V),Ie(ie,Y,V),X=!0,Oe||(Te=[oe(m,"pointerdown",function(){me(e[12]("SHAPE"))&&e[12]("SHAPE").apply(this,arguments)}),oe($,"pointerdown",function(){me(e[12]("SHAPE"))&&e[12]("SHAPE").apply(this,arguments)}),oe(H,"pointerdown",function(){me(e[12]("TOP"))&&e[12]("TOP").apply(this,arguments)}),oe(A,"pointerdown",function(){me(e[12]("RIGHT"))&&e[12]("RIGHT").apply(this,arguments)}),oe(w,"pointerdown",function(){me(e[12]("BOTTOM"))&&e[12]("BOTTOM").apply(this,arguments)}),oe(F,"pointerdown",function(){me(e[12]("LEFT"))&&e[12]("LEFT").apply(this,arguments)})],Oe=!0)},p(Y,V){e=Y,(!X||V&64&&r!==(r=e[6].x))&&b(o,"x",r),(!X||V&64&&i!==(i=e[6].y))&&b(o,"y",i),(!X||V&64&&s!==(s=e[6].w))&&b(o,"width",s),(!X||V&64&&a!==(a=e[6].h))&&b(o,"height",a),(!X||V&32&&l!==(l=e[5].x))&&b(c,"x",l),(!X||V&32&&u!==(u=e[5].y))&&b(c,"y",u),(!X||V&32&&d!==(d=e[5].w))&&b(c,"width",d),(!X||V&32&&f!==(f=e[5].h))&&b(c,"height",f),(!X||V&32&&p!==(p=e[5].x))&&b(m,"x",p),(!X||V&32&&E!==(E=e[5].y))&&b(m,"y",E),(!X||V&32&&v!==(v=e[5].w))&&b(m,"width",v),(!X||V&32&&g!==(g=e[5].h))&&b(m,"height",g),(!X||V&2)&&b($,"style",e[1]),(!X||V&32&&S!==(S=e[5].x))&&b($,"x",S),(!X||V&32&&I!==(I=e[5].y))&&b($,"y",I),(!X||V&32&&P!==(P=e[5].w))&&b($,"width",P),(!X||V&32&&L!==(L=e[5].h))&&b($,"height",L),(!X||V&32&&j!==(j=e[5].x))&&b(H,"x",j),(!X||V&32&&R!==(R=e[5].y))&&b(H,"y",R),(!X||V&32&&T!==(T=e[5].w))&&b(H,"width",T),(!X||V&32&&M!==(M=e[5].x+e[5].w))&&b(A,"x",M),(!X||V&32&&k!==(k=e[5].y))&&b(A,"y",k),(!X||V&32&&C!==(C=e[5].h))&&b(A,"height",C),(!X||V&32&&O!==(O=e[5].x))&&b(w,"x",O),(!X||V&32&&B!==(B=e[5].y+e[5].h))&&b(w,"y",B),(!X||V&32&&D!==(D=e[5].w))&&b(w,"width",D),(!X||V&32&&q!==(q=e[5].x))&&b(F,"x",q),(!X||V&32&&ae!==(ae=e[5].y))&&b(F,"y",ae),(!X||V&32&&ne!==(ne=e[5].h))&&b(F,"height",ne);const Le={};V&32&&(Le.x=e[5].x),V&32&&(Le.y=e[5].y),V&8&&(Le.scale=e[3]),be.$set(Le);const Ce={};V&32&&(Ce.x=e[5].x+e[5].w),V&32&&(Ce.y=e[5].y),V&8&&(Ce.scale=e[3]),W.$set(Ce);const ke={};V&32&&(ke.x=e[5].x+e[5].w),V&32&&(ke.y=e[5].y+e[5].h),V&8&&(ke.scale=e[3]),G.$set(ke);const yt={};V&32&&(yt.x=e[5].x),V&32&&(yt.y=e[5].y+e[5].h),V&8&&(yt.scale=e[3]),ie.$set(yt)},i(Y){X||(re(be.$$.fragment,Y),re(W.$$.fragment,Y),re(G.$$.fragment,Y),re(ie.$$.fragment,Y),X=!0)},o(Y){fe(be.$$.fragment,Y),fe(W.$$.fragment,Y),fe(G.$$.fragment,Y),fe(ie.$$.fragment,Y),X=!1},d(Y){Y&&(J(t),J(h),J(m),J(y),J($),J(N),J(H),J(x),J(A),J(U),J(w),J(K),J(F),J(Ue),J(Ye),J(ee),J(se)),De(be,Y),De(W,Y),De(G,Y),De(ie,Y),Oe=!1,He(Te)}}}function Tl(e){let t,n;return t=new sr({props:{shape:e[0],transform:e[2],editor:e[7],svgEl:e[4],$$slots:{default:[$l,({grab:o})=>({12:o}),({grab:o})=>o?4096:0]},$$scope:{ctx:e}}}),t.$on("grab",e[9]),t.$on("change",e[10]),t.$on("release",e[11]),{c(){Xe(t.$$.fragment)},m(o,r){Ie(t,o,r),n=!0},p(o,[r]){const i={};r&1&&(i.shape=o[0]),r&4&&(i.transform=o[2]),r&16&&(i.svgEl=o[4]),r&12394&&(i.$$scope={dirty:r,ctx:o}),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){De(t,o)}}}function Rl(e,t,n){let o,r,{shape:i}=t,{computedStyle:s}=t,{transform:a}=t,{viewportScale:c=1}=t,{svgEl:l}=t;const u=(p,E,v)=>{const g=p.geometry.bounds;let[y,$]=[g.minX,g.minY],[S,I]=[g.maxX,g.maxY];const[P,L]=v;if(E==="SHAPE")y+=P,S+=P,$+=L,I+=L;else{switch(E){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{$+=L;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{I+=L;break}}switch(E){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{y+=P;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{S+=P;break}}}const N=Math.min(y,S),H=Math.min($,I),j=Math.abs(S-y),R=Math.abs(I-$);return{...p,geometry:{x:N,y:H,w:j,h:R,bounds:{minX:N,minY:H,maxX:N+j,maxY:H+R}}}},d=`rect-mask-${Math.random().toString(36).substring(2,12)}`;function f(p){ye.call(this,e,p)}function h(p){ye.call(this,e,p)}function m(p){ye.call(this,e,p)}return e.$$set=p=>{"shape"in p&&n(0,i=p.shape),"computedStyle"in p&&n(1,s=p.computedStyle),"transform"in p&&n(2,a=p.transform),"viewportScale"in p&&n(3,c=p.viewportScale),"svgEl"in p&&n(4,l=p.svgEl)},e.$$.update=()=>{e.$$.dirty&1&&n(5,o=i.geometry),e.$$.dirty&40&&n(6,r=ir(o.bounds,2/c))},[i,s,a,c,l,o,r,u,d,f,h,m]}class Cl extends Vt{constructor(t){super(),Ut(this,t,Rl,Tl,Ht,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4})}}var Kr=Object.prototype.hasOwnProperty;function qo(e,t){var n,o;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((o=e.length)===t.length)for(;o--&&qo(e[o],t[o]););return o===-1}if(!n||typeof e=="object"){o=0;for(n in e)if(Kr.call(e,n)&&++o&&!Kr.call(t,n)||!(n in t)||!qo(e[n],t[n]))return!1;return Object.keys(t).length===o}}return e!==e&&t!==t}const Ol=12,Ll=(e,t)=>e.polygons.reduce((n,o,r)=>{const i=o.rings.reduce((s,a,c)=>{const l=a.points.map((u,d)=>{const f=d===a.points.length-1?a.points[0]:a.points[d+1],h=(u[0]+f[0])/2,m=(u[1]+f[1])/2,p=Math.sqrt(Math.pow(f[0]-h,2)+Math.pow(f[1]-m,2))>Ol/t;return{point:[h,m],visible:p,elementIdx:r,ringIdx:c,pointIdx:d}});return[...s,...l]},[]);return[...n,...i]},[]);function go(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function qr(e,t,n){const o=e.slice();return o[30]=t[n],o[32]=n,o}function Yr(e,t,n){const o=e.slice();return o[33]=t[n],o[35]=n,o}function Wr(e,t,n){const o=e.slice();return o[29]=t[n],o[37]=n,o}function mo(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function yo(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function zr(e){let t,n,o,r;return{c(){t=z("circle"),b(t,"cx",n=e[29][0]),b(t,"cy",o=e[29][1]),b(t,"r",r=fn/e[3]),b(t,"class","svelte-1vxo6dc")},m(i,s){Q(i,t,s)},p(i,s){s[0]&1088&&n!==(n=i[29][0])&&b(t,"cx",n),s[0]&1088&&o!==(o=i[29][1])&&b(t,"cy",o),s[0]&8&&r!==(r=fn/i[3])&&b(t,"r",r)},d(i){i&&J(t)}}}function Gr(e){let t,n,o,r,i,s,a,c,l,u;return{c(){t=z("mask"),n=z("rect"),a=z("circle"),b(n,"x",o=e[9].x),b(n,"y",r=e[9].y),b(n,"width",i=e[9].w),b(n,"height",s=e[9].h),b(n,"class","svelte-1vxo6dc"),b(a,"cx",c=e[29][0]),b(a,"cy",l=e[29][1]),b(a,"r",u=fn/e[3]),b(a,"class","svelte-1vxo6dc"),b(t,"id",`${e[18]}-${e[32]}-inner`),b(t,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc")},m(d,f){Q(d,t,f),ue(t,n),ue(t,a)},p(d,f){f[0]&512&&o!==(o=d[9].x)&&b(n,"x",o),f[0]&512&&r!==(r=d[9].y)&&b(n,"y",r),f[0]&512&&i!==(i=d[9].w)&&b(n,"width",i),f[0]&512&&s!==(s=d[9].h)&&b(n,"height",s),f[0]&1088&&c!==(c=d[29][0])&&b(a,"cx",c),f[0]&1088&&l!==(l=d[29][1])&&b(a,"cy",l),f[0]&8&&u!==(u=fn/d[3])&&b(a,"r",u)},d(d){d&&J(t)}}}function Jr(e){let t,n;function o(...r){return e[19](e[32],e[35],e[37],...r)}return t=new Lt({props:{class:"a9s-corner-handle",x:e[29][0],y:e[29][1],scale:e[3],selected:e[8].some(o)}}),t.$on("pointerenter",e[11]),t.$on("pointerleave",e[12]),t.$on("pointerdown",e[14]),t.$on("pointerdown",function(){me(e[28](`HANDLE-${e[32]}-${e[35]}-${e[37]}`))&&e[28](`HANDLE-${e[32]}-${e[35]}-${e[37]}`).apply(this,arguments)}),t.$on("pointerup",e[15](e[32],e[35],e[37])),{c(){Xe(t.$$.fragment)},m(r,i){Ie(t,r,i),n=!0},p(r,i){e=r;const s={};i[0]&32&&(s.x=e[29][0]),i[0]&32&&(s.y=e[29][1]),i[0]&8&&(s.scale=e[3]),i[0]&256&&(s.selected=e[8].some(o)),t.$set(s)},i(r){n||(re(t.$$.fragment,r),n=!0)},o(r){fe(t.$$.fragment,r),n=!1},d(r){De(t,r)}}}function Zr(e){let t,n,o=ht(e[33].points),r=[];for(let s=0;s<o.length;s+=1)r[s]=Jr(Wr(e,o,s));const i=s=>fe(r[s],1,1,()=>{r[s]=null});return{c(){for(let s=0;s<r.length;s+=1)r[s].c();t=bn()},m(s,a){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(s,a);Q(s,t,a),n=!0},p(s,a){if(a[0]&268491048){o=ht(s[33].points);let c;for(c=0;c<o.length;c+=1){const l=Wr(s,o,c);r[c]?(r[c].p(l,a),re(r[c],1)):(r[c]=Jr(l),r[c].c(),re(r[c],1),r[c].m(t.parentNode,t))}for(Nt(),c=o.length;c<r.length;c+=1)i(c);It()}},i(s){if(!n){for(let a=0;a<o.length;a+=1)re(r[a]);n=!0}},o(s){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)fe(r[a]);n=!1},d(s){s&&J(t),Gn(r,s)}}}function Qr(e){let t,n,o,r,i,s,a,c,l,u,d,f,h,m,p,E,v,g=e[6]!==void 0&&!e[7]&&zr(yo(e)),y=e[6]!==void 0&&!e[7]&&Gr(mo(e)),$=ht(e[30].rings),S=[];for(let P=0;P<$.length;P+=1)S[P]=Zr(Yr(e,$,P));const I=P=>fe(S[P],1,1,()=>{S[P]=null});return{c(){t=z("g"),n=z("defs"),o=z("mask"),r=z("rect"),l=z("path"),g&&g.c(),y&&y.c(),d=z("path"),h=z("path");for(let P=0;P<S.length;P+=1)S[P].c();b(r,"x",i=e[9].x),b(r,"y",s=e[9].y),b(r,"width",a=e[9].w),b(r,"height",c=e[9].h),b(r,"class","svelte-1vxo6dc"),b(l,"d",u=At(e[30])),b(l,"class","svelte-1vxo6dc"),b(o,"id",`${e[18]}-${e[32]}-outer`),b(o,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc"),b(d,"class","a9s-outer"),b(d,"mask",`url(#${e[18]}-${e[32]}-outer)`),b(d,"fill-rule","evenodd"),b(d,"d",f=At(e[30])),b(h,"class","a9s-inner"),b(h,"mask",`url(#${e[18]}-${e[32]}-inner)`),b(h,"style",e[1]),b(h,"fill-rule","evenodd"),b(h,"d",m=At(e[30]))},m(P,L){Q(P,t,L),ue(t,n),ue(n,o),ue(o,r),ue(o,l),g&&g.m(o,null),y&&y.m(n,null),ue(t,d),ue(t,h);for(let N=0;N<S.length;N+=1)S[N]&&S[N].m(t,null);p=!0,E||(v=[oe(d,"pointerup",e[13]),oe(d,"pointerdown",function(){me(e[28]("SHAPE"))&&e[28]("SHAPE").apply(this,arguments)}),oe(h,"pointerup",e[13]),oe(h,"pointerdown",function(){me(e[28]("SHAPE"))&&e[28]("SHAPE").apply(this,arguments)})],E=!0)},p(P,L){if(e=P,(!p||L[0]&512&&i!==(i=e[9].x))&&b(r,"x",i),(!p||L[0]&512&&s!==(s=e[9].y))&&b(r,"y",s),(!p||L[0]&512&&a!==(a=e[9].w))&&b(r,"width",a),(!p||L[0]&512&&c!==(c=e[9].h))&&b(r,"height",c),(!p||L[0]&32&&u!==(u=At(e[30])))&&b(l,"d",u),e[6]!==void 0&&!e[7]?g?g.p(yo(e),L):(g=zr(yo(e)),g.c(),g.m(o,null)):g&&(g.d(1),g=null),e[6]!==void 0&&!e[7]?y?y.p(mo(e),L):(y=Gr(mo(e)),y.c(),y.m(n,null)):y&&(y.d(1),y=null),(!p||L[0]&32&&f!==(f=At(e[30])))&&b(d,"d",f),(!p||L[0]&2)&&b(h,"style",e[1]),(!p||L[0]&32&&m!==(m=At(e[30])))&&b(h,"d",m),L[0]&268491048){$=ht(e[30].rings);let N;for(N=0;N<$.length;N+=1){const H=Yr(e,$,N);S[N]?(S[N].p(H,L),re(S[N],1)):(S[N]=Zr(H),S[N].c(),re(S[N],1),S[N].m(t,null))}for(Nt(),N=$.length;N<S.length;N+=1)I(N);It()}},i(P){if(!p){for(let L=0;L<$.length;L+=1)re(S[L]);p=!0}},o(P){S=S.filter(Boolean);for(let L=0;L<S.length;L+=1)fe(S[L]);p=!1},d(P){P&&J(t),g&&g.d(),y&&y.d(),Gn(S,P),E=!1,He(v)}}}function ei(e){let t,n;return t=new ds({props:{x:e[29][0],y:e[29][1],scale:e[3]}}),t.$on("pointerdown",function(){me(e[17](e[6]))&&e[17](e[6]).apply(this,arguments)}),{c(){Xe(t.$$.fragment)},m(o,r){Ie(t,o,r),n=!0},p(o,r){e=o;const i={};r[0]&1088&&(i.x=e[29][0]),r[0]&1088&&(i.y=e[29][1]),r[0]&8&&(i.scale=e[3]),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){De(t,o)}}}function kl(e){let t,n,o,r=ht(e[5].polygons),i=[];for(let c=0;c<r.length;c+=1)i[c]=Qr(qr(e,r,c));const s=c=>fe(i[c],1,1,()=>{i[c]=null});let a=e[6]!==void 0&&!e[7]&&ei(go(e));return{c(){for(let c=0;c<i.length;c+=1)i[c].c();t=Re(),a&&a.c(),n=bn()},m(c,l){for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(c,l);Q(c,t,l),a&&a.m(c,l),Q(c,n,l),o=!0},p(c,l){if(l[0]&268763114){r=ht(c[5].polygons);let u;for(u=0;u<r.length;u+=1){const d=qr(c,r,u);i[u]?(i[u].p(d,l),re(i[u],1)):(i[u]=Qr(d),i[u].c(),re(i[u],1),i[u].m(t.parentNode,t))}for(Nt(),u=r.length;u<i.length;u+=1)s(u);It()}c[6]!==void 0&&!c[7]?a?(a.p(go(c),l),l[0]&192&&re(a,1)):(a=ei(go(c)),a.c(),re(a,1),a.m(n.parentNode,n)):a&&(Nt(),fe(a,1,1,()=>{a=null}),It())},i(c){if(!o){for(let l=0;l<r.length;l+=1)re(i[l]);re(a),o=!0}},o(c){i=i.filter(Boolean);for(let l=0;l<i.length;l+=1)fe(i[l]);fe(a),o=!1},d(c){c&&(J(t),J(n)),Gn(i,c),a&&a.d(c)}}}function Ml(e){let t,n;return t=new sr({props:{shape:e[0],transform:e[2],editor:e[16],svgEl:e[4],$$slots:{default:[kl,({grab:o})=>({28:o}),({grab:o})=>[o?268435456:0]]},$$scope:{ctx:e}}}),t.$on("change",e[20]),t.$on("grab",e[21]),t.$on("release",e[22]),{c(){Xe(t.$$.fragment)},m(o,r){Ie(t,o,r),n=!0},p(o,r){const i={};r[0]&1&&(i.shape=o[0]),r[0]&4&&(i.transform=o[2]),r[0]&16&&(i.svgEl=o[4]),r[0]&268437482|r[1]&128&&(i.$$scope={dirty:r,ctx:o}),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){De(t,o)}}}const _l=250,Pl=1e3,fn=4.5;function Nl(e,t,n){let o,r,i;const s=rr();let{shape:a}=t,{computedStyle:c}=t,{transform:l}=t,{viewportScale:u=1}=t,{svgEl:d}=t,f,h=!1,m,p=[];const E=()=>n(7,h=!0),v=()=>n(7,h=!1),g=A=>{if(p.length>0||!r.some(B=>B.visible)){n(6,f=void 0);return}const[M,k]=l.elementToImage(A.offsetX,A.offsetY),C=B=>Math.pow(B[0]-M,2)+Math.pow(B[1]-k,2),U=Za(o).reduce((B,D)=>C(D)<C(B)?D:B),w=r.filter(B=>B.visible).reduce((B,D)=>C(D.point)<C(B.point)?D:B),O=Math.pow(Pl/u,2);C(U)<O||C(w.point)<O?n(6,f=r.indexOf(w)):n(6,f=void 0)},y=()=>{document.activeElement!==d&&d.focus()},$=()=>{n(8,p=[]),y()},S=A=>{n(7,h=!0),A.preventDefault(),A.stopPropagation(),m=performance.now()},I=(A,M,k)=>C=>{if(!m||ft||performance.now()-m>_l)return;const U=O=>O.polygon===A&&O.ring===M&&O.point===k,w=p.some(U);C.metaKey||C.ctrlKey||C.shiftKey?w?n(8,p=p.filter(O=>!U(O))):n(8,p=[...p,{polygon:A,ring:M,point:k}]):w&&p.length>1?n(8,p=[{polygon:A,ring:M,point:k}]):w?n(8,p=[]):n(8,p=[{polygon:A,ring:M,point:k}]),y()},P=(A,M,k)=>{y();const C=A.geometry.polygons;let U;if(M==="SHAPE")U=C.map(w=>{const O=w.rings.map((D,K)=>({points:D.points.map((F,q)=>[F[0]+k[0],F[1]+k[1]])})),B=ct(O[0].points);return{rings:O,bounds:B}});else{const[w,O,B,D]=M.split("-").map(K=>parseInt(K));U=C.map((K,F)=>{if(F===O){const q=K.rings.map((ne,Ue)=>Ue===B?{points:ne.points.map((be,Ye)=>Ye===D?[be[0]+k[0],be[1]+k[1]]:be)}:ne),ae=ct(q[0].points);return{rings:q,bounds:ae}}else return K})}return{...A,geometry:{polygons:U,bounds:uo(U)}}},L=A=>async M=>{M.stopPropagation();const k=r[A],C=o.polygons.map((w,O)=>{if(O===k.elementIdx){const B=w.rings.map((K,F)=>F===k.ringIdx?{points:[...K.points.slice(0,k.pointIdx+1),k.point,...K.points.slice(k.pointIdx+1)]}:K),D=ct(B[0].points);return{rings:B,bounds:D}}else return w});s("change",{...a,geometry:{polygons:C,bounds:uo(C)}}),await ls();const U=[...document.querySelectorAll(".a9s-handle")][A+1];if(U!=null&&U.firstChild){const w=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:M.clientX,clientY:M.clientY,pointerId:M.pointerId,pointerType:M.pointerType,isPrimary:M.isPrimary,buttons:M.buttons});U.firstChild.dispatchEvent(w)}},N=()=>{const A=o.polygons.map((M,k)=>{if(p.some(C=>C.polygon===k)){const C=M.rings.map((w,O)=>{const B=p.filter(D=>D.polygon===k&&D.ring===O);return B.length&&w.points.length-B.length>=3?{points:w.points.filter((D,K)=>!B.some(F=>F.point===K))}:w}),U=ct(C[0].points);return{rings:C,bounds:U}}else return M});!qo(o.polygons,A)&&(s("change",{...a,geometry:{polygons:A,bounds:uo(A)}}),n(8,p=[]))};is(()=>{if(ft)return;const A=M=>{(M.key==="Delete"||M.key==="Backspace")&&(M.preventDefault(),N())};return d.addEventListener("pointermove",g),d.addEventListener("keydown",A),()=>{d.removeEventListener("pointermove",g),d.removeEventListener("keydown",A)}});const H=`polygon-mask-${Math.random().toString(36).substring(2,12)}`,j=(A,M,k,{polygon:C,ring:U,point:w})=>C===A&&U===M&&w===k;function R(A){ye.call(this,e,A)}function T(A){ye.call(this,e,A)}function x(A){ye.call(this,e,A)}return e.$$set=A=>{"shape"in A&&n(0,a=A.shape),"computedStyle"in A&&n(1,c=A.computedStyle),"transform"in A&&n(2,l=A.transform),"viewportScale"in A&&n(3,u=A.viewportScale),"svgEl"in A&&n(4,d=A.svgEl)},e.$$.update=()=>{e.$$.dirty[0]&1&&n(5,o=a.geometry),e.$$.dirty[0]&40&&n(10,r=ft?[]:Ll(o,u)),e.$$.dirty[0]&40&&n(9,i=ir(o.bounds,fn/u))},[a,c,l,u,d,o,f,h,p,i,r,E,v,$,S,I,P,L,H,j,R,T,x]}class Il extends Vt{constructor(t){super(),Ut(this,t,Nl,Ml,Ht,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}ze.RECTANGLE,ze.POLYGON,ze.MULTIPOLYGON;typeof navigator>"u"||navigator.userAgent.indexOf("Mac OS X");var ti=Object.prototype.hasOwnProperty;function wt(e,t){var n,o;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((o=e.length)===t.length)for(;o--&&wt(e[o],t[o]););return o===-1}if(!n||typeof e=="object"){o=0;for(n in e)if(ti.call(e,n)&&++o&&!ti.call(t,n)||!(n in t)||!wt(e[n],t[n]))return!1;return Object.keys(t).length===o}}return e!==e&&t!==t}function vo(){}function Dl(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}const St=[];function ar(e,t=vo){let n;const o=new Set;function r(a){if(Dl(e,a)&&(e=a,n)){const c=!St.length;for(const l of o)l[1](),St.push(l,e);if(c){for(let l=0;l<St.length;l+=2)St[l][0](St[l+1]);St.length=0}}}function i(a){r(a(e))}function s(a,c=vo){const l=[a,c];return o.add(l),o.size===1&&(n=t(r,i)||vo),a(e),()=>{o.delete(l),o.size===0&&n&&(n(),n=null)}}return{set:r,update:i,subscribe:s}}const Bl=e=>{const{subscribe:t,set:n}=ar();let o;return t(r=>o=r),e.observe(({changes:r})=>{if(o){(r.deleted||[]).some(s=>s.id===o)&&n(void 0);const i=(r.updated||[]).find(({oldValue:s})=>s.id===o);i&&n(i.newValue.id)}}),{get current(){return o},subscribe:t,set:n}},An={selected:[]},jl=(e,t,n)=>{const{subscribe:o,set:r}=ar(An);let i=t,s=An;o(p=>s=p);const a=()=>{wt(s,An)||r(An)},c=()=>{var p;return((p=s.selected)==null?void 0:p.length)===0},l=p=>{if(c())return!1;const E=typeof p=="string"?p:p.id;return s.selected.some(v=>v.id===E)},u=(p,E)=>{let v;if(Array.isArray(p)){if(v=p.map(y=>e.getAnnotation(y)).filter(Boolean),v.length<p.length){console.warn("Invalid selection: "+p.filter(y=>!v.some($=>$.id===y)));return}}else{const y=e.getAnnotation(p);if(!y){console.warn("Invalid selection: "+p);return}v=[y]}const g=v.reduce((y,$)=>{const S=m($);return S==="EDIT"?[...y,{id:$.id,editable:!0}]:S==="SELECT"?[...y,{id:$.id}]:y},[]);r({selected:g,event:E})},d=(p,E)=>{const v=Array.isArray(p)?p:[p],g=v.map(y=>e.getAnnotation(y)).filter(y=>!!y);r({selected:g.map(y=>{const $=E===void 0?m(y)==="EDIT":E;return{id:y.id,editable:$}})}),g.length!==v.length&&console.warn("Invalid selection",p)},f=p=>{if(c())return!1;const{selected:E}=s;E.some(({id:v})=>p.includes(v))&&r({selected:E.filter(({id:v})=>!p.includes(v))})},h=p=>{i=p,d(s.selected.map(({id:E})=>E))},m=p=>Hl(p,i,n);return e.observe(({changes:p})=>f((p.deleted||[]).map(E=>E.id))),{get event(){return s?s.event:null},get selected(){return s?[...s.selected]:null},get userSelectAction(){return i},clear:a,evalSelectAction:m,isEmpty:c,isSelected:l,setSelected:d,setUserSelectAction:h,subscribe:o,userSelect:u}},Hl=(e,t,n)=>{const o=n?n.serialize(e):e;return typeof t=="function"?t(o):t||"EDIT"},we=[];for(let e=0;e<256;++e)we.push((e+256).toString(16).slice(1));function Ul(e,t=0){return(we[e[t+0]]+we[e[t+1]]+we[e[t+2]]+we[e[t+3]]+"-"+we[e[t+4]]+we[e[t+5]]+"-"+we[e[t+6]]+we[e[t+7]]+"-"+we[e[t+8]]+we[e[t+9]]+"-"+we[e[t+10]]+we[e[t+11]]+we[e[t+12]]+we[e[t+13]]+we[e[t+14]]+we[e[t+15]]).toLowerCase()}let bo;const Vl=new Uint8Array(16);function Fl(){if(!bo){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");bo=crypto.getRandomValues.bind(crypto)}return bo(Vl)}const Xl=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ni={randomUUID:Xl};function fs(e,t,n){var o;if(ni.randomUUID&&!e)return ni.randomUUID();e=e||{};const r=e.random??((o=e.rng)==null?void 0:o.call(e))??Fl();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Ul(r)}const wo=e=>{const t=n=>{const o={...n};return n.created&&typeof n.created=="string"&&(o.created=new Date(n.created)),n.updated&&typeof n.updated=="string"&&(o.updated=new Date(n.updated)),o};return{...e,bodies:(e.bodies||[]).map(t),target:t(e.target)}},pp=(e,t,n,o)=>({id:fs(),annotation:typeof e=="string"?e:e.id,created:new Date,creator:o,...t}),Kl=(e,t)=>{const n=new Set(e.bodies.map(o=>o.id));return t.bodies.filter(o=>!n.has(o.id))},ql=(e,t)=>{const n=new Set(t.bodies.map(o=>o.id));return e.bodies.filter(o=>!n.has(o.id))},Yl=(e,t)=>t.bodies.map(n=>{const o=e.bodies.find(r=>r.id===n.id);return{newBody:n,oldBody:o&&!wt(o,n)?o:void 0}}).filter(({oldBody:n})=>n).map(({oldBody:n,newBody:o})=>({oldBody:n,newBody:o})),Wl=(e,t)=>!wt(e.target,t.target),ps=(e,t)=>{const n=Kl(e,t),o=ql(e,t),r=Yl(e,t);return{oldValue:e,newValue:t,bodiesCreated:n.length>0?n:void 0,bodiesDeleted:o.length>0?o:void 0,bodiesUpdated:r.length>0?r:void 0,targetUpdated:Wl(e,t)?{oldTarget:e.target,newTarget:t.target}:void 0}};var hs=(e=>(e.BODY_ONLY="BODY_ONLY",e.TARGET_ONLY="TARGET_ONLY",e))(hs||{}),te=(e=>(e.LOCAL="LOCAL",e.REMOTE="REMOTE",e.SILENT="SILENT",e))(te||{});const zl=(e,t)=>{var n,o;const{changes:r,origin:i}=t;if(!(e.options.origin?e.options.origin===i:i!=="SILENT"))return!1;if(e.options.ignore){const{ignore:s}=e.options,a=c=>c&&c.length>0;if(!(a(r.created)||a(r.deleted))){const c=(n=r.updated)==null?void 0:n.some(u=>a(u.bodiesCreated)||a(u.bodiesDeleted)||a(u.bodiesUpdated)),l=(o=r.updated)==null?void 0:o.some(u=>u.targetUpdated);if(s==="BODY_ONLY"&&c&&!l||s==="TARGET_ONLY"&&l&&!c)return!1}}if(e.options.annotations){const s=new Set([...(r.created||[]).map(a=>a.id),...(r.deleted||[]).map(a=>a.id),...(r.updated||[]).map(({oldValue:a})=>a.id)]);return!!(Array.isArray(e.options.annotations)?e.options.annotations:[e.options.annotations]).find(a=>s.has(a))}else return!0},Gl=(e,t)=>{const n=new Set((e.created||[]).map(d=>d.id)),o=new Set((e.updated||[]).map(({newValue:d})=>d.id)),r=new Set((t.created||[]).map(d=>d.id)),i=new Set((t.deleted||[]).map(d=>d.id)),s=new Set((t.updated||[]).map(({oldValue:d})=>d.id)),a=new Set((t.updated||[]).filter(({oldValue:d})=>n.has(d.id)||o.has(d.id)).map(({oldValue:d})=>d.id)),c=[...(e.created||[]).filter(d=>!i.has(d.id)).map(d=>s.has(d.id)?t.updated.find(({oldValue:f})=>f.id===d.id).newValue:d),...t.created||[]],l=[...(e.deleted||[]).filter(d=>!r.has(d.id)),...(t.deleted||[]).filter(d=>!n.has(d.id))],u=[...(e.updated||[]).filter(({newValue:d})=>!i.has(d.id)).map(d=>{const{oldValue:f,newValue:h}=d;if(s.has(h.id)){const m=t.updated.find(p=>p.oldValue.id===h.id).newValue;return ps(f,m)}else return d}),...(t.updated||[]).filter(({oldValue:d})=>!a.has(d.id))];return{created:c,deleted:l,updated:u}},Sn=e=>{const t=e.id===void 0?fs():e.id;return{...e,id:t,bodies:e.bodies===void 0?[]:e.bodies.map(n=>({...n,annotation:t})),target:{...e.target,annotation:t}}},Jl=e=>e.id!==void 0,Zl=()=>{const e=new Map,t=new Map,n=[],o=(R,T={})=>{n.push({onChange:R,options:T})},r=R=>{const T=n.findIndex(x=>x.onChange==R);T>-1&&n.splice(T,1)},i=(R,T)=>{const x={origin:R,changes:{created:T.created||[],updated:T.updated||[],deleted:T.deleted||[]},state:[...e.values()]};n.forEach(A=>{zl(A,x)&&A.onChange(x)})},s=(R,T=te.LOCAL)=>{if(R.id&&e.get(R.id))throw Error(`Cannot add annotation ${R.id} - exists already`);{const x=Sn(R);e.set(x.id,x),x.bodies.forEach(A=>t.set(A.id,x.id)),i(T,{created:[x]})}},a=(R,T)=>{const x=Sn(typeof R=="string"?T:R),A=typeof R=="string"?R:R.id,M=A&&e.get(A);if(M){const k=ps(M,x);return A===x.id?e.set(A,x):(e.delete(A),e.set(x.id,x)),M.bodies.forEach(C=>t.delete(C.id)),x.bodies.forEach(C=>t.set(C.id,x.id)),k}else console.warn(`Cannot update annotation ${A} - does not exist`)},c=(R,T=te.LOCAL,x=te.LOCAL)=>{const A=Jl(T)?x:T,M=a(R,T);M&&i(A,{updated:[M]})},l=(R,T=te.LOCAL)=>{e.get(R.id)?c(R,T):s(R,T)},u=(R,T=te.LOCAL)=>{const x=R.reduce((A,M)=>{const k=a(M);return k?[...A,k]:A},[]);x.length>0&&i(T,{updated:x})},d=(R,T=te.LOCAL)=>{const x=R.map(Sn),{toAdd:A,toUpdate:M}=x.reduce((C,U)=>e.get(U.id)?{...C,toUpdate:[...C.toUpdate,U]}:{...C,toAdd:[...C.toAdd,U]},{toAdd:[],toUpdate:[]}),k=M.map(C=>a(C,T)).filter(Boolean);A.forEach(C=>{e.set(C.id,C),C.bodies.forEach(U=>t.set(U.id,C.id))}),i(T,{created:A,updated:k})},f=(R,T=te.LOCAL)=>{const x=e.get(R.annotation);if(x){const A={...x,bodies:[...x.bodies,R]};e.set(x.id,A),t.set(R.id,A.id),i(T,{updated:[{oldValue:x,newValue:A,bodiesCreated:[R]}]})}else console.warn(`Attempt to add body to missing annotation: ${R.annotation}`)},h=()=>[...e.values()],m=(R=te.LOCAL)=>{const T=[...e.values()];e.clear(),t.clear(),i(R,{deleted:T})},p=(R,T=!0,x=te.LOCAL)=>{const A=R.map(Sn);if(T){const M=[...e.values()];e.clear(),t.clear(),A.forEach(k=>{e.set(k.id,k),k.bodies.forEach(C=>t.set(C.id,k.id))}),i(x,{created:A,deleted:M})}else{const M=R.reduce((k,C)=>{const U=C.id&&e.get(C.id);return U?[...k,U]:k},[]);if(M.length>0)throw Error(`Bulk insert would overwrite the following annotations: ${M.map(k=>k.id).join(", ")}`);A.forEach(k=>{e.set(k.id,k),k.bodies.forEach(C=>t.set(C.id,k.id))}),i(x,{created:A})}},E=R=>{const T=typeof R=="string"?R:R.id,x=e.get(T);if(x)return e.delete(T),x.bodies.forEach(A=>t.delete(A.id)),x;console.warn(`Attempt to delete missing annotation: ${T}`)},v=(R,T=te.LOCAL)=>{const x=E(R);x&&i(T,{deleted:[x]})},g=(R,T=te.LOCAL)=>{const x=R.reduce((A,M)=>{const k=E(M);return k?[...A,k]:A},[]);x.length>0&&i(T,{deleted:x})},y=R=>{const T=e.get(R.annotation);if(T){const x=T.bodies.find(A=>A.id===R.id);if(x){t.delete(x.id);const A={...T,bodies:T.bodies.filter(M=>M.id!==R.id)};return e.set(T.id,A),{oldValue:T,newValue:A,bodiesDeleted:[x]}}else console.warn(`Attempt to delete missing body ${R.id} from annotation ${R.annotation}`)}else console.warn(`Attempt to delete body from missing annotation ${R.annotation}`)},$=(R,T=te.LOCAL)=>{const x=y(R);x&&i(T,{updated:[x]})},S=(R,T=te.LOCAL)=>{const x=R.map(A=>y(A)).filter(Boolean);x.length>0&&i(T,{updated:x})},I=R=>{const T=e.get(R);return T?{...T}:void 0},P=R=>{const T=t.get(R);if(T){const x=I(T).bodies.find(A=>A.id===R);if(x)return x;console.error(`Store integrity error: body ${R} in index, but not in annotation`)}else console.warn(`Attempt to retrieve missing body: ${R}`)},L=(R,T)=>{if(R.annotation!==T.annotation)throw"Annotation integrity violation: annotation ID must be the same when updating bodies";const x=e.get(R.annotation);if(x){const A=x.bodies.find(k=>k.id===R.id),M={...x,bodies:x.bodies.map(k=>k.id===A.id?T:k)};return e.set(x.id,M),A.id!==T.id&&(t.delete(A.id),t.set(T.id,M.id)),{oldValue:x,newValue:M,bodiesUpdated:[{oldBody:A,newBody:T}]}}else console.warn(`Attempt to add body to missing annotation ${R.annotation}`)},N=(R,T,x=te.LOCAL)=>{const A=L(R,T);A&&i(x,{updated:[A]})},H=(R,T=te.LOCAL)=>{const x=R.map(A=>L({id:A.id,annotation:A.annotation},A)).filter(Boolean);i(T,{updated:x})},j=R=>{const T=e.get(R.annotation);if(T){const x={...T,target:{...T.target,...R}};return e.set(T.id,x),{oldValue:T,newValue:x,targetUpdated:{oldTarget:T.target,newTarget:R}}}else console.warn(`Attempt to update target on missing annotation: ${R.annotation}`)};return{addAnnotation:s,addBody:f,all:h,bulkAddAnnotations:p,bulkDeleteAnnotations:g,bulkDeleteBodies:S,bulkUpdateAnnotations:u,bulkUpdateBodies:H,bulkUpdateTargets:(R,T=te.LOCAL)=>{const x=R.map(A=>j(A)).filter(Boolean);x.length>0&&i(T,{updated:x})},bulkUpsertAnnotations:d,clear:m,deleteAnnotation:v,deleteBody:$,getAnnotation:I,getBody:P,observe:o,unobserve:r,updateAnnotation:c,updateBody:N,updateTarget:(R,T=te.LOCAL)=>{const x=j(R);x&&i(T,{updated:[x]})},upsertAnnotation:l}};let Ql=()=>({emit(e,...t){for(let n=this.events[e]||[],o=0,r=n.length;o<r;o++)n[o](...t)},events:{},on(e,t){var n;return((n=this.events)[e]||(n[e]=[])).push(t),()=>{var o;this.events[e]=(o=this.events[e])==null?void 0:o.filter(r=>t!==r)}}});const ec=250,tc=(e,t)=>{const n=Ql(),o=[];let r=-1,i=!1,s=0;const a=m=>{if(!i){const{changes:p}=m,E=performance.now();if(E-s>ec)o.splice(r+1),o.push(p),r=o.length-1;else{const v=o.length-1;o[v]=Gl(o[v],p)}s=E}i=!1};e.observe(a,{origin:te.LOCAL});const c=m=>m&&m.length>0&&e.bulkDeleteAnnotations(m),l=m=>m&&m.length>0&&e.bulkAddAnnotations(m,!1),u=m=>m&&m.length>0&&e.bulkUpdateAnnotations(m.map(({oldValue:p})=>p)),d=m=>m&&m.length>0&&e.bulkUpdateAnnotations(m.map(({newValue:p})=>p)),f=m=>m&&m.length>0&&e.bulkAddAnnotations(m,!1),h=m=>m&&m.length>0&&e.bulkDeleteAnnotations(m);return{canRedo:()=>o.length-1>r,canUndo:()=>r>-1,destroy:()=>e.unobserve(a),getHistory:()=>({changes:[...o],pointer:r}),on:(m,p)=>n.on(m,p),redo:()=>{if(o.length-1>r){i=!0;const{created:m,updated:p,deleted:E}=o[r+1];l(m),d(p),h(E),n.emit("redo",o[r+1]),r+=1}},undo:()=>{if(r>-1){i=!0;const{created:m,updated:p,deleted:E}=o[r];c(m),u(p),f(E),n.emit("undo",o[r]),r-=1}}}},nc=()=>{const{subscribe:e,set:t}=ar([]);return{subscribe:e,set:t}},oc=(e,t,n,o)=>{const{hover:r,selection:i,store:s,viewport:a}=e,c=new Map;let l=[],u;const d=(p,E)=>{c.has(p)?c.get(p).push(E):c.set(p,[E])},f=(p,E)=>{const v=c.get(p);if(v){const g=v.indexOf(E);g!==-1&&v.splice(g,1)}},h=(p,E,v)=>{c.has(p)&&setTimeout(()=>{c.get(p).forEach(g=>{if(n){const y=Array.isArray(E)?E.map(S=>n.serialize(S)):n.serialize(E),$=v?v instanceof PointerEvent?v:n.serialize(v):void 0;g(y,$)}else g(E,v)})},1)};i.subscribe(({selected:p})=>{if(!(l.length===0&&p.length===0)){if(l.length===0&&p.length>0)l=p.map(({id:E})=>s.getAnnotation(E));else if(l.length>0&&p.length===0)l.forEach(E=>{const v=s.getAnnotation(E.id);v&&!wt(v,E)&&h("updateAnnotation",v,E)}),l=[];else{const E=new Set(l.map(g=>g.id)),v=new Set(p.map(({id:g})=>g));l.filter(g=>!v.has(g.id)).forEach(g=>{const y=s.getAnnotation(g.id);y&&!wt(y,g)&&h("updateAnnotation",y,g)}),l=[...l.filter(g=>v.has(g.id)),...p.filter(({id:g})=>!E.has(g)).map(({id:g})=>s.getAnnotation(g))]}h("selectionChanged",l)}}),r.subscribe(p=>{!u&&p?h("mouseEnterAnnotation",s.getAnnotation(p)):u&&!p?h("mouseLeaveAnnotation",s.getAnnotation(u)):u&&p&&(h("mouseLeaveAnnotation",s.getAnnotation(u)),h("mouseEnterAnnotation",s.getAnnotation(p))),u=p}),a==null||a.subscribe(p=>h("viewportIntersect",p.map(E=>s.getAnnotation(E)))),s.observe(p=>{const{created:E,deleted:v}=p.changes;(E||[]).forEach(g=>h("createAnnotation",g)),(v||[]).forEach(g=>h("deleteAnnotation",g)),(p.changes.updated||[]).filter(g=>[...g.bodiesCreated||[],...g.bodiesDeleted||[],...g.bodiesUpdated||[]].length>0).forEach(({oldValue:g,newValue:y})=>{const $=l.find(S=>S.id===g.id)||g;l=l.map(S=>S.id===g.id?y:S),h("updateAnnotation",y,$)})},{origin:te.LOCAL}),s.observe(p=>{if(l){const E=new Set(l.map(g=>g.id)),v=(p.changes.updated||[]).filter(({newValue:g})=>E.has(g.id)).map(({newValue:g})=>g);v.length>0&&(l=l.map(g=>v.find($=>$.id===g.id)||g))}},{origin:te.REMOTE});const m=p=>E=>{const{updated:v}=E;p?(v||[]).forEach(g=>h("updateAnnotation",g.oldValue,g.newValue)):(v||[]).forEach(g=>h("updateAnnotation",g.newValue,g.oldValue))};return t.on("undo",m(!0)),t.on("redo",m(!1)),{on:d,off:f,emit:h}},rc=e=>t=>t.reduce((n,o)=>{const{parsed:r,error:i}=e.parse(o);return i?{parsed:n.parsed,failed:[...n.failed,o]}:r?{parsed:[...n.parsed,r],failed:n.failed}:{...n}},{parsed:[],failed:[]}),ic=(e,t,n)=>{const{store:o,selection:r}=e,i=v=>{if(n){const{parsed:g,error:y}=n.parse(v);g?o.addAnnotation(g,te.REMOTE):console.error(y)}else o.addAnnotation(wo(v),te.REMOTE)},s=()=>r.clear(),a=()=>o.clear(),c=v=>{const g=o.getAnnotation(v);return n&&g?n.serialize(g):g},l=()=>n?o.all().map(n.serialize):o.all(),u=()=>{var v;const g=(((v=r.selected)==null?void 0:v.map(y=>y.id))||[]).map(y=>o.getAnnotation(y)).filter(Boolean);return n?g.map(n.serialize):g},d=(v,g=!0)=>fetch(v).then(y=>y.json()).then(y=>(h(y,g),y)),f=v=>{if(typeof v=="string"){const g=o.getAnnotation(v);if(o.deleteAnnotation(v),g)return n?n.serialize(g):g}else{const g=n?n.parse(v).parsed:v;if(g)return o.deleteAnnotation(g),v}},h=(v,g=!0)=>{if(n){const y=n.parseAll||rc(n),{parsed:$,failed:S}=y(v);S.length>0&&console.warn(`Discarded ${S.length} invalid annotations`,S),o.bulkAddAnnotations($,g,te.REMOTE)}else o.bulkAddAnnotations(v.map(wo),g,te.REMOTE)},m=(v,g)=>{v?r.setSelected(v,g):r.clear()},p=v=>{r.clear(),r.setUserSelectAction(v)},E=v=>{if(n){const g=n.parse(v).parsed,y=n.serialize(o.getAnnotation(g.id));return o.updateAnnotation(g),y}else{const g=o.getAnnotation(v.id);return o.updateAnnotation(wo(v)),g}};return{addAnnotation:i,cancelSelected:s,canRedo:t.canRedo,canUndo:t.canUndo,clearAnnotations:a,getAnnotationById:c,getAnnotations:l,getHistory:t.getHistory,getSelected:u,loadAnnotations:d,redo:t.redo,removeAnnotation:f,setAnnotations:h,setSelected:m,setUserSelectAction:p,undo:t.undo,updateAnnotation:E}},sc="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ac=e=>crypto.getRandomValues(new Uint8Array(e)),lc=(e,t,n)=>{let o=(2<<Math.log2(e.length-1))-1,r=-~(1.6*o*t/e.length);return(i=t)=>{let s="";for(;;){let a=n(r),c=r|0;for(;c--;)if(s+=e[a[c]&o]||"",s.length>=i)return s}}},cc=(e,t=21)=>lc(e,t|0,ac),uc=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=sc[n[e]&63];return t};const dc=()=>({isGuest:!0,id:cc("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()});uc();const fc=[];for(let e=0;e<256;++e)fc.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const pc="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let hc=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=pc[n[e]&63];return t};hc();const xo=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Eo(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on".concat(t),n)}function zt(e,t,n,o){e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on".concat(t),n)}function gs(e,t){const n=t.slice(0,t.length-1);for(let o=0;o<n.length;o++)n[o]=e[n[o].toLowerCase()];return n}function ms(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function gc(e,t){const n=e.length>=t.length?e:t,o=e.length>=t.length?t:e;let r=!0;for(let i=0;i<n.length;i++)o.indexOf(n[i])===-1&&(r=!1);return r}const pn={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":xo?173:189,"=":xo?61:187,";":xo?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},Ke={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,meta:91,command:91},Zt={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Ee={16:!1,18:!1,17:!1,91:!1},pe={};for(let e=1;e<20;e++)pn["f".concat(e)]=111+e;let le=[],sn=null,ys="all";const et=new Map,Xt=e=>pn[e.toLowerCase()]||Ke[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),mc=e=>Object.keys(pn).find(t=>pn[t]===e),yc=e=>Object.keys(Ke).find(t=>Ke[t]===e);function vs(e){ys=e||"all"}function hn(){return ys||"all"}function vc(){return le.slice(0)}function bc(){return le.map(e=>mc(e)||yc(e)||String.fromCharCode(e))}function wc(){const e=[];return Object.keys(pe).forEach(t=>{pe[t].forEach(n=>{let{key:o,scope:r,mods:i,shortcut:s}=n;e.push({scope:r,shortcut:s,mods:i,keys:o.split("+").map(a=>Xt(a))})})}),e}function xc(e){const t=e.target||e.srcElement,{tagName:n}=t;let o=!0;const r=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(r||n==="TEXTAREA"||n==="SELECT")&&!t.readOnly)&&(o=!1),o}function Ec(e){return typeof e=="string"&&(e=Xt(e)),le.indexOf(e)!==-1}function Ac(e,t){let n,o;e||(e=hn());for(const r in pe)if(Object.prototype.hasOwnProperty.call(pe,r))for(n=pe[r],o=0;o<n.length;)n[o].scope===e?n.splice(o,1).forEach(i=>{let{element:s}=i;return lr(s)}):o++;hn()===e&&vs(t||"all")}function Sc(e){let t=e.keyCode||e.which||e.charCode;e.key&&e.key.toLowerCase()==="capslock"&&(t=Xt(e.key));const n=le.indexOf(t);if(n>=0&&le.splice(n,1),e.key&&e.key.toLowerCase()==="meta"&&le.splice(0,le.length),(t===93||t===224)&&(t=91),t in Ee){Ee[t]=!1;for(const o in Ke)Ke[o]===t&&(ut[o]=!1)}}function bs(e){if(typeof e>"u")Object.keys(pe).forEach(r=>{Array.isArray(pe[r])&&pe[r].forEach(i=>$n(i)),delete pe[r]}),lr(null);else if(Array.isArray(e))e.forEach(r=>{r.key&&$n(r)});else if(typeof e=="object")e.key&&$n(e);else if(typeof e=="string"){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];let[r,i]=n;typeof r=="function"&&(i=r,r=""),$n({key:e,scope:r,method:i,splitKey:"+"})}}const $n=e=>{let{key:t,scope:n,method:o,splitKey:r="+"}=e;ms(t).forEach(i=>{const s=i.split(r),a=s.length,c=s[a-1],l=c==="*"?"*":Xt(c);if(!pe[l])return;n||(n=hn());const u=a>1?gs(Ke,s):[],d=[];pe[l]=pe[l].filter(f=>{const h=(o?f.method===o:!0)&&f.scope===n&&gc(f.mods,u);return h&&d.push(f.element),!h}),d.forEach(f=>lr(f))})};function oi(e,t,n,o){if(t.element!==o)return;let r;if(t.scope===n||t.scope==="all"){r=t.mods.length>0;for(const i in Ee)Object.prototype.hasOwnProperty.call(Ee,i)&&(!Ee[i]&&t.mods.indexOf(+i)>-1||Ee[i]&&t.mods.indexOf(+i)===-1)&&(r=!1);(t.mods.length===0&&!Ee[16]&&!Ee[18]&&!Ee[17]&&!Ee[91]||r||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(le),t.method(e,t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function ri(e,t){const n=pe["*"];let o=e.keyCode||e.which||e.charCode;if(e.key&&e.key.toLowerCase()==="capslock"||!ut.filter.call(this,e))return;if((o===93||o===224)&&(o=91),le.indexOf(o)===-1&&o!==229&&le.push(o),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const c=Zt[a];e[a]&&le.indexOf(c)===-1?le.push(c):!e[a]&&le.indexOf(c)>-1?le.splice(le.indexOf(c),1):a==="metaKey"&&e[a]&&(le=le.filter(l=>l in Zt||l===o))}),o in Ee){Ee[o]=!0;for(const a in Ke)if(Object.prototype.hasOwnProperty.call(Ke,a)){const c=Zt[Ke[a]];ut[a]=e[c]}if(!n)return}for(const a in Ee)Object.prototype.hasOwnProperty.call(Ee,a)&&(Ee[a]=e[Zt[a]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(le.indexOf(17)===-1&&le.push(17),le.indexOf(18)===-1&&le.push(18),Ee[17]=!0,Ee[18]=!0);const r=hn();if(n)for(let a=0;a<n.length;a++)n[a].scope===r&&(e.type==="keydown"&&n[a].keydown||e.type==="keyup"&&n[a].keyup)&&oi(e,n[a],r,t);if(!(o in pe))return;const i=pe[o],s=i.length;for(let a=0;a<s;a++)if((e.type==="keydown"&&i[a].keydown||e.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,u=c.key.split(l),d=[];for(let f=0;f<u.length;f++)d.push(Xt(u[f]));d.sort().join("")===le.sort().join("")&&oi(e,c,r,t)}}function ut(e,t,n){le=[];const o=ms(e);let r=[],i="all",s=document,a=0,c=!1,l=!0,u="+",d=!1,f=!1;for(n===void 0&&typeof t=="function"&&(n=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(i=t.scope),t.element&&(s=t.element),t.keyup&&(c=t.keyup),t.keydown!==void 0&&(l=t.keydown),t.capture!==void 0&&(d=t.capture),typeof t.splitKey=="string"&&(u=t.splitKey),t.single===!0&&(f=!0)),typeof t=="string"&&(i=t),f&&bs(e,i);a<o.length;a++)e=o[a].split(u),r=[],e.length>1&&(r=gs(Ke,e)),e=e[e.length-1],e=e==="*"?"*":Xt(e),e in pe||(pe[e]=[]),pe[e].push({keyup:c,keydown:l,scope:i,mods:r,shortcut:o[a],method:n,key:o[a],splitKey:u,element:s});if(typeof s<"u"&&window){if(!et.has(s)){const h=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return ri(p,s)},m=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;ri(p,s),Sc(p)};et.set(s,{keydownListener:h,keyupListenr:m,capture:d}),Eo(s,"keydown",h,d),Eo(s,"keyup",m,d)}if(!sn){const h=()=>{le=[]};sn={listener:h,capture:d},Eo(window,"focus",h,d)}}}function $c(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(pe).forEach(n=>{pe[n].filter(o=>o.scope===t&&o.shortcut===e).forEach(o=>{o&&o.method&&o.method()})})}function lr(e){const t=Object.values(pe).flat();if(t.findIndex(n=>{let{element:o}=n;return o===e})<0){const{keydownListener:n,keyupListenr:o,capture:r}=et.get(e)||{};n&&o&&(zt(e,"keyup",o,r),zt(e,"keydown",n,r),et.delete(e))}if((t.length<=0||et.size<=0)&&(Object.keys(et).forEach(n=>{const{keydownListener:o,keyupListenr:r,capture:i}=et.get(n)||{};o&&r&&(zt(n,"keyup",r,i),zt(n,"keydown",o,i),et.delete(n))}),et.clear(),Object.keys(pe).forEach(n=>delete pe[n]),sn)){const{listener:n,capture:o}=sn;zt(window,"focus",n,o),sn=null}}const Ao={getPressedKeyString:bc,setScope:vs,getScope:hn,deleteScope:Ac,getPressedKeyCodes:vc,getAllKeyCodes:wc,isPressed:Ec,filter:xc,trigger:$c,unbind:bs,keyMap:pn,modifier:Ke,modifierMap:Zt};for(const e in Ao)Object.prototype.hasOwnProperty.call(Ao,e)&&(ut[e]=Ao[e]);if(typeof window<"u"){const e=window.hotkeys;ut.noConflict=t=>(t&&window.hotkeys===ut&&(window.hotkeys=e),ut),window.hotkeys=ut}const Tc="not-annotatable",ws=`.${Tc}`;typeof navigator<"u"&&/mac/i.test(navigator.userAgentData?navigator.userAgentData.platform:navigator.platform);const Rc=e=>{const t=e.cloneContents();return t.querySelectorAll(ws).forEach(n=>n.remove()),t},Cc=e=>e.every(t=>t.range instanceof Range&&!t.range.collapsed),Oc=(e,t,n)=>{const o=document.createRange(),r=t;o.setStart(r,0),o.setEnd(e.startContainer,e.startOffset);const i=Rc(o).textContent,s=e.toString(),a=i.length||0,c=a+s.length;return{quote:s,start:a,end:c,range:e}},Lc=(e,t)=>{var n,o;const{start:r,end:i}=e,s=e.offsetReference||t,a=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,f=>{var h;return(h=f.parentElement)!=null&&h.closest(ws)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT});let c=0;const l=document.createRange();let u=a.nextNode();u===null&&console.error("Could not revive annotation target. Content missing.");let d=!s;for(;u!==null;){if(d||(d=typeof(s==null?void 0:s.contains)=="function"?s.contains(u):!1),d){const f=((n=u.textContent)==null?void 0:n.length)||0;if(c+f>r){l.setStart(u,r-c);break}c+=f}u=a.nextNode()}for(;u!==null;){const f=((o=u.textContent)==null?void 0:o.length)||0;if(c+f>=i){l.setEnd(u,i-c);break}c+=f,u=a.nextNode()}return{...e,range:l}},ii=(e,t)=>Cc(e.selector)?e:{...e,selector:e.selector.map(n=>n.range instanceof Range&&!n.range.collapsed?n:Lc(n,t))},kc=(e,t,n)=>{let o=e,r=n;const i=document.createNodeIterator(t,NodeFilter.SHOW_TEXT);let s=i.nextNode(),a=!0;do s instanceof Text&&(s.length<r?r-=s.length:(o=s,a=!1)),s=i.nextNode();while(s&&a);return{node:o,offset:r}},Yo=(e,t=[])=>{let n,o,r;if(e.nodeType===Node.ELEMENT_NODE&&e.hasAttribute("xml:id")?t.push("/"):e.parentNode&&(t=Yo(e.parentNode,t)),e.nodeType===Node.ELEMENT_NODE&&e.nodeName.toLowerCase().startsWith("tei-")){const i=e;i.hasAttribute("xml:id")?r=`[@xml:id='${i.getAttribute("xml:id")}']`:(n=`count(preceding-sibling::${i.localName})`,o=document.evaluate(n,e,null,XPathResult.NUMBER_TYPE,null).numberValue+1,r=`[${o}]`),t.push("/"),t.push(i.getAttribute("data-origname")+r)}return t},Mc=(e,t,n)=>{const o=l=>l?l.nodeName.toLowerCase().indexOf("tei-")===0?l:o(l.parentNode):null,r=(l,u,d)=>{const f=document.createRange();return f.setStart(l,0),f.setEnd(u,d),f.toString().length},i=r(o(n.startContainer),n.startContainer,n.startOffset),s=r(o(n.endContainer),n.endContainer,n.endOffset),a=e.join("")+"::"+i,c=t.join("")+"::"+s;return{start:a,end:c}},_c=e=>{var t;const{range:n}=e,o=Yo(n.startContainer),r=Yo(n.endContainer),{start:i,end:s}=Mc(o,r,n);return{start:e.start,startSelector:{type:"XPathSelector",value:i},end:e.end,endSelector:{type:"XPathSelector",value:s},quote:(t=e.quote)==null?void 0:t.replace(/\s+/g," "),range:n}},Pc=(e,t)=>{var n,o;const r=Array.isArray(e.selector)?e.selector[0]:e.selector;if("start"in r&&"end"in r)return ii(e,t);{const i=(n=r.startSelector)==null?void 0:n.value,s=(o=r.endSelector)==null?void 0:o.value;if(!i||!s)throw console.error(e),"Could not revive TEI target.";const a=v=>{const g=v.indexOf("::");if(g<0)return;const y=v.substring(0,g).replace(/\/([^[/]+)/g,(I,P)=>"/tei-"+P.toLowerCase()).replace(/xml:/g,""),$=document.evaluate("."+y,t,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,S=parseInt(v.substring(g+2));return[$,S]},[c,l]=a(i),[u,d]=a(s),f=document.createRange(),h=(v,g)=>v.firstChild instanceof Text&&v.firstChild.length>=g?{node:v.firstChild,offset:g}:kc(v.firstChild,v,g),m=h(c,l);f.setStart(m.node,m.offset);const p=h(u,d);f.setEnd(p.node,p.offset);const E=Oc(f,t);return ii({...e,selector:[{...E,...r,range:f}]},t)}},xs=e=>t=>{const n=Pc(t,e);return{...t,selector:n.selector.map(_c)}},Nc=e=>t=>({...t,target:xs(e)(t.target)}),Ic=e=>{const t=e.element,n=Nc(t),o=xs(t),r=e.state.store,i=r.addAnnotation;r.addAnnotation=(l,u)=>{const{selector:d}=l.target;try{return"startSelector"in d&&"start"in d?i(l,u):i(n(l),u)}catch(f){console.warn(f),console.warn("Failed to render annotation",l)}};const s=r.bulkAddAnnotations;r.bulkAddAnnotations=(l,u=!0,d)=>{const f=l.map(m=>{const{selector:p}=m.target;try{return"startSelector"in p&&"start"in p?m:n(m)}catch(E){console.warn(E)}}),h=f.filter(Boolean);return f.length!==h.length&&(console.warn(`Failed to render ${f.length-h.length} annotations.`),f.forEach((m,p)=>{m||console.warn(l[p])})),s(h,u,d)};const a=r.updateAnnotation;r.updateAnnotation=(l,u)=>a(n(l),u);const c=r.updateTarget;return r.updateTarget=(l,u)=>c(o(l),u),{...e,state:{...e.state,store:r}}};var Dc={grad:.9,turn:360,rad:360/(2*Math.PI)},Qe=function(e){return typeof e=="string"?e.length>0:typeof e=="number"},ve=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=Math.pow(10,t)),Math.round(n*e)/n+0},Be=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1),e>n?n:e>t?e:t},Es=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},si=function(e){return{r:Be(e.r,0,255),g:Be(e.g,0,255),b:Be(e.b,0,255),a:Be(e.a)}},So=function(e){return{r:ve(e.r),g:ve(e.g),b:ve(e.b),a:ve(e.a,3)}},Bc=/^#([0-9a-f]{3,8})$/i,Tn=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},As=function(e){var t=e.r,n=e.g,o=e.b,r=e.a,i=Math.max(t,n,o),s=i-Math.min(t,n,o),a=s?i===t?(n-o)/s:i===n?2+(o-t)/s:4+(t-n)/s:0;return{h:60*(a<0?a+6:a),s:i?s/i*100:0,v:i/255*100,a:r}},Ss=function(e){var t=e.h,n=e.s,o=e.v,r=e.a;t=t/360*6,n/=100,o/=100;var i=Math.floor(t),s=o*(1-n),a=o*(1-(t-i)*n),c=o*(1-(1-t+i)*n),l=i%6;return{r:255*[o,a,s,s,c,o][l],g:255*[c,o,o,a,s,s][l],b:255*[s,s,c,o,o,a][l],a:r}},ai=function(e){return{h:Es(e.h),s:Be(e.s,0,100),l:Be(e.l,0,100),a:Be(e.a)}},li=function(e){return{h:ve(e.h),s:ve(e.s),l:ve(e.l),a:ve(e.a,3)}},ci=function(e){return Ss((n=(t=e).s,{h:t.h,s:(n*=((o=t.l)<50?o:100-o)/100)>0?2*n/(o+n)*100:0,v:o+n,a:t.a}));var t,n,o},an=function(e){return{h:(t=As(e)).h,s:(r=(200-(n=t.s))*(o=t.v)/100)>0&&r<200?n*o/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,n,o,r},jc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Hc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Uc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Vc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ui={string:[[function(e){var t=Bc.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?ve(parseInt(e[3]+e[3],16)/255,2):1}:e.length===6||e.length===8?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:e.length===8?ve(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=Uc.exec(e)||Vc.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:si({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=jc.exec(e)||Hc.exec(e);if(!t)return null;var n,o,r=ai({h:(n=t[1],o=t[2],o===void 0&&(o="deg"),Number(n)*(Dc[o]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return ci(r)},"hsl"]],object:[[function(e){var t=e.r,n=e.g,o=e.b,r=e.a,i=r===void 0?1:r;return Qe(t)&&Qe(n)&&Qe(o)?si({r:Number(t),g:Number(n),b:Number(o),a:Number(i)}):null},"rgb"],[function(e){var t=e.h,n=e.s,o=e.l,r=e.a,i=r===void 0?1:r;if(!Qe(t)||!Qe(n)||!Qe(o))return null;var s=ai({h:Number(t),s:Number(n),l:Number(o),a:Number(i)});return ci(s)},"hsl"],[function(e){var t=e.h,n=e.s,o=e.v,r=e.a,i=r===void 0?1:r;if(!Qe(t)||!Qe(n)||!Qe(o))return null;var s=(function(a){return{h:Es(a.h),s:Be(a.s,0,100),v:Be(a.v,0,100),a:Be(a.a)}})({h:Number(t),s:Number(n),v:Number(o),a:Number(i)});return Ss(s)},"hsv"]]},di=function(e,t){for(var n=0;n<t.length;n++){var o=t[n][0](e);if(o)return[o,t[n][1]]}return[null,void 0]},Fc=function(e){return typeof e=="string"?di(e.trim(),ui.string):typeof e=="object"&&e!==null?di(e,ui.object):[null,void 0]},$o=function(e,t){var n=an(e);return{h:n.h,s:Be(n.s+100*t,0,100),l:n.l,a:n.a}},To=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},fi=function(e,t){var n=an(e);return{h:n.h,s:n.s,l:Be(n.l+100*t,0,100),a:n.a}},pi=(function(){function e(t){this.parsed=Fc(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return this.parsed!==null},e.prototype.brightness=function(){return ve(To(this.rgba),2)},e.prototype.isDark=function(){return To(this.rgba)<.5},e.prototype.isLight=function(){return To(this.rgba)>=.5},e.prototype.toHex=function(){return t=So(this.rgba),n=t.r,o=t.g,r=t.b,s=(i=t.a)<1?Tn(ve(255*i)):"","#"+Tn(n)+Tn(o)+Tn(r)+s;var t,n,o,r,i,s},e.prototype.toRgb=function(){return So(this.rgba)},e.prototype.toRgbString=function(){return t=So(this.rgba),n=t.r,o=t.g,r=t.b,(i=t.a)<1?"rgba("+n+", "+o+", "+r+", "+i+")":"rgb("+n+", "+o+", "+r+")";var t,n,o,r,i},e.prototype.toHsl=function(){return li(an(this.rgba))},e.prototype.toHslString=function(){return t=li(an(this.rgba)),n=t.h,o=t.s,r=t.l,(i=t.a)<1?"hsla("+n+", "+o+"%, "+r+"%, "+i+")":"hsl("+n+", "+o+"%, "+r+"%)";var t,n,o,r,i},e.prototype.toHsv=function(){return t=As(this.rgba),{h:ve(t.h),s:ve(t.s),v:ve(t.v),a:ve(t.a,3)};var t},e.prototype.invert=function(){return Ve({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},e.prototype.saturate=function(t){return t===void 0&&(t=.1),Ve($o(this.rgba,t))},e.prototype.desaturate=function(t){return t===void 0&&(t=.1),Ve($o(this.rgba,-t))},e.prototype.grayscale=function(){return Ve($o(this.rgba,-1))},e.prototype.lighten=function(t){return t===void 0&&(t=.1),Ve(fi(this.rgba,t))},e.prototype.darken=function(t){return t===void 0&&(t=.1),Ve(fi(this.rgba,-t))},e.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},e.prototype.alpha=function(t){return typeof t=="number"?Ve({r:(n=this.rgba).r,g:n.g,b:n.b,a:t}):ve(this.rgba.a,3);var n},e.prototype.hue=function(t){var n=an(this.rgba);return typeof t=="number"?Ve({h:t,s:n.s,l:n.l,a:n.a}):ve(n.h)},e.prototype.isEqual=function(t){return this.toHex()===Ve(t).toHex()},e})(),Ve=function(e){return e instanceof pi?e:new pi(e)},hi=Object.prototype.hasOwnProperty;function Wo(e,t){var n,o;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((o=e.length)===t.length)for(;o--&&Wo(e[o],t[o]););return o===-1}if(!n||typeof e=="object"){o=0;for(n in e)if(hi.call(e,n)&&++o&&!hi.call(t,n)||!(n in t)||!Wo(e[n],t[n]))return!1;return Object.keys(t).length===o}}return e!==e&&t!==t}const xe=[];for(let e=0;e<256;++e)xe.push((e+256).toString(16).slice(1));function Xc(e,t=0){return(xe[e[t+0]]+xe[e[t+1]]+xe[e[t+2]]+xe[e[t+3]]+"-"+xe[e[t+4]]+xe[e[t+5]]+"-"+xe[e[t+6]]+xe[e[t+7]]+"-"+xe[e[t+8]]+xe[e[t+9]]+"-"+xe[e[t+10]]+xe[e[t+11]]+xe[e[t+12]]+xe[e[t+13]]+xe[e[t+14]]+xe[e[t+15]]).toLowerCase()}let Ro;const Kc=new Uint8Array(16);function qc(){if(!Ro){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ro=crypto.getRandomValues.bind(crypto)}return Ro(Kc)}const Yc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),gi={randomUUID:Yc};function Wc(e,t,n){var r;if(gi.randomUUID&&!e)return gi.randomUUID();e=e||{};const o=e.random??((r=e.rng)==null?void 0:r.call(e))??qc();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,Xc(o)}function $s(e,t,n=0,o=e.length-1,r=zc){for(;o>n;){if(o-n>600){const c=o-n+1,l=t-n+1,u=Math.log(c),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(c-d)/c)*(l-c/2<0?-1:1),h=Math.max(n,Math.floor(t-l*d/c+f)),m=Math.min(o,Math.floor(t+(c-l)*d/c+f));$s(e,t,h,m,r)}const i=e[t];let s=n,a=o;for(Gt(e,n,t),r(e[o],i)>0&&Gt(e,n,o);s<a;){for(Gt(e,s,a),s++,a--;r(e[s],i)<0;)s++;for(;r(e[a],i)>0;)a--}r(e[n],i)===0?Gt(e,n,a):(a++,Gt(e,a,o)),a<=t&&(n=a+1),t<=a&&(o=a-1)}}function Gt(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}function zc(e,t){return e<t?-1:e>t?1:0}class Gc{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let n=this.data;const o=[];if(!Cn(t,n))return o;const r=this.toBBox,i=[];for(;n;){for(let s=0;s<n.children.length;s++){const a=n.children[s],c=n.leaf?r(a):a;Cn(t,c)&&(n.leaf?o.push(a):Oo(t,c)?this._all(a,o):i.push(a))}n=i.pop()}return o}collides(t){let n=this.data;if(!Cn(t,n))return!1;const o=[];for(;n;){for(let r=0;r<n.children.length;r++){const i=n.children[r],s=n.leaf?this.toBBox(i):i;if(Cn(t,s)){if(n.leaf||Oo(t,s))return!0;o.push(i)}}n=o.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let o=0;o<t.length;o++)this.insert(t[o]);return this}let n=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const o=this.data;this.data=n,n=o}this._insert(n,this.data.height-n.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Ct([]),this}remove(t,n){if(!t)return this;let o=this.data;const r=this.toBBox(t),i=[],s=[];let a,c,l;for(;o||i.length;){if(o||(o=i.pop(),c=i[i.length-1],a=s.pop(),l=!0),o.leaf){const u=Jc(t,o.children,n);if(u!==-1)return o.children.splice(u,1),i.push(o),this._condense(i),this}!l&&!o.leaf&&Oo(o,r)?(i.push(o),s.push(a),a=0,c=o,o=o.children[0]):c?(a++,o=c.children[a],l=!1):o=null}return this}toBBox(t){return t}compareMinX(t,n){return t.minX-n.minX}compareMinY(t,n){return t.minY-n.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,n){const o=[];for(;t;)t.leaf?n.push(...t.children):o.push(...t.children),t=o.pop();return n}_build(t,n,o,r){const i=o-n+1;let s=this._maxEntries,a;if(i<=s)return a=Ct(t.slice(n,o+1)),$t(a,this.toBBox),a;r||(r=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,r-1))),a=Ct([]),a.leaf=!1,a.height=r;const c=Math.ceil(i/s),l=c*Math.ceil(Math.sqrt(s));mi(t,n,o,l,this.compareMinX);for(let u=n;u<=o;u+=l){const d=Math.min(u+l-1,o);mi(t,u,d,c,this.compareMinY);for(let f=u;f<=d;f+=c){const h=Math.min(f+c-1,d);a.children.push(this._build(t,f,h,r-1))}}return $t(a,this.toBBox),a}_chooseSubtree(t,n,o,r){for(;r.push(n),!(n.leaf||r.length-1===o);){let i=1/0,s=1/0,a;for(let c=0;c<n.children.length;c++){const l=n.children[c],u=Co(l),d=eu(t,l)-u;d<s?(s=d,i=u<i?u:i,a=l):d===s&&u<i&&(i=u,a=l)}n=a||n.children[0]}return n}_insert(t,n,o){const r=o?t:this.toBBox(t),i=[],s=this._chooseSubtree(r,this.data,n,i);for(s.children.push(t),en(s,r);n>=0&&i[n].children.length>this._maxEntries;)this._split(i,n),n--;this._adjustParentBBoxes(r,i,n)}_split(t,n){const o=t[n],r=o.children.length,i=this._minEntries;this._chooseSplitAxis(o,i,r);const s=this._chooseSplitIndex(o,i,r),a=Ct(o.children.splice(s,o.children.length-s));a.height=o.height,a.leaf=o.leaf,$t(o,this.toBBox),$t(a,this.toBBox),n?t[n-1].children.push(a):this._splitRoot(o,a)}_splitRoot(t,n){this.data=Ct([t,n]),this.data.height=t.height+1,this.data.leaf=!1,$t(this.data,this.toBBox)}_chooseSplitIndex(t,n,o){let r,i=1/0,s=1/0;for(let a=n;a<=o-n;a++){const c=Qt(t,0,a,this.toBBox),l=Qt(t,a,o,this.toBBox),u=tu(c,l),d=Co(c)+Co(l);u<i?(i=u,r=a,s=d<s?d:s):u===i&&d<s&&(s=d,r=a)}return r||o-n}_chooseSplitAxis(t,n,o){const r=t.leaf?this.compareMinX:Zc,i=t.leaf?this.compareMinY:Qc,s=this._allDistMargin(t,n,o,r),a=this._allDistMargin(t,n,o,i);s<a&&t.children.sort(r)}_allDistMargin(t,n,o,r){t.children.sort(r);const i=this.toBBox,s=Qt(t,0,n,i),a=Qt(t,o-n,o,i);let c=Rn(s)+Rn(a);for(let l=n;l<o-n;l++){const u=t.children[l];en(s,t.leaf?i(u):u),c+=Rn(s)}for(let l=o-n-1;l>=n;l--){const u=t.children[l];en(a,t.leaf?i(u):u),c+=Rn(a)}return c}_adjustParentBBoxes(t,n,o){for(let r=o;r>=0;r--)en(n[r],t)}_condense(t){for(let n=t.length-1,o;n>=0;n--)t[n].children.length===0?n>0?(o=t[n-1].children,o.splice(o.indexOf(t[n]),1)):this.clear():$t(t[n],this.toBBox)}}function Jc(e,t,n){if(!n)return t.indexOf(e);for(let o=0;o<t.length;o++)if(n(e,t[o]))return o;return-1}function $t(e,t){Qt(e,0,e.children.length,t,e)}function Qt(e,t,n,o,r){r||(r=Ct(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let i=t;i<n;i++){const s=e.children[i];en(r,e.leaf?o(s):s)}return r}function en(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Zc(e,t){return e.minX-t.minX}function Qc(e,t){return e.minY-t.minY}function Co(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Rn(e){return e.maxX-e.minX+(e.maxY-e.minY)}function eu(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function tu(e,t){const n=Math.max(e.minX,t.minX),o=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),i=Math.min(e.maxY,t.maxY);return Math.max(0,r-n)*Math.max(0,i-o)}function Oo(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function Cn(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Ct(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function mi(e,t,n,o,r){const i=[t,n];for(;i.length;){if(n=i.pop(),t=i.pop(),n-t<=o)continue;const s=t+Math.ceil((n-t)/o/2)*o;$s(e,s,t,n,r),i.push(t,s,s,n)}}const Lo=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function ko(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on".concat(t),n)}function Jt(e,t,n,o){e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on".concat(t),n)}function Ts(e,t){const n=t.slice(0,t.length-1);for(let o=0;o<n.length;o++)n[o]=e[n[o].toLowerCase()];return n}function Rs(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function nu(e,t){const n=e.length>=t.length?e:t,o=e.length>=t.length?t:e;let r=!0;for(let i=0;i<n.length;i++)o.indexOf(n[i])===-1&&(r=!1);return r}const gn={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":Lo?173:189,"=":Lo?61:187,";":Lo?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},qe={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,meta:91,command:91},tn={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Ae={16:!1,18:!1,17:!1,91:!1},he={};for(let e=1;e<20;e++)gn["f".concat(e)]=111+e;let ce=[],ln=null,Cs="all";const tt=new Map,Kt=e=>gn[e.toLowerCase()]||qe[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),ou=e=>Object.keys(gn).find(t=>gn[t]===e),ru=e=>Object.keys(qe).find(t=>qe[t]===e);function Os(e){Cs=e||"all"}function mn(){return Cs||"all"}function iu(){return ce.slice(0)}function su(){return ce.map(e=>ou(e)||ru(e)||String.fromCharCode(e))}function au(){const e=[];return Object.keys(he).forEach(t=>{he[t].forEach(n=>{let{key:o,scope:r,mods:i,shortcut:s}=n;e.push({scope:r,shortcut:s,mods:i,keys:o.split("+").map(a=>Kt(a))})})}),e}function lu(e){const t=e.target||e.srcElement,{tagName:n}=t;let o=!0;const r=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(r||n==="TEXTAREA"||n==="SELECT")&&!t.readOnly)&&(o=!1),o}function cu(e){return typeof e=="string"&&(e=Kt(e)),ce.indexOf(e)!==-1}function uu(e,t){let n,o;e||(e=mn());for(const r in he)if(Object.prototype.hasOwnProperty.call(he,r))for(n=he[r],o=0;o<n.length;)n[o].scope===e?n.splice(o,1).forEach(s=>{let{element:a}=s;return cr(a)}):o++;mn()===e&&Os(t||"all")}function du(e){let t=e.keyCode||e.which||e.charCode;e.key&&e.key.toLowerCase()==="capslock"&&(t=Kt(e.key));const n=ce.indexOf(t);if(n>=0&&ce.splice(n,1),e.key&&e.key.toLowerCase()==="meta"&&ce.splice(0,ce.length),(t===93||t===224)&&(t=91),t in Ae){Ae[t]=!1;for(const o in qe)qe[o]===t&&(je[o]=!1)}}function Ls(e){if(typeof e>"u")Object.keys(he).forEach(r=>{Array.isArray(he[r])&&he[r].forEach(i=>On(i)),delete he[r]}),cr(null);else if(Array.isArray(e))e.forEach(r=>{r.key&&On(r)});else if(typeof e=="object")e.key&&On(e);else if(typeof e=="string"){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];let[r,i]=n;typeof r=="function"&&(i=r,r=""),On({key:e,scope:r,method:i,splitKey:"+"})}}const On=e=>{let{key:t,scope:n,method:o,splitKey:r="+"}=e;Rs(t).forEach(s=>{const a=s.split(r),c=a.length,l=a[c-1],u=l==="*"?"*":Kt(l);if(!he[u])return;n||(n=mn());const d=c>1?Ts(qe,a):[],f=[];he[u]=he[u].filter(h=>{const p=(o?h.method===o:!0)&&h.scope===n&&nu(h.mods,d);return p&&f.push(h.element),!p}),f.forEach(h=>cr(h))})};function yi(e,t,n,o){if(t.element!==o)return;let r;if(t.scope===n||t.scope==="all"){r=t.mods.length>0;for(const i in Ae)Object.prototype.hasOwnProperty.call(Ae,i)&&(!Ae[i]&&t.mods.indexOf(+i)>-1||Ae[i]&&t.mods.indexOf(+i)===-1)&&(r=!1);(t.mods.length===0&&!Ae[16]&&!Ae[18]&&!Ae[17]&&!Ae[91]||r||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(ce),t.method(e,t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function vi(e,t){const n=he["*"];let o=e.keyCode||e.which||e.charCode;if(e.key&&e.key.toLowerCase()==="capslock"||!je.filter.call(this,e))return;if((o===93||o===224)&&(o=91),ce.indexOf(o)===-1&&o!==229&&ce.push(o),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const c=tn[a];e[a]&&ce.indexOf(c)===-1?ce.push(c):!e[a]&&ce.indexOf(c)>-1?ce.splice(ce.indexOf(c),1):a==="metaKey"&&e[a]&&(ce=ce.filter(l=>l in tn||l===o))}),o in Ae){Ae[o]=!0;for(const a in qe)if(Object.prototype.hasOwnProperty.call(qe,a)){const c=tn[qe[a]];je[a]=e[c]}if(!n)return}for(const a in Ae)Object.prototype.hasOwnProperty.call(Ae,a)&&(Ae[a]=e[tn[a]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(ce.indexOf(17)===-1&&ce.push(17),ce.indexOf(18)===-1&&ce.push(18),Ae[17]=!0,Ae[18]=!0);const r=mn();if(n)for(let a=0;a<n.length;a++)n[a].scope===r&&(e.type==="keydown"&&n[a].keydown||e.type==="keyup"&&n[a].keyup)&&yi(e,n[a],r,t);if(!(o in he))return;const i=he[o],s=i.length;for(let a=0;a<s;a++)if((e.type==="keydown"&&i[a].keydown||e.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,u=c.key.split(l),d=[];for(let f=0;f<u.length;f++)d.push(Kt(u[f]));d.sort().join("")===ce.sort().join("")&&yi(e,c,r,t)}}function je(e,t,n){ce=[];const o=Rs(e);let r=[],i="all",s=document,a=0,c=!1,l=!0,u="+",d=!1,f=!1;for(n===void 0&&typeof t=="function"&&(n=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(i=t.scope),t.element&&(s=t.element),t.keyup&&(c=t.keyup),t.keydown!==void 0&&(l=t.keydown),t.capture!==void 0&&(d=t.capture),typeof t.splitKey=="string"&&(u=t.splitKey),t.single===!0&&(f=!0)),typeof t=="string"&&(i=t),f&&Ls(e,i);a<o.length;a++)e=o[a].split(u),r=[],e.length>1&&(r=Ts(qe,e)),e=e[e.length-1],e=e==="*"?"*":Kt(e),e in he||(he[e]=[]),he[e].push({keyup:c,keydown:l,scope:i,mods:r,shortcut:o[a],method:n,key:o[a],splitKey:u,element:s});if(typeof s<"u"&&window){if(!tt.has(s)){const h=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return vi(p,s)},m=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;vi(p,s),du(p)};tt.set(s,{keydownListener:h,keyupListenr:m,capture:d}),ko(s,"keydown",h,d),ko(s,"keyup",m,d)}if(!ln){const h=()=>{ce=[]};ln={listener:h,capture:d},ko(window,"focus",h,d)}}}function fu(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(he).forEach(n=>{he[n].filter(r=>r.scope===t&&r.shortcut===e).forEach(r=>{r&&r.method&&r.method()})})}function cr(e){const t=Object.values(he).flat();if(t.findIndex(o=>{let{element:r}=o;return r===e})<0){const{keydownListener:o,keyupListenr:r,capture:i}=tt.get(e)||{};o&&r&&(Jt(e,"keyup",r,i),Jt(e,"keydown",o,i),tt.delete(e))}if((t.length<=0||tt.size<=0)&&(Object.keys(tt).forEach(r=>{const{keydownListener:i,keyupListenr:s,capture:a}=tt.get(r)||{};i&&s&&(Jt(r,"keyup",s,a),Jt(r,"keydown",i,a),tt.delete(r))}),tt.clear(),Object.keys(he).forEach(r=>delete he[r]),ln)){const{listener:r,capture:i}=ln;Jt(window,"focus",r,i),ln=null}}const Mo={getPressedKeyString:su,setScope:Os,getScope:mn,deleteScope:uu,getPressedKeyCodes:iu,getAllKeyCodes:au,isPressed:cu,filter:lu,trigger:fu,unbind:Ls,keyMap:gn,modifier:qe,modifierMap:tn};for(const e in Mo)Object.prototype.hasOwnProperty.call(Mo,e)&&(je[e]=Mo[e]);if(typeof window<"u"){const e=window.hotkeys;je.noConflict=t=>(t&&window.hotkeys===je&&(window.hotkeys=e),je),window.hotkeys=je}const ur="not-annotatable",Dt=`.${ur}`,nn=(e,t)=>{var n;return e.contains(t)?!!(t instanceof HTMLElement?t.closest(Dt):(n=t.parentElement)!=null&&n.closest(Dt)):!0},pu=(e,t)=>{const n=t.commonAncestorContainer;return!nn(e,n)},hu=e=>e.addEventListener("click",t=>{!t.target.closest(Dt)&&!t.target.closest("a")&&t.preventDefault()}),_o=e=>({...e,type:e.type,x:e.x,y:e.y,clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY,screenX:e.screenX,screenY:e.screenY,isPrimary:e.isPrimary,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,button:e.button,buttons:e.buttons,currentTarget:e.currentTarget,target:e.target,defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,pointerId:e.pointerId,pointerType:e.pointerType,timeStamp:e.timeStamp}),Ln=e=>({...e,type:e.type,key:e.key,code:e.code,location:e.location,repeat:e.repeat,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,currentTarget:e.currentTarget,target:e.target,defaultPrevented:e.defaultPrevented,detail:e.detail,timeStamp:e.timeStamp}),gu=typeof navigator<"u"&&/mac/i.test(navigator.userAgentData?navigator.userAgentData.platform:navigator.platform),mu=e=>{!e.hasAttribute("tabindex")&&e.tabIndex<0&&e.setAttribute("tabindex","-1"),e.classList.add("no-focus-outline")},yn=(e,t=10)=>{let n;return((...o)=>{clearTimeout(n),n=setTimeout(()=>e.apply(void 0,o),t)})},yu=function*(e){const t=document.createNodeIterator(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,o=>o instanceof HTMLElement&&o.classList.contains(ur)&&!o.parentElement.closest(Dt)&&e.intersectsNode(o)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP);let n;for(;n=t.nextNode();)n instanceof HTMLElement&&(yield n)},vu=(e,t)=>{if(!pu(e,t))return[];const n=[];let o=null;for(const r of yu(t)){let i;o?(i=document.createRange(),i.setStartAfter(o),i.setEndBefore(r)):(i=t.cloneRange(),i.setEndBefore(r)),i.collapsed||n.push(i),o=r}if(o){const r=t.cloneRange();r.setStartAfter(o),r.collapsed||n.push(r)}return n.length>0?n:[t]},bu=e=>{const t=e.cloneContents();return t.querySelectorAll(Dt).forEach(n=>n.remove()),t},nt=e=>e.every(t=>t.range instanceof Range&&!t.range.collapsed),wu=/^\s*$/,xu=e=>wu.test(e.toString()),Eu=(e,t)=>{const n=i=>Math.round(i*10)/10,o={top:n(e.top),bottom:n(e.bottom),left:n(e.left),right:n(e.right)},r={top:n(t.top),bottom:n(t.bottom),left:n(t.left),right:n(t.right)};if(Math.abs(o.top-r.top)<.5&&Math.abs(o.bottom-r.bottom)<.5){if(Math.abs(o.left-r.right)<.5||Math.abs(o.right-r.left)<.5)return"inline-adjacent";if(o.left>=r.left&&o.right<=r.right)return"inline-is-contained";if(o.left<=r.left&&o.right>=r.right)return"inline-contains"}else if(o.top<=r.top&&o.bottom>=r.bottom){if(o.left<=r.left&&o.right>=r.right)return"block-contains"}else if(o.top>=r.top&&o.bottom<=r.bottom&&o.left>=r.left&&o.right<=r.right)return"block-is-contained"},Au=(e,t)=>{const n=Math.min(e.left,t.left),o=Math.max(e.right,t.right),r=Math.min(e.top,t.top),i=Math.max(e.bottom,t.bottom);return new DOMRect(n,r,o-n,i-r)},Su=e=>e.reduce((t,n)=>{if(n.width===0||n.height===0)return t;let o=[...t],r=!1;for(const i of t){const s=Eu(n,i);if(s==="inline-adjacent"){o=o.map(a=>a===i?Au(n,i):a),r=!0;break}else if(s==="inline-contains"){o=o.map(a=>a===i?n:a),r=!0;break}else if(s==="inline-is-contained"){r=!0;break}else if(s==="block-contains"||s==="block-is-contained"){n.width<i.width&&(o=o.map(a=>a===i?n:a)),r=!0;break}}return r?o:[...o,n]},[]),$u=e=>({length:e.length,item:t=>e[t],[Symbol.iterator]:function*(){for(let t=0;t<this.length;t++)yield this.item(t)}}),Tu=(e,t,n)=>{const o=document.createRange(),r=n?e.startContainer.parentElement.closest(n):t;o.setStart(r,0),o.setEnd(e.startContainer,e.startOffset);const i=bu(o).textContent,s=e.toString(),a=i.length||0,c=a+s.length;return n?{quote:s,start:a,end:c,range:e,offsetReference:r}:{quote:s,start:a,end:c,range:e}},ks=(e,t)=>{var n,o;const{start:r,end:i}=e,s=e.offsetReference||t,a=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,f=>{var h;return(h=f.parentElement)!=null&&h.closest(Dt)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT});let c=0;const l=document.createRange();let u=a.nextNode();u===null&&console.error("Could not revive annotation target. Content missing.");let d=!s;for(;u!==null;){if(d||(d=typeof(s==null?void 0:s.contains)=="function"?s.contains(u):!1),d){const f=((n=u.textContent)==null?void 0:n.length)||0;if(c+f>r){l.setStart(u,r-c);break}c+=f}u=a.nextNode()}for(;u!==null;){const f=((o=u.textContent)==null?void 0:o.length)||0;if(c+f>=i){l.setEnd(u,i-c);break}c+=f,u=a.nextNode()}return{...e,range:l}},Hn=(e,t)=>nt(e.selector)?e:{...e,selector:e.selector.map(n=>n.range instanceof Range&&!n.range.collapsed?n:ks(n,t))},Po=(e,t)=>nt(e.target.selector)?e:{...e,target:Hn(e.target,t)},Ru=(e,t)=>{const n=e.cloneRange();return t.contains(n.startContainer)||n.setStart(t,0),t.contains(n.endContainer)||n.setEnd(t,t.childNodes.length),n},Ms=e=>{if(e===null)return document.scrollingElement;const{overflowY:t}=window.getComputedStyle(e);return t!=="visible"&&t!=="hidden"&&e.scrollHeight>e.clientHeight?e:Ms(e.parentElement)},Cu=(e,t)=>n=>{const o=typeof n=="string"?n:n.id,r=u=>{const d=i.getBoundingClientRect(),f=i.clientHeight,h=i.clientWidth,m=u.selector[0].range.getBoundingClientRect(),{width:p,height:E}=t.getAnnotationBounds(o),v=m.top-d.top,g=m.left-d.left,y=i.parentElement?i.scrollTop:0,$=i.parentElement?i.scrollLeft:0,S=v+y-(f-E)/2,I=g+$-(h-p)/2;i.scroll({top:S,left:I,behavior:"smooth"})},i=Ms(e);if(!i)return console.warn(`The scroll parent is missing for the annotation: ${o}`,{container:e}),!1;const s=t.getAnnotation(o);if(!s)return console.warn(`The annotation is missing in the store: ${o}`),!1;const{range:a}=s.target.selector[0];if(a&&!a.collapsed)return r(s.target),!0;const c=Hn(s.target,e),{range:l}=c.selector[0];return l&&!l.collapsed?(r(c),!0):!1},gt={fill:"rgb(0, 128, 255)",fillOpacity:.18},Un={fill:"rgb(0, 128, 255)",fillOpacity:.45},Ou=(e,t,n,o,r)=>{var i,s;const a=n?typeof n=="function"?n(e.annotation,e.state,r)||((i=e.state)!=null&&i.selected?Un:gt):n:(s=e.state)!=null&&s.selected?Un:gt;return o&&o.paint(e,t)||a},Lu=e=>{const{top:t,left:n}=e.getBoundingClientRect(),{innerWidth:o,innerHeight:r}=window,i=-n,s=-t,a=o-n,c=r-t;return{top:t,left:n,minX:i,minY:s,maxX:a,maxY:c}},ku=e=>{let t=new Set;return n=>{const o=n.map(r=>r.id);(t.size!==o.length||o.some(r=>!t.has(r)))&&e.set(o),t=new Set(o)}},dr=(e,t,n,o)=>{const{store:r,selection:i,hover:s}=t;let a,c,l;const u=ku(n),d=L=>{const{x:N,y:H}=e.getBoundingClientRect(),j=r.getAt(L.clientX-N,L.clientY-H,!1,c);j?s.current!==j.id&&(e.classList.add("hovered"),s.set(j.id)):s.current&&(e.classList.remove("hovered"),s.set(null))};e.addEventListener("pointermove",d);const f=(L=!1)=>{l&&l.clear();const N=Lu(e),{minX:H,minY:j,maxX:R,maxY:T}=N,x=c?r.getIntersecting(H,j,R,T).filter(({annotation:k})=>c(k)):r.getIntersecting(H,j,R,T),A=i.selected.map(({id:k})=>k),M=x.map(({annotation:k,rects:C})=>{const U=A.includes(k.id),w=k.id===s.current;return{annotation:k,rects:C,state:{selected:U,hovered:w}}});o.redraw(M,N,a,l,L),setTimeout(()=>u(x.map(({annotation:k})=>k)),1)},h=L=>{l=L,f()},m=L=>{a=L,f()},p=L=>{c=L,f(!1)},E=()=>f();r.observe(E);const v=i.subscribe(()=>f()),g=s.subscribe(()=>f()),y=()=>f(!0);document.addEventListener("scroll",y,{capture:!0,passive:!0});const $=yn(()=>{r.recalculatePositions(),l&&l.reset(),f()});window.addEventListener("resize",$);const S=new ResizeObserver($);S.observe(e);const I={attributes:!0,childList:!0,subtree:!0},P=new MutationObserver(yn(L=>{L.every(N=>N.target===e||e.contains(N.target))||f(!0)},150));return P.observe(document.body,I),{destroy:()=>{e.removeEventListener("pointermove",d),o.destroy(),r.unobserve(E),v(),g(),document.removeEventListener("scroll",y),window.removeEventListener("resize",$),S.disconnect(),P.disconnect()},redraw:f,setStyle:m,setFilter:p,setPainter:h,setVisible:o.setVisible}},Mu=()=>{const e=document.createElement("canvas");return e.width=window.innerWidth,e.height=window.innerHeight,e.className="r6o-canvas-highlight-layer bg",e},_u=(e,t)=>{e.width=window.innerWidth,e.height=window.innerHeight},Pu=e=>{e.classList.add("r6o-annotatable");const t=Mu(),n=t.getContext("2d");document.body.appendChild(t);const o=(i,s,a,c)=>requestAnimationFrame(()=>{const{width:l,height:u}=t;n.clearRect(-.5,-.5,l+1,u+1),c&&c.clear();const{top:d,left:f}=s;[...i].sort((h,m)=>{const{annotation:{target:{created:p}}}=h,{annotation:{target:{created:E}}}=m;return p.getTime()-E.getTime()}).forEach(h=>{var m;const p=a?typeof a=="function"?a(h.annotation,h.state):a:(m=h.state)!=null&&m.selected?Un:gt,E=c&&c.paint(h,s)||p,v=h.rects.map(({x:g,y,width:$,height:S})=>({x:g+f,y:y+d,width:$,height:S}));if(n.fillStyle=E.fill,n.globalAlpha=E.fillOpacity||1,v.forEach(({x:g,y,width:$,height:S})=>n.fillRect(g,y,$,S)),E.underlineColor){n.globalAlpha=1,n.strokeStyle=E.underlineColor,n.lineWidth=E.underlineThickness??1;const g=E.underlineOffset??0;v.forEach(({x:y,y:$,width:S,height:I})=>{n.beginPath(),n.moveTo(y,$+I+g),n.lineTo(y+S,$+I+g),n.stroke()})}})}),r=yn(()=>{_u(t)});return window.addEventListener("resize",r),{destroy:()=>{t.remove(),window.removeEventListener("resize",r)},setVisible:i=>{console.log("setVisible not implemented on Canvas renderer")},redraw:o}},Nu=(e,t,n)=>dr(e,t,n,Pu(e)),Iu=e=>[`background-color:${Ve((e==null?void 0:e.fill)||gt.fill).alpha((e==null?void 0:e.fillOpacity)===void 0?gt.fillOpacity:e.fillOpacity).toHex()}`,e!=null&&e.underlineThickness?"text-decoration:underline":void 0,e!=null&&e.underlineColor?`text-decoration-color:${e.underlineColor}`:void 0,e!=null&&e.underlineOffset?`text-underline-offset:${e.underlineOffset}px`:void 0,e!=null&&e.underlineThickness?`text-decoration-thickness:${e.underlineThickness}px`:void 0].filter(Boolean).join(";"),Du=()=>{const e=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(e);let t=new Set;return{destroy:()=>{CSS.highlights.clear(),e.remove()},setVisible:n=>{console.log("setVisible not implemented on CSS Custom Highlights renderer")},redraw:(n,o,r,i)=>{i&&i.clear();const s=new Set(n.map(c=>c.annotation.id));Array.from(t).filter(c=>!s.has(c));const a=n.map(c=>{var l;const u=r?typeof r=="function"?r(c.annotation,c.state):r:(l=c.state)!=null&&l.selected?Un:gt,d=i&&i.paint(c,o)||u;return`::highlight(_${c.annotation.id}) { ${Iu(d)} }`});e.innerHTML=a.join(`
`),CSS.highlights.clear(),n.forEach(({annotation:c})=>{const l=c.target.selector.map(d=>d.range),u=new Highlight(...l);CSS.highlights.set(`_${c.id}`,u)}),t=s}}},Bu=(e,t,n)=>dr(e,t,n,Du()),ju=(e,t)=>{const n=(i,s)=>i.x<=s.x+s.width&&i.x+i.width>=s.x&&i.y<=s.y+s.height&&i.y+i.height>=s.y,o=i=>i.rects.reduce((s,a)=>s+a.width,0),r=t.filter(({rects:i})=>i.some(s=>n(e,s)));return r.sort((i,s)=>o(s)-o(i)),r.findIndex(i=>i.rects.includes(e))},Hu=e=>{e.classList.add("r6o-annotatable");const t=document.createElement("div");t.className="r6o-span-highlight-layer",e.insertBefore(t,e.firstChild);let n=[];return{destroy:()=>{t.remove()},redraw:(o,r,i,s,a)=>{const c=!(Wo(n,o)&&a);!s&&!c||(c&&(t.innerHTML=""),[...o].sort((l,u)=>{const{annotation:{target:{created:d}}}=l,{annotation:{target:{created:f}}}=u;return d&&f?d.getTime()-f.getTime():0}).forEach(l=>{l.rects.map(u=>{const d=ju(u,o),f=Ou(l,r,i,s,d);if(c){const h=document.createElement("span");h.className="r6o-annotation",h.dataset.annotation=l.annotation.id,h.style.left=`${u.x}px`,h.style.top=`${u.y}px`,h.style.width=`${u.width}px`,h.style.height=`${u.height}px`,h.style.backgroundColor=Ve((f==null?void 0:f.fill)||gt.fill).alpha((f==null?void 0:f.fillOpacity)===void 0?gt.fillOpacity:f.fillOpacity).toHex(),f.underlineStyle&&(h.style.borderStyle=f.underlineStyle),f.underlineColor&&(h.style.borderColor=f.underlineColor),f.underlineThickness&&(h.style.borderBottomWidth=`${f.underlineThickness}px`),f.underlineOffset&&(h.style.paddingBottom=`${f.underlineOffset}px`),t.appendChild(h)}})}),n=o)},setVisible:o=>{o?t.classList.remove("hidden"):t.classList.add("hidden")}}},Uu=(e,t,n)=>dr(e,t,n,Hu(e)),Vu=(e,t)=>{const n=new Gc,o=new Map,r=(m,p)=>{const E=m.selector.flatMap(g=>{const y=nt([g])?g.range:ks(g,t).range;return Array.from(y.getClientRects())}),v=Su(E).map(({left:g,top:y,right:$,bottom:S})=>new DOMRect(g-p.left,y-p.top,$-g,S-y));return v.map(g=>{const{x:y,y:$,width:S,height:I}=g;return{minX:y,minY:$,maxX:y+S,maxY:$+I,annotation:{id:m.annotation,rects:v}}})},i=()=>[...o.values()],s=()=>{n.clear(),o.clear()},a=m=>{const p=r(m,t.getBoundingClientRect());p.length!==0&&(p.forEach(E=>n.insert(E)),o.set(m.annotation,p))},c=m=>{const p=o.get(m.annotation);p&&(p.forEach(E=>n.remove(E)),o.delete(m.annotation))},l=m=>{c(m),a(m)},u=(m,p=!0)=>{p&&s();const E=t.getBoundingClientRect(),v=m.map(y=>({target:y,rects:r(y,E)}));v.forEach(({target:y,rects:$})=>{$.length>0&&o.set(y.annotation,$)});const g=v.flatMap(({rects:y})=>y);n.load(g)},d=(m,p,E=!1)=>{const v=n.search({minX:m,minY:p,maxX:m,maxY:p}),g=y=>y.annotation.rects.reduce(($,S)=>$+S.width*S.height,0);return v.length>0?(v.sort((y,$)=>g(y)-g($)),E?v.map(y=>y.annotation.id):[v[0].annotation.id]):[]},f=m=>{const p=h(m);if(p.length===0)return;let E=p[0].left,v=p[0].top,g=p[0].right,y=p[0].bottom;for(let $=1;$<p.length;$++){const S=p[$];E=Math.min(E,S.left),v=Math.min(v,S.top),g=Math.max(g,S.right),y=Math.max(y,S.bottom)}return new DOMRect(E,v,g-E,y-v)},h=m=>{const p=o.get(m);return p?p[0].annotation.rects:[]};return{all:i,clear:s,getAt:d,getAnnotationBounds:f,getAnnotationRects:h,getIntersecting:(m,p,E,v)=>{const g=n.search({minX:m,minY:p,maxX:E,maxY:v}),y=new Set(g.map($=>$.annotation.id));return Array.from(y).map($=>({annotation:e.getAnnotation($),rects:h($)})).filter($=>!!$.annotation)},insert:a,recalculate:()=>u(e.all().map(m=>m.target),!0),remove:c,set:u,size:()=>n.all().length,update:l}},Fu=(e,t)=>{const n=Zl(),o=Vu(n,e),r=jl(n,t.userSelectAction,t.adapter),i=Bl(n),s=nc(),a=(v,g=te.LOCAL)=>{const y=Po(v,e),$=nt(y.target.selector);return $&&n.addAnnotation(y,g),$},c=(v,g=!0,y=te.LOCAL)=>{const $=v.map(I=>Po(I,e)),S=$.filter(I=>!nt(I.target.selector));return n.bulkAddAnnotations($,g,y),S},l=(v,g=te.LOCAL)=>{const y=v.map(S=>Po(S,e)),$=y.filter(S=>!nt(S.target.selector));return y.forEach(S=>{n.getAnnotation(S.id)?n.updateAnnotation(S,g):n.addAnnotation(S,g)}),$},u=(v,g=te.LOCAL)=>{const y=Hn(v,e);n.updateTarget(y,g)},d=(v,g=te.LOCAL)=>{const y=v.map($=>Hn($,e));n.bulkUpdateTargets(y,g)};function f(v,g,y,$){const S=y||!!$,I=o.getAt(v,g,S).map(L=>n.getAnnotation(L)),P=$?I.filter($):I;if(P.length!==0)return y?P:P[0]}const h=v=>{if(o.getAnnotationRects(v).length!==0)return o.getAnnotationBounds(v)},m=(v,g,y,$)=>o.getIntersecting(v,g,y,$),p=v=>o.getAnnotationRects(v),E=()=>o.recalculate();return n.observe(({changes:v})=>{const g=(v.deleted||[]).filter(S=>nt(S.target.selector)),y=(v.created||[]).filter(S=>nt(S.target.selector)),$=(v.updated||[]).filter(S=>nt(S.newValue.target.selector));(g==null?void 0:g.length)>0&&g.forEach(S=>o.remove(S.target)),y.length>0&&o.set(y.map(S=>S.target),!1),($==null?void 0:$.length)>0&&$.forEach(({newValue:S})=>o.update(S.target))}),{store:{...n,addAnnotation:a,bulkAddAnnotations:c,bulkUpdateTargets:d,bulkUpsertAnnotations:l,getAnnotationBounds:h,getAnnotationRects:p,getIntersecting:m,getAt:f,recalculatePositions:E,updateTarget:u},selection:r,hover:i,viewport:s}},Xu=()=>{const e=document.createElement("canvas");e.width=2*window.innerWidth,e.height=2*window.innerHeight,e.className="r6o-presence-layer";const t=e.getContext("2d");return t.scale(2,2),t.translate(.5,.5),e},Ku=(e,t={})=>{const n=Xu(),o=n.getContext("2d");document.body.appendChild(n);const r=new Map,i=s=>Array.from(r.entries()).filter(([a,c])=>c.presenceKey===s.presenceKey).map(([a,c])=>a);return e.on("selectionChange",(s,a)=>{i(s).forEach(c=>r.delete(c)),a&&a.forEach(c=>r.set(c,s))}),{clear:()=>{const{width:s,height:a}=n;o.clearRect(-.5,-.5,s+1,a+1)},destroy:()=>{n.remove()},paint:(s,a,c)=>{t.font&&(o.font=t.font);const l=r.get(s.annotation.id);if(l){const{height:u}=s.rects[0],d=s.rects[0].x+a.left,f=s.rects[0].y+a.top;o.fillStyle=l.appearance.color,o.fillRect(d-2,f-2.5,2,u+5);const h=o.measureText(l.appearance.label),m=h.width+6,p=h.actualBoundingBoxAscent+h.actualBoundingBoxDescent+8,E=h.fontBoundingBoxAscent?8:6.5;return o.fillRect(d-2,f-2.5-p,m,p),o.fillStyle="#fff",o.fillText(l.appearance.label,d+1,f-E),{fill:l.appearance.color,fillOpacity:c?.45:.18}}},reset:()=>{n.width=2*window.innerWidth,n.height=2*window.innerHeight;const s=n.getContext("2d");s.scale(2,2),s.translate(.5,.5)}}},bi=300,_s=["up","down","left","right"],Ps=gu?"+a":"ctrl+a",qu=[..._s.map(e=>`shift+${e}`),Ps],Yu=(e,t,n)=>{let o;const{annotatingEnabled:r,offsetReferenceSelector:i,selectionMode:s}=n,a=L=>o=L;let c;const l=L=>c=L,{store:u,selection:d}=t;let f,h,m;const p=L=>{h!==!1&&(f=nn(e,L.target)?void 0:{annotation:Wc(),selector:[],creator:o,created:new Date})},E=yn(L=>{const N=document.getSelection();if(!(N!=null&&N.anchorNode))return;if(nn(e,N.anchorNode)){f=void 0;return}const H=L.timeStamp-((m==null?void 0:m.timeStamp)||L.timeStamp);if((m==null?void 0:m.type)==="pointerdown"&&(H<1e3&&!f||N.isCollapsed&&H<bi)&&p(m||L),!f)return;if(N.isCollapsed){u.getAnnotation(f.annotation)&&(d.clear(),u.deleteAnnotation(f.annotation));return}const j=Array.from(Array(N.rangeCount).keys()).map(T=>N.getRangeAt(T)).map(T=>Ru(T,e));if(j.every(T=>xu(T)))return;const R=j.flatMap(T=>vu(e,T.cloneRange()));(R.length!==f.selector.length||R.some((T,x)=>{var A;return T.toString()!==((A=f.selector[x])==null?void 0:A.quote)}))&&(f={...f,selector:R.map(T=>Tu(T,e,i)),updated:new Date},u.getAnnotation(f.annotation)?u.updateTarget(f,te.LOCAL):d.clear())}),v=L=>{nn(e,L.target)||(m=_o(L),h=m.button===0)},g=L=>{if(!h)return;if(nn(e,L.target)){n.dismissOnClickOutside&&d.clear();return}const N=()=>{const{x:j,y:R}=e.getBoundingClientRect(),T=L.target instanceof Node&&e.contains(L.target)&&u.getAt(L.clientX-j,L.clientY-R,s==="all",c);if(T){const{selected:x}=d,A=new Set(x.map(k=>k.id)),M=Array.isArray(T)?T.map(k=>k.id):[T.id];(A.size!==M.length||!M.every(k=>A.has(k)))&&d.userSelect(M,L)}else d.clear()},H=L.timeStamp-m.timeStamp;setTimeout(()=>{const j=document.getSelection();j!=null&&j.isCollapsed&&H<bi?(f=void 0,N()):f&&f.selector.length>0&&(P(),d.userSelect(f.annotation,_o(L)))})},y=L=>{const N=document.getSelection();N!=null&&N.isCollapsed||((!f||f.selector.length===0)&&E(L),f&&(P(),d.userSelect(f.annotation,_o(L))))},$=L=>{L.key==="Shift"&&f&&(document.getSelection().isCollapsed||(P(),d.userSelect(f.annotation,Ln(L))))},S=L=>{const N=()=>setTimeout(()=>{(f==null?void 0:f.selector.length)>0&&(d.clear(),u.addAnnotation({id:f.annotation,bodies:[],target:f}),d.userSelect(f.annotation,Ln(L))),document.removeEventListener("selectionchange",N)},100);document.addEventListener("selectionchange",N),p(L)};je(qu.join(","),{element:e,keydown:!0,keyup:!1},L=>{L.repeat||(m=Ln(L))}),je(Ps,{keydown:!0,keyup:!1},L=>{m=Ln(L),S(L)});const I=L=>{L.repeat||L.target!==e&&L.target!==document.body||(f=void 0,d.clear())};je(_s.join(","),{keydown:!0,keyup:!1},I);const P=()=>{const L=u.getAnnotation(f.annotation);if(!L){u.addAnnotation({id:f.annotation,bodies:[],target:f});return}const{target:{updated:N}}=L,{updated:H}=f;(!N||!H||N<H)&&u.updateTarget(f)};return e.addEventListener("pointerdown",v),document.addEventListener("pointerup",g),document.addEventListener("contextmenu",y),r&&(e.addEventListener("keyup",$),e.addEventListener("selectstart",p),document.addEventListener("selectionchange",E)),{destroy:()=>{e.removeEventListener("pointerdown",v),document.removeEventListener("pointerup",g),document.removeEventListener("contextmenu",y),e.removeEventListener("keyup",$),e.removeEventListener("selectstart",p),document.removeEventListener("selectionchange",E),je.unbind()},setFilter:l,setUser:a}},Wu=(e,t)=>({...e,annotatingEnabled:e.annotatingEnabled??t.annotatingEnabled,user:e.user||t.user}),wi="SPANS",zu=(e,t={})=>{hu(e),mu(e);const n=Wu(t,{annotatingEnabled:!0,user:dc()}),o=Fu(e,n),{selection:r,viewport:i}=o,s=o.store,a=tc(s),c=oc(o,a,n.adapter);let l=n.user;const u=n.renderer==="CSS_HIGHLIGHTS"?CSS.highlights?"CSS_HIGHLIGHTS":wi:n.renderer||wi,d=u==="SPANS"?Uu(e,o,i):u==="CSS_HIGHLIGHTS"?Bu(e,o,i):u==="CANVAS"?Nu(e,o,i):void 0;if(!d)throw`Unknown renderer implementation: ${u}`;console.debug(`Using ${u} renderer`),n.style&&d.setStyle(n.style);const f=Yu(e,o,n);return f.setUser(l),{...ic(o,a,n.adapter),destroy:()=>{d.destroy(),f.destroy(),a.destroy()},element:e,getUser:()=>l,setFilter:h=>{d.setFilter(h),f.setFilter(h)},setStyle:h=>d.setStyle(h),setUser:h=>{l=h,f.setUser(h)},setSelected:h=>{h?r.setSelected(h):r.clear()},setPresenceProvider:h=>{h&&(d.setPainter(Ku(h,n.presence)),h.on("selectionChange",()=>d.redraw()))},setVisible:h=>d.setVisible(h),on:c.on,off:c.off,scrollIntoView:Cu(e,s),state:o}};function Jn(){return typeof window<"u"}function mt(e){return fr(e)?(e.nodeName||"").toLowerCase():"#document"}function Pe(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Ze(e){var t;return(t=(fr(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function fr(e){return Jn()?e instanceof Node||e instanceof Pe(e).Node:!1}function ge(e){return Jn()?e instanceof Element||e instanceof Pe(e).Element:!1}function Se(e){return Jn()?e instanceof HTMLElement||e instanceof Pe(e).HTMLElement:!1}function zo(e){return!Jn()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Pe(e).ShadowRoot}const Gu=new Set(["inline","contents"]);function wn(e){const{overflow:t,overflowX:n,overflowY:o,display:r}=Ne(e);return/auto|scroll|overlay|hidden|clip/.test(t+o+n)&&!Gu.has(r)}const Ju=new Set(["table","td","th"]);function Zu(e){return Ju.has(mt(e))}const Qu=[":popover-open",":modal"];function Zn(e){return Qu.some(t=>{try{return e.matches(t)}catch{return!1}})}const ed=["transform","translate","scale","rotate","perspective"],td=["transform","translate","scale","rotate","perspective","filter"],nd=["paint","layout","strict","content"];function pr(e){const t=Qn(),n=ge(e)?Ne(e):e;return ed.some(o=>n[o]?n[o]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||td.some(o=>(n.willChange||"").includes(o))||nd.some(o=>(n.contain||"").includes(o))}function od(e){let t=it(e);for(;Se(t)&&!rt(t);){if(pr(t))return t;if(Zn(t))return null;t=it(t)}return null}function Qn(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const rd=new Set(["html","body","#document"]);function rt(e){return rd.has(mt(e))}function Ne(e){return Pe(e).getComputedStyle(e)}function eo(e){return ge(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function it(e){if(mt(e)==="html")return e;const t=e.assignedSlot||e.parentNode||zo(e)&&e.host||Ze(e);return zo(t)?t.host:t}function Ns(e){const t=it(e);return rt(t)?e.ownerDocument?e.ownerDocument.body:e.body:Se(t)&&wn(t)?t:Ns(t)}function pt(e,t,n){var o;t===void 0&&(t=[]),n===void 0&&(n=!0);const r=Ns(e),i=r===((o=e.ownerDocument)==null?void 0:o.body),s=Pe(r);if(i){const a=Go(s);return t.concat(s,s.visualViewport||[],wn(r)?r:[],a&&n?pt(a):[])}return t.concat(r,pt(r,[],n))}function Go(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}const st=Math.min,Ge=Math.max,Vn=Math.round,kn=Math.floor,Je=e=>({x:e,y:e}),id={left:"right",right:"left",bottom:"top",top:"bottom"},sd={start:"end",end:"start"};function Jo(e,t,n){return Ge(e,st(t,n))}function qt(e,t){return typeof e=="function"?e(t):e}function at(e){return e.split("-")[0]}function xn(e){return e.split("-")[1]}function Is(e){return e==="x"?"y":"x"}function hr(e){return e==="y"?"height":"width"}const ad=new Set(["top","bottom"]);function ot(e){return ad.has(at(e))?"y":"x"}function gr(e){return Is(ot(e))}function ld(e,t,n){n===void 0&&(n=!1);const o=xn(e),r=gr(e),i=hr(r);let s=r==="x"?o===(n?"end":"start")?"right":"left":o==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(s=Fn(s)),[s,Fn(s)]}function cd(e){const t=Fn(e);return[Zo(e),t,Zo(t)]}function Zo(e){return e.replace(/start|end/g,t=>sd[t])}const xi=["left","right"],Ei=["right","left"],ud=["top","bottom"],dd=["bottom","top"];function fd(e,t,n){switch(e){case"top":case"bottom":return n?t?Ei:xi:t?xi:Ei;case"left":case"right":return t?ud:dd;default:return[]}}function pd(e,t,n,o){const r=xn(e);let i=fd(at(e),n==="start",o);return r&&(i=i.map(s=>s+"-"+r),t&&(i=i.concat(i.map(Zo)))),i}function Fn(e){return e.replace(/left|right|bottom|top/g,t=>id[t])}function hd(e){return{top:0,right:0,bottom:0,left:0,...e}}function mr(e){return typeof e!="number"?hd(e):{top:e,right:e,bottom:e,left:e}}function Bt(e){const{x:t,y:n,width:o,height:r}=e;return{width:o,height:r,top:n,left:t,right:t+o,bottom:n+r,x:t,y:n}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var gd=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],Xn=gd.join(","),Ds=typeof Element>"u",jt=Ds?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Kn=!Ds&&Element.prototype.getRootNode?function(e){var t;return e==null||(t=e.getRootNode)===null||t===void 0?void 0:t.call(e)}:function(e){return e==null?void 0:e.ownerDocument},qn=function e(t,n){var o;n===void 0&&(n=!0);var r=t==null||(o=t.getAttribute)===null||o===void 0?void 0:o.call(t,"inert"),i=r===""||r==="true",s=i||n&&t&&e(t.parentNode);return s},md=function(t){var n,o=t==null||(n=t.getAttribute)===null||n===void 0?void 0:n.call(t,"contenteditable");return o===""||o==="true"},Bs=function(t,n,o){if(qn(t))return[];var r=Array.prototype.slice.apply(t.querySelectorAll(Xn));return n&&jt.call(t,Xn)&&r.unshift(t),r=r.filter(o),r},js=function e(t,n,o){for(var r=[],i=Array.from(t);i.length;){var s=i.shift();if(!qn(s,!1))if(s.tagName==="SLOT"){var a=s.assignedElements(),c=a.length?a:s.children,l=e(c,!0,o);o.flatten?r.push.apply(r,l):r.push({scopeParent:s,candidates:l})}else{var u=jt.call(s,Xn);u&&o.filter(s)&&(n||!t.includes(s))&&r.push(s);var d=s.shadowRoot||typeof o.getShadowRoot=="function"&&o.getShadowRoot(s),f=!qn(d,!1)&&(!o.shadowRootFilter||o.shadowRootFilter(s));if(d&&f){var h=e(d===!0?s.children:d.children,!0,o);o.flatten?r.push.apply(r,h):r.push({scopeParent:s,candidates:h})}else i.unshift.apply(i,s.children)}}return r},Hs=function(t){return!isNaN(parseInt(t.getAttribute("tabindex"),10))},Us=function(t){if(!t)throw new Error("No node provided");return t.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||md(t))&&!Hs(t)?0:t.tabIndex},yd=function(t,n){var o=Us(t);return o<0&&n&&!Hs(t)?0:o},vd=function(t,n){return t.tabIndex===n.tabIndex?t.documentOrder-n.documentOrder:t.tabIndex-n.tabIndex},Vs=function(t){return t.tagName==="INPUT"},bd=function(t){return Vs(t)&&t.type==="hidden"},wd=function(t){var n=t.tagName==="DETAILS"&&Array.prototype.slice.apply(t.children).some(function(o){return o.tagName==="SUMMARY"});return n},xd=function(t,n){for(var o=0;o<t.length;o++)if(t[o].checked&&t[o].form===n)return t[o]},Ed=function(t){if(!t.name)return!0;var n=t.form||Kn(t),o=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},r;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")r=o(window.CSS.escape(t.name));else try{r=o(t.name)}catch(s){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",s.message),!1}var i=xd(r,t.form);return!i||i===t},Ad=function(t){return Vs(t)&&t.type==="radio"},Sd=function(t){return Ad(t)&&!Ed(t)},$d=function(t){var n,o=t&&Kn(t),r=(n=o)===null||n===void 0?void 0:n.host,i=!1;if(o&&o!==t){var s,a,c;for(i=!!((s=r)!==null&&s!==void 0&&(a=s.ownerDocument)!==null&&a!==void 0&&a.contains(r)||t!=null&&(c=t.ownerDocument)!==null&&c!==void 0&&c.contains(t));!i&&r;){var l,u,d;o=Kn(r),r=(l=o)===null||l===void 0?void 0:l.host,i=!!((u=r)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(r))}}return i},Ai=function(t){var n=t.getBoundingClientRect(),o=n.width,r=n.height;return o===0&&r===0},Td=function(t,n){var o=n.displayCheck,r=n.getShadowRoot;if(getComputedStyle(t).visibility==="hidden")return!0;var i=jt.call(t,"details>summary:first-of-type"),s=i?t.parentElement:t;if(jt.call(s,"details:not([open]) *"))return!0;if(!o||o==="full"||o==="legacy-full"){if(typeof r=="function"){for(var a=t;t;){var c=t.parentElement,l=Kn(t);if(c&&!c.shadowRoot&&r(c)===!0)return Ai(t);t.assignedSlot?t=t.assignedSlot:!c&&l!==t.ownerDocument?t=l.host:t=c}t=a}if($d(t))return!t.getClientRects().length;if(o!=="legacy-full")return!0}else if(o==="non-zero-area")return Ai(t);return!1},Rd=function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var n=t.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var o=0;o<n.children.length;o++){var r=n.children.item(o);if(r.tagName==="LEGEND")return jt.call(n,"fieldset[disabled] *")?!0:!r.contains(t)}return!0}n=n.parentElement}return!1},Qo=function(t,n){return!(n.disabled||qn(n)||bd(n)||Td(n,t)||wd(n)||Rd(n))},er=function(t,n){return!(Sd(n)||Us(n)<0||!Qo(t,n))},Cd=function(t){var n=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},Od=function e(t){var n=[],o=[];return t.forEach(function(r,i){var s=!!r.scopeParent,a=s?r.scopeParent:r,c=yd(a,s),l=s?e(r.candidates):a;c===0?s?n.push.apply(n,l):n.push(a):o.push({documentOrder:i,tabIndex:c,item:r,isScope:s,content:l})}),o.sort(vd).reduce(function(r,i){return i.isScope?r.push.apply(r,i.content):r.push(i.content),r},[]).concat(n)},to=function(t,n){n=n||{};var o;return n.getShadowRoot?o=js([t],n.includeContainer,{filter:er.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:Cd}):o=Bs(t,n.includeContainer,er.bind(null,n)),Od(o)},Ld=function(t,n){n=n||{};var o;return n.getShadowRoot?o=js([t],n.includeContainer,{filter:Qo.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):o=Bs(t,n.includeContainer,Qo.bind(null,n)),o},Fs=function(t,n){if(n=n||{},!t)throw new Error("No node provided");return jt.call(t,Xn)===!1?!1:er(n,t)};function kd(){const e=navigator.userAgentData;return e!=null&&e.platform?e.platform:navigator.platform}function Xs(){const e=navigator.userAgentData;return e&&Array.isArray(e.brands)?e.brands.map(t=>{let{brand:n,version:o}=t;return n+"/"+o}).join(" "):navigator.userAgent}function Md(){return/apple/i.test(navigator.vendor)}function tr(){const e=/android/i;return e.test(kd())||e.test(Xs())}function _d(){return Xs().includes("jsdom/")}const Si="data-floating-ui-focusable",Pd="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function Ot(e){let t=e.activeElement;for(;((n=t)==null||(n=n.shadowRoot)==null?void 0:n.activeElement)!=null;){var n;t=t.shadowRoot.activeElement}return t}function Me(e,t){if(!e||!t)return!1;const n=t.getRootNode==null?void 0:t.getRootNode();if(e.contains(t))return!0;if(n&&zo(n)){let o=t;for(;o;){if(e===o)return!0;o=o.parentNode||o.host}}return!1}function lt(e){return"composedPath"in e?e.composedPath()[0]:e.target}function No(e,t){if(t==null)return!1;if("composedPath"in e)return e.composedPath().includes(t);const n=e;return n.target!=null&&t.contains(n.target)}function Nd(e){return e.matches("html,body")}function Fe(e){return(e==null?void 0:e.ownerDocument)||document}function Id(e){return Se(e)&&e.matches(Pd)}function $i(e){return e?e.getAttribute("role")==="combobox"&&Id(e):!1}function nr(e){return e?e.hasAttribute(Si)?e:e.querySelector("["+Si+"]")||e:null}function Mt(e,t,n){return n===void 0&&(n=!0),e.filter(r=>{var i;return r.parentId===t&&(!n||((i=r.context)==null?void 0:i.open))}).flatMap(r=>[r,...Mt(e,r.id,n)])}function Ti(e,t){var n;let o=[],r=(n=e.find(i=>i.id===t))==null?void 0:n.parentId;for(;r;){const i=e.find(s=>s.id===r);r=i==null?void 0:i.parentId,i&&(o=o.concat(i))}return o}function Io(e){e.preventDefault(),e.stopPropagation()}function Dd(e){return"nativeEvent"in e}function Bd(e){return e.mozInputSource===0&&e.isTrusted?!0:tr()&&e.pointerType?e.type==="click"&&e.buttons===1:e.detail===0&&!e.pointerType}function jd(e){return _d()?!1:!tr()&&e.width===0&&e.height===0||tr()&&e.width===1&&e.height===1&&e.pressure===0&&e.detail===0&&e.pointerType==="mouse"||e.width<1&&e.height<1&&e.pressure===0&&e.detail===0&&e.pointerType==="touch"}var Hd=typeof document<"u",Ud=function(){},_e=Hd?_.useLayoutEffect:Ud;const Vd={...zi};function Do(e){const t=_.useRef(e);return _e(()=>{t.current=e}),t}const Fd=Vd.useInsertionEffect,Xd=Fd||(e=>e());function We(e){const t=_.useRef(()=>{});return Xd(()=>{t.current=e}),_.useCallback(function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return t.current==null?void 0:t.current(...o)},[])}const En=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function Ks(e,t){const n=to(e,En()),o=n.length;if(o===0)return;const r=Ot(Fe(e)),i=n.indexOf(r),s=i===-1?t===1?0:o-1:i+t;return n[s]}function qs(e){return Ks(Fe(e).body,1)||e}function Ys(e){return Ks(Fe(e).body,-1)||e}function cn(e,t){const n=t||e.currentTarget,o=e.relatedTarget;return!o||!Me(n,o)}function Kd(e){to(e,En()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function Ri(e){e.querySelectorAll("[data-tabindex]").forEach(n=>{const o=n.dataset.tabindex;delete n.dataset.tabindex,o?n.setAttribute("tabindex",o):n.removeAttribute("tabindex")})}function Ci(e,t,n){let{reference:o,floating:r}=e;const i=ot(t),s=gr(t),a=hr(s),c=at(t),l=i==="y",u=o.x+o.width/2-r.width/2,d=o.y+o.height/2-r.height/2,f=o[a]/2-r[a]/2;let h;switch(c){case"top":h={x:u,y:o.y-r.height};break;case"bottom":h={x:u,y:o.y+o.height};break;case"right":h={x:o.x+o.width,y:d};break;case"left":h={x:o.x-r.width,y:d};break;default:h={x:o.x,y:o.y}}switch(xn(t)){case"start":h[s]-=f*(n&&l?-1:1);break;case"end":h[s]+=f*(n&&l?-1:1);break}return h}const qd=async(e,t,n)=>{const{placement:o="bottom",strategy:r="absolute",middleware:i=[],platform:s}=n,a=i.filter(Boolean),c=await(s.isRTL==null?void 0:s.isRTL(t));let l=await s.getElementRects({reference:e,floating:t,strategy:r}),{x:u,y:d}=Ci(l,o,c),f=o,h={},m=0;for(let p=0;p<a.length;p++){const{name:E,fn:v}=a[p],{x:g,y,data:$,reset:S}=await v({x:u,y:d,initialPlacement:o,placement:f,strategy:r,middlewareData:h,rects:l,platform:s,elements:{reference:e,floating:t}});u=g??u,d=y??d,h={...h,[E]:{...h[E],...$}},S&&m<=50&&(m++,typeof S=="object"&&(S.placement&&(f=S.placement),S.rects&&(l=S.rects===!0?await s.getElementRects({reference:e,floating:t,strategy:r}):S.rects),{x:u,y:d}=Ci(l,f,c)),p=-1)}return{x:u,y:d,placement:f,strategy:r,middlewareData:h}};async function Ws(e,t){var n;t===void 0&&(t={});const{x:o,y:r,platform:i,rects:s,elements:a,strategy:c}=e,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:h=0}=qt(t,e),m=mr(h),E=a[f?d==="floating"?"reference":"floating":d],v=Bt(await i.getClippingRect({element:(n=await(i.isElement==null?void 0:i.isElement(E)))==null||n?E:E.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),g=d==="floating"?{x:o,y:r,width:s.floating.width,height:s.floating.height}:s.reference,y=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),$=await(i.isElement==null?void 0:i.isElement(y))?await(i.getScale==null?void 0:i.getScale(y))||{x:1,y:1}:{x:1,y:1},S=Bt(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:g,offsetParent:y,strategy:c}):g);return{top:(v.top-S.top+m.top)/$.y,bottom:(S.bottom-v.bottom+m.bottom)/$.y,left:(v.left-S.left+m.left)/$.x,right:(S.right-v.right+m.right)/$.x}}const Yd=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:o,placement:r,rects:i,platform:s,elements:a,middlewareData:c}=t,{element:l,padding:u=0}=qt(e,t)||{};if(l==null)return{};const d=mr(u),f={x:n,y:o},h=gr(r),m=hr(h),p=await s.getDimensions(l),E=h==="y",v=E?"top":"left",g=E?"bottom":"right",y=E?"clientHeight":"clientWidth",$=i.reference[m]+i.reference[h]-f[h]-i.floating[m],S=f[h]-i.reference[h],I=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l));let P=I?I[y]:0;(!P||!await(s.isElement==null?void 0:s.isElement(I)))&&(P=a.floating[y]||i.floating[m]);const L=$/2-S/2,N=P/2-p[m]/2-1,H=st(d[v],N),j=st(d[g],N),R=H,T=P-p[m]-j,x=P/2-p[m]/2+L,A=Jo(R,x,T),M=!c.arrow&&xn(r)!=null&&x!==A&&i.reference[m]/2-(x<R?H:j)-p[m]/2<0,k=M?x<R?x-R:x-T:0;return{[h]:f[h]+k,data:{[h]:A,centerOffset:x-A-k,...M&&{alignmentOffset:k}},reset:M}}}),Wd=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,o;const{placement:r,middlewareData:i,rects:s,initialPlacement:a,platform:c,elements:l}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...E}=qt(e,t);if((n=i.arrow)!=null&&n.alignmentOffset)return{};const v=at(r),g=ot(a),y=at(a)===a,$=await(c.isRTL==null?void 0:c.isRTL(l.floating)),S=f||(y||!p?[Fn(a)]:cd(a)),I=m!=="none";!f&&I&&S.push(...pd(a,p,m,$));const P=[a,...S],L=await Ws(t,E),N=[];let H=((o=i.flip)==null?void 0:o.overflows)||[];if(u&&N.push(L[v]),d){const x=ld(r,s,$);N.push(L[x[0]],L[x[1]])}if(H=[...H,{placement:r,overflows:N}],!N.every(x=>x<=0)){var j,R;const x=(((j=i.flip)==null?void 0:j.index)||0)+1,A=P[x];if(A&&(!(d==="alignment"?g!==ot(A):!1)||H.every(C=>ot(C.placement)===g?C.overflows[0]>0:!0)))return{data:{index:x,overflows:H},reset:{placement:A}};let M=(R=H.filter(k=>k.overflows[0]<=0).sort((k,C)=>k.overflows[1]-C.overflows[1])[0])==null?void 0:R.placement;if(!M)switch(h){case"bestFit":{var T;const k=(T=H.filter(C=>{if(I){const U=ot(C.placement);return U===g||U==="y"}return!0}).map(C=>[C.placement,C.overflows.filter(U=>U>0).reduce((U,w)=>U+w,0)]).sort((C,U)=>C[1]-U[1])[0])==null?void 0:T[0];k&&(M=k);break}case"initialPlacement":M=a;break}if(r!==M)return{reset:{placement:M}}}return{}}}};function zs(e){const t=st(...e.map(i=>i.left)),n=st(...e.map(i=>i.top)),o=Ge(...e.map(i=>i.right)),r=Ge(...e.map(i=>i.bottom));return{x:t,y:n,width:o-t,height:r-n}}function zd(e){const t=e.slice().sort((r,i)=>r.y-i.y),n=[];let o=null;for(let r=0;r<t.length;r++){const i=t[r];!o||i.y-o.y>o.height/2?n.push([i]):n[n.length-1].push(i),o=i}return n.map(r=>Bt(zs(r)))}const Gd=function(e){return e===void 0&&(e={}),{name:"inline",options:e,async fn(t){const{placement:n,elements:o,rects:r,platform:i,strategy:s}=t,{padding:a=2,x:c,y:l}=qt(e,t),u=Array.from(await(i.getClientRects==null?void 0:i.getClientRects(o.reference))||[]),d=zd(u),f=Bt(zs(u)),h=mr(a);function m(){if(d.length===2&&d[0].left>d[1].right&&c!=null&&l!=null)return d.find(E=>c>E.left-h.left&&c<E.right+h.right&&l>E.top-h.top&&l<E.bottom+h.bottom)||f;if(d.length>=2){if(ot(n)==="y"){const H=d[0],j=d[d.length-1],R=at(n)==="top",T=H.top,x=j.bottom,A=R?H.left:j.left,M=R?H.right:j.right,k=M-A,C=x-T;return{top:T,bottom:x,left:A,right:M,width:k,height:C,x:A,y:T}}const E=at(n)==="left",v=Ge(...d.map(H=>H.right)),g=st(...d.map(H=>H.left)),y=d.filter(H=>E?H.left===g:H.right===v),$=y[0].top,S=y[y.length-1].bottom,I=g,P=v,L=P-I,N=S-$;return{top:$,bottom:S,left:I,right:P,width:L,height:N,x:I,y:$}}return f}const p=await i.getElementRects({reference:{getBoundingClientRect:m},floating:o.floating,strategy:s});return r.reference.x!==p.reference.x||r.reference.y!==p.reference.y||r.reference.width!==p.reference.width||r.reference.height!==p.reference.height?{reset:{rects:p}}:{}}}},Jd=new Set(["left","top"]);async function Zd(e,t){const{placement:n,platform:o,elements:r}=e,i=await(o.isRTL==null?void 0:o.isRTL(r.floating)),s=at(n),a=xn(n),c=ot(n)==="y",l=Jd.has(s)?-1:1,u=i&&c?-1:1,d=qt(t,e);let{mainAxis:f,crossAxis:h,alignmentAxis:m}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof m=="number"&&(h=a==="end"?m*-1:m),c?{x:h*u,y:f*l}:{x:f*l,y:h*u}}const Qd=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,o;const{x:r,y:i,placement:s,middlewareData:a}=t,c=await Zd(t,e);return s===((n=a.offset)==null?void 0:n.placement)&&(o=a.arrow)!=null&&o.alignmentOffset?{}:{x:r+c.x,y:i+c.y,data:{...c,placement:s}}}}},ef=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:o,placement:r}=t,{mainAxis:i=!0,crossAxis:s=!1,limiter:a={fn:E=>{let{x:v,y:g}=E;return{x:v,y:g}}},...c}=qt(e,t),l={x:n,y:o},u=await Ws(t,c),d=ot(at(r)),f=Is(d);let h=l[f],m=l[d];if(i){const E=f==="y"?"top":"left",v=f==="y"?"bottom":"right",g=h+u[E],y=h-u[v];h=Jo(g,h,y)}if(s){const E=d==="y"?"top":"left",v=d==="y"?"bottom":"right",g=m+u[E],y=m-u[v];m=Jo(g,m,y)}const p=a.fn({...t,[f]:h,[d]:m});return{...p,data:{x:p.x-n,y:p.y-o,enabled:{[f]:i,[d]:s}}}}}};function Gs(e){const t=Ne(e);let n=parseFloat(t.width)||0,o=parseFloat(t.height)||0;const r=Se(e),i=r?e.offsetWidth:n,s=r?e.offsetHeight:o,a=Vn(n)!==i||Vn(o)!==s;return a&&(n=i,o=s),{width:n,height:o,$:a}}function yr(e){return ge(e)?e:e.contextElement}function _t(e){const t=yr(e);if(!Se(t))return Je(1);const n=t.getBoundingClientRect(),{width:o,height:r,$:i}=Gs(t);let s=(i?Vn(n.width):n.width)/o,a=(i?Vn(n.height):n.height)/r;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const tf=Je(0);function Js(e){const t=Pe(e);return!Qn()||!t.visualViewport?tf:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function nf(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==Pe(e)?!1:t}function xt(e,t,n,o){t===void 0&&(t=!1),n===void 0&&(n=!1);const r=e.getBoundingClientRect(),i=yr(e);let s=Je(1);t&&(o?ge(o)&&(s=_t(o)):s=_t(e));const a=nf(i,n,o)?Js(i):Je(0);let c=(r.left+a.x)/s.x,l=(r.top+a.y)/s.y,u=r.width/s.x,d=r.height/s.y;if(i){const f=Pe(i),h=o&&ge(o)?Pe(o):o;let m=f,p=Go(m);for(;p&&o&&h!==m;){const E=_t(p),v=p.getBoundingClientRect(),g=Ne(p),y=v.left+(p.clientLeft+parseFloat(g.paddingLeft))*E.x,$=v.top+(p.clientTop+parseFloat(g.paddingTop))*E.y;c*=E.x,l*=E.y,u*=E.x,d*=E.y,c+=y,l+=$,m=Pe(p),p=Go(m)}}return Bt({width:u,height:d,x:c,y:l})}function no(e,t){const n=eo(e).scrollLeft;return t?t.left+n:xt(Ze(e)).left+n}function Zs(e,t){const n=e.getBoundingClientRect(),o=n.left+t.scrollLeft-no(e,n),r=n.top+t.scrollTop;return{x:o,y:r}}function of(e){let{elements:t,rect:n,offsetParent:o,strategy:r}=e;const i=r==="fixed",s=Ze(o),a=t?Zn(t.floating):!1;if(o===s||a&&i)return n;let c={scrollLeft:0,scrollTop:0},l=Je(1);const u=Je(0),d=Se(o);if((d||!d&&!i)&&((mt(o)!=="body"||wn(s))&&(c=eo(o)),Se(o))){const h=xt(o);l=_t(o),u.x=h.x+o.clientLeft,u.y=h.y+o.clientTop}const f=s&&!d&&!i?Zs(s,c):Je(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x+f.x,y:n.y*l.y-c.scrollTop*l.y+u.y+f.y}}function rf(e){return Array.from(e.getClientRects())}function sf(e){const t=Ze(e),n=eo(e),o=e.ownerDocument.body,r=Ge(t.scrollWidth,t.clientWidth,o.scrollWidth,o.clientWidth),i=Ge(t.scrollHeight,t.clientHeight,o.scrollHeight,o.clientHeight);let s=-n.scrollLeft+no(e);const a=-n.scrollTop;return Ne(o).direction==="rtl"&&(s+=Ge(t.clientWidth,o.clientWidth)-r),{width:r,height:i,x:s,y:a}}const Oi=25;function af(e,t){const n=Pe(e),o=Ze(e),r=n.visualViewport;let i=o.clientWidth,s=o.clientHeight,a=0,c=0;if(r){i=r.width,s=r.height;const u=Qn();(!u||u&&t==="fixed")&&(a=r.offsetLeft,c=r.offsetTop)}const l=no(o);if(l<=0){const u=o.ownerDocument,d=u.body,f=getComputedStyle(d),h=u.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,m=Math.abs(o.clientWidth-d.clientWidth-h);m<=Oi&&(i-=m)}else l<=Oi&&(i+=l);return{width:i,height:s,x:a,y:c}}const lf=new Set(["absolute","fixed"]);function cf(e,t){const n=xt(e,!0,t==="fixed"),o=n.top+e.clientTop,r=n.left+e.clientLeft,i=Se(e)?_t(e):Je(1),s=e.clientWidth*i.x,a=e.clientHeight*i.y,c=r*i.x,l=o*i.y;return{width:s,height:a,x:c,y:l}}function Li(e,t,n){let o;if(t==="viewport")o=af(e,n);else if(t==="document")o=sf(Ze(e));else if(ge(t))o=cf(t,n);else{const r=Js(e);o={x:t.x-r.x,y:t.y-r.y,width:t.width,height:t.height}}return Bt(o)}function Qs(e,t){const n=it(e);return n===t||!ge(n)||rt(n)?!1:Ne(n).position==="fixed"||Qs(n,t)}function uf(e,t){const n=t.get(e);if(n)return n;let o=pt(e,[],!1).filter(a=>ge(a)&&mt(a)!=="body"),r=null;const i=Ne(e).position==="fixed";let s=i?it(e):e;for(;ge(s)&&!rt(s);){const a=Ne(s),c=pr(s);!c&&a.position==="fixed"&&(r=null),(i?!c&&!r:!c&&a.position==="static"&&!!r&&lf.has(r.position)||wn(s)&&!c&&Qs(e,s))?o=o.filter(u=>u!==s):r=a,s=it(s)}return t.set(e,o),o}function df(e){let{element:t,boundary:n,rootBoundary:o,strategy:r}=e;const s=[...n==="clippingAncestors"?Zn(t)?[]:uf(t,this._c):[].concat(n),o],a=s[0],c=s.reduce((l,u)=>{const d=Li(t,u,r);return l.top=Ge(d.top,l.top),l.right=st(d.right,l.right),l.bottom=st(d.bottom,l.bottom),l.left=Ge(d.left,l.left),l},Li(t,a,r));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function ff(e){const{width:t,height:n}=Gs(e);return{width:t,height:n}}function pf(e,t,n){const o=Se(t),r=Ze(t),i=n==="fixed",s=xt(e,!0,i,t);let a={scrollLeft:0,scrollTop:0};const c=Je(0);function l(){c.x=no(r)}if(o||!o&&!i)if((mt(t)!=="body"||wn(r))&&(a=eo(t)),o){const h=xt(t,!0,i,t);c.x=h.x+t.clientLeft,c.y=h.y+t.clientTop}else r&&l();i&&!o&&r&&l();const u=r&&!o&&!i?Zs(r,a):Je(0),d=s.left+a.scrollLeft-c.x-u.x,f=s.top+a.scrollTop-c.y-u.y;return{x:d,y:f,width:s.width,height:s.height}}function Bo(e){return Ne(e).position==="static"}function ki(e,t){if(!Se(e)||Ne(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return Ze(e)===n&&(n=n.ownerDocument.body),n}function ea(e,t){const n=Pe(e);if(Zn(e))return n;if(!Se(e)){let r=it(e);for(;r&&!rt(r);){if(ge(r)&&!Bo(r))return r;r=it(r)}return n}let o=ki(e,t);for(;o&&Zu(o)&&Bo(o);)o=ki(o,t);return o&&rt(o)&&Bo(o)&&!pr(o)?n:o||od(e)||n}const hf=async function(e){const t=this.getOffsetParent||ea,n=this.getDimensions,o=await n(e.floating);return{reference:pf(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:o.width,height:o.height}}};function gf(e){return Ne(e).direction==="rtl"}const mf={convertOffsetParentRelativeRectToViewportRelativeRect:of,getDocumentElement:Ze,getClippingRect:df,getOffsetParent:ea,getElementRects:hf,getClientRects:rf,getDimensions:ff,getScale:_t,isElement:ge,isRTL:gf};function ta(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function yf(e,t){let n=null,o;const r=Ze(e);function i(){var a;clearTimeout(o),(a=n)==null||a.disconnect(),n=null}function s(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),i();const l=e.getBoundingClientRect(),{left:u,top:d,width:f,height:h}=l;if(a||t(),!f||!h)return;const m=kn(d),p=kn(r.clientWidth-(u+f)),E=kn(r.clientHeight-(d+h)),v=kn(u),y={rootMargin:-m+"px "+-p+"px "+-E+"px "+-v+"px",threshold:Ge(0,st(1,c))||1};let $=!0;function S(I){const P=I[0].intersectionRatio;if(P!==c){if(!$)return s();P?s(!1,P):o=setTimeout(()=>{s(!1,1e-7)},1e3)}P===1&&!ta(l,e.getBoundingClientRect())&&s(),$=!1}try{n=new IntersectionObserver(S,{...y,root:r.ownerDocument})}catch{n=new IntersectionObserver(S,y)}n.observe(e)}return s(!0),i}function vf(e,t,n,o){o===void 0&&(o={});const{ancestorScroll:r=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=o,l=yr(e),u=r||i?[...l?pt(l):[],...pt(t)]:[];u.forEach(v=>{r&&v.addEventListener("scroll",n,{passive:!0}),i&&v.addEventListener("resize",n)});const d=l&&a?yf(l,n):null;let f=-1,h=null;s&&(h=new ResizeObserver(v=>{let[g]=v;g&&g.target===l&&h&&(h.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var y;(y=h)==null||y.observe(t)})),n()}),l&&!c&&h.observe(l),h.observe(t));let m,p=c?xt(e):null;c&&E();function E(){const v=xt(e);p&&!ta(p,v)&&n(),p=v,m=requestAnimationFrame(E)}return n(),()=>{var v;u.forEach(g=>{r&&g.removeEventListener("scroll",n),i&&g.removeEventListener("resize",n)}),d==null||d(),(v=h)==null||v.disconnect(),h=null,c&&cancelAnimationFrame(m)}}const bf=Qd,wf=ef,xf=Wd,Mi=Yd,Ef=Gd,Af=(e,t,n)=>{const o=new Map,r={platform:mf,...n},i={...r.platform,_c:o};return qd(e,t,{...r,platform:i})};var Sf=typeof document<"u",$f=function(){},Nn=Sf?_.useLayoutEffect:$f;function Yn(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,o,r;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(o=n;o--!==0;)if(!Yn(e[o],t[o]))return!1;return!0}if(r=Object.keys(e),n=r.length,n!==Object.keys(t).length)return!1;for(o=n;o--!==0;)if(!{}.hasOwnProperty.call(t,r[o]))return!1;for(o=n;o--!==0;){const i=r[o];if(!(i==="_owner"&&e.$$typeof)&&!Yn(e[i],t[i]))return!1}return!0}return e!==e&&t!==t}function na(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function _i(e,t){const n=na(e);return Math.round(t*n)/n}function jo(e){const t=_.useRef(e);return Nn(()=>{t.current=e}),t}function Tf(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:o=[],platform:r,elements:{reference:i,floating:s}={},transform:a=!0,whileElementsMounted:c,open:l}=e,[u,d]=_.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[f,h]=_.useState(o);Yn(f,o)||h(o);const[m,p]=_.useState(null),[E,v]=_.useState(null),g=_.useCallback(C=>{C!==I.current&&(I.current=C,p(C))},[]),y=_.useCallback(C=>{C!==P.current&&(P.current=C,v(C))},[]),$=i||m,S=s||E,I=_.useRef(null),P=_.useRef(null),L=_.useRef(u),N=c!=null,H=jo(c),j=jo(r),R=jo(l),T=_.useCallback(()=>{if(!I.current||!P.current)return;const C={placement:t,strategy:n,middleware:f};j.current&&(C.platform=j.current),Af(I.current,P.current,C).then(U=>{const w={...U,isPositioned:R.current!==!1};x.current&&!Yn(L.current,w)&&(L.current=w,or.flushSync(()=>{d(w)}))})},[f,t,n,j,R]);Nn(()=>{l===!1&&L.current.isPositioned&&(L.current.isPositioned=!1,d(C=>({...C,isPositioned:!1})))},[l]);const x=_.useRef(!1);Nn(()=>(x.current=!0,()=>{x.current=!1}),[]),Nn(()=>{if($&&(I.current=$),S&&(P.current=S),$&&S){if(H.current)return H.current($,S,T);T()}},[$,S,T,H,N]);const A=_.useMemo(()=>({reference:I,floating:P,setReference:g,setFloating:y}),[g,y]),M=_.useMemo(()=>({reference:$,floating:S}),[$,S]),k=_.useMemo(()=>{const C={position:n,left:0,top:0};if(!M.floating)return C;const U=_i(M.floating,u.x),w=_i(M.floating,u.y);return a?{...C,transform:"translate("+U+"px, "+w+"px)",...na(M.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:U,top:w}},[n,a,M.floating,u.x,u.y]);return _.useMemo(()=>({...u,update:T,refs:A,elements:M,floatingStyles:k}),[u,T,A,M,k])}const Rf=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:o,padding:r}=typeof e=="function"?e(n):e;return o&&t(o)?o.current!=null?Mi({element:o.current,padding:r}).fn(n):{}:o?Mi({element:o,padding:r}).fn(n):{}}}},Cf=(e,t)=>({...bf(e),options:[e,t]}),Of=(e,t)=>({...wf(e),options:[e,t]}),Lf=(e,t)=>({...xf(e),options:[e,t]}),kf=(e,t)=>({...Ef(e),options:[e,t]}),Mf=(e,t)=>({...Rf(e),options:[e,t]}),_f="data-floating-ui-focusable",Pi="active",Ni="selected",Pf={...zi};let Ii=!1,Nf=0;const Di=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+Nf++;function If(){const[e,t]=_.useState(()=>Ii?Di():void 0);return _e(()=>{e==null&&t(Di())},[]),_.useEffect(()=>{Ii=!0},[]),e}const Df=Pf.useId,oo=Df||If,Bf=_.forwardRef(function(t,n){const{context:{placement:o,elements:{floating:r},middlewareData:{arrow:i,shift:s}},width:a=14,height:c=7,tipRadius:l=0,strokeWidth:u=0,staticOffset:d,stroke:f,d:h,style:{transform:m,...p}={},...E}=t,v=oo(),[g,y]=_.useState(!1);if(_e(()=>{if(!r)return;Ne(r).direction==="rtl"&&y(!0)},[r]),!r)return null;const[$,S]=o.split("-"),I=$==="top"||$==="bottom";let P=d;(I&&s!=null&&s.x||!I&&s!=null&&s.y)&&(P=null);const L=u*2,N=L/2,H=a/2*(l/-8+1),j=c/2*l/4,R=!!h,T=P&&S==="end"?"bottom":"top";let x=P&&S==="end"?"right":"left";P&&g&&(x=S==="end"?"left":"right");const A=(i==null?void 0:i.x)!=null?P||i.x:"",M=(i==null?void 0:i.y)!=null?P||i.y:"",k=h||"M0,0"+(" H"+a)+(" L"+(a-H)+","+(c-j))+(" Q"+a/2+","+c+" "+H+","+(c-j))+" Z",C={top:R?"rotate(180deg)":"",left:R?"rotate(90deg)":"rotate(-90deg)",bottom:R?"":"rotate(180deg)",right:R?"rotate(-90deg)":"rotate(90deg)"}[$];return de.jsxs("svg",{...E,"aria-hidden":!0,ref:n,width:R?a:a+L,height:a,viewBox:"0 0 "+a+" "+(c>a?c:a),style:{position:"absolute",pointerEvents:"none",[x]:A,[T]:M,[$]:I||R?"100%":"calc(100% - "+L/2+"px)",transform:[C,m].filter(U=>!!U).join(" "),...p},children:[L>0&&de.jsx("path",{clipPath:"url(#"+v+")",fill:"none",stroke:f,strokeWidth:L+(h?0:1),d:k}),de.jsx("path",{stroke:L&&!h?E.fill:"none",d:k}),de.jsx("clipPath",{id:v,children:de.jsx("rect",{x:-N,y:N*(R?-1:1),width:a+L,height:a})})]})});function jf(){const e=new Map;return{emit(t,n){var o;(o=e.get(t))==null||o.forEach(r=>r(n))},on(t,n){e.has(t)||e.set(t,new Set),e.get(t).add(n)},off(t,n){var o;(o=e.get(t))==null||o.delete(n)}}}const Hf=_.createContext(null),Uf=_.createContext(null),oa=()=>{var e;return((e=_.useContext(Hf))==null?void 0:e.id)||null},vr=()=>_.useContext(Uf);function vn(e){return"data-floating-ui-"+e}function Vf(e){e.current!==-1&&(clearTimeout(e.current),e.current=-1)}let Bi=0;function Tt(e,t){t===void 0&&(t={});const{preventScroll:n=!1,cancelPrevious:o=!0,sync:r=!1}=t;o&&cancelAnimationFrame(Bi);const i=()=>e==null?void 0:e.focus({preventScroll:n});r?i():Bi=requestAnimationFrame(i)}function Ff(e){return(e==null?void 0:e.ownerDocument)||document}const Pt={inert:new WeakMap,"aria-hidden":new WeakMap,none:new WeakMap};function ji(e){return e==="inert"?Pt.inert:e==="aria-hidden"?Pt["aria-hidden"]:Pt.none}let Mn=new WeakSet,_n={},Ho=0;const Xf=()=>typeof HTMLElement<"u"&&"inert"in HTMLElement.prototype,ra=e=>e&&(e.host||ra(e.parentNode)),Kf=(e,t)=>t.map(n=>{if(e.contains(n))return n;const o=ra(n);return e.contains(o)?o:null}).filter(n=>n!=null);function qf(e,t,n,o){const r="data-floating-ui-inert",i=o?"inert":n?"aria-hidden":null,s=Kf(t,e),a=new Set,c=new Set(s),l=[];_n[r]||(_n[r]=new WeakMap);const u=_n[r];s.forEach(d),f(t),a.clear();function d(h){!h||a.has(h)||(a.add(h),h.parentNode&&d(h.parentNode))}function f(h){!h||c.has(h)||[].forEach.call(h.children,m=>{if(mt(m)!=="script")if(a.has(m))f(m);else{const p=i?m.getAttribute(i):null,E=p!==null&&p!=="false",v=ji(i),g=(v.get(m)||0)+1,y=(u.get(m)||0)+1;v.set(m,g),u.set(m,y),l.push(m),g===1&&E&&Mn.add(m),y===1&&m.setAttribute(r,""),!E&&i&&m.setAttribute(i,i==="inert"?"":"true")}})}return Ho++,()=>{l.forEach(h=>{const m=ji(i),E=(m.get(h)||0)-1,v=(u.get(h)||0)-1;m.set(h,E),u.set(h,v),E||(!Mn.has(h)&&i&&h.removeAttribute(i),Mn.delete(h)),v||h.removeAttribute(r)}),Ho--,Ho||(Pt.inert=new WeakMap,Pt["aria-hidden"]=new WeakMap,Pt.none=new WeakMap,Mn=new WeakSet,_n={})}}function Hi(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);const o=Ff(e[0]).body;return qf(e.concat(Array.from(o.querySelectorAll('[aria-live],[role="status"],output'))),o,t,n)}const ro={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0},Wn=_.forwardRef(function(t,n){const[o,r]=_.useState();_e(()=>{Md()&&r("button")},[]);const i={ref:n,tabIndex:0,role:o,"aria-hidden":o?void 0:!0,[vn("focus-guard")]:"",style:ro};return de.jsx("span",{...t,...i})}),ia=_.createContext(null),Ui=vn("portal");function Yf(e){e===void 0&&(e={});const{id:t,root:n}=e,o=oo(),r=sa(),[i,s]=_.useState(null),a=_.useRef(null);return _e(()=>()=>{i==null||i.remove(),queueMicrotask(()=>{a.current=null})},[i]),_e(()=>{if(!o||a.current)return;const c=t?document.getElementById(t):null;if(!c)return;const l=document.createElement("div");l.id=o,l.setAttribute(Ui,""),c.appendChild(l),a.current=l,s(l)},[t,o]),_e(()=>{if(n===null||!o||a.current)return;let c=n||(r==null?void 0:r.portalNode);c&&!fr(c)&&(c=c.current),c=c||document.body;let l=null;t&&(l=document.createElement("div"),l.id=t,c.appendChild(l));const u=document.createElement("div");u.id=o,u.setAttribute(Ui,""),c=l||c,c.appendChild(u),a.current=u,s(u)},[t,n,o,r]),i}function Wf(e){const{children:t,id:n,root:o,preserveTabOrder:r=!0}=e,i=Yf({id:n,root:o}),[s,a]=_.useState(null),c=_.useRef(null),l=_.useRef(null),u=_.useRef(null),d=_.useRef(null),f=s==null?void 0:s.modal,h=s==null?void 0:s.open,m=!!s&&!s.modal&&s.open&&r&&!!(o||i);return _.useEffect(()=>{if(!i||!r||f)return;function p(E){i&&cn(E)&&(E.type==="focusin"?Ri:Kd)(i)}return i.addEventListener("focusin",p,!0),i.addEventListener("focusout",p,!0),()=>{i.removeEventListener("focusin",p,!0),i.removeEventListener("focusout",p,!0)}},[i,r,f]),_.useEffect(()=>{i&&(h||Ri(i))},[h,i]),de.jsxs(ia.Provider,{value:_.useMemo(()=>({preserveTabOrder:r,beforeOutsideRef:c,afterOutsideRef:l,beforeInsideRef:u,afterInsideRef:d,portalNode:i,setFocusManagerState:a}),[r,i]),children:[m&&i&&de.jsx(Wn,{"data-type":"outside",ref:c,onFocus:p=>{if(cn(p,i)){var E;(E=u.current)==null||E.focus()}else{const v=s?s.domReference:null,g=Ys(v);g==null||g.focus()}}}),m&&i&&de.jsx("span",{"aria-owns":i.id,style:ro}),i&&or.createPortal(t,i),m&&i&&de.jsx(Wn,{"data-type":"outside",ref:l,onFocus:p=>{if(cn(p,i)){var E;(E=d.current)==null||E.focus()}else{const v=s?s.domReference:null,g=qs(v);g==null||g.focus(),s!=null&&s.closeOnFocusOut&&(s==null||s.onOpenChange(!1,p.nativeEvent,"focus-out"))}}})]})}const sa=()=>_.useContext(ia);function Vi(e){return _.useMemo(()=>t=>{e.forEach(n=>{n&&(n.current=t)})},e)}const zf=20;let dt=[];function br(){dt=dt.filter(e=>e.isConnected)}function Gf(e){br(),e&&mt(e)!=="body"&&(dt.push(e),dt.length>zf&&(dt=dt.slice(-20)))}function Fi(){return br(),dt[dt.length-1]}function Jf(e){const t=En();return Fs(e,t)?e:to(e,t)[0]||e}function Xi(e,t){var n;if(!t.current.includes("floating")&&!((n=e.getAttribute("role"))!=null&&n.includes("dialog")))return;const o=En(),i=Ld(e,o).filter(a=>{const c=a.getAttribute("data-tabindex")||"";return Fs(a,o)||a.hasAttribute("data-tabindex")&&!c.startsWith("-")}),s=e.getAttribute("tabindex");t.current.includes("floating")||i.length===0?s!=="0"&&e.setAttribute("tabindex","0"):(s!=="-1"||e.hasAttribute("data-tabindex")&&e.getAttribute("data-tabindex")!=="-1")&&(e.setAttribute("tabindex","-1"),e.setAttribute("data-tabindex","-1"))}const Zf=_.forwardRef(function(t,n){return de.jsx("button",{...t,type:"button",ref:n,tabIndex:-1,style:ro})});function Qf(e){const{context:t,children:n,disabled:o=!1,order:r=["content"],guards:i=!0,initialFocus:s=0,returnFocus:a=!0,restoreFocus:c=!1,modal:l=!0,visuallyHiddenDismiss:u=!1,closeOnFocusOut:d=!0,outsideElementsInert:f=!1,getInsideElements:h=()=>[]}=e,{open:m,onOpenChange:p,events:E,dataRef:v,elements:{domReference:g,floating:y}}=t,$=We(()=>{var W;return(W=v.current.floatingContext)==null?void 0:W.nodeId}),S=We(h),I=typeof s=="number"&&s<0,P=$i(g)&&I,L=Xf(),N=L?i:!0,H=!N||L&&f,j=Do(r),R=Do(s),T=Do(a),x=vr(),A=sa(),M=_.useRef(null),k=_.useRef(null),C=_.useRef(!1),U=_.useRef(!1),w=_.useRef(-1),O=_.useRef(-1),B=A!=null,D=nr(y),K=We(function(W){return W===void 0&&(W=D),W?to(W,En()):[]}),F=We(W=>{const ee=K(W);return j.current.map(G=>g&&G==="reference"?g:D&&G==="floating"?D:ee).filter(Boolean).flat()});_.useEffect(()=>{if(o||!l)return;function W(G){if(G.key==="Tab"){Me(D,Ot(Fe(D)))&&K().length===0&&!P&&Io(G);const se=F(),ie=lt(G);j.current[0]==="reference"&&ie===g&&(Io(G),G.shiftKey?Tt(se[se.length-1]):Tt(se[1])),j.current[1]==="floating"&&ie===D&&G.shiftKey&&(Io(G),Tt(se[0]))}}const ee=Fe(D);return ee.addEventListener("keydown",W),()=>{ee.removeEventListener("keydown",W)}},[o,g,D,l,j,P,K,F]),_.useEffect(()=>{if(o||!y)return;function W(ee){const G=lt(ee),ie=K().indexOf(G);ie!==-1&&(w.current=ie)}return y.addEventListener("focusin",W),()=>{y.removeEventListener("focusin",W)}},[o,y,K]),_.useEffect(()=>{if(o||!d)return;function W(){U.current=!0,setTimeout(()=>{U.current=!1})}function ee(ie){const X=ie.relatedTarget,Oe=ie.currentTarget,Te=lt(ie);queueMicrotask(()=>{const Y=$(),V=!(Me(g,X)||Me(y,X)||Me(X,y)||Me(A==null?void 0:A.portalNode,X)||X!=null&&X.hasAttribute(vn("focus-guard"))||x&&(Mt(x.nodesRef.current,Y).find(Le=>{var Ce,ke;return Me((Ce=Le.context)==null?void 0:Ce.elements.floating,X)||Me((ke=Le.context)==null?void 0:ke.elements.domReference,X)})||Ti(x.nodesRef.current,Y).find(Le=>{var Ce,ke,yt;return[(Ce=Le.context)==null?void 0:Ce.elements.floating,nr((ke=Le.context)==null?void 0:ke.elements.floating)].includes(X)||((yt=Le.context)==null?void 0:yt.elements.domReference)===X})));if(Oe===g&&D&&Xi(D,j),c&&Oe!==g&&!(Te!=null&&Te.isConnected)&&Ot(Fe(D))===Fe(D).body){Se(D)&&D.focus();const Le=w.current,Ce=K(),ke=Ce[Le]||Ce[Ce.length-1]||D;Se(ke)&&ke.focus()}if(v.current.insideReactTree){v.current.insideReactTree=!1;return}(P||!l)&&X&&V&&!U.current&&X!==Fi()&&(C.current=!0,p(!1,ie,"focus-out"))})}const G=!!(!x&&A);function se(){Vf(O),v.current.insideReactTree=!0,O.current=window.setTimeout(()=>{v.current.insideReactTree=!1})}if(y&&Se(g))return g.addEventListener("focusout",ee),g.addEventListener("pointerdown",W),y.addEventListener("focusout",ee),G&&y.addEventListener("focusout",se,!0),()=>{g.removeEventListener("focusout",ee),g.removeEventListener("pointerdown",W),y.removeEventListener("focusout",ee),G&&y.removeEventListener("focusout",se,!0)}},[o,g,y,D,l,x,A,p,d,c,K,P,$,j,v]);const q=_.useRef(null),ae=_.useRef(null),ne=Vi([q,A==null?void 0:A.beforeInsideRef]),Ue=Vi([ae,A==null?void 0:A.afterInsideRef]);_.useEffect(()=>{var W,ee;if(o||!y)return;const G=Array.from((A==null||(W=A.portalNode)==null?void 0:W.querySelectorAll("["+vn("portal")+"]"))||[]),ie=(ee=(x?Ti(x.nodesRef.current,$()):[]).find(Te=>{var Y;return $i(((Y=Te.context)==null?void 0:Y.elements.domReference)||null)}))==null||(ee=ee.context)==null?void 0:ee.elements.domReference,X=[y,ie,...G,...S(),M.current,k.current,q.current,ae.current,A==null?void 0:A.beforeOutsideRef.current,A==null?void 0:A.afterOutsideRef.current,j.current.includes("reference")||P?g:null].filter(Te=>Te!=null),Oe=l||P?Hi(X,!H,H):Hi(X);return()=>{Oe()}},[o,g,y,l,j,A,P,N,H,x,$,S]),_e(()=>{if(o||!Se(D))return;const W=Fe(D),ee=Ot(W);queueMicrotask(()=>{const G=F(D),se=R.current,ie=(typeof se=="number"?G[se]:se.current)||D,X=Me(D,ee);!I&&!X&&m&&Tt(ie,{preventScroll:ie===D})})},[o,m,D,I,F,R]),_e(()=>{if(o||!D)return;const W=Fe(D),ee=Ot(W);Gf(ee);function G(X){let{reason:Oe,event:Te,nested:Y}=X;if(["hover","safe-polygon"].includes(Oe)&&Te.type==="mouseleave"&&(C.current=!0),Oe==="outside-press")if(Y)C.current=!1;else if(Bd(Te)||jd(Te))C.current=!1;else{let V=!1;document.createElement("div").focus({get preventScroll(){return V=!0,!1}}),V?C.current=!1:C.current=!0}}E.on("openchange",G);const se=W.createElement("span");se.setAttribute("tabindex","-1"),se.setAttribute("aria-hidden","true"),Object.assign(se.style,ro),B&&g&&g.insertAdjacentElement("afterend",se);function ie(){if(typeof T.current=="boolean"){const X=g||Fi();return X&&X.isConnected?X:se}return T.current.current||se}return()=>{E.off("openchange",G);const X=Ot(W),Oe=Me(y,X)||x&&Mt(x.nodesRef.current,$(),!1).some(Y=>{var V;return Me((V=Y.context)==null?void 0:V.elements.floating,X)}),Te=ie();queueMicrotask(()=>{const Y=Jf(Te);T.current&&!C.current&&Se(Y)&&(!(Y!==X&&X!==W.body)||Oe)&&Y.focus({preventScroll:!0}),se.remove()})}},[o,y,D,T,v,E,x,B,g,$]),_.useEffect(()=>(queueMicrotask(()=>{C.current=!1}),()=>{queueMicrotask(br)}),[o]),_e(()=>{if(!o&&A)return A.setFocusManagerState({modal:l,closeOnFocusOut:d,open:m,onOpenChange:p,domReference:g}),()=>{A.setFocusManagerState(null)}},[o,A,l,m,p,d,g]),_e(()=>{o||D&&Xi(D,j)},[o,D,j]);function be(W){return o||!u||!l?null:de.jsx(Zf,{ref:W==="start"?M:k,onClick:ee=>p(!1,ee.nativeEvent),children:typeof u=="string"?u:"Dismiss"})}const Ye=!o&&N&&(l?!P:!0)&&(B||l);return de.jsxs(de.Fragment,{children:[Ye&&de.jsx(Wn,{"data-type":"inside",ref:ne,onFocus:W=>{if(l){const G=F();Tt(r[0]==="reference"?G[0]:G[G.length-1])}else if(A!=null&&A.preserveTabOrder&&A.portalNode)if(C.current=!1,cn(W,A.portalNode)){const G=qs(g);G==null||G.focus()}else{var ee;(ee=A.beforeOutsideRef.current)==null||ee.focus()}}}),!P&&be("start"),n,be("end"),Ye&&de.jsx(Wn,{"data-type":"inside",ref:Ue,onFocus:W=>{if(l)Tt(F()[0]);else if(A!=null&&A.preserveTabOrder&&A.portalNode)if(d&&(C.current=!0),cn(W,A.portalNode)){const G=Ys(g);G==null||G.focus()}else{var ee;(ee=A.afterOutsideRef.current)==null||ee.focus()}}})]})}const ep={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},tp={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},Ki=e=>{var t,n;return{escapeKey:typeof e=="boolean"?e:(t=e==null?void 0:e.escapeKey)!=null?t:!1,outsidePress:typeof e=="boolean"?e:(n=e==null?void 0:e.outsidePress)!=null?n:!0}};function np(e,t){t===void 0&&(t={});const{open:n,onOpenChange:o,elements:r,dataRef:i}=e,{enabled:s=!0,escapeKey:a=!0,outsidePress:c=!0,outsidePressEvent:l="pointerdown",referencePress:u=!1,referencePressEvent:d="pointerdown",ancestorScroll:f=!1,bubbles:h,capture:m}=t,p=vr(),E=We(typeof c=="function"?c:()=>!1),v=typeof c=="function"?E:c,g=_.useRef(!1),{escapeKey:y,outsidePress:$}=Ki(h),{escapeKey:S,outsidePress:I}=Ki(m),P=_.useRef(!1),L=We(x=>{var A;if(!n||!s||!a||x.key!=="Escape"||P.current)return;const M=(A=i.current.floatingContext)==null?void 0:A.nodeId,k=p?Mt(p.nodesRef.current,M):[];if(!y&&(x.stopPropagation(),k.length>0)){let C=!0;if(k.forEach(U=>{var w;if((w=U.context)!=null&&w.open&&!U.context.dataRef.current.__escapeKeyBubbles){C=!1;return}}),!C)return}o(!1,Dd(x)?x.nativeEvent:x,"escape-key")}),N=We(x=>{var A;const M=()=>{var k;L(x),(k=lt(x))==null||k.removeEventListener("keydown",M)};(A=lt(x))==null||A.addEventListener("keydown",M)}),H=We(x=>{var A;const M=i.current.insideReactTree;i.current.insideReactTree=!1;const k=g.current;if(g.current=!1,l==="click"&&k||M||typeof v=="function"&&!v(x))return;const C=lt(x),U="["+vn("inert")+"]",w=Fe(r.floating).querySelectorAll(U);let O=ge(C)?C:null;for(;O&&!rt(O);){const F=it(O);if(rt(F)||!ge(F))break;O=F}if(w.length&&ge(C)&&!Nd(C)&&!Me(C,r.floating)&&Array.from(w).every(F=>!Me(O,F)))return;if(Se(C)&&T){const F=rt(C),q=Ne(C),ae=/auto|scroll/,ne=F||ae.test(q.overflowX),Ue=F||ae.test(q.overflowY),be=ne&&C.clientWidth>0&&C.scrollWidth>C.clientWidth,Ye=Ue&&C.clientHeight>0&&C.scrollHeight>C.clientHeight,W=q.direction==="rtl",ee=Ye&&(W?x.offsetX<=C.offsetWidth-C.clientWidth:x.offsetX>C.clientWidth),G=be&&x.offsetY>C.clientHeight;if(ee||G)return}const B=(A=i.current.floatingContext)==null?void 0:A.nodeId,D=p&&Mt(p.nodesRef.current,B).some(F=>{var q;return No(x,(q=F.context)==null?void 0:q.elements.floating)});if(No(x,r.floating)||No(x,r.domReference)||D)return;const K=p?Mt(p.nodesRef.current,B):[];if(K.length>0){let F=!0;if(K.forEach(q=>{var ae;if((ae=q.context)!=null&&ae.open&&!q.context.dataRef.current.__outsidePressBubbles){F=!1;return}}),!F)return}o(!1,x,"outside-press")}),j=We(x=>{var A;const M=()=>{var k;H(x),(k=lt(x))==null||k.removeEventListener(l,M)};(A=lt(x))==null||A.addEventListener(l,M)});_.useEffect(()=>{if(!n||!s)return;i.current.__escapeKeyBubbles=y,i.current.__outsidePressBubbles=$;let x=-1;function A(w){o(!1,w,"ancestor-scroll")}function M(){window.clearTimeout(x),P.current=!0}function k(){x=window.setTimeout(()=>{P.current=!1},Qn()?5:0)}const C=Fe(r.floating);a&&(C.addEventListener("keydown",S?N:L,S),C.addEventListener("compositionstart",M),C.addEventListener("compositionend",k)),v&&C.addEventListener(l,I?j:H,I);let U=[];return f&&(ge(r.domReference)&&(U=pt(r.domReference)),ge(r.floating)&&(U=U.concat(pt(r.floating))),!ge(r.reference)&&r.reference&&r.reference.contextElement&&(U=U.concat(pt(r.reference.contextElement)))),U=U.filter(w=>{var O;return w!==((O=C.defaultView)==null?void 0:O.visualViewport)}),U.forEach(w=>{w.addEventListener("scroll",A,{passive:!0})}),()=>{a&&(C.removeEventListener("keydown",S?N:L,S),C.removeEventListener("compositionstart",M),C.removeEventListener("compositionend",k)),v&&C.removeEventListener(l,I?j:H,I),U.forEach(w=>{w.removeEventListener("scroll",A)}),window.clearTimeout(x)}},[i,r,a,v,l,n,o,f,s,y,$,L,S,N,H,I,j]),_.useEffect(()=>{i.current.insideReactTree=!1},[i,v,l]);const R=_.useMemo(()=>({onKeyDown:L,...u&&{[ep[d]]:x=>{o(!1,x.nativeEvent,"reference-press")},...d!=="click"&&{onClick(x){o(!1,x.nativeEvent,"reference-press")}}}}),[L,o,u,d]),T=_.useMemo(()=>({onKeyDown:L,onMouseDown(){g.current=!0},onMouseUp(){g.current=!0},[tp[l]]:()=>{i.current.insideReactTree=!0}}),[L,l,i]);return _.useMemo(()=>s?{reference:R,floating:T}:{},[s,R,T])}function op(e){const{open:t=!1,onOpenChange:n,elements:o}=e,r=oo(),i=_.useRef({}),[s]=_.useState(()=>jf()),a=oa()!=null,[c,l]=_.useState(o.reference),u=We((h,m,p)=>{i.current.openEvent=h?m:void 0,s.emit("openchange",{open:h,event:m,reason:p,nested:a}),n==null||n(h,m,p)}),d=_.useMemo(()=>({setPositionReference:l}),[]),f=_.useMemo(()=>({reference:c||o.reference||null,floating:o.floating||null,domReference:o.reference}),[c,o.reference,o.floating]);return _.useMemo(()=>({dataRef:i,open:t,onOpenChange:u,elements:f,events:s,floatingId:r,refs:d}),[t,u,f,s,r,d])}function rp(e){e===void 0&&(e={});const{nodeId:t}=e,n=op({...e,elements:{reference:null,floating:null,...e.elements}}),o=e.rootContext||n,r=o.elements,[i,s]=_.useState(null),[a,c]=_.useState(null),u=(r==null?void 0:r.domReference)||i,d=_.useRef(null),f=vr();_e(()=>{u&&(d.current=u)},[u]);const h=Tf({...e,elements:{...r,...a&&{reference:a}}}),m=_.useCallback(y=>{const $=ge(y)?{getBoundingClientRect:()=>y.getBoundingClientRect(),getClientRects:()=>y.getClientRects(),contextElement:y}:y;c($),h.refs.setReference($)},[h.refs]),p=_.useCallback(y=>{(ge(y)||y===null)&&(d.current=y,s(y)),(ge(h.refs.reference.current)||h.refs.reference.current===null||y!==null&&!ge(y))&&h.refs.setReference(y)},[h.refs]),E=_.useMemo(()=>({...h.refs,setReference:p,setPositionReference:m,domReference:d}),[h.refs,p,m]),v=_.useMemo(()=>({...h.elements,domReference:u}),[h.elements,u]),g=_.useMemo(()=>({...h,...o,refs:E,elements:v,nodeId:t}),[h,E,v,t,o]);return _e(()=>{o.dataRef.current.floatingContext=g;const y=f==null?void 0:f.nodesRef.current.find($=>$.id===t);y&&(y.context=g)}),_.useMemo(()=>({...h,context:g,refs:E,elements:v}),[h,E,v,g])}function Uo(e,t,n){const o=new Map,r=n==="item";let i=e;if(r&&e){const{[Pi]:s,[Ni]:a,...c}=e;i=c}return{...n==="floating"&&{tabIndex:-1,[_f]:""},...i,...t.map(s=>{const a=s?s[n]:null;return typeof a=="function"?e?a(e):null:a}).concat(e).reduce((s,a)=>(a&&Object.entries(a).forEach(c=>{let[l,u]=c;if(!(r&&[Pi,Ni].includes(l)))if(l.indexOf("on")===0){if(o.has(l)||o.set(l,[]),typeof u=="function"){var d;(d=o.get(l))==null||d.push(u),s[l]=function(){for(var f,h=arguments.length,m=new Array(h),p=0;p<h;p++)m[p]=arguments[p];return(f=o.get(l))==null?void 0:f.map(E=>E(...m)).find(E=>E!==void 0)}}}else s[l]=u}),s),{})}}function ip(e){e===void 0&&(e=[]);const t=e.map(a=>a==null?void 0:a.reference),n=e.map(a=>a==null?void 0:a.floating),o=e.map(a=>a==null?void 0:a.item),r=_.useCallback(a=>Uo(a,e,"reference"),t),i=_.useCallback(a=>Uo(a,e,"floating"),n),s=_.useCallback(a=>Uo(a,e,"item"),o);return _.useMemo(()=>({getReferenceProps:r,getFloatingProps:i,getItemProps:s}),[r,i,s])}const sp=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function ap(e,t){var n,o;t===void 0&&(t={});const{open:r,elements:i,floatingId:s}=e,{enabled:a=!0,role:c="dialog"}=t,l=oo(),u=((n=i.domReference)==null?void 0:n.id)||l,d=_.useMemo(()=>{var g;return((g=nr(i.floating))==null?void 0:g.id)||s},[i.floating,s]),f=(o=sp.get(c))!=null?o:c,m=oa()!=null,p=_.useMemo(()=>f==="tooltip"||c==="label"?{["aria-"+(c==="label"?"labelledby":"describedby")]:r?d:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":f==="alertdialog"?"dialog":f,"aria-controls":r?d:void 0,...f==="listbox"&&{role:"combobox"},...f==="menu"&&{id:u},...f==="menu"&&m&&{role:"menuitem"},...c==="select"&&{"aria-autocomplete":"none"},...c==="combobox"&&{"aria-autocomplete":"list"}},[f,d,m,r,u,c]),E=_.useMemo(()=>{const g={id:d,...f&&{role:f}};return f==="tooltip"||c==="label"?g:{...g,...f==="menu"&&{"aria-labelledby":u}}},[f,d,u,c]),v=_.useCallback(g=>{let{active:y,selected:$}=g;const S={role:"option",...y&&{id:d+"-fui-option"}};switch(c){case"select":case"combobox":return{...S,"aria-selected":$}}return{}},[d,c]);return _.useMemo(()=>a?{reference:p,floating:E,item:v}:{},[a,p,E,v])}const hp=e=>{const{children:t,...n}=e,{anno:o,setAnno:r}=_.useContext(zn),i=_.useCallback(s=>{const a=Ic(zu(s,n));r(a)},[]);return _.useEffect(()=>{o&&o.setStyle(e.style)},[e.style]),_.useEffect(()=>{o&&o.setFilter(e.filter)},[e.filter]),e.children?de.jsx(de.Fragment,{children:_.Children.toArray(e.children).map(s=>_.cloneElement(s,{onLoad:i}))}):null},qi=()=>{if(typeof navigator>"u")return!1;var e=navigator.userAgent||navigator.vendor||(window==null?void 0:window.opera);return!!(/android/i.test(e)||/iPad|iPhone/.test(e)&&!window.MSStream)},lp=(e,t={timeout:250})=>{const n=ka(),[o,r]=_.useState(!0);return _.useEffect(()=>{if(!n||!e)return;let i;const s=a=>{const{changes:{updated:c}}=a;c!=null&&c.some(l=>{const{targetUpdated:u}=l;if(u){const{oldTarget:d,newTarget:f}=u;return cp(d,f)}})&&(r(!1),clearTimeout(i),i=setTimeout(()=>r(!0),t.timeout))};return n.observe(s,{annotations:e,ignore:hs.BODY_ONLY,origin:te.LOCAL}),()=>{clearTimeout(i),n.unobserve(s)}},[n,e,t.timeout]),o},cp=(e,t)=>{const{selector:n}=e,o=n.map(({quote:s})=>s),{selector:r}=t,i=r.map(({quote:s})=>s);return o.join()!==i.join()};let aa=null;const la=(e,t)=>{const{left:n,top:o,right:r,bottom:i}=e,s=t.getBoundingClientRect();return new DOMRect(n+s.left,o+s.top,r-n,i-o)},up=yn((e,t,n)=>{requestAnimationFrame(()=>{const o=t.getAnnotationBounds(e);o&&(aa=la(o,n))})},250),gp=e=>{var t;const n=es(),{selected:o,event:r}=Ma(),i=(t=o[0])==null?void 0:t.annotation,s=lp(i==null?void 0:i.id),[a,c]=_.useState((o==null?void 0:o.length)>0),l=_.useRef(!1),u=_.useRef(null),{refs:d,floatingStyles:f,update:h,context:m}=rp({placement:qi()?"bottom":e.placement||"top",strategy:"absolute",open:a,onOpenChange:($,S,I)=>{!$&&(I==="escape-key"||I==="focus-out")&&(c($),n==null||n.cancelSelected())},middleware:[kf(),Cf(10),Lf({crossAxis:!0}),Of({crossAxis:!0,padding:10}),Mf({element:u})],whileElementsMounted:vf}),p=np(m),E=ap(m,{role:"dialog"}),{getFloatingProps:v}=ip([p,E]);_.useEffect(()=>{if(i!=null&&i.id&&s){const $=n==null?void 0:n.state.store.getAnnotationBounds(i.id);c(!!$)}else c(!1)},[i==null?void 0:i.id,i==null?void 0:i.target.selector,s,n==null?void 0:n.state.store]),_.useEffect(()=>{e.onClose&&(a?l.current=!0:l.current&&(l.current=!1,e.onClose()))},[e.onClose,a]),_.useEffect(()=>{n&&(a&&i!=null&&i.id?d.setPositionReference({getBoundingClientRect:()=>(up(i.id,n.state.store,n.element),aa||new DOMRect),getClientRects:()=>{const $=n.state.store.getAnnotationRects(i.id).map(S=>la(S,n.element));return $u($)}}):d.setPositionReference(null))},[a,i==null?void 0:i.id,i==null?void 0:i.target,n]);const g=_.useMemo(()=>(r==null?void 0:r.type)==="keyup"||(r==null?void 0:r.type)==="contextmenu"||qi()?-1:0,[r]),y=()=>n==null?void 0:n.cancelSelected();return a&&i?de.jsx(Wf,{root:e.asPortal?null:n.element,children:de.jsx(Qf,{context:m,modal:!1,closeOnFocusOut:!0,returnFocus:!1,initialFocus:g,children:de.jsxs("div",{className:`a9s-popup r6o-popup annotation-popup r6o-text-popup ${ur}`,ref:d.setFloating,style:f,children:[e.popup({annotation:o[0].annotation,editable:o[0].editable,event:r}),e.arrow&&de.jsx(Bf,{ref:u,context:m,...e.arrowProps||{}}),de.jsx("button",{className:"r6o-popup-sr-only","aria-live":"assertive",onClick:y,children:e.ariaCloseWarning||"Click or leave this dialog to close it."})]})})}):null};export{ga as R,ha as a,_ as b,zi as c,or as d,pp as e,dp as f,Yi as g,gp as h,de as j,Wi as r,hp as y};
