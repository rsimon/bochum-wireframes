function da(e,t){for(var n=0;n<t.length;n++){const o=t[n];if(typeof o!="string"&&!Array.isArray(o)){for(const r in o)if(r!=="default"&&!(r in e)){const i=Object.getOwnPropertyDescriptor(o,r);i&&Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:()=>o[r]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function Zi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var so={exports:{}},Wt={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Er;function fa(){if(Er)return Wt;Er=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(o,r,i){var s=null;if(i!==void 0&&(s=""+i),r.key!==void 0&&(s=""+r.key),"key"in r){i={};for(var a in r)a!=="key"&&(i[a]=r[a])}else i=r;return r=i.ref,{$$typeof:e,type:o,key:s,ref:r!==void 0?r:null,props:i}}return Wt.Fragment=t,Wt.jsx=n,Wt.jsxs=n,Wt}var Ar;function pa(){return Ar||(Ar=1,so.exports=fa()),so.exports}var de=pa(),ao={exports:{}},Z={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sr;function ha(){if(Sr)return Z;Sr=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),s=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),d=Symbol.iterator;function f(w){return w===null||typeof w!="object"?null:(w=d&&w[d]||w["@@iterator"],typeof w=="function"?w:null)}var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,p={};function x(w,L,B){this.props=w,this.context=L,this.refs=p,this.updater=B||h}x.prototype.isReactComponent={},x.prototype.setState=function(w,L){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,L,"setState")},x.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function v(){}v.prototype=x.prototype;function m(w,L,B){this.props=w,this.context=L,this.refs=p,this.updater=B||h}var y=m.prototype=new v;y.constructor=m,g(y,x.prototype),y.isPureReactComponent=!0;var S=Array.isArray,$={H:null,A:null,T:null,S:null,V:null},I=Object.prototype.hasOwnProperty;function _(w,L,B,D,K,F){return B=F.ref,{$$typeof:e,type:w,key:L,ref:B!==void 0?B:null,props:F}}function C(w,L){return _(w.type,L,void 0,void 0,void 0,w.props)}function N(w){return typeof w=="object"&&w!==null&&w.$$typeof===e}function H(w){var L={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(B){return L[B]})}var j=/\/+/g;function T(w,L){return typeof w=="object"&&w!==null&&w.key!=null?H(""+w.key):L.toString(36)}function R(){}function E(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(R,R):(w.status="pending",w.then(function(L){w.status==="pending"&&(w.status="fulfilled",w.value=L)},function(L){w.status==="pending"&&(w.status="rejected",w.reason=L)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function A(w,L,B,D,K){var F=typeof w;(F==="undefined"||F==="boolean")&&(w=null);var q=!1;if(w===null)q=!0;else switch(F){case"bigint":case"string":case"number":q=!0;break;case"object":switch(w.$$typeof){case e:case t:q=!0;break;case u:return q=w._init,A(q(w._payload),L,B,D,K)}}if(q)return K=K(w),q=D===""?"."+T(w,0):D,S(K)?(B="",q!=null&&(B=q.replace(j,"$&/")+"/"),A(K,L,B,"",function(Ve){return Ve})):K!=null&&(N(K)&&(K=C(K,B+(K.key==null||w&&w.key===K.key?"":(""+K.key).replace(j,"$&/")+"/")+q)),L.push(K)),1;q=0;var ae=D===""?".":D+":";if(S(w))for(var ne=0;ne<w.length;ne++)D=w[ne],F=ae+T(D,ne),q+=A(D,L,B,F,K);else if(ne=f(w),typeof ne=="function")for(w=ne.call(w),ne=0;!(D=w.next()).done;)D=D.value,F=ae+T(D,ne++),q+=A(D,L,B,F,K);else if(F==="object"){if(typeof w.then=="function")return A(E(w),L,B,D,K);throw L=String(w),Error("Objects are not valid as a React child (found: "+(L==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":L)+"). If you meant to render a collection of children, use an array instead.")}return q}function M(w,L,B){if(w==null)return w;var D=[],K=0;return A(w,D,"","",function(F){return L.call(B,F,K++)}),D}function k(w){if(w._status===-1){var L=w._result;L=L(),L.then(function(B){(w._status===0||w._status===-1)&&(w._status=1,w._result=B)},function(B){(w._status===0||w._status===-1)&&(w._status=2,w._result=B)}),w._status===-1&&(w._status=0,w._result=L)}if(w._status===1)return w._result.default;throw w._result}var O=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var L=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(L))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)};function U(){}return Z.Children={map:M,forEach:function(w,L,B){M(w,function(){L.apply(this,arguments)},B)},count:function(w){var L=0;return M(w,function(){L++}),L},toArray:function(w){return M(w,function(L){return L})||[]},only:function(w){if(!N(w))throw Error("React.Children.only expected to receive a single React element child.");return w}},Z.Component=x,Z.Fragment=n,Z.Profiler=r,Z.PureComponent=m,Z.StrictMode=o,Z.Suspense=c,Z.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,Z.__COMPILER_RUNTIME={__proto__:null,c:function(w){return $.H.useMemoCache(w)}},Z.cache=function(w){return function(){return w.apply(null,arguments)}},Z.cloneElement=function(w,L,B){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var D=g({},w.props),K=w.key,F=void 0;if(L!=null)for(q in L.ref!==void 0&&(F=void 0),L.key!==void 0&&(K=""+L.key),L)!I.call(L,q)||q==="key"||q==="__self"||q==="__source"||q==="ref"&&L.ref===void 0||(D[q]=L[q]);var q=arguments.length-2;if(q===1)D.children=B;else if(1<q){for(var ae=Array(q),ne=0;ne<q;ne++)ae[ne]=arguments[ne+2];D.children=ae}return _(w.type,K,void 0,void 0,F,D)},Z.createContext=function(w){return w={$$typeof:s,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:i,_context:w},w},Z.createElement=function(w,L,B){var D,K={},F=null;if(L!=null)for(D in L.key!==void 0&&(F=""+L.key),L)I.call(L,D)&&D!=="key"&&D!=="__self"&&D!=="__source"&&(K[D]=L[D]);var q=arguments.length-2;if(q===1)K.children=B;else if(1<q){for(var ae=Array(q),ne=0;ne<q;ne++)ae[ne]=arguments[ne+2];K.children=ae}if(w&&w.defaultProps)for(D in q=w.defaultProps,q)K[D]===void 0&&(K[D]=q[D]);return _(w,F,void 0,void 0,null,K)},Z.createRef=function(){return{current:null}},Z.forwardRef=function(w){return{$$typeof:a,render:w}},Z.isValidElement=N,Z.lazy=function(w){return{$$typeof:u,_payload:{_status:-1,_result:w},_init:k}},Z.memo=function(w,L){return{$$typeof:l,type:w,compare:L===void 0?null:L}},Z.startTransition=function(w){var L=$.T,B={};$.T=B;try{var D=w(),K=$.S;K!==null&&K(B,D),typeof D=="object"&&D!==null&&typeof D.then=="function"&&D.then(U,O)}catch(F){O(F)}finally{$.T=L}},Z.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},Z.use=function(w){return $.H.use(w)},Z.useActionState=function(w,L,B){return $.H.useActionState(w,L,B)},Z.useCallback=function(w,L){return $.H.useCallback(w,L)},Z.useContext=function(w){return $.H.useContext(w)},Z.useDebugValue=function(){},Z.useDeferredValue=function(w,L){return $.H.useDeferredValue(w,L)},Z.useEffect=function(w,L,B){var D=$.H;if(typeof B=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return D.useEffect(w,L)},Z.useId=function(){return $.H.useId()},Z.useImperativeHandle=function(w,L,B){return $.H.useImperativeHandle(w,L,B)},Z.useInsertionEffect=function(w,L){return $.H.useInsertionEffect(w,L)},Z.useLayoutEffect=function(w,L){return $.H.useLayoutEffect(w,L)},Z.useMemo=function(w,L){return $.H.useMemo(w,L)},Z.useOptimistic=function(w,L){return $.H.useOptimistic(w,L)},Z.useReducer=function(w,L,B){return $.H.useReducer(w,L,B)},Z.useRef=function(w){return $.H.useRef(w)},Z.useState=function(w){return $.H.useState(w)},Z.useSyncExternalStore=function(w,L,B){return $.H.useSyncExternalStore(w,L,B)},Z.useTransition=function(){return $.H.useTransition()},Z.version="19.1.1",Z}var $r;function Qi(){return $r||($r=1,ao.exports=ha()),ao.exports}var lo={exports:{}},$e={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rr;function ma(){if(Rr)return $e;Rr=1;var e=Qi();function t(c){var l="https://react.dev/errors/"+c;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)l+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+c+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var o={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");function i(c,l,u){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:d==null?null:""+d,children:c,containerInfo:l,implementation:u}}var s=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(c,l){if(c==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return $e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,$e.createPortal=function(c,l){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(t(299));return i(c,l,null,u)},$e.flushSync=function(c){var l=s.T,u=o.p;try{if(s.T=null,o.p=2,c)return c()}finally{s.T=l,o.p=u,o.d.f()}},$e.preconnect=function(c,l){typeof c=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,o.d.C(c,l))},$e.prefetchDNS=function(c){typeof c=="string"&&o.d.D(c)},$e.preinit=function(c,l){if(typeof c=="string"&&l&&typeof l.as=="string"){var u=l.as,d=a(u,l.crossOrigin),f=typeof l.integrity=="string"?l.integrity:void 0,h=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;u==="style"?o.d.S(c,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:d,integrity:f,fetchPriority:h}):u==="script"&&o.d.X(c,{crossOrigin:d,integrity:f,fetchPriority:h,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},$e.preinitModule=function(c,l){if(typeof c=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var u=a(l.as,l.crossOrigin);o.d.M(c,{crossOrigin:u,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&o.d.M(c)},$e.preload=function(c,l){if(typeof c=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var u=l.as,d=a(u,l.crossOrigin);o.d.L(c,u,{crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},$e.preloadModule=function(c,l){if(typeof c=="string")if(l){var u=a(l.as,l.crossOrigin);o.d.m(c,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:u,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else o.d.m(c)},$e.requestFormReset=function(c){o.d.r(c)},$e.unstable_batchedUpdates=function(c,l){return c(l)},$e.useFormState=function(c,l,u){return s.H.useFormState(c,l,u)},$e.useFormStatus=function(){return s.H.useHostTransitionStatus()},$e.version="19.1.1",$e}var Tr;function ga(){if(Tr)return lo.exports;Tr=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),lo.exports=ma(),lo.exports}var P=Qi();const ya=Zi(P),es=da({__proto__:null,default:ya},[P]),Gn=P.createContext({anno:void 0,setAnno:void 0,annotations:[],selection:{selected:[]}}),va=(e,t)=>{const{event:n,...o}=e,{event:r,...i}=t;return JSON.stringify(o)!==JSON.stringify(i)?!1:(n==null?void 0:n.timeStamp)===(r==null?void 0:r.timeStamp)},vp=P.forwardRef((e,t)=>{const[n,o]=P.useState(null),[r,i]=P.useState([]),[s,a]=P.useState({selected:[],previous:[]}),c=P.useRef([]);return P.useImperativeHandle(t,()=>n),P.useEffect(()=>{if(n){const{selection:l,store:u}=n.state;u.all().length>0&&i(u.all());const d=()=>i(()=>u.all());u.observe(d);let f;const h=l.subscribe(({selected:g,...p})=>{f&&u.unobserve(f);const x=(g||[]).map(({id:v,editable:m})=>({annotation:u.getAnnotation(v),editable:m}));a(v=>{const m={selected:x,previous:v.selected,...p};return va(v,m)?v:(c.current=v.selected,m)}),f=v=>{const{updated:m}=v.changes;a(y=>({...y,selected:y.selected.map(({annotation:S,editable:$})=>{const I=m.find(_=>_.oldValue.id===S.id);return I?{annotation:I.newValue,editable:$}:{annotation:S,editable:$}})}))},u.observe(f,{annotations:g.map(({id:v})=>v)})});return()=>{u.unobserve(d),h()}}},[n]),de.jsx(Gn.Provider,{value:{anno:n,setAnno:o,annotations:r,selection:s},children:e.children})}),ts=()=>{const{anno:e}=P.useContext(Gn);return e},ba=()=>{const e=ts();return e==null?void 0:e.state.store},wa=()=>{const{selection:e}=P.useContext(Gn);return e};var rr=ga();const bp=Zi(rr);var xa=Object.defineProperty,Ea=(e,t,n)=>t in e?xa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Cr=(e,t,n)=>Ea(e,typeof t!="symbol"?t+"":t,n);function wt(){}function Fo(e,t){for(const n in t)e[n]=t[n];return e}function ns(e){return e()}function Or(){return Object.create(null)}function Ue(e){e.forEach(ns)}function ge(e){return typeof e=="function"}function Ut(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Aa(e){return Object.keys(e).length===0}function Sa(e,t,n,o){if(e){const r=os(e,t,n,o);return e[0](r)}}function os(e,t,n,o){return e[1]&&o?Fo(n.ctx.slice(),e[1](o(t))):n.ctx}function $a(e,t,n,o){if(e[2]&&o){const r=e[2](o(n));if(t.dirty===void 0)return r;if(typeof r=="object"){const i=[],s=Math.max(t.dirty.length,r.length);for(let a=0;a<s;a+=1)i[a]=t.dirty[a]|r[a];return i}return t.dirty|r}return t.dirty}function Ra(e,t,n,o,r,i){if(r){const s=os(t,n,o,i);e.p(s,r)}}function Ta(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let o=0;o<n;o++)t[o]=-1;return t}return-1}function Lr(e){const t={};for(const n in e)n[0]!=="$"&&(t[n]=e[n]);return t}function kr(e){return e??""}function ue(e,t){e.appendChild(t)}function Q(e,t,n){e.insertBefore(t,n||null)}function J(e){e.parentNode&&e.parentNode.removeChild(e)}function Jn(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function z(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function rs(e){return document.createTextNode(e)}function Ce(){return rs(" ")}function wn(){return rs("")}function oe(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function b(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Ca(e){return Array.from(e.childNodes)}function Mr(e,t,n){e.classList.toggle(t,!!n)}function Oa(e,t,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:o})}let dn;function rn(e){dn=e}function is(){if(!dn)throw new Error("Function called outside component initialization");return dn}function ss(e){is().$$.on_mount.push(e)}function ir(){const e=is();return(t,n,{cancelable:o=!1}={})=>{const r=e.$$.callbacks[t];if(r){const i=Oa(t,n,{cancelable:o});return r.slice().forEach(s=>{s.call(e,i)}),!i.defaultPrevented}return!0}}function ye(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(o=>o.call(this,t))}const Ct=[],_r=[];let Mt=[];const Pr=[],as=Promise.resolve();let Xo=!1;function ls(){Xo||(Xo=!0,as.then(us))}function cs(){return ls(),as}function Ko(e){Mt.push(e)}const co=new Set;let At=0;function us(){if(At!==0)return;const e=dn;do{try{for(;At<Ct.length;){const t=Ct[At];At++,rn(t),La(t.$$)}}catch(t){throw Ct.length=0,At=0,t}for(rn(null),Ct.length=0,At=0;_r.length;)_r.pop()();for(let t=0;t<Mt.length;t+=1){const n=Mt[t];co.has(n)||(co.add(n),n())}Mt.length=0}while(Ct.length);for(;Pr.length;)Pr.pop()();Xo=!1,co.clear(),rn(e)}function La(e){if(e.fragment!==null){e.update(),Ue(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ko)}}function ka(e){const t=[],n=[];Mt.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),Mt=t}const Pn=new Set;let bt;function It(){bt={r:0,c:[],p:bt}}function Dt(){bt.r||Ue(bt.c),bt=bt.p}function re(e,t){e&&e.i&&(Pn.delete(e),e.i(t))}function fe(e,t,n,o){if(e&&e.o){if(Pn.has(e))return;Pn.add(e),bt.c.push(()=>{Pn.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function mt(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Ke(e){e&&e.c()}function De(e,t,n){const{fragment:o,after_update:r}=e.$$;o&&o.m(t,n),Ko(()=>{const i=e.$$.on_mount.map(ns).filter(ge);e.$$.on_destroy?e.$$.on_destroy.push(...i):Ue(i),e.$$.on_mount=[]}),r.forEach(Ko)}function Be(e,t){const n=e.$$;n.fragment!==null&&(ka(n.after_update),Ue(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ma(e,t){e.$$.dirty[0]===-1&&(Ct.push(e),ls(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Vt(e,t,n,o,r,i,s=null,a=[-1]){const c=dn;rn(e);const l=e.$$={fragment:null,ctx:[],props:i,update:wt,not_equal:r,bound:Or(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:Or(),dirty:a,skip_bound:!1,root:t.target||c.$$.root};s&&s(l.root);let u=!1;if(l.ctx=n?n(e,t.props||{},(d,f,...h)=>{const g=h.length?h[0]:f;return l.ctx&&r(l.ctx[d],l.ctx[d]=g)&&(!l.skip_bound&&l.bound[d]&&l.bound[d](g),u&&Ma(e,d)),f}):[],l.update(),u=!0,Ue(l.before_update),l.fragment=o?o(l.ctx):!1,t.target){if(t.hydrate){const d=Ca(t.target);l.fragment&&l.fragment.l(d),d.forEach(J)}else l.fragment&&l.fragment.c();t.intro&&re(e.$$.fragment),De(e,t.target,t.anchor),us()}rn(c)}let Ft=class{constructor(){Cr(this,"$$"),Cr(this,"$$set")}$destroy(){Be(this,1),this.$destroy=wt}$on(t,n){if(!ge(n))return wt;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(t){this.$$set&&!Aa(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};const _a="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(_a);var Qe=(e=>(e.ELLIPSE="ELLIPSE",e.MULTIPOLYGON="MULTIPOLYGON",e.POLYGON="POLYGON",e.POLYLINE="POLYLINE",e.RECTANGLE="RECTANGLE",e.LINE="LINE",e))(Qe||{}),Pa={exports:{}};(function(e){(function(){function t(a,c){var l=a.x-c.x,u=a.y-c.y;return l*l+u*u}function n(a,c,l){var u=c.x,d=c.y,f=l.x-u,h=l.y-d;if(f!==0||h!==0){var g=((a.x-u)*f+(a.y-d)*h)/(f*f+h*h);g>1?(u=l.x,d=l.y):g>0&&(u+=f*g,d+=h*g)}return f=a.x-u,h=a.y-d,f*f+h*h}function o(a,c){for(var l=a[0],u=[l],d,f=1,h=a.length;f<h;f++)d=a[f],t(d,l)>c&&(u.push(d),l=d);return l!==d&&u.push(d),u}function r(a,c,l,u,d){for(var f=u,h,g=c+1;g<l;g++){var p=n(a[g],a[c],a[l]);p>f&&(h=g,f=p)}f>u&&(h-c>1&&r(a,c,h,u,d),d.push(a[h]),l-h>1&&r(a,h,l,u,d))}function i(a,c){var l=a.length-1,u=[a[0]];return r(a,0,l,c,u),u.push(a[l]),u}function s(a,c,l){if(a.length<=2)return a;var u=c!==void 0?c*c:1;return a=l?a:o(a,u),a=i(a,u),a}e.exports=s,e.exports.default=s})()})(Pa);const Xt=(e,t)=>t,ut=e=>{let t=1/0,n=1/0,o=-1/0,r=-1/0;return e.forEach(([i,s])=>{t=Math.min(t,i),n=Math.min(n,s),o=Math.max(o,i),r=Math.max(r,s)}),{minX:t,minY:n,maxX:o,maxY:r}},In=e=>{let t=0,n=e.length-1;for(let o=0;o<e.length;o++)t+=(e[n][0]+e[o][0])*(e[n][1]-e[o][1]),n=o;return Math.abs(.5*t)},Dn=(e,t,n)=>{let o=!1;for(let r=0,i=e.length-1;r<e.length;i=r++){const s=e[r][0],a=e[r][1],c=e[i][0],l=e[i][1];a>n!=l>n&&t<(c-s)*(n-a)/(l-a)+s&&(o=!o)}return o},Na=(e,t=!0)=>{let n="M ";return e.forEach(([o,r],i)=>{i===0?n+=`${o},${r}`:n+=` L ${o},${r}`}),t&&(n+=" Z"),n},Ia=(e,t)=>{const n=Math.abs(t[0]-e[0]),o=Math.abs(t[1]-e[1]);return Math.sqrt(Math.pow(n,2)+Math.pow(o,2))},Da={area:e=>Math.PI*e.geometry.rx*e.geometry.ry,intersects:(e,t,n)=>{const{cx:o,cy:r,rx:i,ry:s}=e.geometry,a=0,c=Math.cos(a),l=Math.sin(a),u=t-o,d=n-r,f=c*u+l*d,h=l*u-c*d;return f*f/(i*i)+h*h/(s*s)<=1}};Xt(Qe.ELLIPSE,Da);const Ba={area:e=>0,intersects:(e,t,n,o=2)=>{const[[r,i],[s,a]]=e.geometry.points,c=Math.abs((a-i)*t-(s-r)*n+s*i-a*r),l=Ia([r,i],[s,a]);return c/l<=o}};Xt(Qe.LINE,Ba);const ja={area:e=>{const{polygons:t}=e.geometry;return t.reduce((n,o)=>{const[r,...i]=o.rings,s=In(r.points),a=i.reduce((c,l)=>c+In(l.points),0);return n+s-a},0)},intersects:(e,t,n)=>{const{polygons:o}=e.geometry;for(const r of o){const[i,...s]=r.rings;if(Dn(i.points,t,n)){let a=!1;for(const c of s)if(Dn(c.points,t,n)){a=!0;break}if(!a)return!0}}return!1}},uo=e=>{const t=e.reduce((n,o)=>[...n,...o.rings[0].points],[]);return ut(t)},St=e=>e.rings.map(t=>Na(t.points)).join(" "),Ha=e=>e.polygons.reduce((t,n)=>[...t,...n.rings.reduce((o,r)=>[...o,...r.points],[])],[]);Xt(Qe.MULTIPOLYGON,ja);const Ua={area:e=>{const t=e.geometry.points;return In(t)},intersects:(e,t,n)=>{const o=e.geometry.points;return Dn(o,t,n)}};Xt(Qe.POLYGON,Ua);const Va={area:e=>{const t=e.geometry;if(!t.closed||t.points.length<3)return 0;const n=Nr(t.points,t.closed);return In(n)},intersects:(e,t,n,o=2)=>{const r=e.geometry;if(r.closed){const i=Nr(r.points,r.closed);return Dn(i,t,n)}else return Fa(r,[t,n],o)}},Nr=(e,t=!1)=>{const n=[];for(let o=0;o<e.length;o++){const r=e[o],i=e[(o+1)%e.length];if(n.push(r.point),(o<e.length-1||t)&&(r.type==="CURVE"||i.type=="CURVE")){const s=ds(r.point,r.type==="CURVE"&&r.outHandle||r.point,i.type==="CURVE"&&i.inHandle||i.point,i.point,10);n.push(...s.slice(1))}}return n},ds=(e,t,n,o,r=10)=>{const i=[];for(let s=0;s<=r;s++){const a=s/r,c=Math.pow(1-a,3)*e[0]+3*Math.pow(1-a,2)*a*t[0]+3*(1-a)*Math.pow(a,2)*n[0]+Math.pow(a,3)*o[0],l=Math.pow(1-a,3)*e[1]+3*Math.pow(1-a,2)*a*t[1]+3*(1-a)*Math.pow(a,2)*n[1]+Math.pow(a,3)*o[1];i.push([c,l])}return i},Fa=(e,t,n)=>{for(let o=0;o<e.points.length-1;o++){const r=e.points[o],i=e.points[o+1];if(r.type==="CURVE"||i.type==="CURVE"){const s=ds(r.point,r.type==="CURVE"&&r.outHandle||r.point,i.type==="CURVE"&&i.inHandle||i.point,i.point,20);for(let a=0;a<s.length-1;a++)if(Ir(t,s[a],s[a+1])<=n)return!0}else if(Ir(t,r.point,i.point)<=n)return!0}return!1},Ir=(e,t,n)=>{const[o,r]=e,[i,s]=t,[a,c]=n,l=a-i,u=c-s,d=Math.sqrt(l*l+u*u);if(d===0)return Math.sqrt((o-i)*(o-i)+(r-s)*(r-s));const f=((o-i)*l+(r-s)*u)/(d*d);return f<=0?Math.sqrt((o-i)*(o-i)+(r-s)*(r-s)):f>=1?Math.sqrt((o-a)*(o-a)+(r-c)*(r-c)):Math.abs((c-s)*o-(a-i)*r+a*s-c*i)/d};Xt(Qe.POLYLINE,Va);const Xa={area:e=>e.geometry.w*e.geometry.h,intersects:(e,t,n)=>t>=e.geometry.x&&t<=e.geometry.x+e.geometry.w&&n>=e.geometry.y&&n<=e.geometry.y+e.geometry.h};Xt(Qe.RECTANGLE,Xa);const Ka=[];for(let e=0;e<256;++e)Ka.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const qa=[];for(let e=0;e<256;++e)qa.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Ya="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Wa=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=Ya[n[e]&63];return t};Wa();const sr=(e,t=0)=>{const{minX:n,minY:o,maxX:r,maxY:i}=e;return{x:n-t,y:o-t,w:r-n+2*t,h:i-o+2*t}},pt=typeof window>"u"||typeof navigator>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,za=e=>({}),Dr=e=>({grab:e[0]});function Ga(e){let t,n,o,r;const i=e[8].default,s=Sa(i,e,e[7],Dr);return{c(){t=z("g"),s&&s.c(),b(t,"class","a9s-annotation selected")},m(a,c){Q(a,t,c),s&&s.m(t,null),n=!0,o||(r=[oe(t,"pointerup",e[2]),oe(t,"pointermove",e[1])],o=!0)},p(a,[c]){s&&s.p&&(!n||c&128)&&Ra(s,i,a,a[7],n?$a(i,a[7],c,za):Ta(a[7]),Dr)},i(a){n||(re(s,a),n=!0)},o(a){fe(s,a),n=!1},d(a){a&&J(t),s&&s.d(a),o=!1,Ue(r)}}}function Ja(e,t,n){let{$$slots:o={},$$scope:r}=t;const i=ir();let{shape:s}=t,{editor:a}=t,{transform:c}=t,{svgEl:l}=t,u,d,f;const h=x=>v=>{if(u=x,l){const{left:m,top:y}=l.getBoundingClientRect(),S=v.clientX-m,$=v.clientY-y;d=c.elementToImage(S,$)}else{const{offsetX:m,offsetY:y}=v;d=c.elementToImage(m,y)}f=s,v.target.setPointerCapture(v.pointerId),i("grab",v)},g=x=>{if(u){const[v,m]=c.elementToImage(x.offsetX,x.offsetY),y=[v-d[0],m-d[1]];n(3,s=a(f,u,y)),i("change",s)}},p=x=>{x.target.releasePointerCapture(x.pointerId),u=void 0,f=s,i("release",x)};return e.$$set=x=>{"shape"in x&&n(3,s=x.shape),"editor"in x&&n(4,a=x.editor),"transform"in x&&n(5,c=x.transform),"svgEl"in x&&n(6,l=x.svgEl),"$$scope"in x&&n(7,r=x.$$scope)},[h,g,p,s,a,c,l,r,o]}class ar extends Ft{constructor(t){super(),Vt(this,t,Ja,Ga,Ut,{shape:3,editor:4,transform:5,svgEl:6})}}function Za(e){let t,n,o,r,i,s,a,c,l=e[3]&&Br(e);return{c(){t=z("g"),n=z("circle"),l&&l.c(),r=z("circle"),b(n,"class","a9s-handle-buffer svelte-qtyc7s"),b(n,"cx",e[0]),b(n,"cy",e[1]),b(n,"r",o=e[5]+6/e[2]),b(n,"role","button"),b(n,"tabindex","0"),b(r,"class",i=kr(`a9s-handle-dot${e[3]?" selected":""}`)+" svelte-qtyc7s"),b(r,"cx",e[0]),b(r,"cy",e[1]),b(r,"r",e[5]),b(t,"class",s=`a9s-handle ${e[8].class||""}`.trim())},m(u,d){Q(u,t,d),ue(t,n),l&&l.m(t,null),ue(t,r),a||(c=[oe(n,"dblclick",e[12]),oe(n,"pointerenter",e[13]),oe(n,"pointerleave",e[14]),oe(n,"pointerdown",e[15]),oe(n,"pointerdown",e[6]),oe(n,"pointerup",e[16]),oe(n,"pointerup",e[7])],a=!0)},p(u,d){d&1&&b(n,"cx",u[0]),d&2&&b(n,"cy",u[1]),d&36&&o!==(o=u[5]+6/u[2])&&b(n,"r",o),u[3]?l?l.p(u,d):(l=Br(u),l.c(),l.m(t,r)):l&&(l.d(1),l=null),d&8&&i!==(i=kr(`a9s-handle-dot${u[3]?" selected":""}`)+" svelte-qtyc7s")&&b(r,"class",i),d&1&&b(r,"cx",u[0]),d&2&&b(r,"cy",u[1]),d&32&&b(r,"r",u[5]),d&256&&s!==(s=`a9s-handle ${u[8].class||""}`.trim())&&b(t,"class",s)},d(u){u&&J(t),l&&l.d(),a=!1,Ue(c)}}}function Qa(e){let t,n,o,r,i,s,a,c,l;return{c(){t=z("g"),n=z("circle"),r=z("circle"),s=z("circle"),b(n,"cx",e[0]),b(n,"cy",e[1]),b(n,"r",o=e[5]*10),b(n,"class","a9s-touch-halo"),Mr(n,"touched",e[4]),b(r,"cx",e[0]),b(r,"cy",e[1]),b(r,"r",i=e[5]+10/e[2]),b(r,"class","a9s-handle-buffer svelte-qtyc7s"),b(r,"role","button"),b(r,"tabindex","0"),b(s,"class","a9s-handle-dot"),b(s,"cx",e[0]),b(s,"cy",e[1]),b(s,"r",a=e[5]+2/e[2]),b(t,"class","a9s-touch-handle")},m(u,d){Q(u,t,d),ue(t,n),ue(t,r),ue(t,s),c||(l=[oe(r,"dblclick",e[9]),oe(r,"pointerdown",e[10]),oe(r,"pointerdown",e[6]),oe(r,"pointerup",e[11]),oe(r,"pointerup",e[7])],c=!0)},p(u,d){d&1&&b(n,"cx",u[0]),d&2&&b(n,"cy",u[1]),d&32&&o!==(o=u[5]*10)&&b(n,"r",o),d&16&&Mr(n,"touched",u[4]),d&1&&b(r,"cx",u[0]),d&2&&b(r,"cy",u[1]),d&36&&i!==(i=u[5]+10/u[2])&&b(r,"r",i),d&1&&b(s,"cx",u[0]),d&2&&b(s,"cy",u[1]),d&36&&a!==(a=u[5]+2/u[2])&&b(s,"r",a)},d(u){u&&J(t),c=!1,Ue(l)}}}function Br(e){let t,n;return{c(){t=z("circle"),b(t,"class","a9s-handle-selected"),b(t,"cx",e[0]),b(t,"cy",e[1]),b(t,"r",n=e[5]+8/e[2])},m(o,r){Q(o,t,r)},p(o,r){r&1&&b(t,"cx",o[0]),r&2&&b(t,"cy",o[1]),r&36&&n!==(n=o[5]+8/o[2])&&b(t,"r",n)},d(o){o&&J(t)}}}function el(e){let t;function n(r,i){return pt?Qa:Za}let o=n()(e);return{c(){o.c(),t=wn()},m(r,i){o.m(r,i),Q(r,t,i)},p(r,[i]){o.p(r,i)},i:wt,o:wt,d(r){r&&J(t),o.d(r)}}}function tl(e,t,n){let o,{x:r}=t,{y:i}=t,{scale:s}=t,{selected:a=void 0}=t,c=!1;const l=y=>{y.pointerType==="touch"&&n(4,c=!0)},u=()=>n(4,c=!1);function d(y){ye.call(this,e,y)}function f(y){ye.call(this,e,y)}function h(y){ye.call(this,e,y)}function g(y){ye.call(this,e,y)}function p(y){ye.call(this,e,y)}function x(y){ye.call(this,e,y)}function v(y){ye.call(this,e,y)}function m(y){ye.call(this,e,y)}return e.$$set=y=>{n(8,t=Fo(Fo({},t),Lr(y))),"x"in y&&n(0,r=y.x),"y"in y&&n(1,i=y.y),"scale"in y&&n(2,s=y.scale),"selected"in y&&n(3,a=y.selected)},e.$$.update=()=>{e.$$.dirty&4&&n(5,o=4/s)},t=Lr(t),[r,i,s,a,c,o,l,u,t,d,f,h,g,p,x,v,m]}class kt extends Ft{constructor(t){super(),Vt(this,t,tl,el,Ut,{x:0,y:1,scale:2,selected:3})}}function nl(e){let t,n,o,r,i,s,a;return{c(){t=z("g"),n=z("circle"),r=z("circle"),i=z("circle"),b(n,"class","a9s-polygon-midpoint-buffer svelte-12ykj76"),b(n,"cx",e[0]),b(n,"cy",e[1]),b(n,"r",o=1.75*e[2]),b(r,"class","a9s-polygon-midpoint-outer svelte-12ykj76"),b(r,"cx",e[0]),b(r,"cy",e[1]),b(r,"r",e[2]),b(i,"class","a9s-polygon-midpoint-inner svelte-12ykj76"),b(i,"cx",e[0]),b(i,"cy",e[1]),b(i,"r",e[2]),b(t,"class","a9s-polygon-midpoint svelte-12ykj76")},m(c,l){Q(c,t,l),ue(t,n),ue(t,r),ue(t,i),s||(a=[oe(n,"pointerdown",e[5]),oe(n,"pointerdown",e[3])],s=!0)},p(c,l){l&1&&b(n,"cx",c[0]),l&2&&b(n,"cy",c[1]),l&4&&o!==(o=1.75*c[2])&&b(n,"r",o),l&1&&b(r,"cx",c[0]),l&2&&b(r,"cy",c[1]),l&4&&b(r,"r",c[2]),l&1&&b(i,"cx",c[0]),l&2&&b(i,"cy",c[1]),l&4&&b(i,"r",c[2])},d(c){c&&J(t),s=!1,Ue(a)}}}function ol(e){let t;return{c(){t=z("circle"),b(t,"cx",e[0]),b(t,"cy",e[1]),b(t,"r",e[2])},m(n,o){Q(n,t,o)},p(n,o){o&1&&b(t,"cx",n[0]),o&2&&b(t,"cy",n[1]),o&4&&b(t,"r",n[2])},d(n){n&&J(t)}}}function rl(e){let t;function n(r,i){return pt?ol:nl}let o=n()(e);return{c(){o.c(),t=wn()},m(r,i){o.m(r,i),Q(r,t,i)},p(r,[i]){o.p(r,i)},i:wt,o:wt,d(r){r&&J(t),o.d(r)}}}function il(e,t,n){let o,{x:r}=t,{y:i}=t,{scale:s}=t;const a=l=>{l.pointerType};function c(l){ye.call(this,e,l)}return e.$$set=l=>{"x"in l&&n(0,r=l.x),"y"in l&&n(1,i=l.y),"scale"in l&&n(4,s=l.scale)},e.$$.update=()=>{e.$$.dirty&16&&n(2,o=4/s)},[r,i,o,a,s,c]}class fs extends Ft{constructor(t){super(),Vt(this,t,il,rl,Ut,{x:0,y:1,scale:4})}}function fo(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function jr(e,t,n){const o=e.slice();return o[28]=t[n],o[30]=n,o}function po(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function ho(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function Hr(e){let t,n,o,r;return{c(){t=z("circle"),b(t,"cx",n=e[28][0]),b(t,"cy",o=e[28][1]),b(t,"r",r=fn/e[3]),b(t,"class","svelte-1h2slbm")},m(i,s){Q(i,t,s)},p(i,s){s[0]&1088&&n!==(n=i[28][0])&&b(t,"cx",n),s[0]&1088&&o!==(o=i[28][1])&&b(t,"cy",o),s[0]&8&&r!==(r=fn/i[3])&&b(t,"r",r)},d(i){i&&J(t)}}}function Ur(e){let t,n,o,r,i,s,a,c,l,u;return{c(){t=z("mask"),n=z("rect"),a=z("circle"),b(n,"x",o=e[9].x),b(n,"y",r=e[9].y),b(n,"width",i=e[9].w),b(n,"height",s=e[9].h),b(n,"class","svelte-1h2slbm"),b(a,"cx",c=e[28][0]),b(a,"cy",l=e[28][1]),b(a,"r",u=fn/e[3]),b(a,"class","svelte-1h2slbm"),b(t,"id",`${e[19]}-inner`),b(t,"class","a9s-polygon-editor-mask svelte-1h2slbm")},m(d,f){Q(d,t,f),ue(t,n),ue(t,a)},p(d,f){f[0]&512&&o!==(o=d[9].x)&&b(n,"x",o),f[0]&512&&r!==(r=d[9].y)&&b(n,"y",r),f[0]&512&&i!==(i=d[9].w)&&b(n,"width",i),f[0]&512&&s!==(s=d[9].h)&&b(n,"height",s),f[0]&1088&&c!==(c=d[28][0])&&b(a,"cx",c),f[0]&1088&&l!==(l=d[28][1])&&b(a,"cy",l),f[0]&8&&u!==(u=fn/d[3])&&b(a,"r",u)},d(d){d&&J(t)}}}function Vr(e){let t,n;return t=new kt({props:{class:"a9s-corner-handle",x:e[28][0],y:e[28][1],scale:e[3],selected:e[8].includes(e[30])}}),t.$on("pointerenter",e[11]),t.$on("pointerleave",e[12]),t.$on("pointerdown",e[15]),t.$on("pointerdown",function(){ge(e[27](`HANDLE-${e[30]}`))&&e[27](`HANDLE-${e[30]}`).apply(this,arguments)}),t.$on("pointerup",e[16](e[30])),{c(){Ke(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,r){e=o;const i={};r[0]&32&&(i.x=e[28][0]),r[0]&32&&(i.y=e[28][1]),r[0]&8&&(i.scale=e[3]),r[0]&256&&(i.selected=e[8].includes(e[30])),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){Be(t,o)}}}function Fr(e){let t,n;return t=new fs({props:{x:e[28][0],y:e[28][1],scale:e[3]}}),t.$on("pointerdown",function(){ge(e[18](e[6]))&&e[18](e[6]).apply(this,arguments)}),{c(){Ke(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,r){e=o;const i={};r[0]&1088&&(i.x=e[28][0]),r[0]&1088&&(i.y=e[28][1]),r[0]&8&&(i.scale=e[3]),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){Be(t,o)}}}function sl(e){let t,n,o,r,i,s,a,c,l,u,d,f,h,g,p,x,v,m,y,S,$,I=e[6]!==void 0&&!e[7]&&Hr(ho(e)),_=e[6]!==void 0&&!e[7]&&Ur(po(e)),C=mt(e[5].points),N=[];for(let T=0;T<C.length;T+=1)N[T]=Vr(jr(e,C,T));const H=T=>fe(N[T],1,1,()=>{N[T]=null});let j=e[6]!==void 0&&!e[7]&&Fr(fo(e));return{c(){t=z("defs"),n=z("mask"),o=z("rect"),c=z("polygon"),I&&I.c(),_&&_.c(),u=Ce(),d=z("polygon"),h=Ce(),g=z("polygon"),x=Ce();for(let T=0;T<N.length;T+=1)N[T].c();v=Ce(),j&&j.c(),m=wn(),b(o,"x",r=e[9].x),b(o,"y",i=e[9].y),b(o,"width",s=e[9].w),b(o,"height",a=e[9].h),b(o,"class","svelte-1h2slbm"),b(c,"points",l=e[5].points.map(Xr).join(" ")),b(c,"class","svelte-1h2slbm"),b(n,"id",`${e[19]}-outer`),b(n,"class","a9s-polygon-editor-mask svelte-1h2slbm"),b(d,"class","a9s-outer"),b(d,"mask",`url(#${e[19]}-outer)`),b(d,"points",f=e[5].points.map(Kr).join(" ")),b(g,"class","a9s-inner a9s-shape-handle"),b(g,"mask",`url(#${e[19]}-inner)`),b(g,"style",e[1]),b(g,"points",p=e[5].points.map(qr).join(" "))},m(T,R){Q(T,t,R),ue(t,n),ue(n,o),ue(n,c),I&&I.m(n,null),_&&_.m(t,null),Q(T,u,R),Q(T,d,R),Q(T,h,R),Q(T,g,R),Q(T,x,R);for(let E=0;E<N.length;E+=1)N[E]&&N[E].m(T,R);Q(T,v,R),j&&j.m(T,R),Q(T,m,R),y=!0,S||($=[oe(d,"pointerup",e[14]),oe(d,"pointerdown",function(){ge(e[27]("SHAPE"))&&e[27]("SHAPE").apply(this,arguments)}),oe(g,"pointermove",e[13]),oe(g,"pointerup",e[14]),oe(g,"pointerdown",function(){ge(e[27]("SHAPE"))&&e[27]("SHAPE").apply(this,arguments)})],S=!0)},p(T,R){if(e=T,(!y||R[0]&512&&r!==(r=e[9].x))&&b(o,"x",r),(!y||R[0]&512&&i!==(i=e[9].y))&&b(o,"y",i),(!y||R[0]&512&&s!==(s=e[9].w))&&b(o,"width",s),(!y||R[0]&512&&a!==(a=e[9].h))&&b(o,"height",a),(!y||R[0]&32&&l!==(l=e[5].points.map(Xr).join(" ")))&&b(c,"points",l),e[6]!==void 0&&!e[7]?I?I.p(ho(e),R):(I=Hr(ho(e)),I.c(),I.m(n,null)):I&&(I.d(1),I=null),e[6]!==void 0&&!e[7]?_?_.p(po(e),R):(_=Ur(po(e)),_.c(),_.m(t,null)):_&&(_.d(1),_=null),(!y||R[0]&32&&f!==(f=e[5].points.map(Kr).join(" ")))&&b(d,"points",f),(!y||R[0]&2)&&b(g,"style",e[1]),(!y||R[0]&32&&p!==(p=e[5].points.map(qr).join(" ")))&&b(g,"points",p),R[0]&134322472){C=mt(e[5].points);let E;for(E=0;E<C.length;E+=1){const A=jr(e,C,E);N[E]?(N[E].p(A,R),re(N[E],1)):(N[E]=Vr(A),N[E].c(),re(N[E],1),N[E].m(v.parentNode,v))}for(It(),E=C.length;E<N.length;E+=1)H(E);Dt()}e[6]!==void 0&&!e[7]?j?(j.p(fo(e),R),R[0]&192&&re(j,1)):(j=Fr(fo(e)),j.c(),re(j,1),j.m(m.parentNode,m)):j&&(It(),fe(j,1,1,()=>{j=null}),Dt())},i(T){if(!y){for(let R=0;R<C.length;R+=1)re(N[R]);re(j),y=!0}},o(T){N=N.filter(Boolean);for(let R=0;R<N.length;R+=1)fe(N[R]);fe(j),y=!1},d(T){T&&(J(t),J(u),J(d),J(h),J(g),J(x),J(v),J(m)),I&&I.d(),_&&_.d(),Jn(N,T),j&&j.d(T),S=!1,Ue($)}}}function al(e){let t,n;return t=new ar({props:{shape:e[0],transform:e[2],editor:e[17],svgEl:e[4],$$slots:{default:[sl,({grab:o})=>({27:o}),({grab:o})=>[o?134217728:0]]},$$scope:{ctx:e}}}),t.$on("change",e[20]),t.$on("grab",e[21]),t.$on("release",e[22]),{c(){Ke(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,r){const i={};r[0]&1&&(i.shape=o[0]),r[0]&4&&(i.transform=o[2]),r[0]&16&&(i.svgEl=o[4]),r[0]&134219754|r[1]&1&&(i.$$scope={dirty:r,ctx:o}),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){Be(t,o)}}}const ll=250,cl=1e3,ul=12,fn=4.5,Xr=e=>e.join(","),Kr=e=>e.join(","),qr=e=>e.join(",");function dl(e,t,n){let o,r,i;const s=ir();let{shape:a}=t,{computedStyle:c}=t,{transform:l}=t,{viewportScale:u=1}=t,{svgEl:d}=t,f,h=!1,g,p=[];const x=()=>n(7,h=!0),v=()=>n(7,h=!1),m=E=>{if(p.length>0||!r.some(L=>L.visible)){n(6,f=void 0);return}const[A,M]=l.elementToImage(E.offsetX,E.offsetY),k=L=>Math.pow(L[0]-A,2)+Math.pow(L[1]-M,2),O=o.points.reduce((L,B)=>k(B)<k(L)?B:L),U=r.filter(L=>L.visible).reduce((L,B)=>k(B.point)<k(L.point)?B:L),w=Math.pow(cl/u,2);k(O)<w||k(U.point)<w?n(6,f=r.indexOf(U)):n(6,f=void 0)},y=()=>{document.activeElement!==d&&d.focus()},S=()=>{n(8,p=[]),y()},$=E=>{n(7,h=!0),E.preventDefault(),E.stopPropagation(),g=performance.now()},I=E=>A=>{if(!g||pt||performance.now()-g>ll)return;const M=p.includes(E);A.metaKey||A.ctrlKey||A.shiftKey?M?n(8,p=p.filter(k=>k!==E)):n(8,p=[...p,E]):M&&p.length>1?n(8,p=[E]):M?n(8,p=[]):n(8,p=[E]),y()},_=(E,A,M)=>{y();let k;const O=E.geometry;p.length>1?k=O.points.map(([w,L],B)=>p.includes(B)?[w+M[0],L+M[1]]:[w,L]):A==="SHAPE"?k=O.points.map(([w,L])=>[w+M[0],L+M[1]]):k=O.points.map(([w,L],B)=>A===`HANDLE-${B}`?[w+M[0],L+M[1]]:[w,L]);const U=ut(k);return{...E,geometry:{points:k,bounds:U}}},C=E=>async A=>{A.stopPropagation();const M=[...o.points.slice(0,E+1),r[E].point,...o.points.slice(E+1)],k=ut(M);s("change",{...a,geometry:{points:M,bounds:k}}),await cs();const O=[...document.querySelectorAll(".a9s-handle")][E+1];if(O!=null&&O.firstChild){const U=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:A.clientX,clientY:A.clientY,pointerId:A.pointerId,pointerType:A.pointerType,isPrimary:A.isPrimary,buttons:A.buttons});O.firstChild.dispatchEvent(U)}},N=()=>{if(o.points.length-p.length<3)return;const E=o.points.filter((M,k)=>!p.includes(k)),A=ut(E);s("change",{...a,geometry:{points:E,bounds:A}}),n(8,p=[])};ss(()=>{if(pt)return;const E=A=>{(A.key==="Delete"||A.key==="Backspace")&&(A.preventDefault(),N())};return d.addEventListener("pointermove",m),d.addEventListener("keydown",E),()=>{d.removeEventListener("pointermove",m),d.removeEventListener("keydown",E)}});const H=`polygon-mask-${Math.random().toString(36).substring(2,12)}`;function j(E){ye.call(this,e,E)}function T(E){ye.call(this,e,E)}function R(E){ye.call(this,e,E)}return e.$$set=E=>{"shape"in E&&n(0,a=E.shape),"computedStyle"in E&&n(1,c=E.computedStyle),"transform"in E&&n(2,l=E.transform),"viewportScale"in E&&n(3,u=E.viewportScale),"svgEl"in E&&n(4,d=E.svgEl)},e.$$.update=()=>{e.$$.dirty[0]&1&&n(5,o=a.geometry),e.$$.dirty[0]&40&&n(10,r=pt?[]:o.points.map((E,A)=>{const M=A===o.points.length-1?o.points[0]:o.points[A+1],k=(E[0]+M[0])/2,O=(E[1]+M[1])/2,U=Math.sqrt(Math.pow(M[0]-k,2)+Math.pow(M[1]-O,2))>ul/u;return{point:[k,O],visible:U}})),e.$$.dirty[0]&40&&n(9,i=sr(o.bounds,fn/u))},[a,c,l,u,d,o,f,h,p,i,r,x,v,m,S,$,I,_,C,H,j,T,R]}class fl extends Ft{constructor(t){super(),Vt(this,t,dl,al,Ut,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}function pl(e){let t,n,o,r,i,s,a,c,l,u,d,f,h,g,p,x,v,m,y,S,$,I,_,C,N,H,j,T,R,E,A,M,k,O,U,w,L,B,D,K,F,q,ae,ne,Ve,be,Je,W,ee,G,se,ie,X,Le,Te;return be=new kt({props:{class:"a9s-corner-handle-topleft",x:e[5].x,y:e[5].y,scale:e[3]}}),be.$on("pointerdown",function(){ge(e[12]("TOP_LEFT"))&&e[12]("TOP_LEFT").apply(this,arguments)}),W=new kt({props:{class:"a9s-corner-handle-topright",x:e[5].x+e[5].w,y:e[5].y,scale:e[3]}}),W.$on("pointerdown",function(){ge(e[12]("TOP_RIGHT"))&&e[12]("TOP_RIGHT").apply(this,arguments)}),G=new kt({props:{class:"a9s-corner-handle-bottomright",x:e[5].x+e[5].w,y:e[5].y+e[5].h,scale:e[3]}}),G.$on("pointerdown",function(){ge(e[12]("BOTTOM_RIGHT"))&&e[12]("BOTTOM_RIGHT").apply(this,arguments)}),ie=new kt({props:{class:"a9s-corner-handle-bottomleft",x:e[5].x,y:e[5].y+e[5].h,scale:e[3]}}),ie.$on("pointerdown",function(){ge(e[12]("BOTTOM_LEFT"))&&e[12]("BOTTOM_LEFT").apply(this,arguments)}),{c(){t=z("defs"),n=z("mask"),o=z("rect"),c=z("rect"),h=Ce(),g=z("rect"),y=Ce(),S=z("rect"),N=Ce(),H=z("rect"),E=Ce(),A=z("rect"),U=Ce(),w=z("rect"),K=Ce(),F=z("rect"),Ve=Ce(),Ke(be.$$.fragment),Je=Ce(),Ke(W.$$.fragment),ee=Ce(),Ke(G.$$.fragment),se=Ce(),Ke(ie.$$.fragment),b(o,"class","rect-mask-bg svelte-1njczvj"),b(o,"x",r=e[6].x),b(o,"y",i=e[6].y),b(o,"width",s=e[6].w),b(o,"height",a=e[6].h),b(c,"class","rect-mask-fg svelte-1njczvj"),b(c,"x",l=e[5].x),b(c,"y",u=e[5].y),b(c,"width",d=e[5].w),b(c,"height",f=e[5].h),b(n,"id",e[8]),b(n,"class","a9s-rectangle-editor-mask svelte-1njczvj"),b(g,"class","a9s-outer"),b(g,"mask",`url(#${e[8]})`),b(g,"x",p=e[5].x),b(g,"y",x=e[5].y),b(g,"width",v=e[5].w),b(g,"height",m=e[5].h),b(S,"class","a9s-inner a9s-shape-handle"),b(S,"style",e[1]),b(S,"x",$=e[5].x),b(S,"y",I=e[5].y),b(S,"width",_=e[5].w),b(S,"height",C=e[5].h),b(H,"class","a9s-edge-handle a9s-edge-handle-top"),b(H,"x",j=e[5].x),b(H,"y",T=e[5].y),b(H,"height",1),b(H,"width",R=e[5].w),b(A,"class","a9s-edge-handle a9s-edge-handle-right"),b(A,"x",M=e[5].x+e[5].w),b(A,"y",k=e[5].y),b(A,"height",O=e[5].h),b(A,"width",1),b(w,"class","a9s-edge-handle a9s-edge-handle-bottom"),b(w,"x",L=e[5].x),b(w,"y",B=e[5].y+e[5].h),b(w,"height",1),b(w,"width",D=e[5].w),b(F,"class","a9s-edge-handle a9s-edge-handle-left"),b(F,"x",q=e[5].x),b(F,"y",ae=e[5].y),b(F,"height",ne=e[5].h),b(F,"width",1)},m(Y,V){Q(Y,t,V),ue(t,n),ue(n,o),ue(n,c),Q(Y,h,V),Q(Y,g,V),Q(Y,y,V),Q(Y,S,V),Q(Y,N,V),Q(Y,H,V),Q(Y,E,V),Q(Y,A,V),Q(Y,U,V),Q(Y,w,V),Q(Y,K,V),Q(Y,F,V),Q(Y,Ve,V),De(be,Y,V),Q(Y,Je,V),De(W,Y,V),Q(Y,ee,V),De(G,Y,V),Q(Y,se,V),De(ie,Y,V),X=!0,Le||(Te=[oe(g,"pointerdown",function(){ge(e[12]("SHAPE"))&&e[12]("SHAPE").apply(this,arguments)}),oe(S,"pointerdown",function(){ge(e[12]("SHAPE"))&&e[12]("SHAPE").apply(this,arguments)}),oe(H,"pointerdown",function(){ge(e[12]("TOP"))&&e[12]("TOP").apply(this,arguments)}),oe(A,"pointerdown",function(){ge(e[12]("RIGHT"))&&e[12]("RIGHT").apply(this,arguments)}),oe(w,"pointerdown",function(){ge(e[12]("BOTTOM"))&&e[12]("BOTTOM").apply(this,arguments)}),oe(F,"pointerdown",function(){ge(e[12]("LEFT"))&&e[12]("LEFT").apply(this,arguments)})],Le=!0)},p(Y,V){e=Y,(!X||V&64&&r!==(r=e[6].x))&&b(o,"x",r),(!X||V&64&&i!==(i=e[6].y))&&b(o,"y",i),(!X||V&64&&s!==(s=e[6].w))&&b(o,"width",s),(!X||V&64&&a!==(a=e[6].h))&&b(o,"height",a),(!X||V&32&&l!==(l=e[5].x))&&b(c,"x",l),(!X||V&32&&u!==(u=e[5].y))&&b(c,"y",u),(!X||V&32&&d!==(d=e[5].w))&&b(c,"width",d),(!X||V&32&&f!==(f=e[5].h))&&b(c,"height",f),(!X||V&32&&p!==(p=e[5].x))&&b(g,"x",p),(!X||V&32&&x!==(x=e[5].y))&&b(g,"y",x),(!X||V&32&&v!==(v=e[5].w))&&b(g,"width",v),(!X||V&32&&m!==(m=e[5].h))&&b(g,"height",m),(!X||V&2)&&b(S,"style",e[1]),(!X||V&32&&$!==($=e[5].x))&&b(S,"x",$),(!X||V&32&&I!==(I=e[5].y))&&b(S,"y",I),(!X||V&32&&_!==(_=e[5].w))&&b(S,"width",_),(!X||V&32&&C!==(C=e[5].h))&&b(S,"height",C),(!X||V&32&&j!==(j=e[5].x))&&b(H,"x",j),(!X||V&32&&T!==(T=e[5].y))&&b(H,"y",T),(!X||V&32&&R!==(R=e[5].w))&&b(H,"width",R),(!X||V&32&&M!==(M=e[5].x+e[5].w))&&b(A,"x",M),(!X||V&32&&k!==(k=e[5].y))&&b(A,"y",k),(!X||V&32&&O!==(O=e[5].h))&&b(A,"height",O),(!X||V&32&&L!==(L=e[5].x))&&b(w,"x",L),(!X||V&32&&B!==(B=e[5].y+e[5].h))&&b(w,"y",B),(!X||V&32&&D!==(D=e[5].w))&&b(w,"width",D),(!X||V&32&&q!==(q=e[5].x))&&b(F,"x",q),(!X||V&32&&ae!==(ae=e[5].y))&&b(F,"y",ae),(!X||V&32&&ne!==(ne=e[5].h))&&b(F,"height",ne);const ke={};V&32&&(ke.x=e[5].x),V&32&&(ke.y=e[5].y),V&8&&(ke.scale=e[3]),be.$set(ke);const Oe={};V&32&&(Oe.x=e[5].x+e[5].w),V&32&&(Oe.y=e[5].y),V&8&&(Oe.scale=e[3]),W.$set(Oe);const Me={};V&32&&(Me.x=e[5].x+e[5].w),V&32&&(Me.y=e[5].y+e[5].h),V&8&&(Me.scale=e[3]),G.$set(Me);const vt={};V&32&&(vt.x=e[5].x),V&32&&(vt.y=e[5].y+e[5].h),V&8&&(vt.scale=e[3]),ie.$set(vt)},i(Y){X||(re(be.$$.fragment,Y),re(W.$$.fragment,Y),re(G.$$.fragment,Y),re(ie.$$.fragment,Y),X=!0)},o(Y){fe(be.$$.fragment,Y),fe(W.$$.fragment,Y),fe(G.$$.fragment,Y),fe(ie.$$.fragment,Y),X=!1},d(Y){Y&&(J(t),J(h),J(g),J(y),J(S),J(N),J(H),J(E),J(A),J(U),J(w),J(K),J(F),J(Ve),J(Je),J(ee),J(se)),Be(be,Y),Be(W,Y),Be(G,Y),Be(ie,Y),Le=!1,Ue(Te)}}}function hl(e){let t,n;return t=new ar({props:{shape:e[0],transform:e[2],editor:e[7],svgEl:e[4],$$slots:{default:[pl,({grab:o})=>({12:o}),({grab:o})=>o?4096:0]},$$scope:{ctx:e}}}),t.$on("grab",e[9]),t.$on("change",e[10]),t.$on("release",e[11]),{c(){Ke(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,[r]){const i={};r&1&&(i.shape=o[0]),r&4&&(i.transform=o[2]),r&16&&(i.svgEl=o[4]),r&12394&&(i.$$scope={dirty:r,ctx:o}),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){Be(t,o)}}}function ml(e,t,n){let o,r,{shape:i}=t,{computedStyle:s}=t,{transform:a}=t,{viewportScale:c=1}=t,{svgEl:l}=t;const u=(p,x,v)=>{const m=p.geometry.bounds;let[y,S]=[m.minX,m.minY],[$,I]=[m.maxX,m.maxY];const[_,C]=v;if(x==="SHAPE")y+=_,$+=_,S+=C,I+=C;else{switch(x){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{S+=C;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{I+=C;break}}switch(x){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{y+=_;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{$+=_;break}}}const N=Math.min(y,$),H=Math.min(S,I),j=Math.abs($-y),T=Math.abs(I-S);return{...p,geometry:{x:N,y:H,w:j,h:T,bounds:{minX:N,minY:H,maxX:N+j,maxY:H+T}}}},d=`rect-mask-${Math.random().toString(36).substring(2,12)}`;function f(p){ye.call(this,e,p)}function h(p){ye.call(this,e,p)}function g(p){ye.call(this,e,p)}return e.$$set=p=>{"shape"in p&&n(0,i=p.shape),"computedStyle"in p&&n(1,s=p.computedStyle),"transform"in p&&n(2,a=p.transform),"viewportScale"in p&&n(3,c=p.viewportScale),"svgEl"in p&&n(4,l=p.svgEl)},e.$$.update=()=>{e.$$.dirty&1&&n(5,o=i.geometry),e.$$.dirty&40&&n(6,r=sr(o.bounds,2/c))},[i,s,a,c,l,o,r,u,d,f,h,g]}class gl extends Ft{constructor(t){super(),Vt(this,t,ml,hl,Ut,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4})}}var Yr=Object.prototype.hasOwnProperty;function qo(e,t){var n,o;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((o=e.length)===t.length)for(;o--&&qo(e[o],t[o]););return o===-1}if(!n||typeof e=="object"){o=0;for(n in e)if(Yr.call(e,n)&&++o&&!Yr.call(t,n)||!(n in t)||!qo(e[n],t[n]))return!1;return Object.keys(t).length===o}}return e!==e&&t!==t}const yl=12,vl=(e,t)=>e.polygons.reduce((n,o,r)=>{const i=o.rings.reduce((s,a,c)=>{const l=a.points.map((u,d)=>{const f=d===a.points.length-1?a.points[0]:a.points[d+1],h=(u[0]+f[0])/2,g=(u[1]+f[1])/2,p=Math.sqrt(Math.pow(f[0]-h,2)+Math.pow(f[1]-g,2))>yl/t;return{point:[h,g],visible:p,elementIdx:r,ringIdx:c,pointIdx:d}});return[...s,...l]},[]);return[...n,...i]},[]);function mo(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function Wr(e,t,n){const o=e.slice();return o[30]=t[n],o[32]=n,o}function zr(e,t,n){const o=e.slice();return o[33]=t[n],o[35]=n,o}function Gr(e,t,n){const o=e.slice();return o[29]=t[n],o[37]=n,o}function go(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function yo(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function Jr(e){let t,n,o,r;return{c(){t=z("circle"),b(t,"cx",n=e[29][0]),b(t,"cy",o=e[29][1]),b(t,"r",r=pn/e[3]),b(t,"class","svelte-1vxo6dc")},m(i,s){Q(i,t,s)},p(i,s){s[0]&1088&&n!==(n=i[29][0])&&b(t,"cx",n),s[0]&1088&&o!==(o=i[29][1])&&b(t,"cy",o),s[0]&8&&r!==(r=pn/i[3])&&b(t,"r",r)},d(i){i&&J(t)}}}function Zr(e){let t,n,o,r,i,s,a,c,l,u;return{c(){t=z("mask"),n=z("rect"),a=z("circle"),b(n,"x",o=e[9].x),b(n,"y",r=e[9].y),b(n,"width",i=e[9].w),b(n,"height",s=e[9].h),b(n,"class","svelte-1vxo6dc"),b(a,"cx",c=e[29][0]),b(a,"cy",l=e[29][1]),b(a,"r",u=pn/e[3]),b(a,"class","svelte-1vxo6dc"),b(t,"id",`${e[18]}-${e[32]}-inner`),b(t,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc")},m(d,f){Q(d,t,f),ue(t,n),ue(t,a)},p(d,f){f[0]&512&&o!==(o=d[9].x)&&b(n,"x",o),f[0]&512&&r!==(r=d[9].y)&&b(n,"y",r),f[0]&512&&i!==(i=d[9].w)&&b(n,"width",i),f[0]&512&&s!==(s=d[9].h)&&b(n,"height",s),f[0]&1088&&c!==(c=d[29][0])&&b(a,"cx",c),f[0]&1088&&l!==(l=d[29][1])&&b(a,"cy",l),f[0]&8&&u!==(u=pn/d[3])&&b(a,"r",u)},d(d){d&&J(t)}}}function Qr(e){let t,n;function o(...r){return e[19](e[32],e[35],e[37],...r)}return t=new kt({props:{class:"a9s-corner-handle",x:e[29][0],y:e[29][1],scale:e[3],selected:e[8].some(o)}}),t.$on("pointerenter",e[11]),t.$on("pointerleave",e[12]),t.$on("pointerdown",e[14]),t.$on("pointerdown",function(){ge(e[28](`HANDLE-${e[32]}-${e[35]}-${e[37]}`))&&e[28](`HANDLE-${e[32]}-${e[35]}-${e[37]}`).apply(this,arguments)}),t.$on("pointerup",e[15](e[32],e[35],e[37])),{c(){Ke(t.$$.fragment)},m(r,i){De(t,r,i),n=!0},p(r,i){e=r;const s={};i[0]&32&&(s.x=e[29][0]),i[0]&32&&(s.y=e[29][1]),i[0]&8&&(s.scale=e[3]),i[0]&256&&(s.selected=e[8].some(o)),t.$set(s)},i(r){n||(re(t.$$.fragment,r),n=!0)},o(r){fe(t.$$.fragment,r),n=!1},d(r){Be(t,r)}}}function ei(e){let t,n,o=mt(e[33].points),r=[];for(let s=0;s<o.length;s+=1)r[s]=Qr(Gr(e,o,s));const i=s=>fe(r[s],1,1,()=>{r[s]=null});return{c(){for(let s=0;s<r.length;s+=1)r[s].c();t=wn()},m(s,a){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(s,a);Q(s,t,a),n=!0},p(s,a){if(a[0]&268491048){o=mt(s[33].points);let c;for(c=0;c<o.length;c+=1){const l=Gr(s,o,c);r[c]?(r[c].p(l,a),re(r[c],1)):(r[c]=Qr(l),r[c].c(),re(r[c],1),r[c].m(t.parentNode,t))}for(It(),c=o.length;c<r.length;c+=1)i(c);Dt()}},i(s){if(!n){for(let a=0;a<o.length;a+=1)re(r[a]);n=!0}},o(s){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)fe(r[a]);n=!1},d(s){s&&J(t),Jn(r,s)}}}function ti(e){let t,n,o,r,i,s,a,c,l,u,d,f,h,g,p,x,v,m=e[6]!==void 0&&!e[7]&&Jr(yo(e)),y=e[6]!==void 0&&!e[7]&&Zr(go(e)),S=mt(e[30].rings),$=[];for(let _=0;_<S.length;_+=1)$[_]=ei(zr(e,S,_));const I=_=>fe($[_],1,1,()=>{$[_]=null});return{c(){t=z("g"),n=z("defs"),o=z("mask"),r=z("rect"),l=z("path"),m&&m.c(),y&&y.c(),d=z("path"),h=z("path");for(let _=0;_<$.length;_+=1)$[_].c();b(r,"x",i=e[9].x),b(r,"y",s=e[9].y),b(r,"width",a=e[9].w),b(r,"height",c=e[9].h),b(r,"class","svelte-1vxo6dc"),b(l,"d",u=St(e[30])),b(l,"class","svelte-1vxo6dc"),b(o,"id",`${e[18]}-${e[32]}-outer`),b(o,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc"),b(d,"class","a9s-outer"),b(d,"mask",`url(#${e[18]}-${e[32]}-outer)`),b(d,"fill-rule","evenodd"),b(d,"d",f=St(e[30])),b(h,"class","a9s-inner"),b(h,"mask",`url(#${e[18]}-${e[32]}-inner)`),b(h,"style",e[1]),b(h,"fill-rule","evenodd"),b(h,"d",g=St(e[30]))},m(_,C){Q(_,t,C),ue(t,n),ue(n,o),ue(o,r),ue(o,l),m&&m.m(o,null),y&&y.m(n,null),ue(t,d),ue(t,h);for(let N=0;N<$.length;N+=1)$[N]&&$[N].m(t,null);p=!0,x||(v=[oe(d,"pointerup",e[13]),oe(d,"pointerdown",function(){ge(e[28]("SHAPE"))&&e[28]("SHAPE").apply(this,arguments)}),oe(h,"pointerup",e[13]),oe(h,"pointerdown",function(){ge(e[28]("SHAPE"))&&e[28]("SHAPE").apply(this,arguments)})],x=!0)},p(_,C){if(e=_,(!p||C[0]&512&&i!==(i=e[9].x))&&b(r,"x",i),(!p||C[0]&512&&s!==(s=e[9].y))&&b(r,"y",s),(!p||C[0]&512&&a!==(a=e[9].w))&&b(r,"width",a),(!p||C[0]&512&&c!==(c=e[9].h))&&b(r,"height",c),(!p||C[0]&32&&u!==(u=St(e[30])))&&b(l,"d",u),e[6]!==void 0&&!e[7]?m?m.p(yo(e),C):(m=Jr(yo(e)),m.c(),m.m(o,null)):m&&(m.d(1),m=null),e[6]!==void 0&&!e[7]?y?y.p(go(e),C):(y=Zr(go(e)),y.c(),y.m(n,null)):y&&(y.d(1),y=null),(!p||C[0]&32&&f!==(f=St(e[30])))&&b(d,"d",f),(!p||C[0]&2)&&b(h,"style",e[1]),(!p||C[0]&32&&g!==(g=St(e[30])))&&b(h,"d",g),C[0]&268491048){S=mt(e[30].rings);let N;for(N=0;N<S.length;N+=1){const H=zr(e,S,N);$[N]?($[N].p(H,C),re($[N],1)):($[N]=ei(H),$[N].c(),re($[N],1),$[N].m(t,null))}for(It(),N=S.length;N<$.length;N+=1)I(N);Dt()}},i(_){if(!p){for(let C=0;C<S.length;C+=1)re($[C]);p=!0}},o(_){$=$.filter(Boolean);for(let C=0;C<$.length;C+=1)fe($[C]);p=!1},d(_){_&&J(t),m&&m.d(),y&&y.d(),Jn($,_),x=!1,Ue(v)}}}function ni(e){let t,n;return t=new fs({props:{x:e[29][0],y:e[29][1],scale:e[3]}}),t.$on("pointerdown",function(){ge(e[17](e[6]))&&e[17](e[6]).apply(this,arguments)}),{c(){Ke(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,r){e=o;const i={};r[0]&1088&&(i.x=e[29][0]),r[0]&1088&&(i.y=e[29][1]),r[0]&8&&(i.scale=e[3]),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){Be(t,o)}}}function bl(e){let t,n,o,r=mt(e[5].polygons),i=[];for(let c=0;c<r.length;c+=1)i[c]=ti(Wr(e,r,c));const s=c=>fe(i[c],1,1,()=>{i[c]=null});let a=e[6]!==void 0&&!e[7]&&ni(mo(e));return{c(){for(let c=0;c<i.length;c+=1)i[c].c();t=Ce(),a&&a.c(),n=wn()},m(c,l){for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(c,l);Q(c,t,l),a&&a.m(c,l),Q(c,n,l),o=!0},p(c,l){if(l[0]&268763114){r=mt(c[5].polygons);let u;for(u=0;u<r.length;u+=1){const d=Wr(c,r,u);i[u]?(i[u].p(d,l),re(i[u],1)):(i[u]=ti(d),i[u].c(),re(i[u],1),i[u].m(t.parentNode,t))}for(It(),u=r.length;u<i.length;u+=1)s(u);Dt()}c[6]!==void 0&&!c[7]?a?(a.p(mo(c),l),l[0]&192&&re(a,1)):(a=ni(mo(c)),a.c(),re(a,1),a.m(n.parentNode,n)):a&&(It(),fe(a,1,1,()=>{a=null}),Dt())},i(c){if(!o){for(let l=0;l<r.length;l+=1)re(i[l]);re(a),o=!0}},o(c){i=i.filter(Boolean);for(let l=0;l<i.length;l+=1)fe(i[l]);fe(a),o=!1},d(c){c&&(J(t),J(n)),Jn(i,c),a&&a.d(c)}}}function wl(e){let t,n;return t=new ar({props:{shape:e[0],transform:e[2],editor:e[16],svgEl:e[4],$$slots:{default:[bl,({grab:o})=>({28:o}),({grab:o})=>[o?268435456:0]]},$$scope:{ctx:e}}}),t.$on("change",e[20]),t.$on("grab",e[21]),t.$on("release",e[22]),{c(){Ke(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,r){const i={};r[0]&1&&(i.shape=o[0]),r[0]&4&&(i.transform=o[2]),r[0]&16&&(i.svgEl=o[4]),r[0]&268437482|r[1]&128&&(i.$$scope={dirty:r,ctx:o}),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){fe(t.$$.fragment,o),n=!1},d(o){Be(t,o)}}}const xl=250,El=1e3,pn=4.5;function Al(e,t,n){let o,r,i;const s=ir();let{shape:a}=t,{computedStyle:c}=t,{transform:l}=t,{viewportScale:u=1}=t,{svgEl:d}=t,f,h=!1,g,p=[];const x=()=>n(7,h=!0),v=()=>n(7,h=!1),m=A=>{if(p.length>0||!r.some(B=>B.visible)){n(6,f=void 0);return}const[M,k]=l.elementToImage(A.offsetX,A.offsetY),O=B=>Math.pow(B[0]-M,2)+Math.pow(B[1]-k,2),U=Ha(o).reduce((B,D)=>O(D)<O(B)?D:B),w=r.filter(B=>B.visible).reduce((B,D)=>O(D.point)<O(B.point)?D:B),L=Math.pow(El/u,2);O(U)<L||O(w.point)<L?n(6,f=r.indexOf(w)):n(6,f=void 0)},y=()=>{document.activeElement!==d&&d.focus()},S=()=>{n(8,p=[]),y()},$=A=>{n(7,h=!0),A.preventDefault(),A.stopPropagation(),g=performance.now()},I=(A,M,k)=>O=>{if(!g||pt||performance.now()-g>xl)return;const U=L=>L.polygon===A&&L.ring===M&&L.point===k,w=p.some(U);O.metaKey||O.ctrlKey||O.shiftKey?w?n(8,p=p.filter(L=>!U(L))):n(8,p=[...p,{polygon:A,ring:M,point:k}]):w&&p.length>1?n(8,p=[{polygon:A,ring:M,point:k}]):w?n(8,p=[]):n(8,p=[{polygon:A,ring:M,point:k}]),y()},_=(A,M,k)=>{y();const O=A.geometry.polygons;let U;if(M==="SHAPE")U=O.map(w=>{const L=w.rings.map((D,K)=>({points:D.points.map((F,q)=>[F[0]+k[0],F[1]+k[1]])})),B=ut(L[0].points);return{rings:L,bounds:B}});else{const[w,L,B,D]=M.split("-").map(K=>parseInt(K));U=O.map((K,F)=>{if(F===L){const q=K.rings.map((ne,Ve)=>Ve===B?{points:ne.points.map((be,Je)=>Je===D?[be[0]+k[0],be[1]+k[1]]:be)}:ne),ae=ut(q[0].points);return{rings:q,bounds:ae}}else return K})}return{...A,geometry:{polygons:U,bounds:uo(U)}}},C=A=>async M=>{M.stopPropagation();const k=r[A],O=o.polygons.map((w,L)=>{if(L===k.elementIdx){const B=w.rings.map((K,F)=>F===k.ringIdx?{points:[...K.points.slice(0,k.pointIdx+1),k.point,...K.points.slice(k.pointIdx+1)]}:K),D=ut(B[0].points);return{rings:B,bounds:D}}else return w});s("change",{...a,geometry:{polygons:O,bounds:uo(O)}}),await cs();const U=[...document.querySelectorAll(".a9s-handle")][A+1];if(U!=null&&U.firstChild){const w=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:M.clientX,clientY:M.clientY,pointerId:M.pointerId,pointerType:M.pointerType,isPrimary:M.isPrimary,buttons:M.buttons});U.firstChild.dispatchEvent(w)}},N=()=>{const A=o.polygons.map((M,k)=>{if(p.some(O=>O.polygon===k)){const O=M.rings.map((w,L)=>{const B=p.filter(D=>D.polygon===k&&D.ring===L);return B.length&&w.points.length-B.length>=3?{points:w.points.filter((D,K)=>!B.some(F=>F.point===K))}:w}),U=ut(O[0].points);return{rings:O,bounds:U}}else return M});!qo(o.polygons,A)&&(s("change",{...a,geometry:{polygons:A,bounds:uo(A)}}),n(8,p=[]))};ss(()=>{if(pt)return;const A=M=>{(M.key==="Delete"||M.key==="Backspace")&&(M.preventDefault(),N())};return d.addEventListener("pointermove",m),d.addEventListener("keydown",A),()=>{d.removeEventListener("pointermove",m),d.removeEventListener("keydown",A)}});const H=`polygon-mask-${Math.random().toString(36).substring(2,12)}`,j=(A,M,k,{polygon:O,ring:U,point:w})=>O===A&&U===M&&w===k;function T(A){ye.call(this,e,A)}function R(A){ye.call(this,e,A)}function E(A){ye.call(this,e,A)}return e.$$set=A=>{"shape"in A&&n(0,a=A.shape),"computedStyle"in A&&n(1,c=A.computedStyle),"transform"in A&&n(2,l=A.transform),"viewportScale"in A&&n(3,u=A.viewportScale),"svgEl"in A&&n(4,d=A.svgEl)},e.$$.update=()=>{e.$$.dirty[0]&1&&n(5,o=a.geometry),e.$$.dirty[0]&40&&n(10,r=pt?[]:vl(o,u)),e.$$.dirty[0]&40&&n(9,i=sr(o.bounds,pn/u))},[a,c,l,u,d,o,f,h,p,i,r,x,v,S,$,I,_,C,H,j,T,R,E]}class Sl extends Ft{constructor(t){super(),Vt(this,t,Al,wl,Ut,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}Qe.RECTANGLE,Qe.POLYGON,Qe.MULTIPOLYGON;typeof navigator>"u"||navigator.userAgent.indexOf("Mac OS X");var oi=Object.prototype.hasOwnProperty;function xt(e,t){var n,o;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((o=e.length)===t.length)for(;o--&&xt(e[o],t[o]););return o===-1}if(!n||typeof e=="object"){o=0;for(n in e)if(oi.call(e,n)&&++o&&!oi.call(t,n)||!(n in t)||!xt(e[n],t[n]))return!1;return Object.keys(t).length===o}}return e!==e&&t!==t}function vo(){}function $l(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}const $t=[];function lr(e,t=vo){let n;const o=new Set;function r(a){if($l(e,a)&&(e=a,n)){const c=!$t.length;for(const l of o)l[1](),$t.push(l,e);if(c){for(let l=0;l<$t.length;l+=2)$t[l][0]($t[l+1]);$t.length=0}}}function i(a){r(a(e))}function s(a,c=vo){const l=[a,c];return o.add(l),o.size===1&&(n=t(r,i)||vo),a(e),()=>{o.delete(l),o.size===0&&n&&(n(),n=null)}}return{set:r,update:i,subscribe:s}}const Rl=e=>{const{subscribe:t,set:n}=lr();let o;return t(r=>o=r),e.observe(({changes:r})=>{if(o){(r.deleted||[]).some(s=>s.id===o)&&n(void 0);const i=(r.updated||[]).find(({oldValue:s})=>s.id===o);i&&n(i.newValue.id)}}),{get current(){return o},subscribe:t,set:n}},An={selected:[]},Tl=(e,t,n)=>{const{subscribe:o,set:r}=lr(An);let i=t,s=An;o(p=>s=p);const a=()=>{xt(s,An)||r(An)},c=()=>{var p;return((p=s.selected)==null?void 0:p.length)===0},l=p=>{if(c())return!1;const x=typeof p=="string"?p:p.id;return s.selected.some(v=>v.id===x)},u=(p,x)=>{let v;if(Array.isArray(p)){if(v=p.map(y=>e.getAnnotation(y)).filter(Boolean),v.length<p.length){console.warn("Invalid selection: "+p.filter(y=>!v.some(S=>S.id===y)));return}}else{const y=e.getAnnotation(p);if(!y){console.warn("Invalid selection: "+p);return}v=[y]}const m=v.reduce((y,S)=>{const $=g(S);return $==="EDIT"?[...y,{id:S.id,editable:!0}]:$==="SELECT"?[...y,{id:S.id}]:y},[]);r({selected:m,event:x})},d=(p,x)=>{const v=Array.isArray(p)?p:[p],m=v.map(y=>e.getAnnotation(y)).filter(y=>!!y);r({selected:m.map(y=>{const S=x===void 0?g(y)==="EDIT":x;return{id:y.id,editable:S}})}),m.length!==v.length&&console.warn("Invalid selection",p)},f=p=>{if(c())return!1;const{selected:x}=s;x.some(({id:v})=>p.includes(v))&&r({selected:x.filter(({id:v})=>!p.includes(v))})},h=p=>{i=p,d(s.selected.map(({id:x})=>x))},g=p=>Cl(p,i,n);return e.observe(({changes:p})=>f((p.deleted||[]).map(x=>x.id))),{get event(){return s?s.event:null},get selected(){return s?[...s.selected]:null},get userSelectAction(){return i},clear:a,evalSelectAction:g,isEmpty:c,isSelected:l,setSelected:d,setUserSelectAction:h,subscribe:o,userSelect:u}},Cl=(e,t,n)=>{const o=n?n.serialize(e):e;return typeof t=="function"?t(o):t||"EDIT"},we=[];for(let e=0;e<256;++e)we.push((e+256).toString(16).slice(1));function Ol(e,t=0){return(we[e[t+0]]+we[e[t+1]]+we[e[t+2]]+we[e[t+3]]+"-"+we[e[t+4]]+we[e[t+5]]+"-"+we[e[t+6]]+we[e[t+7]]+"-"+we[e[t+8]]+we[e[t+9]]+"-"+we[e[t+10]]+we[e[t+11]]+we[e[t+12]]+we[e[t+13]]+we[e[t+14]]+we[e[t+15]]).toLowerCase()}let bo;const Ll=new Uint8Array(16);function kl(){if(!bo){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");bo=crypto.getRandomValues.bind(crypto)}return bo(Ll)}const Ml=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ri={randomUUID:Ml};function ps(e,t,n){var o;if(ri.randomUUID&&!e)return ri.randomUUID();e=e||{};const r=e.random??((o=e.rng)==null?void 0:o.call(e))??kl();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Ol(r)}const wo=e=>{const t=n=>{const o={...n};return n.created&&typeof n.created=="string"&&(o.created=new Date(n.created)),n.updated&&typeof n.updated=="string"&&(o.updated=new Date(n.updated)),o};return{...e,bodies:(e.bodies||[]).map(t),target:t(e.target)}},xp=(e,t,n,o)=>({id:ps(),annotation:typeof e=="string"?e:e.id,created:new Date,creator:o,...t}),_l=(e,t)=>{const n=new Set(e.bodies.map(o=>o.id));return t.bodies.filter(o=>!n.has(o.id))},Pl=(e,t)=>{const n=new Set(t.bodies.map(o=>o.id));return e.bodies.filter(o=>!n.has(o.id))},Nl=(e,t)=>t.bodies.map(n=>{const o=e.bodies.find(r=>r.id===n.id);return{newBody:n,oldBody:o&&!xt(o,n)?o:void 0}}).filter(({oldBody:n})=>n).map(({oldBody:n,newBody:o})=>({oldBody:n,newBody:o})),Il=(e,t)=>!xt(e.target,t.target),hs=(e,t)=>{const n=_l(e,t),o=Pl(e,t),r=Nl(e,t);return{oldValue:e,newValue:t,bodiesCreated:n.length>0?n:void 0,bodiesDeleted:o.length>0?o:void 0,bodiesUpdated:r.length>0?r:void 0,targetUpdated:Il(e,t)?{oldTarget:e.target,newTarget:t.target}:void 0}};var ms=(e=>(e.BODY_ONLY="BODY_ONLY",e.TARGET_ONLY="TARGET_ONLY",e))(ms||{}),te=(e=>(e.LOCAL="LOCAL",e.REMOTE="REMOTE",e.SILENT="SILENT",e))(te||{});const Dl=(e,t)=>{var n,o;const{changes:r,origin:i}=t;if(!(e.options.origin?e.options.origin===i:i!=="SILENT"))return!1;if(e.options.ignore){const{ignore:s}=e.options,a=c=>c&&c.length>0;if(!(a(r.created)||a(r.deleted))){const c=(n=r.updated)==null?void 0:n.some(u=>a(u.bodiesCreated)||a(u.bodiesDeleted)||a(u.bodiesUpdated)),l=(o=r.updated)==null?void 0:o.some(u=>u.targetUpdated);if(s==="BODY_ONLY"&&c&&!l||s==="TARGET_ONLY"&&l&&!c)return!1}}if(e.options.annotations){const s=new Set([...(r.created||[]).map(a=>a.id),...(r.deleted||[]).map(a=>a.id),...(r.updated||[]).map(({oldValue:a})=>a.id)]);return!!(Array.isArray(e.options.annotations)?e.options.annotations:[e.options.annotations]).find(a=>s.has(a))}else return!0},Bl=(e,t)=>{const n=new Set((e.created||[]).map(d=>d.id)),o=new Set((e.updated||[]).map(({newValue:d})=>d.id)),r=new Set((t.created||[]).map(d=>d.id)),i=new Set((t.deleted||[]).map(d=>d.id)),s=new Set((t.updated||[]).map(({oldValue:d})=>d.id)),a=new Set((t.updated||[]).filter(({oldValue:d})=>n.has(d.id)||o.has(d.id)).map(({oldValue:d})=>d.id)),c=[...(e.created||[]).filter(d=>!i.has(d.id)).map(d=>s.has(d.id)?t.updated.find(({oldValue:f})=>f.id===d.id).newValue:d),...t.created||[]],l=[...(e.deleted||[]).filter(d=>!r.has(d.id)),...(t.deleted||[]).filter(d=>!n.has(d.id))],u=[...(e.updated||[]).filter(({newValue:d})=>!i.has(d.id)).map(d=>{const{oldValue:f,newValue:h}=d;if(s.has(h.id)){const g=t.updated.find(p=>p.oldValue.id===h.id).newValue;return hs(f,g)}else return d}),...(t.updated||[]).filter(({oldValue:d})=>!a.has(d.id))];return{created:c,deleted:l,updated:u}},Sn=e=>{const t=e.id===void 0?ps():e.id;return{...e,id:t,bodies:e.bodies===void 0?[]:e.bodies.map(n=>({...n,annotation:t})),target:{...e.target,annotation:t}}},jl=e=>e.id!==void 0,Hl=()=>{const e=new Map,t=new Map,n=[],o=(T,R={})=>{n.push({onChange:T,options:R})},r=T=>{const R=n.findIndex(E=>E.onChange==T);R>-1&&n.splice(R,1)},i=(T,R)=>{const E={origin:T,changes:{created:R.created||[],updated:R.updated||[],deleted:R.deleted||[]},state:[...e.values()]};n.forEach(A=>{Dl(A,E)&&A.onChange(E)})},s=(T,R=te.LOCAL)=>{if(T.id&&e.get(T.id))throw Error(`Cannot add annotation ${T.id} - exists already`);{const E=Sn(T);e.set(E.id,E),E.bodies.forEach(A=>t.set(A.id,E.id)),i(R,{created:[E]})}},a=(T,R)=>{const E=Sn(typeof T=="string"?R:T),A=typeof T=="string"?T:T.id,M=A&&e.get(A);if(M){const k=hs(M,E);return A===E.id?e.set(A,E):(e.delete(A),e.set(E.id,E)),M.bodies.forEach(O=>t.delete(O.id)),E.bodies.forEach(O=>t.set(O.id,E.id)),k}else console.warn(`Cannot update annotation ${A} - does not exist`)},c=(T,R=te.LOCAL,E=te.LOCAL)=>{const A=jl(R)?E:R,M=a(T,R);M&&i(A,{updated:[M]})},l=(T,R=te.LOCAL)=>{e.get(T.id)?c(T,R):s(T,R)},u=(T,R=te.LOCAL)=>{const E=T.reduce((A,M)=>{const k=a(M);return k?[...A,k]:A},[]);E.length>0&&i(R,{updated:E})},d=(T,R=te.LOCAL)=>{const E=T.map(Sn),{toAdd:A,toUpdate:M}=E.reduce((O,U)=>e.get(U.id)?{...O,toUpdate:[...O.toUpdate,U]}:{...O,toAdd:[...O.toAdd,U]},{toAdd:[],toUpdate:[]}),k=M.map(O=>a(O,R)).filter(Boolean);A.forEach(O=>{e.set(O.id,O),O.bodies.forEach(U=>t.set(U.id,O.id))}),i(R,{created:A,updated:k})},f=(T,R=te.LOCAL)=>{const E=e.get(T.annotation);if(E){const A={...E,bodies:[...E.bodies,T]};e.set(E.id,A),t.set(T.id,A.id),i(R,{updated:[{oldValue:E,newValue:A,bodiesCreated:[T]}]})}else console.warn(`Attempt to add body to missing annotation: ${T.annotation}`)},h=()=>[...e.values()],g=(T=te.LOCAL)=>{const R=[...e.values()];e.clear(),t.clear(),i(T,{deleted:R})},p=(T,R=!0,E=te.LOCAL)=>{const A=T.map(Sn);if(R){const M=[...e.values()];e.clear(),t.clear(),A.forEach(k=>{e.set(k.id,k),k.bodies.forEach(O=>t.set(O.id,k.id))}),i(E,{created:A,deleted:M})}else{const M=T.reduce((k,O)=>{const U=O.id&&e.get(O.id);return U?[...k,U]:k},[]);if(M.length>0)throw Error(`Bulk insert would overwrite the following annotations: ${M.map(k=>k.id).join(", ")}`);A.forEach(k=>{e.set(k.id,k),k.bodies.forEach(O=>t.set(O.id,k.id))}),i(E,{created:A})}},x=T=>{const R=typeof T=="string"?T:T.id,E=e.get(R);if(E)return e.delete(R),E.bodies.forEach(A=>t.delete(A.id)),E;console.warn(`Attempt to delete missing annotation: ${R}`)},v=(T,R=te.LOCAL)=>{const E=x(T);E&&i(R,{deleted:[E]})},m=(T,R=te.LOCAL)=>{const E=T.reduce((A,M)=>{const k=x(M);return k?[...A,k]:A},[]);E.length>0&&i(R,{deleted:E})},y=T=>{const R=e.get(T.annotation);if(R){const E=R.bodies.find(A=>A.id===T.id);if(E){t.delete(E.id);const A={...R,bodies:R.bodies.filter(M=>M.id!==T.id)};return e.set(R.id,A),{oldValue:R,newValue:A,bodiesDeleted:[E]}}else console.warn(`Attempt to delete missing body ${T.id} from annotation ${T.annotation}`)}else console.warn(`Attempt to delete body from missing annotation ${T.annotation}`)},S=(T,R=te.LOCAL)=>{const E=y(T);E&&i(R,{updated:[E]})},$=(T,R=te.LOCAL)=>{const E=T.map(A=>y(A)).filter(Boolean);E.length>0&&i(R,{updated:E})},I=T=>{const R=e.get(T);return R?{...R}:void 0},_=T=>{const R=t.get(T);if(R){const E=I(R).bodies.find(A=>A.id===T);if(E)return E;console.error(`Store integrity error: body ${T} in index, but not in annotation`)}else console.warn(`Attempt to retrieve missing body: ${T}`)},C=(T,R)=>{if(T.annotation!==R.annotation)throw"Annotation integrity violation: annotation ID must be the same when updating bodies";const E=e.get(T.annotation);if(E){const A=E.bodies.find(k=>k.id===T.id),M={...E,bodies:E.bodies.map(k=>k.id===A.id?R:k)};return e.set(E.id,M),A.id!==R.id&&(t.delete(A.id),t.set(R.id,M.id)),{oldValue:E,newValue:M,bodiesUpdated:[{oldBody:A,newBody:R}]}}else console.warn(`Attempt to add body to missing annotation ${T.annotation}`)},N=(T,R,E=te.LOCAL)=>{const A=C(T,R);A&&i(E,{updated:[A]})},H=(T,R=te.LOCAL)=>{const E=T.map(A=>C({id:A.id,annotation:A.annotation},A)).filter(Boolean);i(R,{updated:E})},j=T=>{const R=e.get(T.annotation);if(R){const E={...R,target:{...R.target,...T}};return e.set(R.id,E),{oldValue:R,newValue:E,targetUpdated:{oldTarget:R.target,newTarget:T}}}else console.warn(`Attempt to update target on missing annotation: ${T.annotation}`)};return{addAnnotation:s,addBody:f,all:h,bulkAddAnnotations:p,bulkDeleteAnnotations:m,bulkDeleteBodies:$,bulkUpdateAnnotations:u,bulkUpdateBodies:H,bulkUpdateTargets:(T,R=te.LOCAL)=>{const E=T.map(A=>j(A)).filter(Boolean);E.length>0&&i(R,{updated:E})},bulkUpsertAnnotations:d,clear:g,deleteAnnotation:v,deleteBody:S,getAnnotation:I,getBody:_,observe:o,unobserve:r,updateAnnotation:c,updateBody:N,updateTarget:(T,R=te.LOCAL)=>{const E=j(T);E&&i(R,{updated:[E]})},upsertAnnotation:l}};let Ul=()=>({emit(e,...t){for(let n=this.events[e]||[],o=0,r=n.length;o<r;o++)n[o](...t)},events:{},on(e,t){var n;return((n=this.events)[e]||(n[e]=[])).push(t),()=>{var o;this.events[e]=(o=this.events[e])==null?void 0:o.filter(r=>t!==r)}}});const Vl=250,Fl=(e,t)=>{const n=Ul(),o=[];let r=-1,i=!1,s=0;const a=g=>{if(!i){const{changes:p}=g,x=performance.now();if(x-s>Vl)o.splice(r+1),o.push(p),r=o.length-1;else{const v=o.length-1;o[v]=Bl(o[v],p)}s=x}i=!1};e.observe(a,{origin:te.LOCAL});const c=g=>g&&g.length>0&&e.bulkDeleteAnnotations(g),l=g=>g&&g.length>0&&e.bulkAddAnnotations(g,!1),u=g=>g&&g.length>0&&e.bulkUpdateAnnotations(g.map(({oldValue:p})=>p)),d=g=>g&&g.length>0&&e.bulkUpdateAnnotations(g.map(({newValue:p})=>p)),f=g=>g&&g.length>0&&e.bulkAddAnnotations(g,!1),h=g=>g&&g.length>0&&e.bulkDeleteAnnotations(g);return{canRedo:()=>o.length-1>r,canUndo:()=>r>-1,destroy:()=>e.unobserve(a),getHistory:()=>({changes:[...o],pointer:r}),on:(g,p)=>n.on(g,p),redo:()=>{if(o.length-1>r){i=!0;const{created:g,updated:p,deleted:x}=o[r+1];l(g),d(p),h(x),n.emit("redo",o[r+1]),r+=1}},undo:()=>{if(r>-1){i=!0;const{created:g,updated:p,deleted:x}=o[r];c(g),u(p),f(x),n.emit("undo",o[r]),r-=1}}}},Xl=()=>{const{subscribe:e,set:t}=lr([]);return{subscribe:e,set:t}},Kl=(e,t,n,o)=>{const{hover:r,selection:i,store:s,viewport:a}=e,c=new Map;let l=[],u;const d=(p,x)=>{c.has(p)?c.get(p).push(x):c.set(p,[x])},f=(p,x)=>{const v=c.get(p);if(v){const m=v.indexOf(x);m!==-1&&v.splice(m,1)}},h=(p,x,v)=>{c.has(p)&&setTimeout(()=>{c.get(p).forEach(m=>{if(n){const y=Array.isArray(x)?x.map($=>n.serialize($)):n.serialize(x),S=v?v instanceof PointerEvent?v:n.serialize(v):void 0;m(y,S)}else m(x,v)})},1)};i.subscribe(({selected:p})=>{if(!(l.length===0&&p.length===0)){if(l.length===0&&p.length>0)l=p.map(({id:x})=>s.getAnnotation(x));else if(l.length>0&&p.length===0)l.forEach(x=>{const v=s.getAnnotation(x.id);v&&!xt(v,x)&&h("updateAnnotation",v,x)}),l=[];else{const x=new Set(l.map(m=>m.id)),v=new Set(p.map(({id:m})=>m));l.filter(m=>!v.has(m.id)).forEach(m=>{const y=s.getAnnotation(m.id);y&&!xt(y,m)&&h("updateAnnotation",y,m)}),l=[...l.filter(m=>v.has(m.id)),...p.filter(({id:m})=>!x.has(m)).map(({id:m})=>s.getAnnotation(m))]}h("selectionChanged",l)}}),r.subscribe(p=>{!u&&p?h("mouseEnterAnnotation",s.getAnnotation(p)):u&&!p?h("mouseLeaveAnnotation",s.getAnnotation(u)):u&&p&&(h("mouseLeaveAnnotation",s.getAnnotation(u)),h("mouseEnterAnnotation",s.getAnnotation(p))),u=p}),a==null||a.subscribe(p=>h("viewportIntersect",p.map(x=>s.getAnnotation(x)))),s.observe(p=>{const{created:x,deleted:v}=p.changes;(x||[]).forEach(m=>h("createAnnotation",m)),(v||[]).forEach(m=>h("deleteAnnotation",m)),(p.changes.updated||[]).filter(m=>[...m.bodiesCreated||[],...m.bodiesDeleted||[],...m.bodiesUpdated||[]].length>0).forEach(({oldValue:m,newValue:y})=>{const S=l.find($=>$.id===m.id)||m;l=l.map($=>$.id===m.id?y:$),h("updateAnnotation",y,S)})},{origin:te.LOCAL}),s.observe(p=>{if(l){const x=new Set(l.map(m=>m.id)),v=(p.changes.updated||[]).filter(({newValue:m})=>x.has(m.id)).map(({newValue:m})=>m);v.length>0&&(l=l.map(m=>v.find(S=>S.id===m.id)||m))}},{origin:te.REMOTE});const g=p=>x=>{const{updated:v}=x;p?(v||[]).forEach(m=>h("updateAnnotation",m.oldValue,m.newValue)):(v||[]).forEach(m=>h("updateAnnotation",m.newValue,m.oldValue))};return t.on("undo",g(!0)),t.on("redo",g(!1)),{on:d,off:f,emit:h}},ql=e=>t=>t.reduce((n,o)=>{const{parsed:r,error:i}=e.parse(o);return i?{parsed:n.parsed,failed:[...n.failed,o]}:r?{parsed:[...n.parsed,r],failed:n.failed}:{...n}},{parsed:[],failed:[]}),Yl=(e,t,n)=>{const{store:o,selection:r}=e,i=v=>{if(n){const{parsed:m,error:y}=n.parse(v);m?o.addAnnotation(m,te.REMOTE):console.error(y)}else o.addAnnotation(wo(v),te.REMOTE)},s=()=>r.clear(),a=()=>o.clear(),c=v=>{const m=o.getAnnotation(v);return n&&m?n.serialize(m):m},l=()=>n?o.all().map(n.serialize):o.all(),u=()=>{var v;const m=(((v=r.selected)==null?void 0:v.map(y=>y.id))||[]).map(y=>o.getAnnotation(y)).filter(Boolean);return n?m.map(n.serialize):m},d=(v,m=!0)=>fetch(v).then(y=>y.json()).then(y=>(h(y,m),y)),f=v=>{if(typeof v=="string"){const m=o.getAnnotation(v);if(o.deleteAnnotation(v),m)return n?n.serialize(m):m}else{const m=n?n.parse(v).parsed:v;if(m)return o.deleteAnnotation(m),v}},h=(v,m=!0)=>{if(n){const y=n.parseAll||ql(n),{parsed:S,failed:$}=y(v);$.length>0&&console.warn(`Discarded ${$.length} invalid annotations`,$),o.bulkAddAnnotations(S,m,te.REMOTE)}else o.bulkAddAnnotations(v.map(wo),m,te.REMOTE)},g=(v,m)=>{v?r.setSelected(v,m):r.clear()},p=v=>{r.clear(),r.setUserSelectAction(v)},x=v=>{if(n){const m=n.parse(v).parsed,y=n.serialize(o.getAnnotation(m.id));return o.updateAnnotation(m),y}else{const m=o.getAnnotation(v.id);return o.updateAnnotation(wo(v)),m}};return{addAnnotation:i,cancelSelected:s,canRedo:t.canRedo,canUndo:t.canUndo,clearAnnotations:a,getAnnotationById:c,getAnnotations:l,getHistory:t.getHistory,getSelected:u,loadAnnotations:d,redo:t.redo,removeAnnotation:f,setAnnotations:h,setSelected:g,setUserSelectAction:p,undo:t.undo,updateAnnotation:x}},Wl="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let zl=e=>crypto.getRandomValues(new Uint8Array(e)),Gl=(e,t,n)=>{let o=(2<<Math.log2(e.length-1))-1,r=-~(1.6*o*t/e.length);return(i=t)=>{let s="";for(;;){let a=n(r),c=r|0;for(;c--;)if(s+=e[a[c]&o]||"",s.length>=i)return s}}},Jl=(e,t=21)=>Gl(e,t|0,zl),Zl=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=Wl[n[e]&63];return t};const Ql=()=>({isGuest:!0,id:Jl("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()});Zl();const ec={namespaces:{tei:"http://www.tei-c.org/ns/1.0",teieg:"http://www.tei-c.org/ns/Examples",rng:"http://relaxng.org/ns/structure/1.0"},tei:{eg:["<pre>","</pre>"],ptr:['<a href="$rw@target">$@target</a>'],ref:[["[target]",['<a href="$rw@target">',"</a>"]]],graphic:function(e){let t=e.ownerDocument.createElement("img");return t.src=this.rw(e.getAttribute("url")),e.hasAttribute("width")&&t.setAttribute("width",e.getAttribute("width")),e.hasAttribute("height")&&t.setAttribute("height",e.getAttribute("height")),t},list:[["[type=gloss]",function(e){const t=e.ownerDocument;let n=t.createElement("dl");for(let o of Array.from(e.children))if(o.nodeType==1){if(o.localName=="tei-label"){let r=t.createElement("dt");r.innerHTML=o.innerHTML,n.appendChild(r)}if(o.localName=="tei-item"){let r=t.createElement("dd");r.innerHTML=o.innerHTML,n.appendChild(r)}}return n}]],note:[["[place=end]",function(e){const t=e.ownerDocument;this.noteIndex?this.noteIndex++:this.noteIndex=1;let n="_note_"+this.noteIndex,o=t.createElement("a");o.setAttribute("id","src"+n),o.setAttribute("href","#"+n),o.innerHTML=this.noteIndex;let r=t.createElement("sup");r.appendChild(o);let i=t.querySelector("ol.notes");i||(i=t.createElement("ol"),i.setAttribute("class","notes"),this.dom.appendChild(i));let s=t.createElement("li");return s.id=n,s.innerHTML=e.innerHTML,i.appendChild(s),r}],["_",["(",")"]]],teiHeader:function(e){this.hideContent(e,!1)},title:[["tei-titlestmt>tei-title",function(e){const t=e.ownerDocument;let n=t.createElement("title");n.innerHTML=e.innerText,t.querySelector("head").appendChild(n)}]]},teieg:{egXML:function(e){const t=e.ownerDocument;let n=t.createElement("pre"),o=t.createElement("code");n.appendChild(o);let r=this.serialize(e,!0).replace(/</g,"&lt;"),i=r.match(/^[\t ]+/);return i&&(r=r.replace(new RegExp("^"+i[0],"mg"),"")),o.innerHTML=r,n}}};function tc(e,t){let n=1,o=e;for(;o&&o.previousElementSibling!==null&&(!t||o.previousElementSibling.localName==t)&&(n++,o=o.previousElementSibling,!!o.previousElementSibling););return n}function gs(e){const t=e.ownerDocument;let n=o=>{let r;switch(o.nodeType){case 1:r=t.createElement(o.nodeName);break;case 9:r=t.implementation.createDocument();break;case 11:r=t.createDocumentFragment();break;default:r=o.cloneNode(!0)}if(o.attributes)for(let i of Array.from(o.attributes))i.name!=="data-processed"&&r.setAttribute(i.name,i.value);for(let i of Array.from(o.childNodes))if(i.nodeType==1)if(i.hasAttribute("data-original")){for(let s of Array.from(i.childNodes)){let a=r.appendChild(n(s));a.nodeType===1&&a.hasAttribute("data-origid")&&(a.setAttribute("id",a.getAttribute("data-origid")),a.removeAttribute("data-origid"))}return r}else i.hasAttribute("data-origname")&&r.appendChild(n(i));else r.appendChild(i.cloneNode());return r};return n(e)}function ys(e){return e.replace(/ .*$/,"")}function vs(e,t=!0){const n=e.ownerDocument;if(e.childNodes.length>0){let o=n.createElement("cetei-original");e.appendChild(o),o.setAttribute("hidden",""),o.setAttribute("data-original",""),o.setAttribute("role","none");for(let r of Array.from(e.childNodes))if(r!==o){if(r.nodeType===1){r.setAttribute("data-processed","");for(let i of r.querySelectorAll("*"))i.setAttribute("data-processed","")}o.appendChild(e.removeChild(r))}if(t)for(let r of Array.from(o.querySelectorAll("*")))r.hasAttribute("id")&&(r.setAttribute("data-origid",r.getAttribute("id")),r.removeAttribute("id"))}}function nc(e){return this.rw(this.first(e))}function oc(e,t){let n="";for(let o=0;o<t;o++)n+=e;return n}function rc(e){let t=this.prefixDefs[e.substring(0,e.indexOf(":"))];return e.replace(new RegExp(t.matchPattern),t.replacementPattern)}function ic(e){return this.prefixDefs[e]}function sc(e){return e.trim().match(/^(?:http|mailto|file|\/|#).*$/)?e:this.base+ys(e.trim())}function ac(e,t,n){return Bn(gs(e),t,n)}function Bn(e,t,n){let o="";const r=i=>!/[^\t\n\r ]/.test(i);if((e.nodeType===9||e.nodeType===11)&&(o+=`<?xml version="1.0" encoding="UTF-8"?>
`),!t&&e.nodeType==1){typeof n=="string"&&n!==""?o+=`
`+n+"<":o+="<",o+=e.getAttribute("data-origname");let i=e.hasAttribute("data-origatts")?e.getAttribute("data-origatts").split(" "):[];for(let s of Array.from(e.attributes))!s.name.startsWith("data-")&&!s.name.startsWith("tei-")&&!s.name.startsWith("aria-")&&!["id","lang","class"].includes(s.name)&&(o+=" "+i.find(function(a){return a.toLowerCase()==s.name})+'="'+s.value+'"'),s.name=="data-xmlns"&&(o+=' xmlns="'+s.value+'"'),s.name.startsWith("tei-")&&(o+=" "+i.find(function(a){return a.toLowerCase()==s.name.replace("tei-","")})+'="'+s.value+'"');e.childNodes.length>0?o+=">":o+="/>"}for(let i of Array.from(e.childNodes))switch(i.nodeType){case 1:typeof n=="string"?o+=Bn(i,!1,n+"  "):o+=Bn(i,!1,n);break;case 7:o+=`<?${i.nodeName} ${i.nodeValue}?>`,(e.nodeType===9||e.nodeType===11)&&(o+=`
`);break;case 8:o+=`<!--${i.nodeValue}-->`,(e.nodeType===9||e.nodeType===11)&&(o+=`
`);break;default:if(t&&r(i.nodeValue)&&(o+=i.nodeValue.replace(/^\s*\n/,"")),typeof n=="string"&&r(i.nodeValue))break;o+=i.nodeValue}return!t&&e.nodeType==1&&e.childNodes.length>0&&(typeof n=="string"?o+=`
`+n+"</":o+="</",o+=e.getAttribute("data-origname")+">"),(e.nodeType===9||e.nodeType===11)&&(o+=`
`),o}function Yo(e,t,n){const o=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];let r="";const i=s=>!/[^\t\n\r ]/.test(s);if(!t&&e.nodeType==1){typeof n=="string"&&n!==""?r+=`
`+n+"<":r+="<",r+=e.nodeName;for(let s of Array.from(e.attributes))r+=" "+s.name+'="'+s.value+'"';r+=">"}for(let s of Array.from(e.childNodes))switch(s.nodeType){case 1:typeof n=="string"?r+=Yo(s,!1,n+"  "):r+=Yo(s,!1,n);break;case 7:r+=`<?${s.nodeName} ${s.nodeValue}?>`,(e.nodeType===9||e.nodeType===11)&&(r+=`
`);break;case 8:r+=`<!--${s.nodeValue}-->`,(e.nodeType===9||e.nodeType===11)&&(r+=`
`);break;default:if(t&&i(s.nodeValue)&&(r+=s.nodeValue.replace(/^\s*\n/,"")),typeof n=="string"&&i(s.nodeValue))break;r+=s.nodeValue.replace(/</g,"&lt;")}return o.includes(e.nodeName)||!t&&e.nodeType==1&&(typeof n=="string"?r+=`
${n}</`:r+="</",r+=`${e.nodeName}>`),(e.nodeType===9||e.nodeType===11)&&(r+=`
`),r}function lc(e){return e.replace(/&gt;/,">").replace(/&quot;/,'"').replace(/&apos;/,"'").replace(/&amp;/,"&")}function jn(e){return e.includes(":"),e.replace(/:/,"-").toLowerCase()}function bs(e,t=null,n=!1){try{window.customElements.define(jn(e),class extends HTMLElement{constructor(){super(),this.matches(":defined")||t&&(t.call(this),this.setAttribute("data-processed",""))}connectedCallback(){this.hasAttribute("data-processed")||t&&(t.call(this),this.setAttribute("data-processed",""))}})}catch(o){n&&(console.log(jn(e)+" couldn't be registered or is already registered."),console.log(o))}}const xo=Object.freeze(Object.defineProperty({__proto__:null,copyAndReset:gs,defineCustomElement:bs,first:ys,getOrdinality:tc,getPrefixDef:ic,hideContent:vs,normalizeURI:nc,repeat:oc,resetAndSerialize:ac,resolveURI:rc,rw:sc,serialize:Bn,serializeHTML:Yo,tagName:jn,unEscapeEntities:lc},Symbol.toStringTag,{value:"Module"}));function cc(e){if(e.namespaces)for(let t of Object.keys(e.namespaces))!this.namespaces.has(e.namespaces[t])&&!Array.from(this.namespaces.values()).includes(t)&&this.namespaces.set(e.namespaces[t],t);for(let t of this.namespaces.values())if(e[t])for(let n of Object.keys(e[t]))this.behaviors[`${t}:${n}`]=e[t][n];if(e.functions)for(let t of Object.keys(e.functions))this.utilities[t]=e.functions[t].bind(this.utilities);e.handlers&&console.log("Behavior handlers are no longer used."),e.fallbacks&&console.log("Fallback behaviors are no longer used.")}function uc(e,t,n){let o;if(e===Object(e))for(let r of Object.keys(e))this.namespaces.has(e[r])||(this.namespaces.set(e[r],r),o=r);else o=e;this.behaviors[`${o}:${t}`]=n}function dc(e,t){let n;if(e===Object(e))for(let o of Object.keys(e))this.namespaces.has(e[o])||(this.namespaces.set(e[o],o),n=o);else n=e;delete this.behaviors[`${n}:${t}`]}function fc(e,t){const n=e.documentElement;let o=1,r=function(s){return t.has(s.namespaceURI?s.namespaceURI:"")||t.set(s.namespaceURI,"ns"+o++),t.get(s.namespaceURI?s.namespaceURI:"")+":"+s.localName};const i=new Set(Array.from(n.querySelectorAll("*"),r));return i.add(r(n)),i}function pc(e){return new Set(Array.from(e.querySelectorAll("*[data-origname]"),t=>t.localName.replace(/(\w+)-.+/,"$1:")+t.getAttribute("data-origname")))}class sn{constructor(t){this.options=t||{},this.document=this.options.documentObject?this.options.documentObject:void 0,this.document===void 0&&(typeof window<"u"&&window.document?this.document=window.document:typeof global<"u"&&global.document&&(this.document=global.document)),this.addBehaviors=cc.bind(this),this.addBehavior=uc.bind(this),this.removeBehavior=dc.bind(this),this.utilities={};for(const n of Object.keys(xo))["getPrefixDef","rw","resolveURI"].includes(n)?this.utilities[n]=xo[n].bind(this):this.utilities[n]=xo[n];if(this.els=[],this.namespaces=new Map,this.behaviors={},this.hasStyle=!1,this.prefixDefs=[],this.debug=this.options.debug===!0,this.discardContent=this.options.discardContent===!0,this.options.base)this.base=this.options.base;else try{window&&(this.base=window.location.href.replace(/\/[^\/]*$/,"/"))}catch{this.base=""}this.options.omitDefaultBehaviors||this.addBehaviors(ec),this.options.ignoreFragmentId&&window&&window.removeEventListener("ceteiceanload",sn.restorePosition)}async getHTML5(t,n,o){window&&window.location.href.startsWith(this.base)&&t.indexOf("/")>=0&&(this.base=t.replace(/\/[^\/]*$/,"/"));try{const r=await fetch(t);if(r.ok){const i=await r.text();return this.makeHTML5(i,n,o)}else console.log(`Could not get XML file ${t}.
Server returned ${r.status}: ${r.statusText}`)}catch(r){console.log(r)}}makeHTML5(t,n,o){return this.XML_dom=new DOMParser().parseFromString(t,"text/xml"),this.domToHTML5(this.XML_dom,n,o)}preprocess(t,n,o){this.els=fc(t,this.namespaces);let r=i=>{let s;if(this.namespaces.has(i.namespaceURI?i.namespaceURI:"")){let a=this.namespaces.get(i.namespaceURI?i.namespaceURI:"");s=this.document.createElement(`${a}-${i.localName.toLowerCase()}`)}else s=this.document.importNode(i,!1);for(let a of Array.from(i.attributes))a.name=="xmlns"?s.setAttribute("data-xmlns",a.value):["role"].includes(a.name)||s.setAttribute(a.name,a.value),a.name=="xml:id"&&s.setAttribute("id",a.value),a.name=="xml:lang"&&s.setAttribute("lang",a.value),a.name=="rendition"&&s.setAttribute("class",a.value.replace(/#/g,"")),a.name=="role"&&s.setAttribute("tei-role",a.value);if(s.setAttribute("data-origname",i.localName),i.hasAttributes()&&s.setAttribute("data-origatts",i.getAttributeNames().join(" ")),i.childNodes.length==0&&s.setAttribute("data-empty",""),i.localName=="head"&&i.namespaceURI=="http://www.tei-c.org/ns/1.0"){let a=function(c){let l=0,u=c.parentElement;for(;u;){let d=u.children,f=0;for(;f<d.length;){if(d[f].tagName.toLowerCase()==="head"&&d[f].namespaceURI==="http://www.tei-c.org/ns/1.0"){l++;break}f++}u=u.parentElement}return l};s.setAttribute("data-level",a(i))}if(i.localName=="tagsDecl"){let a=this.document.createElement("style");for(let c of Array.from(i.childNodes))if(c.nodeType==1&&c.localName=="rendition"&&c.getAttribute("scheme")=="css"){let l="";c.hasAttribute("selector")?(l+=c.getAttribute("selector").replace(/([^#, >]+\w*)/g,"tei-$1").replace(/#tei-/g,"#")+`{
`,l+=c.textContent):(l+="."+c.getAttribute("xml:id")+`{
`,l+=c.textContent),l+=`
}
`,a.appendChild(this.document.createTextNode(l))}a.childNodes.length>0&&(s.appendChild(a),this.hasStyle=!0)}i.localName=="prefixDef"&&(this.prefixDefs.push(i.getAttribute("ident")),this.prefixDefs[i.getAttribute("ident")]={matchPattern:i.getAttribute("matchPattern"),replacementPattern:i.getAttribute("replacementPattern")}),i.localName=="TEI"&&s.setAttribute("role","main"),["body","front","back","div"].includes(i.localName)&&(s.setAttribute("role","region"),s.setAttribute("aria-label",i.getAttribute("xml:id")||i.getAttribute("n")||i.localName));for(let a of Array.from(i.childNodes))a.nodeType==1?s.appendChild(r(a)):s.appendChild(a.cloneNode());return o&&o(s,i),s};this.dom=this.document.createDocumentFragment();for(let i of Array.from(t.childNodes))i.nodeType==1&&this.dom.appendChild(r(i)),i.nodeType==7&&this.dom.appendChild(this.document.importNode(i,!0)),i.nodeType==8&&this.dom.appendChild(this.document.importNode(i,!0));if(this.utilities.dom=this.dom.firstElementChild,n)n(this.dom,this),window&&window.dispatchEvent(zt);else return typeof window<"u"&&window.dispatchEvent(zt),this.dom}domToHTML5(t,n,o){if(this.preprocess(t,null,o),this.applyBehaviors(),this.done=!0,n)n(this.dom,this),window&&window.dispatchEvent(zt);else return typeof window<"u"&&window.dispatchEvent(zt),this.dom}processPage(){this.els=pc(this.document),this.applyBehaviors(),window&&window.dispatchEvent(zt)}unsetNamespace(t){this.namespaces.delete(t)}setBaseUrl(t){this.base=t}append(t,n){let o=this;if(n&&!n.hasAttribute("data-processed")){let r=t.call(o.utilities,n);r&&o.appendBasic(n,r)}else return function(){if(!this.hasAttribute("data-processed")){let r=t.call(o.utilities,this);r&&o.appendBasic(this,r)}}}appendBasic(t,n){this.discardContent?t.innerHTML="":vs(t,!0),t.appendChild(n)}bName(t){return t.tagName.substring(0,t.tagName.indexOf("-")).toLowerCase()+":"+t.getAttribute("data-origname")}childExists(t,n){return t&&t.nodeName==n?!0:t&&t.nextElementSibling&&this.childExists(t.nextElementSibling,n)}decorator(t){if(Array.isArray(t)&&t.length==0)return function(o){};if(Array.isArray(t)&&!Array.isArray(t[0]))return this.applyDecorator(t);let n=this;return function(o){for(let r of t)if(o.matches(r[0])||r[0]==="_")return Array.isArray(r[1])?n.decorator(r[1]).call(this,o):r[1].call(this,o)}}applyDecorator(t){let n=this;return function(o){let r=[];for(let i=0;i<t.length;i++)r.push(n.template(t[i],o));return n.insert(o,r)}}getFallback(t,n){if(t[n])return t[n]instanceof Function?t[n]:this.decorator(t[n])}getHandler(t,n){if(t[n])return t[n]instanceof Function?this.append(t[n]):this.append(this.decorator(t[n]))}insert(t,n){let o=this.document.createElement("cetei-content");for(let r of Array.from(t.childNodes))r.nodeType===1&&!r.hasAttribute("data-processed")&&this.processElement(r);if(n[0].match("<[^>]+>")&&n[1]&&n[1].match("<[^>]+>"))o.innerHTML=n[0]+t.innerHTML+(n[1]?n[1]:"");else{o.innerHTML=n[0],o.setAttribute("data-before",n[0].replace(/<[^>]+>/g,"").length);for(let r of Array.from(t.childNodes))o.appendChild(r.cloneNode(!0));n.length>1&&(o.innerHTML+=n[1],o.setAttribute("data-after",n[1].replace(/<[^>]+>/g,"").length))}return o.childNodes.length<2?o.firstChild:o}processElement(t){if(t.hasAttribute("data-origname")&&!t.hasAttribute("data-processed")){let n=this.getFallback(this.bName(t));n&&(this.append(n,t),t.setAttribute("data-processed",""))}for(let n of Array.from(t.childNodes))n.nodeType===1&&this.processElement(n)}template(t,n){let o=t;if(t.search(/\$(\w*)(@([a-zA-Z:]+))/)){let r=/\$(\w*)@([a-zA-Z:]+)/g,i;for(;i=r.exec(t);)n.hasAttribute(i[2])?i[1]&&this.utilities[i[1]]?o=o.replace(i[0],this.utilities[i[1]](n.getAttribute(i[2]))):o=o.replace(i[0],n.getAttribute(i[2])):o=o.replace(i[0],"")}return o}applyBehaviors(){typeof window<"u"&&window.customElements?this.define.call(this,this.els):this.fallback.call(this,this.els)}define(t){for(let n of t){const o=this.getHandler(this.behaviors,n);bs(n,o,this.debug)}}fallback(t){for(let n of t){let o=this.getFallback(this.behaviors,n);if(o)for(let r of Array.from((this.dom&&!this.done?this.dom:this.document).querySelectorAll(jn(n))))r.hasAttribute("data-processed")||(this.append(o,r),r.setAttribute("data-processed",""))}}static savePosition(){window.sessionStorage.setItem(window.location+"-scroll",window.scrollY)}static restorePosition(){if(window.location.hash)setTimeout(function(){let t=this.document.querySelector(window.decodeURI(window.location.hash));t&&t.scrollIntoView()},100);else{let t;(t=window.sessionStorage.getItem(window.location+"-scroll"))&&(window.sessionStorage.removeItem(window.location+"-scroll"),setTimeout(function(){window.scrollTo(0,t)},100))}}}try{if(typeof window<"u"){window.CETEI=sn,window.addEventListener("beforeunload",sn.savePosition);var zt=new Event("ceteiceanload");window.addEventListener("ceteiceanload",sn.restorePosition)}}catch(e){console.log(e)}const hc=[];for(let e=0;e<256;++e)hc.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const mc="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let gc=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=mc[n[e]&63];return t};gc();const Eo=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Ao(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on".concat(t),n)}function Gt(e,t,n,o){e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on".concat(t),n)}function ws(e,t){const n=t.slice(0,t.length-1);for(let o=0;o<n.length;o++)n[o]=e[n[o].toLowerCase()];return n}function xs(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function yc(e,t){const n=e.length>=t.length?e:t,o=e.length>=t.length?t:e;let r=!0;for(let i=0;i<n.length;i++)o.indexOf(n[i])===-1&&(r=!1);return r}const hn={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":Eo?173:189,"=":Eo?61:187,";":Eo?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},Ye={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},Qt={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Ee={16:!1,18:!1,17:!1,91:!1},pe={};for(let e=1;e<20;e++)hn["f".concat(e)]=111+e;let le=[],an=null,Es="all";const rt=new Map,Kt=e=>hn[e.toLowerCase()]||Ye[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),vc=e=>Object.keys(hn).find(t=>hn[t]===e),bc=e=>Object.keys(Ye).find(t=>Ye[t]===e);function As(e){Es=e||"all"}function mn(){return Es||"all"}function wc(){return le.slice(0)}function xc(){return le.map(e=>vc(e)||bc(e)||String.fromCharCode(e))}function Ec(){const e=[];return Object.keys(pe).forEach(t=>{pe[t].forEach(n=>{let{key:o,scope:r,mods:i,shortcut:s}=n;e.push({scope:r,shortcut:s,mods:i,keys:o.split("+").map(a=>Kt(a))})})}),e}function Ac(e){const t=e.target||e.srcElement,{tagName:n}=t;let o=!0;const r=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(r||n==="TEXTAREA"||n==="SELECT")&&!t.readOnly)&&(o=!1),o}function Sc(e){return typeof e=="string"&&(e=Kt(e)),le.indexOf(e)!==-1}function $c(e,t){let n,o;e||(e=mn());for(const r in pe)if(Object.prototype.hasOwnProperty.call(pe,r))for(n=pe[r],o=0;o<n.length;)n[o].scope===e?n.splice(o,1).forEach(i=>{let{element:s}=i;return cr(s)}):o++;mn()===e&&As(t||"all")}function Rc(e){let t=e.keyCode||e.which||e.charCode;e.key&&e.key.toLowerCase()==="capslock"&&(t=Kt(e.key));const n=le.indexOf(t);if(n>=0&&le.splice(n,1),e.key&&e.key.toLowerCase()==="meta"&&le.splice(0,le.length),(t===93||t===224)&&(t=91),t in Ee){Ee[t]=!1;for(const o in Ye)Ye[o]===t&&(dt[o]=!1)}}function Ss(e){if(typeof e>"u")Object.keys(pe).forEach(r=>{Array.isArray(pe[r])&&pe[r].forEach(i=>$n(i)),delete pe[r]}),cr(null);else if(Array.isArray(e))e.forEach(r=>{r.key&&$n(r)});else if(typeof e=="object")e.key&&$n(e);else if(typeof e=="string"){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];let[r,i]=n;typeof r=="function"&&(i=r,r=""),$n({key:e,scope:r,method:i,splitKey:"+"})}}const $n=e=>{let{key:t,scope:n,method:o,splitKey:r="+"}=e;xs(t).forEach(i=>{const s=i.split(r),a=s.length,c=s[a-1],l=c==="*"?"*":Kt(c);if(!pe[l])return;n||(n=mn());const u=a>1?ws(Ye,s):[],d=[];pe[l]=pe[l].filter(f=>{const h=(o?f.method===o:!0)&&f.scope===n&&yc(f.mods,u);return h&&d.push(f.element),!h}),d.forEach(f=>cr(f))})};function ii(e,t,n,o){if(t.element!==o)return;let r;if(t.scope===n||t.scope==="all"){r=t.mods.length>0;for(const i in Ee)Object.prototype.hasOwnProperty.call(Ee,i)&&(!Ee[i]&&t.mods.indexOf(+i)>-1||Ee[i]&&t.mods.indexOf(+i)===-1)&&(r=!1);(t.mods.length===0&&!Ee[16]&&!Ee[18]&&!Ee[17]&&!Ee[91]||r||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(le),t.method(e,t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function si(e,t){const n=pe["*"];let o=e.keyCode||e.which||e.charCode;if(e.key&&e.key.toLowerCase()==="capslock"||!dt.filter.call(this,e))return;if((o===93||o===224)&&(o=91),le.indexOf(o)===-1&&o!==229&&le.push(o),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const c=Qt[a];e[a]&&le.indexOf(c)===-1?le.push(c):!e[a]&&le.indexOf(c)>-1?le.splice(le.indexOf(c),1):a==="metaKey"&&e[a]&&(le=le.filter(l=>l in Qt||l===o))}),o in Ee){Ee[o]=!0;for(const a in Ye)if(Object.prototype.hasOwnProperty.call(Ye,a)){const c=Qt[Ye[a]];dt[a]=e[c]}if(!n)return}for(const a in Ee)Object.prototype.hasOwnProperty.call(Ee,a)&&(Ee[a]=e[Qt[a]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(le.indexOf(17)===-1&&le.push(17),le.indexOf(18)===-1&&le.push(18),Ee[17]=!0,Ee[18]=!0);const r=mn();if(n)for(let a=0;a<n.length;a++)n[a].scope===r&&(e.type==="keydown"&&n[a].keydown||e.type==="keyup"&&n[a].keyup)&&ii(e,n[a],r,t);if(!(o in pe))return;const i=pe[o],s=i.length;for(let a=0;a<s;a++)if((e.type==="keydown"&&i[a].keydown||e.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,u=c.key.split(l),d=[];for(let f=0;f<u.length;f++)d.push(Kt(u[f]));d.sort().join("")===le.sort().join("")&&ii(e,c,r,t)}}function dt(e,t,n){le=[];const o=xs(e);let r=[],i="all",s=document,a=0,c=!1,l=!0,u="+",d=!1,f=!1;for(n===void 0&&typeof t=="function"&&(n=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(i=t.scope),t.element&&(s=t.element),t.keyup&&(c=t.keyup),t.keydown!==void 0&&(l=t.keydown),t.capture!==void 0&&(d=t.capture),typeof t.splitKey=="string"&&(u=t.splitKey),t.single===!0&&(f=!0)),typeof t=="string"&&(i=t),f&&Ss(e,i);a<o.length;a++)e=o[a].split(u),r=[],e.length>1&&(r=ws(Ye,e)),e=e[e.length-1],e=e==="*"?"*":Kt(e),e in pe||(pe[e]=[]),pe[e].push({keyup:c,keydown:l,scope:i,mods:r,shortcut:o[a],method:n,key:o[a],splitKey:u,element:s});if(typeof s<"u"&&window){if(!rt.has(s)){const h=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return si(p,s)},g=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;si(p,s),Rc(p)};rt.set(s,{keydownListener:h,keyupListenr:g,capture:d}),Ao(s,"keydown",h,d),Ao(s,"keyup",g,d)}if(!an){const h=()=>{le=[]};an={listener:h,capture:d},Ao(window,"focus",h,d)}}}function Tc(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(pe).forEach(n=>{pe[n].filter(o=>o.scope===t&&o.shortcut===e).forEach(o=>{o&&o.method&&o.method()})})}function cr(e){const t=Object.values(pe).flat();if(t.findIndex(n=>{let{element:o}=n;return o===e})<0){const{keydownListener:n,keyupListenr:o,capture:r}=rt.get(e)||{};n&&o&&(Gt(e,"keyup",o,r),Gt(e,"keydown",n,r),rt.delete(e))}if((t.length<=0||rt.size<=0)&&(Object.keys(rt).forEach(n=>{const{keydownListener:o,keyupListenr:r,capture:i}=rt.get(n)||{};o&&r&&(Gt(n,"keyup",r,i),Gt(n,"keydown",o,i),rt.delete(n))}),rt.clear(),Object.keys(pe).forEach(n=>delete pe[n]),an)){const{listener:n,capture:o}=an;Gt(window,"focus",n,o),an=null}}const So={getPressedKeyString:xc,setScope:As,getScope:mn,deleteScope:$c,getPressedKeyCodes:wc,getAllKeyCodes:Ec,isPressed:Sc,filter:Ac,trigger:Tc,unbind:Ss,keyMap:hn,modifier:Ye,modifierMap:Qt};for(const e in So)Object.prototype.hasOwnProperty.call(So,e)&&(dt[e]=So[e]);if(typeof window<"u"){const e=window.hotkeys;dt.noConflict=t=>(t&&window.hotkeys===dt&&(window.hotkeys=e),dt),window.hotkeys=dt}const Cc="not-annotatable",$s=`.${Cc}`;typeof navigator<"u"&&/mac/i.test(navigator.userAgentData?navigator.userAgentData.platform:navigator.platform);const Oc=e=>{const t=e.cloneContents();return t.querySelectorAll($s).forEach(n=>n.remove()),t},Lc=e=>e.every(t=>t.range instanceof Range&&!t.range.collapsed),kc=(e,t,n)=>{const o=document.createRange(),r=t;o.setStart(r,0),o.setEnd(e.startContainer,e.startOffset);const i=Oc(o).textContent,s=e.toString(),a=i.length||0,c=a+s.length;return{quote:s,start:a,end:c,range:e}},Mc=(e,t)=>{var n,o;const{start:r,end:i}=e,s=e.offsetReference||t,a=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,f=>{var h;return(h=f.parentElement)!=null&&h.closest($s)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT});let c=0;const l=document.createRange();let u=a.nextNode();u===null&&console.error("Could not revive annotation target. Content missing.");let d=!s;for(;u!==null;){if(d||(d=typeof(s==null?void 0:s.contains)=="function"?s.contains(u):!1),d){const f=((n=u.textContent)==null?void 0:n.length)||0;if(c+f>r){l.setStart(u,r-c);break}c+=f}u=a.nextNode()}for(;u!==null;){const f=((o=u.textContent)==null?void 0:o.length)||0;if(c+f>=i){l.setEnd(u,i-c);break}c+=f,u=a.nextNode()}return{...e,range:l}},ai=(e,t)=>Lc(e.selector)?e:{...e,selector:e.selector.map(n=>n.range instanceof Range&&!n.range.collapsed?n:Mc(n,t))},_c=(e,t,n)=>{let o=e,r=n;const i=document.createNodeIterator(t,NodeFilter.SHOW_TEXT);let s=i.nextNode(),a=!0;do s instanceof Text&&(s.length<r?r-=s.length:(o=s,a=!1)),s=i.nextNode();while(s&&a);return{node:o,offset:r}},Wo=(e,t=[])=>{let n,o,r;if(e.nodeType===Node.ELEMENT_NODE&&e.hasAttribute("xml:id")?t.push("/"):e.parentNode&&(t=Wo(e.parentNode,t)),e.nodeType===Node.ELEMENT_NODE&&e.nodeName.toLowerCase().startsWith("tei-")){const i=e;i.hasAttribute("xml:id")?r=`[@xml:id='${i.getAttribute("xml:id")}']`:(n=`count(preceding-sibling::${i.localName})`,o=document.evaluate(n,e,null,XPathResult.NUMBER_TYPE,null).numberValue+1,r=`[${o}]`),t.push("/"),t.push(i.getAttribute("data-origname")+r)}return t},Pc=(e,t,n)=>{const o=l=>l?l.nodeName.toLowerCase().indexOf("tei-")===0?l:o(l.parentNode):null,r=(l,u,d)=>{const f=document.createRange();return f.setStart(l,0),f.setEnd(u,d),f.toString().length},i=r(o(n.startContainer),n.startContainer,n.startOffset),s=r(o(n.endContainer),n.endContainer,n.endOffset),a=e.join("")+"::"+i,c=t.join("")+"::"+s;return{start:a,end:c}},Nc=e=>{var t;const{range:n}=e,o=Wo(n.startContainer),r=Wo(n.endContainer),{start:i,end:s}=Pc(o,r,n);return{start:e.start,startSelector:{type:"XPathSelector",value:i},end:e.end,endSelector:{type:"XPathSelector",value:s},quote:(t=e.quote)==null?void 0:t.replace(/\s+/g," "),range:n}},Ic=(e,t)=>{var n,o;const r=Array.isArray(e.selector)?e.selector[0]:e.selector;if("start"in r&&"end"in r)return ai(e,t);{const i=(n=r.startSelector)==null?void 0:n.value,s=(o=r.endSelector)==null?void 0:o.value;if(!i||!s)throw console.error(e),"Could not revive TEI target.";const a=v=>{const m=v.indexOf("::");if(m<0)return;const y=v.substring(0,m).replace(/\/([^[/]+)/g,(I,_)=>"/tei-"+_.toLowerCase()).replace(/xml:/g,""),S=document.evaluate("."+y,t,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,$=parseInt(v.substring(m+2));return[S,$]},[c,l]=a(i),[u,d]=a(s),f=document.createRange(),h=(v,m)=>v.firstChild instanceof Text&&v.firstChild.length>=m?{node:v.firstChild,offset:m}:_c(v.firstChild,v,m),g=h(c,l);f.setStart(g.node,g.offset);const p=h(u,d);f.setEnd(p.node,p.offset);const x=kc(f,t);return ai({...e,selector:[{...x,...r,range:f}]},t)}},Rs=e=>t=>{const n=Ic(t,e);return{...t,selector:n.selector.map(Nc)}},Dc=e=>t=>({...t,target:Rs(e)(t.target)}),Bc=e=>{const t=e.element,n=Dc(t),o=Rs(t),r=e.state.store,i=r.addAnnotation;r.addAnnotation=(l,u)=>{const{selector:d}=l.target;try{return"startSelector"in d&&"start"in d?i(l,u):i(n(l),u)}catch(f){console.warn(f),console.warn("Failed to render annotation",l)}};const s=r.bulkAddAnnotations;r.bulkAddAnnotations=(l,u=!0,d)=>{const f=l.map(g=>{const{selector:p}=g.target;try{return"startSelector"in p&&"start"in p?g:n(g)}catch(x){console.warn(x)}}),h=f.filter(Boolean);return f.length!==h.length&&(console.warn(`Failed to render ${f.length-h.length} annotations.`),f.forEach((g,p)=>{g||console.warn(l[p])})),s(h,u,d)};const a=r.updateAnnotation;r.updateAnnotation=(l,u)=>a(n(l),u);const c=r.updateTarget;return r.updateTarget=(l,u)=>c(o(l),u),{...e,state:{...e.state,store:r}}};var jc={grad:.9,turn:360,rad:360/(2*Math.PI)},ot=function(e){return typeof e=="string"?e.length>0:typeof e=="number"},ve=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=Math.pow(10,t)),Math.round(n*e)/n+0},je=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1),e>n?n:e>t?e:t},Ts=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},li=function(e){return{r:je(e.r,0,255),g:je(e.g,0,255),b:je(e.b,0,255),a:je(e.a)}},$o=function(e){return{r:ve(e.r),g:ve(e.g),b:ve(e.b),a:ve(e.a,3)}},Hc=/^#([0-9a-f]{3,8})$/i,Rn=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},Cs=function(e){var t=e.r,n=e.g,o=e.b,r=e.a,i=Math.max(t,n,o),s=i-Math.min(t,n,o),a=s?i===t?(n-o)/s:i===n?2+(o-t)/s:4+(t-n)/s:0;return{h:60*(a<0?a+6:a),s:i?s/i*100:0,v:i/255*100,a:r}},Os=function(e){var t=e.h,n=e.s,o=e.v,r=e.a;t=t/360*6,n/=100,o/=100;var i=Math.floor(t),s=o*(1-n),a=o*(1-(t-i)*n),c=o*(1-(1-t+i)*n),l=i%6;return{r:255*[o,a,s,s,c,o][l],g:255*[c,o,o,a,s,s][l],b:255*[s,s,c,o,o,a][l],a:r}},ci=function(e){return{h:Ts(e.h),s:je(e.s,0,100),l:je(e.l,0,100),a:je(e.a)}},ui=function(e){return{h:ve(e.h),s:ve(e.s),l:ve(e.l),a:ve(e.a,3)}},di=function(e){return Os((n=(t=e).s,{h:t.h,s:(n*=((o=t.l)<50?o:100-o)/100)>0?2*n/(o+n)*100:0,v:o+n,a:t.a}));var t,n,o},ln=function(e){return{h:(t=Cs(e)).h,s:(r=(200-(n=t.s))*(o=t.v)/100)>0&&r<200?n*o/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,n,o,r},Uc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Vc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Fc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Xc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,fi={string:[[function(e){var t=Hc.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?ve(parseInt(e[3]+e[3],16)/255,2):1}:e.length===6||e.length===8?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:e.length===8?ve(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=Fc.exec(e)||Xc.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:li({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=Uc.exec(e)||Vc.exec(e);if(!t)return null;var n,o,r=ci({h:(n=t[1],o=t[2],o===void 0&&(o="deg"),Number(n)*(jc[o]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return di(r)},"hsl"]],object:[[function(e){var t=e.r,n=e.g,o=e.b,r=e.a,i=r===void 0?1:r;return ot(t)&&ot(n)&&ot(o)?li({r:Number(t),g:Number(n),b:Number(o),a:Number(i)}):null},"rgb"],[function(e){var t=e.h,n=e.s,o=e.l,r=e.a,i=r===void 0?1:r;if(!ot(t)||!ot(n)||!ot(o))return null;var s=ci({h:Number(t),s:Number(n),l:Number(o),a:Number(i)});return di(s)},"hsl"],[function(e){var t=e.h,n=e.s,o=e.v,r=e.a,i=r===void 0?1:r;if(!ot(t)||!ot(n)||!ot(o))return null;var s=(function(a){return{h:Ts(a.h),s:je(a.s,0,100),v:je(a.v,0,100),a:je(a.a)}})({h:Number(t),s:Number(n),v:Number(o),a:Number(i)});return Os(s)},"hsv"]]},pi=function(e,t){for(var n=0;n<t.length;n++){var o=t[n][0](e);if(o)return[o,t[n][1]]}return[null,void 0]},Kc=function(e){return typeof e=="string"?pi(e.trim(),fi.string):typeof e=="object"&&e!==null?pi(e,fi.object):[null,void 0]},Ro=function(e,t){var n=ln(e);return{h:n.h,s:je(n.s+100*t,0,100),l:n.l,a:n.a}},To=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},hi=function(e,t){var n=ln(e);return{h:n.h,s:n.s,l:je(n.l+100*t,0,100),a:n.a}},mi=(function(){function e(t){this.parsed=Kc(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return this.parsed!==null},e.prototype.brightness=function(){return ve(To(this.rgba),2)},e.prototype.isDark=function(){return To(this.rgba)<.5},e.prototype.isLight=function(){return To(this.rgba)>=.5},e.prototype.toHex=function(){return t=$o(this.rgba),n=t.r,o=t.g,r=t.b,s=(i=t.a)<1?Rn(ve(255*i)):"","#"+Rn(n)+Rn(o)+Rn(r)+s;var t,n,o,r,i,s},e.prototype.toRgb=function(){return $o(this.rgba)},e.prototype.toRgbString=function(){return t=$o(this.rgba),n=t.r,o=t.g,r=t.b,(i=t.a)<1?"rgba("+n+", "+o+", "+r+", "+i+")":"rgb("+n+", "+o+", "+r+")";var t,n,o,r,i},e.prototype.toHsl=function(){return ui(ln(this.rgba))},e.prototype.toHslString=function(){return t=ui(ln(this.rgba)),n=t.h,o=t.s,r=t.l,(i=t.a)<1?"hsla("+n+", "+o+"%, "+r+"%, "+i+")":"hsl("+n+", "+o+"%, "+r+"%)";var t,n,o,r,i},e.prototype.toHsv=function(){return t=Cs(this.rgba),{h:ve(t.h),s:ve(t.s),v:ve(t.v),a:ve(t.a,3)};var t},e.prototype.invert=function(){return Fe({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},e.prototype.saturate=function(t){return t===void 0&&(t=.1),Fe(Ro(this.rgba,t))},e.prototype.desaturate=function(t){return t===void 0&&(t=.1),Fe(Ro(this.rgba,-t))},e.prototype.grayscale=function(){return Fe(Ro(this.rgba,-1))},e.prototype.lighten=function(t){return t===void 0&&(t=.1),Fe(hi(this.rgba,t))},e.prototype.darken=function(t){return t===void 0&&(t=.1),Fe(hi(this.rgba,-t))},e.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},e.prototype.alpha=function(t){return typeof t=="number"?Fe({r:(n=this.rgba).r,g:n.g,b:n.b,a:t}):ve(this.rgba.a,3);var n},e.prototype.hue=function(t){var n=ln(this.rgba);return typeof t=="number"?Fe({h:t,s:n.s,l:n.l,a:n.a}):ve(n.h)},e.prototype.isEqual=function(t){return this.toHex()===Fe(t).toHex()},e})(),Fe=function(e){return e instanceof mi?e:new mi(e)},gi=Object.prototype.hasOwnProperty;function zo(e,t){var n,o;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((o=e.length)===t.length)for(;o--&&zo(e[o],t[o]););return o===-1}if(!n||typeof e=="object"){o=0;for(n in e)if(gi.call(e,n)&&++o&&!gi.call(t,n)||!(n in t)||!zo(e[n],t[n]))return!1;return Object.keys(t).length===o}}return e!==e&&t!==t}const xe=[];for(let e=0;e<256;++e)xe.push((e+256).toString(16).slice(1));function qc(e,t=0){return(xe[e[t+0]]+xe[e[t+1]]+xe[e[t+2]]+xe[e[t+3]]+"-"+xe[e[t+4]]+xe[e[t+5]]+"-"+xe[e[t+6]]+xe[e[t+7]]+"-"+xe[e[t+8]]+xe[e[t+9]]+"-"+xe[e[t+10]]+xe[e[t+11]]+xe[e[t+12]]+xe[e[t+13]]+xe[e[t+14]]+xe[e[t+15]]).toLowerCase()}let Co;const Yc=new Uint8Array(16);function Wc(){if(!Co){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Co=crypto.getRandomValues.bind(crypto)}return Co(Yc)}const zc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),yi={randomUUID:zc};function Gc(e,t,n){var r;if(yi.randomUUID&&!e)return yi.randomUUID();e=e||{};const o=e.random??((r=e.rng)==null?void 0:r.call(e))??Wc();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,qc(o)}function Ls(e,t,n=0,o=e.length-1,r=Jc){for(;o>n;){if(o-n>600){const c=o-n+1,l=t-n+1,u=Math.log(c),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(c-d)/c)*(l-c/2<0?-1:1),h=Math.max(n,Math.floor(t-l*d/c+f)),g=Math.min(o,Math.floor(t+(c-l)*d/c+f));Ls(e,t,h,g,r)}const i=e[t];let s=n,a=o;for(Jt(e,n,t),r(e[o],i)>0&&Jt(e,n,o);s<a;){for(Jt(e,s,a),s++,a--;r(e[s],i)<0;)s++;for(;r(e[a],i)>0;)a--}r(e[n],i)===0?Jt(e,n,a):(a++,Jt(e,a,o)),a<=t&&(n=a+1),t<=a&&(o=a-1)}}function Jt(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}function Jc(e,t){return e<t?-1:e>t?1:0}class Zc{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let n=this.data;const o=[];if(!Cn(t,n))return o;const r=this.toBBox,i=[];for(;n;){for(let s=0;s<n.children.length;s++){const a=n.children[s],c=n.leaf?r(a):a;Cn(t,c)&&(n.leaf?o.push(a):Lo(t,c)?this._all(a,o):i.push(a))}n=i.pop()}return o}collides(t){let n=this.data;if(!Cn(t,n))return!1;const o=[];for(;n;){for(let r=0;r<n.children.length;r++){const i=n.children[r],s=n.leaf?this.toBBox(i):i;if(Cn(t,s)){if(n.leaf||Lo(t,s))return!0;o.push(i)}}n=o.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let o=0;o<t.length;o++)this.insert(t[o]);return this}let n=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const o=this.data;this.data=n,n=o}this._insert(n,this.data.height-n.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Ot([]),this}remove(t,n){if(!t)return this;let o=this.data;const r=this.toBBox(t),i=[],s=[];let a,c,l;for(;o||i.length;){if(o||(o=i.pop(),c=i[i.length-1],a=s.pop(),l=!0),o.leaf){const u=Qc(t,o.children,n);if(u!==-1)return o.children.splice(u,1),i.push(o),this._condense(i),this}!l&&!o.leaf&&Lo(o,r)?(i.push(o),s.push(a),a=0,c=o,o=o.children[0]):c?(a++,o=c.children[a],l=!1):o=null}return this}toBBox(t){return t}compareMinX(t,n){return t.minX-n.minX}compareMinY(t,n){return t.minY-n.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,n){const o=[];for(;t;)t.leaf?n.push(...t.children):o.push(...t.children),t=o.pop();return n}_build(t,n,o,r){const i=o-n+1;let s=this._maxEntries,a;if(i<=s)return a=Ot(t.slice(n,o+1)),Rt(a,this.toBBox),a;r||(r=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,r-1))),a=Ot([]),a.leaf=!1,a.height=r;const c=Math.ceil(i/s),l=c*Math.ceil(Math.sqrt(s));vi(t,n,o,l,this.compareMinX);for(let u=n;u<=o;u+=l){const d=Math.min(u+l-1,o);vi(t,u,d,c,this.compareMinY);for(let f=u;f<=d;f+=c){const h=Math.min(f+c-1,d);a.children.push(this._build(t,f,h,r-1))}}return Rt(a,this.toBBox),a}_chooseSubtree(t,n,o,r){for(;r.push(n),!(n.leaf||r.length-1===o);){let i=1/0,s=1/0,a;for(let c=0;c<n.children.length;c++){const l=n.children[c],u=Oo(l),d=nu(t,l)-u;d<s?(s=d,i=u<i?u:i,a=l):d===s&&u<i&&(i=u,a=l)}n=a||n.children[0]}return n}_insert(t,n,o){const r=o?t:this.toBBox(t),i=[],s=this._chooseSubtree(r,this.data,n,i);for(s.children.push(t),tn(s,r);n>=0&&i[n].children.length>this._maxEntries;)this._split(i,n),n--;this._adjustParentBBoxes(r,i,n)}_split(t,n){const o=t[n],r=o.children.length,i=this._minEntries;this._chooseSplitAxis(o,i,r);const s=this._chooseSplitIndex(o,i,r),a=Ot(o.children.splice(s,o.children.length-s));a.height=o.height,a.leaf=o.leaf,Rt(o,this.toBBox),Rt(a,this.toBBox),n?t[n-1].children.push(a):this._splitRoot(o,a)}_splitRoot(t,n){this.data=Ot([t,n]),this.data.height=t.height+1,this.data.leaf=!1,Rt(this.data,this.toBBox)}_chooseSplitIndex(t,n,o){let r,i=1/0,s=1/0;for(let a=n;a<=o-n;a++){const c=en(t,0,a,this.toBBox),l=en(t,a,o,this.toBBox),u=ou(c,l),d=Oo(c)+Oo(l);u<i?(i=u,r=a,s=d<s?d:s):u===i&&d<s&&(s=d,r=a)}return r||o-n}_chooseSplitAxis(t,n,o){const r=t.leaf?this.compareMinX:eu,i=t.leaf?this.compareMinY:tu,s=this._allDistMargin(t,n,o,r),a=this._allDistMargin(t,n,o,i);s<a&&t.children.sort(r)}_allDistMargin(t,n,o,r){t.children.sort(r);const i=this.toBBox,s=en(t,0,n,i),a=en(t,o-n,o,i);let c=Tn(s)+Tn(a);for(let l=n;l<o-n;l++){const u=t.children[l];tn(s,t.leaf?i(u):u),c+=Tn(s)}for(let l=o-n-1;l>=n;l--){const u=t.children[l];tn(a,t.leaf?i(u):u),c+=Tn(a)}return c}_adjustParentBBoxes(t,n,o){for(let r=o;r>=0;r--)tn(n[r],t)}_condense(t){for(let n=t.length-1,o;n>=0;n--)t[n].children.length===0?n>0?(o=t[n-1].children,o.splice(o.indexOf(t[n]),1)):this.clear():Rt(t[n],this.toBBox)}}function Qc(e,t,n){if(!n)return t.indexOf(e);for(let o=0;o<t.length;o++)if(n(e,t[o]))return o;return-1}function Rt(e,t){en(e,0,e.children.length,t,e)}function en(e,t,n,o,r){r||(r=Ot(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let i=t;i<n;i++){const s=e.children[i];tn(r,e.leaf?o(s):s)}return r}function tn(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function eu(e,t){return e.minX-t.minX}function tu(e,t){return e.minY-t.minY}function Oo(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Tn(e){return e.maxX-e.minX+(e.maxY-e.minY)}function nu(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function ou(e,t){const n=Math.max(e.minX,t.minX),o=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),i=Math.min(e.maxY,t.maxY);return Math.max(0,r-n)*Math.max(0,i-o)}function Lo(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function Cn(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Ot(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function vi(e,t,n,o,r){const i=[t,n];for(;i.length;){if(n=i.pop(),t=i.pop(),n-t<=o)continue;const s=t+Math.ceil((n-t)/o/2)*o;Ls(e,s,t,n,r),i.push(t,s,s,n)}}const ko=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Mo(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on".concat(t),n)}function Zt(e,t,n,o){e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on".concat(t),n)}function ks(e,t){const n=t.slice(0,t.length-1);for(let o=0;o<n.length;o++)n[o]=e[n[o].toLowerCase()];return n}function Ms(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function ru(e,t){const n=e.length>=t.length?e:t,o=e.length>=t.length?t:e;let r=!0;for(let i=0;i<n.length;i++)o.indexOf(n[i])===-1&&(r=!1);return r}const gn={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":ko?173:189,"=":ko?61:187,";":ko?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},We={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},nn={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Ae={16:!1,18:!1,17:!1,91:!1},he={};for(let e=1;e<20;e++)gn["f".concat(e)]=111+e;let ce=[],cn=null,_s="all";const it=new Map,qt=e=>gn[e.toLowerCase()]||We[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),iu=e=>Object.keys(gn).find(t=>gn[t]===e),su=e=>Object.keys(We).find(t=>We[t]===e);function Ps(e){_s=e||"all"}function yn(){return _s||"all"}function au(){return ce.slice(0)}function lu(){return ce.map(e=>iu(e)||su(e)||String.fromCharCode(e))}function cu(){const e=[];return Object.keys(he).forEach(t=>{he[t].forEach(n=>{let{key:o,scope:r,mods:i,shortcut:s}=n;e.push({scope:r,shortcut:s,mods:i,keys:o.split("+").map(a=>qt(a))})})}),e}function uu(e){const t=e.target||e.srcElement,{tagName:n}=t;let o=!0;const r=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(r||n==="TEXTAREA"||n==="SELECT")&&!t.readOnly)&&(o=!1),o}function du(e){return typeof e=="string"&&(e=qt(e)),ce.indexOf(e)!==-1}function fu(e,t){let n,o;e||(e=yn());for(const r in he)if(Object.prototype.hasOwnProperty.call(he,r))for(n=he[r],o=0;o<n.length;)n[o].scope===e?n.splice(o,1).forEach(s=>{let{element:a}=s;return ur(a)}):o++;yn()===e&&Ps(t||"all")}function pu(e){let t=e.keyCode||e.which||e.charCode;e.key&&e.key.toLowerCase()==="capslock"&&(t=qt(e.key));const n=ce.indexOf(t);if(n>=0&&ce.splice(n,1),e.key&&e.key.toLowerCase()==="meta"&&ce.splice(0,ce.length),(t===93||t===224)&&(t=91),t in Ae){Ae[t]=!1;for(const o in We)We[o]===t&&(He[o]=!1)}}function Ns(e){if(typeof e>"u")Object.keys(he).forEach(r=>{Array.isArray(he[r])&&he[r].forEach(i=>On(i)),delete he[r]}),ur(null);else if(Array.isArray(e))e.forEach(r=>{r.key&&On(r)});else if(typeof e=="object")e.key&&On(e);else if(typeof e=="string"){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];let[r,i]=n;typeof r=="function"&&(i=r,r=""),On({key:e,scope:r,method:i,splitKey:"+"})}}const On=e=>{let{key:t,scope:n,method:o,splitKey:r="+"}=e;Ms(t).forEach(s=>{const a=s.split(r),c=a.length,l=a[c-1],u=l==="*"?"*":qt(l);if(!he[u])return;n||(n=yn());const d=c>1?ks(We,a):[],f=[];he[u]=he[u].filter(h=>{const p=(o?h.method===o:!0)&&h.scope===n&&ru(h.mods,d);return p&&f.push(h.element),!p}),f.forEach(h=>ur(h))})};function bi(e,t,n,o){if(t.element!==o)return;let r;if(t.scope===n||t.scope==="all"){r=t.mods.length>0;for(const i in Ae)Object.prototype.hasOwnProperty.call(Ae,i)&&(!Ae[i]&&t.mods.indexOf(+i)>-1||Ae[i]&&t.mods.indexOf(+i)===-1)&&(r=!1);(t.mods.length===0&&!Ae[16]&&!Ae[18]&&!Ae[17]&&!Ae[91]||r||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(ce),t.method(e,t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function wi(e,t){const n=he["*"];let o=e.keyCode||e.which||e.charCode;if(e.key&&e.key.toLowerCase()==="capslock"||!He.filter.call(this,e))return;if((o===93||o===224)&&(o=91),ce.indexOf(o)===-1&&o!==229&&ce.push(o),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const c=nn[a];e[a]&&ce.indexOf(c)===-1?ce.push(c):!e[a]&&ce.indexOf(c)>-1?ce.splice(ce.indexOf(c),1):a==="metaKey"&&e[a]&&(ce=ce.filter(l=>l in nn||l===o))}),o in Ae){Ae[o]=!0;for(const a in We)if(Object.prototype.hasOwnProperty.call(We,a)){const c=nn[We[a]];He[a]=e[c]}if(!n)return}for(const a in Ae)Object.prototype.hasOwnProperty.call(Ae,a)&&(Ae[a]=e[nn[a]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(ce.indexOf(17)===-1&&ce.push(17),ce.indexOf(18)===-1&&ce.push(18),Ae[17]=!0,Ae[18]=!0);const r=yn();if(n)for(let a=0;a<n.length;a++)n[a].scope===r&&(e.type==="keydown"&&n[a].keydown||e.type==="keyup"&&n[a].keyup)&&bi(e,n[a],r,t);if(!(o in he))return;const i=he[o],s=i.length;for(let a=0;a<s;a++)if((e.type==="keydown"&&i[a].keydown||e.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,u=c.key.split(l),d=[];for(let f=0;f<u.length;f++)d.push(qt(u[f]));d.sort().join("")===ce.sort().join("")&&bi(e,c,r,t)}}function He(e,t,n){ce=[];const o=Ms(e);let r=[],i="all",s=document,a=0,c=!1,l=!0,u="+",d=!1,f=!1;for(n===void 0&&typeof t=="function"&&(n=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(i=t.scope),t.element&&(s=t.element),t.keyup&&(c=t.keyup),t.keydown!==void 0&&(l=t.keydown),t.capture!==void 0&&(d=t.capture),typeof t.splitKey=="string"&&(u=t.splitKey),t.single===!0&&(f=!0)),typeof t=="string"&&(i=t),f&&Ns(e,i);a<o.length;a++)e=o[a].split(u),r=[],e.length>1&&(r=ks(We,e)),e=e[e.length-1],e=e==="*"?"*":qt(e),e in he||(he[e]=[]),he[e].push({keyup:c,keydown:l,scope:i,mods:r,shortcut:o[a],method:n,key:o[a],splitKey:u,element:s});if(typeof s<"u"&&window){if(!it.has(s)){const h=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return wi(p,s)},g=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;wi(p,s),pu(p)};it.set(s,{keydownListener:h,keyupListenr:g,capture:d}),Mo(s,"keydown",h,d),Mo(s,"keyup",g,d)}if(!cn){const h=()=>{ce=[]};cn={listener:h,capture:d},Mo(window,"focus",h,d)}}}function hu(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(he).forEach(n=>{he[n].filter(r=>r.scope===t&&r.shortcut===e).forEach(r=>{r&&r.method&&r.method()})})}function ur(e){const t=Object.values(he).flat();if(t.findIndex(o=>{let{element:r}=o;return r===e})<0){const{keydownListener:o,keyupListenr:r,capture:i}=it.get(e)||{};o&&r&&(Zt(e,"keyup",r,i),Zt(e,"keydown",o,i),it.delete(e))}if((t.length<=0||it.size<=0)&&(Object.keys(it).forEach(r=>{const{keydownListener:i,keyupListenr:s,capture:a}=it.get(r)||{};i&&s&&(Zt(r,"keyup",s,a),Zt(r,"keydown",i,a),it.delete(r))}),it.clear(),Object.keys(he).forEach(r=>delete he[r]),cn)){const{listener:r,capture:i}=cn;Zt(window,"focus",r,i),cn=null}}const _o={getPressedKeyString:lu,setScope:Ps,getScope:yn,deleteScope:fu,getPressedKeyCodes:au,getAllKeyCodes:cu,isPressed:du,filter:uu,trigger:hu,unbind:Ns,keyMap:gn,modifier:We,modifierMap:nn};for(const e in _o)Object.prototype.hasOwnProperty.call(_o,e)&&(He[e]=_o[e]);if(typeof window<"u"){const e=window.hotkeys;He.noConflict=t=>(t&&window.hotkeys===He&&(window.hotkeys=e),He),window.hotkeys=He}const dr="not-annotatable",Bt=`.${dr}`,on=(e,t)=>{var n;return e.contains(t)?!!(t instanceof HTMLElement?t.closest(Bt):(n=t.parentElement)!=null&&n.closest(Bt)):!0},mu=(e,t)=>{const n=t.commonAncestorContainer;return!on(e,n)},gu=e=>e.addEventListener("click",t=>{!t.target.closest(Bt)&&!t.target.closest("a")&&t.preventDefault()}),Po=e=>({...e,type:e.type,x:e.x,y:e.y,clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY,screenX:e.screenX,screenY:e.screenY,isPrimary:e.isPrimary,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,button:e.button,buttons:e.buttons,currentTarget:e.currentTarget,target:e.target,defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,pointerId:e.pointerId,pointerType:e.pointerType,timeStamp:e.timeStamp}),Ln=e=>({...e,type:e.type,key:e.key,code:e.code,location:e.location,repeat:e.repeat,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,currentTarget:e.currentTarget,target:e.target,defaultPrevented:e.defaultPrevented,detail:e.detail,timeStamp:e.timeStamp}),yu=typeof navigator<"u"&&/mac/i.test(navigator.userAgentData?navigator.userAgentData.platform:navigator.platform),vu=e=>{!e.hasAttribute("tabindex")&&e.tabIndex<0&&e.setAttribute("tabindex","-1"),e.classList.add("no-focus-outline")},Hn=(e,t=10)=>{let n;return((...o)=>{clearTimeout(n),n=setTimeout(()=>e.apply(void 0,o),t)})},bu=function*(e){const t=document.createNodeIterator(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,o=>o instanceof HTMLElement&&o.classList.contains(dr)&&!o.parentElement.closest(Bt)&&e.intersectsNode(o)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP);let n;for(;n=t.nextNode();)n instanceof HTMLElement&&(yield n)},wu=(e,t)=>{if(!mu(e,t))return[];const n=[];let o=null;for(const r of bu(t)){let i;o?(i=document.createRange(),i.setStartAfter(o),i.setEndBefore(r)):(i=t.cloneRange(),i.setEndBefore(r)),i.collapsed||n.push(i),o=r}if(o){const r=t.cloneRange();r.setStartAfter(o),r.collapsed||n.push(r)}return n.length>0?n:[t]},xu=e=>{const t=e.cloneContents();return t.querySelectorAll(Bt).forEach(n=>n.remove()),t},st=e=>e.every(t=>t.range instanceof Range&&!t.range.collapsed),Eu=/^\s*$/,Au=e=>Eu.test(e.toString()),Su=(e,t)=>{const n=i=>Math.round(i*10)/10,o={top:n(e.top),bottom:n(e.bottom),left:n(e.left),right:n(e.right)},r={top:n(t.top),bottom:n(t.bottom),left:n(t.left),right:n(t.right)};if(Math.abs(o.top-r.top)<.5&&Math.abs(o.bottom-r.bottom)<.5){if(Math.abs(o.left-r.right)<.5||Math.abs(o.right-r.left)<.5)return"inline-adjacent";if(o.left>=r.left&&o.right<=r.right)return"inline-is-contained";if(o.left<=r.left&&o.right>=r.right)return"inline-contains"}else if(o.top<=r.top&&o.bottom>=r.bottom){if(o.left<=r.left&&o.right>=r.right)return"block-contains"}else if(o.top>=r.top&&o.bottom<=r.bottom&&o.left>=r.left&&o.right<=r.right)return"block-is-contained"},$u=(e,t)=>{const n=Math.min(e.left,t.left),o=Math.max(e.right,t.right),r=Math.min(e.top,t.top),i=Math.max(e.bottom,t.bottom);return new DOMRect(n,r,o-n,i-r)},Ru=e=>e.reduce((t,n)=>{if(n.width===0||n.height===0)return t;let o=[...t],r=!1;for(const i of t){const s=Su(n,i);if(s==="inline-adjacent"){o=o.map(a=>a===i?$u(n,i):a),r=!0;break}else if(s==="inline-contains"){o=o.map(a=>a===i?n:a),r=!0;break}else if(s==="inline-is-contained"){r=!0;break}else if(s==="block-contains"||s==="block-is-contained"){n.width<i.width&&(o=o.map(a=>a===i?n:a)),r=!0;break}}return r?o:[...o,n]},[]),Tu=e=>({length:e.length,item:t=>e[t],[Symbol.iterator]:function*(){for(let t=0;t<this.length;t++)yield this.item(t)}}),Cu=(e,t,n)=>{const o=document.createRange(),r=n?e.startContainer.parentElement.closest(n):t;o.setStart(r,0),o.setEnd(e.startContainer,e.startOffset);const i=xu(o).textContent,s=e.toString(),a=i.length||0,c=a+s.length;return n?{quote:s,start:a,end:c,range:e,offsetReference:r}:{quote:s,start:a,end:c,range:e}},Is=(e,t)=>{var n,o;const{start:r,end:i}=e,s=e.offsetReference||t,a=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,f=>{var h;return(h=f.parentElement)!=null&&h.closest(Bt)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT});let c=0;const l=document.createRange();let u=a.nextNode();u===null&&console.error("Could not revive annotation target. Content missing.");let d=!s;for(;u!==null;){if(d||(d=typeof(s==null?void 0:s.contains)=="function"?s.contains(u):!1),d){const f=((n=u.textContent)==null?void 0:n.length)||0;if(c+f>r){l.setStart(u,r-c);break}c+=f}u=a.nextNode()}for(;u!==null;){const f=((o=u.textContent)==null?void 0:o.length)||0;if(c+f>=i){l.setEnd(u,i-c);break}c+=f,u=a.nextNode()}return{...e,range:l}},Un=(e,t)=>st(e.selector)?e:{...e,selector:e.selector.map(n=>n.range instanceof Range&&!n.range.collapsed?n:Is(n,t))},No=(e,t)=>st(e.target.selector)?e:{...e,target:Un(e.target,t)},Ou=(e,t)=>{const n=e.cloneRange();return t.contains(n.startContainer)||n.setStart(t,0),t.contains(n.endContainer)||n.setEnd(t,t.childNodes.length),n},Ds=e=>{if(e===null)return document.scrollingElement;const{overflowY:t}=window.getComputedStyle(e);return t!=="visible"&&t!=="hidden"&&e.scrollHeight>e.clientHeight?e:Ds(e.parentElement)},Lu=(e,t)=>n=>{const o=typeof n=="string"?n:n.id,r=u=>{const d=i.getBoundingClientRect(),f=i.clientHeight,h=i.clientWidth,g=u.selector[0].range.getBoundingClientRect(),{width:p,height:x}=t.getAnnotationBounds(o),v=g.top-d.top,m=g.left-d.left,y=i.parentElement?i.scrollTop:0,S=i.parentElement?i.scrollLeft:0,$=v+y-(f-x)/2,I=m+S-(h-p)/2;i.scroll({top:$,left:I,behavior:"smooth"})},i=Ds(e);if(!i)return console.warn(`The scroll parent is missing for the annotation: ${o}`,{container:e}),!1;const s=t.getAnnotation(o);if(!s)return console.warn(`The annotation is missing in the store: ${o}`),!1;const{range:a}=s.target.selector[0];if(a&&!a.collapsed)return r(s.target),!0;const c=Un(s.target,e),{range:l}=c.selector[0];return l&&!l.collapsed?(r(c),!0):!1},gt={fill:"rgb(0, 128, 255)",fillOpacity:.18},Vn={fill:"rgb(0, 128, 255)",fillOpacity:.45},ku=(e,t,n,o,r)=>{var i,s;const a=n?typeof n=="function"?n(e.annotation,e.state,r)||((i=e.state)!=null&&i.selected?Vn:gt):n:(s=e.state)!=null&&s.selected?Vn:gt;return o&&o.paint(e,t)||a},Mu=e=>{const{top:t,left:n}=e.getBoundingClientRect(),{innerWidth:o,innerHeight:r}=window,i=-n,s=-t,a=o-n,c=r-t;return{top:t,left:n,minX:i,minY:s,maxX:a,maxY:c}},_u=e=>{let t=new Set;return n=>{const o=n.map(r=>r.id);(t.size!==o.length||o.some(r=>!t.has(r)))&&e.set(o),t=new Set(o)}},fr=(e,t,n,o)=>{const{store:r,selection:i,hover:s}=t;let a,c,l;const u=_u(n),d=C=>{const{x:N,y:H}=e.getBoundingClientRect(),j=r.getAt(C.clientX-N,C.clientY-H,!1,c);j?s.current!==j.id&&(e.classList.add("hovered"),s.set(j.id)):s.current&&(e.classList.remove("hovered"),s.set(null))};e.addEventListener("pointermove",d);const f=(C=!1)=>{l&&l.clear();const N=Mu(e),{minX:H,minY:j,maxX:T,maxY:R}=N,E=c?r.getIntersecting(H,j,T,R).filter(({annotation:k})=>c(k)):r.getIntersecting(H,j,T,R),A=i.selected.map(({id:k})=>k),M=E.map(({annotation:k,rects:O})=>{const U=A.includes(k.id),w=k.id===s.current;return{annotation:k,rects:O,state:{selected:U,hovered:w}}});o.redraw(M,N,a,l,C),setTimeout(()=>u(E.map(({annotation:k})=>k)),1)},h=C=>{l=C,f()},g=C=>{a=C,f()},p=C=>{c=C,f(!1)},x=()=>f();r.observe(x);const v=i.subscribe(()=>f()),m=s.subscribe(()=>f()),y=()=>f(!0);document.addEventListener("scroll",y,{capture:!0,passive:!0});const S=Hn(()=>{r.recalculatePositions(),l&&l.reset(),f()});window.addEventListener("resize",S);const $=new ResizeObserver(S);$.observe(e);const I={attributes:!0,childList:!0,subtree:!0},_=new MutationObserver(Hn(C=>{C.every(N=>N.target===e||e.contains(N.target))||f(!0)},150));return _.observe(document.body,I),{destroy:()=>{e.removeEventListener("pointermove",d),o.destroy(),r.unobserve(x),v(),m(),document.removeEventListener("scroll",y),window.removeEventListener("resize",S),$.disconnect(),_.disconnect()},redraw:f,setStyle:g,setFilter:p,setPainter:h,setVisible:o.setVisible}},Pu=()=>{const e=document.createElement("canvas");return e.width=window.innerWidth,e.height=window.innerHeight,e.className="r6o-canvas-highlight-layer bg",e},Nu=(e,t)=>{e.width=window.innerWidth,e.height=window.innerHeight},Iu=e=>{e.classList.add("r6o-annotatable");const t=Pu(),n=t.getContext("2d");document.body.appendChild(t);const o=(i,s,a,c)=>requestAnimationFrame(()=>{const{width:l,height:u}=t;n.clearRect(-.5,-.5,l+1,u+1),c&&c.clear();const{top:d,left:f}=s;[...i].sort((h,g)=>{const{annotation:{target:{created:p}}}=h,{annotation:{target:{created:x}}}=g;return p.getTime()-x.getTime()}).forEach(h=>{var g;const p=a?typeof a=="function"?a(h.annotation,h.state):a:(g=h.state)!=null&&g.selected?Vn:gt,x=c&&c.paint(h,s)||p,v=h.rects.map(({x:m,y,width:S,height:$})=>({x:m+f,y:y+d,width:S,height:$}));if(n.fillStyle=x.fill,n.globalAlpha=x.fillOpacity||1,v.forEach(({x:m,y,width:S,height:$})=>n.fillRect(m,y,S,$)),x.underlineColor){n.globalAlpha=1,n.strokeStyle=x.underlineColor,n.lineWidth=x.underlineThickness??1;const m=x.underlineOffset??0;v.forEach(({x:y,y:S,width:$,height:I})=>{n.beginPath(),n.moveTo(y,S+I+m),n.lineTo(y+$,S+I+m),n.stroke()})}})}),r=Hn(()=>{Nu(t)});return window.addEventListener("resize",r),{destroy:()=>{t.remove(),window.removeEventListener("resize",r)},setVisible:i=>{console.log("setVisible not implemented on Canvas renderer")},redraw:o}},Du=(e,t,n)=>fr(e,t,n,Iu(e)),Bu=e=>[`background-color:${Fe((e==null?void 0:e.fill)||gt.fill).alpha((e==null?void 0:e.fillOpacity)===void 0?gt.fillOpacity:e.fillOpacity).toHex()}`,e!=null&&e.underlineThickness?"text-decoration:underline":void 0,e!=null&&e.underlineColor?`text-decoration-color:${e.underlineColor}`:void 0,e!=null&&e.underlineOffset?`text-underline-offset:${e.underlineOffset}px`:void 0,e!=null&&e.underlineThickness?`text-decoration-thickness:${e.underlineThickness}px`:void 0].filter(Boolean).join(";"),ju=()=>{const e=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(e);let t=new Set;return{destroy:()=>{CSS.highlights.clear(),e.remove()},setVisible:n=>{console.log("setVisible not implemented on CSS Custom Highlights renderer")},redraw:(n,o,r,i)=>{i&&i.clear();const s=new Set(n.map(c=>c.annotation.id));Array.from(t).filter(c=>!s.has(c));const a=n.map(c=>{var l;const u=r?typeof r=="function"?r(c.annotation,c.state):r:(l=c.state)!=null&&l.selected?Vn:gt,d=i&&i.paint(c,o)||u;return`::highlight(_${c.annotation.id}) { ${Bu(d)} }`});e.innerHTML=a.join(`
`),CSS.highlights.clear(),n.forEach(({annotation:c})=>{const l=c.target.selector.map(d=>d.range),u=new Highlight(...l);CSS.highlights.set(`_${c.id}`,u)}),t=s}}},Hu=(e,t,n)=>fr(e,t,n,ju()),Uu=(e,t)=>{const n=(i,s)=>i.x<=s.x+s.width&&i.x+i.width>=s.x&&i.y<=s.y+s.height&&i.y+i.height>=s.y,o=i=>i.rects.reduce((s,a)=>s+a.width,0),r=t.filter(({rects:i})=>i.some(s=>n(e,s)));return r.sort((i,s)=>o(s)-o(i)),r.findIndex(i=>i.rects.includes(e))},Vu=e=>{e.classList.add("r6o-annotatable");const t=document.createElement("div");t.className="r6o-span-highlight-layer",e.insertBefore(t,e.firstChild);let n=[];return{destroy:()=>{t.remove()},redraw:(o,r,i,s,a)=>{const c=!(zo(n,o)&&a);!s&&!c||(c&&(t.innerHTML=""),[...o].sort((l,u)=>{const{annotation:{target:{created:d}}}=l,{annotation:{target:{created:f}}}=u;return d&&f?d.getTime()-f.getTime():0}).forEach(l=>{l.rects.map(u=>{const d=Uu(u,o),f=ku(l,r,i,s,d);if(c){const h=document.createElement("span");h.className="r6o-annotation",h.dataset.annotation=l.annotation.id,h.style.left=`${u.x}px`,h.style.top=`${u.y}px`,h.style.width=`${u.width}px`,h.style.height=`${u.height}px`,h.style.backgroundColor=Fe((f==null?void 0:f.fill)||gt.fill).alpha((f==null?void 0:f.fillOpacity)===void 0?gt.fillOpacity:f.fillOpacity).toHex(),f.underlineStyle&&(h.style.borderStyle=f.underlineStyle),f.underlineColor&&(h.style.borderColor=f.underlineColor),f.underlineThickness&&(h.style.borderBottomWidth=`${f.underlineThickness}px`),f.underlineOffset&&(h.style.paddingBottom=`${f.underlineOffset}px`),t.appendChild(h)}})}),n=o)},setVisible:o=>{o?t.classList.remove("hidden"):t.classList.add("hidden")}}},Fu=(e,t,n)=>fr(e,t,n,Vu(e)),Xu=(e,t)=>{const n=new Zc,o=new Map,r=(g,p)=>{const x=g.selector.flatMap(m=>{const y=st([m])?m.range:Is(m,t).range;return Array.from(y.getClientRects())}),v=Ru(x).map(({left:m,top:y,right:S,bottom:$})=>new DOMRect(m-p.left,y-p.top,S-m,$-y));return v.map(m=>{const{x:y,y:S,width:$,height:I}=m;return{minX:y,minY:S,maxX:y+$,maxY:S+I,annotation:{id:g.annotation,rects:v}}})},i=()=>[...o.values()],s=()=>{n.clear(),o.clear()},a=g=>{const p=r(g,t.getBoundingClientRect());p.length!==0&&(p.forEach(x=>n.insert(x)),o.set(g.annotation,p))},c=g=>{const p=o.get(g.annotation);p&&(p.forEach(x=>n.remove(x)),o.delete(g.annotation))},l=g=>{c(g),a(g)},u=(g,p=!0)=>{p&&s();const x=t.getBoundingClientRect(),v=g.map(y=>({target:y,rects:r(y,x)}));v.forEach(({target:y,rects:S})=>{S.length>0&&o.set(y.annotation,S)});const m=v.flatMap(({rects:y})=>y);n.load(m)},d=(g,p,x=!1)=>{const v=n.search({minX:g,minY:p,maxX:g,maxY:p}),m=y=>y.annotation.rects.reduce((S,$)=>S+$.width*$.height,0);return v.length>0?(v.sort((y,S)=>m(y)-m(S)),x?v.map(y=>y.annotation.id):[v[0].annotation.id]):[]},f=g=>{const p=h(g);if(p.length===0)return;let x=p[0].left,v=p[0].top,m=p[0].right,y=p[0].bottom;for(let S=1;S<p.length;S++){const $=p[S];x=Math.min(x,$.left),v=Math.min(v,$.top),m=Math.max(m,$.right),y=Math.max(y,$.bottom)}return new DOMRect(x,v,m-x,y-v)},h=g=>{const p=o.get(g);return p?p[0].annotation.rects:[]};return{all:i,clear:s,getAt:d,getAnnotationBounds:f,getAnnotationRects:h,getIntersecting:(g,p,x,v)=>{const m=n.search({minX:g,minY:p,maxX:x,maxY:v}),y=new Set(m.map(S=>S.annotation.id));return Array.from(y).map(S=>({annotation:e.getAnnotation(S),rects:h(S)})).filter(S=>!!S.annotation)},insert:a,recalculate:()=>u(e.all().map(g=>g.target),!0),remove:c,set:u,size:()=>n.all().length,update:l}},Ku=(e,t)=>{const n=Hl(),o=Xu(n,e),r=Tl(n,t.userSelectAction,t.adapter),i=Rl(n),s=Xl(),a=(v,m=te.LOCAL)=>{const y=No(v,e),S=st(y.target.selector);return S&&n.addAnnotation(y,m),S},c=(v,m=!0,y=te.LOCAL)=>{const S=v.map(I=>No(I,e)),$=S.filter(I=>!st(I.target.selector));return n.bulkAddAnnotations(S,m,y),$},l=(v,m=te.LOCAL)=>{const y=v.map($=>No($,e)),S=y.filter($=>!st($.target.selector));return y.forEach($=>{n.getAnnotation($.id)?n.updateAnnotation($,m):n.addAnnotation($,m)}),S},u=(v,m=te.LOCAL)=>{const y=Un(v,e);n.updateTarget(y,m)},d=(v,m=te.LOCAL)=>{const y=v.map(S=>Un(S,e));n.bulkUpdateTargets(y,m)};function f(v,m,y,S){const $=y||!!S,I=o.getAt(v,m,$).map(C=>n.getAnnotation(C)),_=S?I.filter(S):I;if(_.length!==0)return y?_:_[0]}const h=v=>{if(o.getAnnotationRects(v).length!==0)return o.getAnnotationBounds(v)},g=(v,m,y,S)=>o.getIntersecting(v,m,y,S),p=v=>o.getAnnotationRects(v),x=()=>o.recalculate();return n.observe(({changes:v})=>{const m=(v.deleted||[]).filter($=>st($.target.selector)),y=(v.created||[]).filter($=>st($.target.selector)),S=(v.updated||[]).filter($=>st($.newValue.target.selector));(m==null?void 0:m.length)>0&&m.forEach($=>o.remove($.target)),y.length>0&&o.set(y.map($=>$.target),!1),(S==null?void 0:S.length)>0&&S.forEach(({newValue:$})=>o.update($.target))}),{store:{...n,addAnnotation:a,bulkAddAnnotations:c,bulkUpdateTargets:d,bulkUpsertAnnotations:l,getAnnotationBounds:h,getAnnotationRects:p,getIntersecting:g,getAt:f,recalculatePositions:x,updateTarget:u},selection:r,hover:i,viewport:s}},qu=()=>{const e=document.createElement("canvas");e.width=2*window.innerWidth,e.height=2*window.innerHeight,e.className="r6o-presence-layer";const t=e.getContext("2d");return t.scale(2,2),t.translate(.5,.5),e},Yu=(e,t={})=>{const n=qu(),o=n.getContext("2d");document.body.appendChild(n);const r=new Map,i=s=>Array.from(r.entries()).filter(([a,c])=>c.presenceKey===s.presenceKey).map(([a,c])=>a);return e.on("selectionChange",(s,a)=>{i(s).forEach(c=>r.delete(c)),a&&a.forEach(c=>r.set(c,s))}),{clear:()=>{const{width:s,height:a}=n;o.clearRect(-.5,-.5,s+1,a+1)},destroy:()=>{n.remove()},paint:(s,a,c)=>{t.font&&(o.font=t.font);const l=r.get(s.annotation.id);if(l){const{height:u}=s.rects[0],d=s.rects[0].x+a.left,f=s.rects[0].y+a.top;o.fillStyle=l.appearance.color,o.fillRect(d-2,f-2.5,2,u+5);const h=o.measureText(l.appearance.label),g=h.width+6,p=h.actualBoundingBoxAscent+h.actualBoundingBoxDescent+8,x=h.fontBoundingBoxAscent?8:6.5;return o.fillRect(d-2,f-2.5-p,g,p),o.fillStyle="#fff",o.fillText(l.appearance.label,d+1,f-x),{fill:l.appearance.color,fillOpacity:c?.45:.18}}},reset:()=>{n.width=2*window.innerWidth,n.height=2*window.innerHeight;const s=n.getContext("2d");s.scale(2,2),s.translate(.5,.5)}}},xi=300,Bs=["up","down","left","right"],js=yu?"⌘+a":"ctrl+a",Wu=[...Bs.map(e=>`shift+${e}`),js],zu=(e,t,n)=>{let o;const{annotatingEnabled:r,offsetReferenceSelector:i,selectionMode:s}=n,a=C=>o=C;let c;const l=C=>c=C,{store:u,selection:d}=t;let f,h,g;const p=C=>{h!==!1&&(f=on(e,C.target)?void 0:{annotation:Gc(),selector:[],creator:o,created:new Date})},x=Hn(C=>{const N=document.getSelection();if(!(N!=null&&N.anchorNode))return;if(on(e,N.anchorNode)){f=void 0;return}const H=C.timeStamp-((g==null?void 0:g.timeStamp)||C.timeStamp);if((g==null?void 0:g.type)==="pointerdown"&&(H<1e3&&!f||N.isCollapsed&&H<xi)&&p(g||C),!f)return;if(N.isCollapsed){u.getAnnotation(f.annotation)&&(d.clear(),u.deleteAnnotation(f.annotation));return}const j=Array.from(Array(N.rangeCount).keys()).map(R=>N.getRangeAt(R)).map(R=>Ou(R,e));if(j.every(R=>Au(R)))return;const T=j.flatMap(R=>wu(e,R.cloneRange()));(T.length!==f.selector.length||T.some((R,E)=>{var A;return R.toString()!==((A=f.selector[E])==null?void 0:A.quote)}))&&(f={...f,selector:T.map(R=>Cu(R,e,i)),updated:new Date},u.getAnnotation(f.annotation)?u.updateTarget(f,te.LOCAL):d.clear())}),v=C=>{on(e,C.target)||(g=Po(C),h=g.button===0)},m=C=>{if(!h)return;if(on(e,C.target)){n.dismissOnClickOutside&&d.clear();return}const N=()=>{const{x:j,y:T}=e.getBoundingClientRect(),R=C.target instanceof Node&&e.contains(C.target)&&u.getAt(C.clientX-j,C.clientY-T,s==="all",c);if(R){const{selected:E}=d,A=new Set(E.map(k=>k.id)),M=Array.isArray(R)?R.map(k=>k.id):[R.id];(A.size!==M.length||!M.every(k=>A.has(k)))&&d.userSelect(M,C)}else d.clear()},H=C.timeStamp-g.timeStamp;setTimeout(()=>{const j=document.getSelection();j!=null&&j.isCollapsed&&H<xi?(f=void 0,N()):f&&f.selector.length>0&&(_(),d.userSelect(f.annotation,Po(C)))})},y=C=>{const N=document.getSelection();N!=null&&N.isCollapsed||((!f||f.selector.length===0)&&x(C),f&&(_(),d.userSelect(f.annotation,Po(C))))},S=C=>{C.key==="Shift"&&f&&(document.getSelection().isCollapsed||(_(),d.userSelect(f.annotation,Ln(C))))},$=C=>{const N=()=>setTimeout(()=>{(f==null?void 0:f.selector.length)>0&&(d.clear(),u.addAnnotation({id:f.annotation,bodies:[],target:f}),d.userSelect(f.annotation,Ln(C))),document.removeEventListener("selectionchange",N)},100);document.addEventListener("selectionchange",N),p(C)};He(Wu.join(","),{element:e,keydown:!0,keyup:!1},C=>{C.repeat||(g=Ln(C))}),He(js,{keydown:!0,keyup:!1},C=>{g=Ln(C),$(C)});const I=C=>{C.repeat||C.target!==e&&C.target!==document.body||(f=void 0,d.clear())};He(Bs.join(","),{keydown:!0,keyup:!1},I);const _=()=>{const C=u.getAnnotation(f.annotation);if(!C){u.addAnnotation({id:f.annotation,bodies:[],target:f});return}const{target:{updated:N}}=C,{updated:H}=f;(!N||!H||N<H)&&u.updateTarget(f)};return e.addEventListener("pointerdown",v),document.addEventListener("pointerup",m),document.addEventListener("contextmenu",y),r&&(e.addEventListener("keyup",S),e.addEventListener("selectstart",p),document.addEventListener("selectionchange",x)),{destroy:()=>{e.removeEventListener("pointerdown",v),document.removeEventListener("pointerup",m),document.removeEventListener("contextmenu",y),e.removeEventListener("keyup",S),e.removeEventListener("selectstart",p),document.removeEventListener("selectionchange",x),He.unbind()},setFilter:l,setUser:a}},Gu=(e,t)=>({...e,annotatingEnabled:e.annotatingEnabled??t.annotatingEnabled,user:e.user||t.user}),Ei="SPANS",Ju=(e,t={})=>{gu(e),vu(e);const n=Gu(t,{annotatingEnabled:!0,user:Ql()}),o=Ku(e,n),{selection:r,viewport:i}=o,s=o.store,a=Fl(s),c=Kl(o,a,n.adapter);let l=n.user;const u=n.renderer==="CSS_HIGHLIGHTS"?CSS.highlights?"CSS_HIGHLIGHTS":Ei:n.renderer||Ei,d=u==="SPANS"?Fu(e,o,i):u==="CSS_HIGHLIGHTS"?Hu(e,o,i):u==="CANVAS"?Du(e,o,i):void 0;if(!d)throw`Unknown renderer implementation: ${u}`;console.debug(`Using ${u} renderer`),n.style&&d.setStyle(n.style);const f=zu(e,o,n);return f.setUser(l),{...Yl(o,a,n.adapter),destroy:()=>{d.destroy(),f.destroy(),a.destroy()},element:e,getUser:()=>l,setFilter:h=>{d.setFilter(h),f.setFilter(h)},setStyle:h=>d.setStyle(h),setUser:h=>{l=h,f.setUser(h)},setSelected:h=>{h?r.setSelected(h):r.clear()},setPresenceProvider:h=>{h&&(d.setPainter(Yu(h,n.presence)),h.on("selectionChange",()=>d.redraw()))},setVisible:h=>d.setVisible(h),on:c.on,off:c.off,scrollIntoView:Lu(e,s),state:o}};function Zn(){return typeof window<"u"}function yt(e){return pr(e)?(e.nodeName||"").toLowerCase():"#document"}function Ne(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function nt(e){var t;return(t=(pr(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function pr(e){return Zn()?e instanceof Node||e instanceof Ne(e).Node:!1}function me(e){return Zn()?e instanceof Element||e instanceof Ne(e).Element:!1}function Se(e){return Zn()?e instanceof HTMLElement||e instanceof Ne(e).HTMLElement:!1}function Go(e){return!Zn()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Ne(e).ShadowRoot}const Zu=new Set(["inline","contents"]);function xn(e){const{overflow:t,overflowX:n,overflowY:o,display:r}=Ie(e);return/auto|scroll|overlay|hidden|clip/.test(t+o+n)&&!Zu.has(r)}const Qu=new Set(["table","td","th"]);function ed(e){return Qu.has(yt(e))}const td=[":popover-open",":modal"];function Qn(e){return td.some(t=>{try{return e.matches(t)}catch{return!1}})}const nd=["transform","translate","scale","rotate","perspective"],od=["transform","translate","scale","rotate","perspective","filter"],rd=["paint","layout","strict","content"];function hr(e){const t=eo(),n=me(e)?Ie(e):e;return nd.some(o=>n[o]?n[o]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||od.some(o=>(n.willChange||"").includes(o))||rd.some(o=>(n.contain||"").includes(o))}function id(e){let t=lt(e);for(;Se(t)&&!at(t);){if(hr(t))return t;if(Qn(t))return null;t=lt(t)}return null}function eo(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const sd=new Set(["html","body","#document"]);function at(e){return sd.has(yt(e))}function Ie(e){return Ne(e).getComputedStyle(e)}function to(e){return me(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function lt(e){if(yt(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Go(e)&&e.host||nt(e);return Go(t)?t.host:t}function Hs(e){const t=lt(e);return at(t)?e.ownerDocument?e.ownerDocument.body:e.body:Se(t)&&xn(t)?t:Hs(t)}function ht(e,t,n){var o;t===void 0&&(t=[]),n===void 0&&(n=!0);const r=Hs(e),i=r===((o=e.ownerDocument)==null?void 0:o.body),s=Ne(r);if(i){const a=Jo(s);return t.concat(s,s.visualViewport||[],xn(r)?r:[],a&&n?ht(a):[])}return t.concat(r,ht(r,[],n))}function Jo(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}const ad=["top","right","bottom","left"],ze=Math.min,Re=Math.max,Fn=Math.round,kn=Math.floor,et=e=>({x:e,y:e}),ld={left:"right",right:"left",bottom:"top",top:"bottom"},cd={start:"end",end:"start"};function Zo(e,t,n){return Re(e,ze(t,n))}function tt(e,t){return typeof e=="function"?e(t):e}function Ge(e){return e.split("-")[0]}function Yt(e){return e.split("-")[1]}function mr(e){return e==="x"?"y":"x"}function gr(e){return e==="y"?"height":"width"}const ud=new Set(["top","bottom"]);function qe(e){return ud.has(Ge(e))?"y":"x"}function yr(e){return mr(qe(e))}function dd(e,t,n){n===void 0&&(n=!1);const o=Yt(e),r=yr(e),i=gr(r);let s=r==="x"?o===(n?"end":"start")?"right":"left":o==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(s=Xn(s)),[s,Xn(s)]}function fd(e){const t=Xn(e);return[Qo(e),t,Qo(t)]}function Qo(e){return e.replace(/start|end/g,t=>cd[t])}const Ai=["left","right"],Si=["right","left"],pd=["top","bottom"],hd=["bottom","top"];function md(e,t,n){switch(e){case"top":case"bottom":return n?t?Si:Ai:t?Ai:Si;case"left":case"right":return t?pd:hd;default:return[]}}function gd(e,t,n,o){const r=Yt(e);let i=md(Ge(e),n==="start",o);return r&&(i=i.map(s=>s+"-"+r),t&&(i=i.concat(i.map(Qo)))),i}function Xn(e){return e.replace(/left|right|bottom|top/g,t=>ld[t])}function yd(e){return{top:0,right:0,bottom:0,left:0,...e}}function vr(e){return typeof e!="number"?yd(e):{top:e,right:e,bottom:e,left:e}}function jt(e){const{x:t,y:n,width:o,height:r}=e;return{width:o,height:r,top:n,left:t,right:t+o,bottom:n+r,x:t,y:n}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var vd=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],Kn=vd.join(","),Us=typeof Element>"u",Ht=Us?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,qn=!Us&&Element.prototype.getRootNode?function(e){var t;return e==null||(t=e.getRootNode)===null||t===void 0?void 0:t.call(e)}:function(e){return e==null?void 0:e.ownerDocument},Yn=function e(t,n){var o;n===void 0&&(n=!0);var r=t==null||(o=t.getAttribute)===null||o===void 0?void 0:o.call(t,"inert"),i=r===""||r==="true",s=i||n&&t&&e(t.parentNode);return s},bd=function(t){var n,o=t==null||(n=t.getAttribute)===null||n===void 0?void 0:n.call(t,"contenteditable");return o===""||o==="true"},Vs=function(t,n,o){if(Yn(t))return[];var r=Array.prototype.slice.apply(t.querySelectorAll(Kn));return n&&Ht.call(t,Kn)&&r.unshift(t),r=r.filter(o),r},Fs=function e(t,n,o){for(var r=[],i=Array.from(t);i.length;){var s=i.shift();if(!Yn(s,!1))if(s.tagName==="SLOT"){var a=s.assignedElements(),c=a.length?a:s.children,l=e(c,!0,o);o.flatten?r.push.apply(r,l):r.push({scopeParent:s,candidates:l})}else{var u=Ht.call(s,Kn);u&&o.filter(s)&&(n||!t.includes(s))&&r.push(s);var d=s.shadowRoot||typeof o.getShadowRoot=="function"&&o.getShadowRoot(s),f=!Yn(d,!1)&&(!o.shadowRootFilter||o.shadowRootFilter(s));if(d&&f){var h=e(d===!0?s.children:d.children,!0,o);o.flatten?r.push.apply(r,h):r.push({scopeParent:s,candidates:h})}else i.unshift.apply(i,s.children)}}return r},Xs=function(t){return!isNaN(parseInt(t.getAttribute("tabindex"),10))},Ks=function(t){if(!t)throw new Error("No node provided");return t.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||bd(t))&&!Xs(t)?0:t.tabIndex},wd=function(t,n){var o=Ks(t);return o<0&&n&&!Xs(t)?0:o},xd=function(t,n){return t.tabIndex===n.tabIndex?t.documentOrder-n.documentOrder:t.tabIndex-n.tabIndex},qs=function(t){return t.tagName==="INPUT"},Ed=function(t){return qs(t)&&t.type==="hidden"},Ad=function(t){var n=t.tagName==="DETAILS"&&Array.prototype.slice.apply(t.children).some(function(o){return o.tagName==="SUMMARY"});return n},Sd=function(t,n){for(var o=0;o<t.length;o++)if(t[o].checked&&t[o].form===n)return t[o]},$d=function(t){if(!t.name)return!0;var n=t.form||qn(t),o=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},r;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")r=o(window.CSS.escape(t.name));else try{r=o(t.name)}catch(s){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",s.message),!1}var i=Sd(r,t.form);return!i||i===t},Rd=function(t){return qs(t)&&t.type==="radio"},Td=function(t){return Rd(t)&&!$d(t)},Cd=function(t){var n,o=t&&qn(t),r=(n=o)===null||n===void 0?void 0:n.host,i=!1;if(o&&o!==t){var s,a,c;for(i=!!((s=r)!==null&&s!==void 0&&(a=s.ownerDocument)!==null&&a!==void 0&&a.contains(r)||t!=null&&(c=t.ownerDocument)!==null&&c!==void 0&&c.contains(t));!i&&r;){var l,u,d;o=qn(r),r=(l=o)===null||l===void 0?void 0:l.host,i=!!((u=r)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(r))}}return i},$i=function(t){var n=t.getBoundingClientRect(),o=n.width,r=n.height;return o===0&&r===0},Od=function(t,n){var o=n.displayCheck,r=n.getShadowRoot;if(getComputedStyle(t).visibility==="hidden")return!0;var i=Ht.call(t,"details>summary:first-of-type"),s=i?t.parentElement:t;if(Ht.call(s,"details:not([open]) *"))return!0;if(!o||o==="full"||o==="legacy-full"){if(typeof r=="function"){for(var a=t;t;){var c=t.parentElement,l=qn(t);if(c&&!c.shadowRoot&&r(c)===!0)return $i(t);t.assignedSlot?t=t.assignedSlot:!c&&l!==t.ownerDocument?t=l.host:t=c}t=a}if(Cd(t))return!t.getClientRects().length;if(o!=="legacy-full")return!0}else if(o==="non-zero-area")return $i(t);return!1},Ld=function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var n=t.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var o=0;o<n.children.length;o++){var r=n.children.item(o);if(r.tagName==="LEGEND")return Ht.call(n,"fieldset[disabled] *")?!0:!r.contains(t)}return!0}n=n.parentElement}return!1},er=function(t,n){return!(n.disabled||Yn(n)||Ed(n)||Od(n,t)||Ad(n)||Ld(n))},tr=function(t,n){return!(Td(n)||Ks(n)<0||!er(t,n))},kd=function(t){var n=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},Md=function e(t){var n=[],o=[];return t.forEach(function(r,i){var s=!!r.scopeParent,a=s?r.scopeParent:r,c=wd(a,s),l=s?e(r.candidates):a;c===0?s?n.push.apply(n,l):n.push(a):o.push({documentOrder:i,tabIndex:c,item:r,isScope:s,content:l})}),o.sort(xd).reduce(function(r,i){return i.isScope?r.push.apply(r,i.content):r.push(i.content),r},[]).concat(n)},no=function(t,n){n=n||{};var o;return n.getShadowRoot?o=Fs([t],n.includeContainer,{filter:tr.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:kd}):o=Vs(t,n.includeContainer,tr.bind(null,n)),Md(o)},_d=function(t,n){n=n||{};var o;return n.getShadowRoot?o=Fs([t],n.includeContainer,{filter:er.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):o=Vs(t,n.includeContainer,er.bind(null,n)),o},Ys=function(t,n){if(n=n||{},!t)throw new Error("No node provided");return Ht.call(t,Kn)===!1?!1:tr(n,t)};function Pd(){const e=navigator.userAgentData;return e!=null&&e.platform?e.platform:navigator.platform}function Ws(){const e=navigator.userAgentData;return e&&Array.isArray(e.brands)?e.brands.map(t=>{let{brand:n,version:o}=t;return n+"/"+o}).join(" "):navigator.userAgent}function Nd(){return/apple/i.test(navigator.vendor)}function nr(){const e=/android/i;return e.test(Pd())||e.test(Ws())}function Id(){return Ws().includes("jsdom/")}const Ri="data-floating-ui-focusable",Dd="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function Lt(e){let t=e.activeElement;for(;((n=t)==null||(n=n.shadowRoot)==null?void 0:n.activeElement)!=null;){var n;t=t.shadowRoot.activeElement}return t}function _e(e,t){if(!e||!t)return!1;const n=t.getRootNode==null?void 0:t.getRootNode();if(e.contains(t))return!0;if(n&&Go(n)){let o=t;for(;o;){if(e===o)return!0;o=o.parentNode||o.host}}return!1}function ct(e){return"composedPath"in e?e.composedPath()[0]:e.target}function Io(e,t){if(t==null)return!1;if("composedPath"in e)return e.composedPath().includes(t);const n=e;return n.target!=null&&t.contains(n.target)}function Bd(e){return e.matches("html,body")}function Xe(e){return(e==null?void 0:e.ownerDocument)||document}function jd(e){return Se(e)&&e.matches(Dd)}function Ti(e){return e?e.getAttribute("role")==="combobox"&&jd(e):!1}function or(e){return e?e.hasAttribute(Ri)?e:e.querySelector("["+Ri+"]")||e:null}function _t(e,t,n){return n===void 0&&(n=!0),e.filter(r=>{var i;return r.parentId===t&&(!n||((i=r.context)==null?void 0:i.open))}).flatMap(r=>[r,..._t(e,r.id,n)])}function Ci(e,t){var n;let o=[],r=(n=e.find(i=>i.id===t))==null?void 0:n.parentId;for(;r;){const i=e.find(s=>s.id===r);r=i==null?void 0:i.parentId,i&&(o=o.concat(i))}return o}function Do(e){e.preventDefault(),e.stopPropagation()}function Hd(e){return"nativeEvent"in e}function Ud(e){return e.mozInputSource===0&&e.isTrusted?!0:nr()&&e.pointerType?e.type==="click"&&e.buttons===1:e.detail===0&&!e.pointerType}function Vd(e){return Id()?!1:!nr()&&e.width===0&&e.height===0||nr()&&e.width===1&&e.height===1&&e.pressure===0&&e.detail===0&&e.pointerType==="mouse"||e.width<1&&e.height<1&&e.pressure===0&&e.detail===0&&e.pointerType==="touch"}var Fd=typeof document<"u",Xd=function(){},Pe=Fd?P.useLayoutEffect:Xd;const Kd={...es};function Bo(e){const t=P.useRef(e);return Pe(()=>{t.current=e}),t}const qd=Kd.useInsertionEffect,Yd=qd||(e=>e());function Ze(e){const t=P.useRef(()=>{});return Yd(()=>{t.current=e}),P.useCallback(function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return t.current==null?void 0:t.current(...o)},[])}const En=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function zs(e,t){const n=no(e,En()),o=n.length;if(o===0)return;const r=Lt(Xe(e)),i=n.indexOf(r),s=i===-1?t===1?0:o-1:i+t;return n[s]}function Gs(e){return zs(Xe(e).body,1)||e}function Js(e){return zs(Xe(e).body,-1)||e}function un(e,t){const n=t||e.currentTarget,o=e.relatedTarget;return!o||!_e(n,o)}function Wd(e){no(e,En()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function Oi(e){e.querySelectorAll("[data-tabindex]").forEach(n=>{const o=n.dataset.tabindex;delete n.dataset.tabindex,o?n.setAttribute("tabindex",o):n.removeAttribute("tabindex")})}function Li(e,t,n){let{reference:o,floating:r}=e;const i=qe(t),s=yr(t),a=gr(s),c=Ge(t),l=i==="y",u=o.x+o.width/2-r.width/2,d=o.y+o.height/2-r.height/2,f=o[a]/2-r[a]/2;let h;switch(c){case"top":h={x:u,y:o.y-r.height};break;case"bottom":h={x:u,y:o.y+o.height};break;case"right":h={x:o.x+o.width,y:d};break;case"left":h={x:o.x-r.width,y:d};break;default:h={x:o.x,y:o.y}}switch(Yt(t)){case"start":h[s]-=f*(n&&l?-1:1);break;case"end":h[s]+=f*(n&&l?-1:1);break}return h}const zd=async(e,t,n)=>{const{placement:o="bottom",strategy:r="absolute",middleware:i=[],platform:s}=n,a=i.filter(Boolean),c=await(s.isRTL==null?void 0:s.isRTL(t));let l=await s.getElementRects({reference:e,floating:t,strategy:r}),{x:u,y:d}=Li(l,o,c),f=o,h={},g=0;for(let p=0;p<a.length;p++){const{name:x,fn:v}=a[p],{x:m,y,data:S,reset:$}=await v({x:u,y:d,initialPlacement:o,placement:f,strategy:r,middlewareData:h,rects:l,platform:s,elements:{reference:e,floating:t}});u=m??u,d=y??d,h={...h,[x]:{...h[x],...S}},$&&g<=50&&(g++,typeof $=="object"&&($.placement&&(f=$.placement),$.rects&&(l=$.rects===!0?await s.getElementRects({reference:e,floating:t,strategy:r}):$.rects),{x:u,y:d}=Li(l,f,c)),p=-1)}return{x:u,y:d,placement:f,strategy:r,middlewareData:h}};async function vn(e,t){var n;t===void 0&&(t={});const{x:o,y:r,platform:i,rects:s,elements:a,strategy:c}=e,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:h=0}=tt(t,e),g=vr(h),x=a[f?d==="floating"?"reference":"floating":d],v=jt(await i.getClippingRect({element:(n=await(i.isElement==null?void 0:i.isElement(x)))==null||n?x:x.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),m=d==="floating"?{x:o,y:r,width:s.floating.width,height:s.floating.height}:s.reference,y=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),S=await(i.isElement==null?void 0:i.isElement(y))?await(i.getScale==null?void 0:i.getScale(y))||{x:1,y:1}:{x:1,y:1},$=jt(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:m,offsetParent:y,strategy:c}):m);return{top:(v.top-$.top+g.top)/S.y,bottom:($.bottom-v.bottom+g.bottom)/S.y,left:(v.left-$.left+g.left)/S.x,right:($.right-v.right+g.right)/S.x}}const Gd=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:o,placement:r,rects:i,platform:s,elements:a,middlewareData:c}=t,{element:l,padding:u=0}=tt(e,t)||{};if(l==null)return{};const d=vr(u),f={x:n,y:o},h=yr(r),g=gr(h),p=await s.getDimensions(l),x=h==="y",v=x?"top":"left",m=x?"bottom":"right",y=x?"clientHeight":"clientWidth",S=i.reference[g]+i.reference[h]-f[h]-i.floating[g],$=f[h]-i.reference[h],I=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l));let _=I?I[y]:0;(!_||!await(s.isElement==null?void 0:s.isElement(I)))&&(_=a.floating[y]||i.floating[g]);const C=S/2-$/2,N=_/2-p[g]/2-1,H=ze(d[v],N),j=ze(d[m],N),T=H,R=_-p[g]-j,E=_/2-p[g]/2+C,A=Zo(T,E,R),M=!c.arrow&&Yt(r)!=null&&E!==A&&i.reference[g]/2-(E<T?H:j)-p[g]/2<0,k=M?E<T?E-T:E-R:0;return{[h]:f[h]+k,data:{[h]:A,centerOffset:E-A-k,...M&&{alignmentOffset:k}},reset:M}}}),Jd=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,o;const{placement:r,middlewareData:i,rects:s,initialPlacement:a,platform:c,elements:l}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:p=!0,...x}=tt(e,t);if((n=i.arrow)!=null&&n.alignmentOffset)return{};const v=Ge(r),m=qe(a),y=Ge(a)===a,S=await(c.isRTL==null?void 0:c.isRTL(l.floating)),$=f||(y||!p?[Xn(a)]:fd(a)),I=g!=="none";!f&&I&&$.push(...gd(a,p,g,S));const _=[a,...$],C=await vn(t,x),N=[];let H=((o=i.flip)==null?void 0:o.overflows)||[];if(u&&N.push(C[v]),d){const E=dd(r,s,S);N.push(C[E[0]],C[E[1]])}if(H=[...H,{placement:r,overflows:N}],!N.every(E=>E<=0)){var j,T;const E=(((j=i.flip)==null?void 0:j.index)||0)+1,A=_[E];if(A&&(!(d==="alignment"?m!==qe(A):!1)||H.every(O=>qe(O.placement)===m?O.overflows[0]>0:!0)))return{data:{index:E,overflows:H},reset:{placement:A}};let M=(T=H.filter(k=>k.overflows[0]<=0).sort((k,O)=>k.overflows[1]-O.overflows[1])[0])==null?void 0:T.placement;if(!M)switch(h){case"bestFit":{var R;const k=(R=H.filter(O=>{if(I){const U=qe(O.placement);return U===m||U==="y"}return!0}).map(O=>[O.placement,O.overflows.filter(U=>U>0).reduce((U,w)=>U+w,0)]).sort((O,U)=>O[1]-U[1])[0])==null?void 0:R[0];k&&(M=k);break}case"initialPlacement":M=a;break}if(r!==M)return{reset:{placement:M}}}return{}}}};function ki(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Mi(e){return ad.some(t=>e[t]>=0)}const Zd=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:o="referenceHidden",...r}=tt(e,t);switch(o){case"referenceHidden":{const i=await vn(t,{...r,elementContext:"reference"}),s=ki(i,n.reference);return{data:{referenceHiddenOffsets:s,referenceHidden:Mi(s)}}}case"escaped":{const i=await vn(t,{...r,altBoundary:!0}),s=ki(i,n.floating);return{data:{escapedOffsets:s,escaped:Mi(s)}}}default:return{}}}}};function Zs(e){const t=ze(...e.map(i=>i.left)),n=ze(...e.map(i=>i.top)),o=Re(...e.map(i=>i.right)),r=Re(...e.map(i=>i.bottom));return{x:t,y:n,width:o-t,height:r-n}}function Qd(e){const t=e.slice().sort((r,i)=>r.y-i.y),n=[];let o=null;for(let r=0;r<t.length;r++){const i=t[r];!o||i.y-o.y>o.height/2?n.push([i]):n[n.length-1].push(i),o=i}return n.map(r=>jt(Zs(r)))}const ef=function(e){return e===void 0&&(e={}),{name:"inline",options:e,async fn(t){const{placement:n,elements:o,rects:r,platform:i,strategy:s}=t,{padding:a=2,x:c,y:l}=tt(e,t),u=Array.from(await(i.getClientRects==null?void 0:i.getClientRects(o.reference))||[]),d=Qd(u),f=jt(Zs(u)),h=vr(a);function g(){if(d.length===2&&d[0].left>d[1].right&&c!=null&&l!=null)return d.find(x=>c>x.left-h.left&&c<x.right+h.right&&l>x.top-h.top&&l<x.bottom+h.bottom)||f;if(d.length>=2){if(qe(n)==="y"){const H=d[0],j=d[d.length-1],T=Ge(n)==="top",R=H.top,E=j.bottom,A=T?H.left:j.left,M=T?H.right:j.right,k=M-A,O=E-R;return{top:R,bottom:E,left:A,right:M,width:k,height:O,x:A,y:R}}const x=Ge(n)==="left",v=Re(...d.map(H=>H.right)),m=ze(...d.map(H=>H.left)),y=d.filter(H=>x?H.left===m:H.right===v),S=y[0].top,$=y[y.length-1].bottom,I=m,_=v,C=_-I,N=$-S;return{top:S,bottom:$,left:I,right:_,width:C,height:N,x:I,y:S}}return f}const p=await i.getElementRects({reference:{getBoundingClientRect:g},floating:o.floating,strategy:s});return r.reference.x!==p.reference.x||r.reference.y!==p.reference.y||r.reference.width!==p.reference.width||r.reference.height!==p.reference.height?{reset:{rects:p}}:{}}}},Qs=new Set(["left","top"]);async function tf(e,t){const{placement:n,platform:o,elements:r}=e,i=await(o.isRTL==null?void 0:o.isRTL(r.floating)),s=Ge(n),a=Yt(n),c=qe(n)==="y",l=Qs.has(s)?-1:1,u=i&&c?-1:1,d=tt(t,e);let{mainAxis:f,crossAxis:h,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(h=a==="end"?g*-1:g),c?{x:h*u,y:f*l}:{x:f*l,y:h*u}}const nf=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,o;const{x:r,y:i,placement:s,middlewareData:a}=t,c=await tf(t,e);return s===((n=a.offset)==null?void 0:n.placement)&&(o=a.arrow)!=null&&o.alignmentOffset?{}:{x:r+c.x,y:i+c.y,data:{...c,placement:s}}}}},of=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:o,placement:r}=t,{mainAxis:i=!0,crossAxis:s=!1,limiter:a={fn:x=>{let{x:v,y:m}=x;return{x:v,y:m}}},...c}=tt(e,t),l={x:n,y:o},u=await vn(t,c),d=qe(Ge(r)),f=mr(d);let h=l[f],g=l[d];if(i){const x=f==="y"?"top":"left",v=f==="y"?"bottom":"right",m=h+u[x],y=h-u[v];h=Zo(m,h,y)}if(s){const x=d==="y"?"top":"left",v=d==="y"?"bottom":"right",m=g+u[x],y=g-u[v];g=Zo(m,g,y)}const p=a.fn({...t,[f]:h,[d]:g});return{...p,data:{x:p.x-n,y:p.y-o,enabled:{[f]:i,[d]:s}}}}}},rf=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:o,placement:r,rects:i,middlewareData:s}=t,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=tt(e,t),u={x:n,y:o},d=qe(r),f=mr(d);let h=u[f],g=u[d];const p=tt(a,t),x=typeof p=="number"?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(c){const y=f==="y"?"height":"width",S=i.reference[f]-i.floating[y]+x.mainAxis,$=i.reference[f]+i.reference[y]-x.mainAxis;h<S?h=S:h>$&&(h=$)}if(l){var v,m;const y=f==="y"?"width":"height",S=Qs.has(Ge(r)),$=i.reference[d]-i.floating[y]+(S&&((v=s.offset)==null?void 0:v[d])||0)+(S?0:x.crossAxis),I=i.reference[d]+i.reference[y]+(S?0:((m=s.offset)==null?void 0:m[d])||0)-(S?x.crossAxis:0);g<$?g=$:g>I&&(g=I)}return{[f]:h,[d]:g}}}},sf=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,o;const{placement:r,rects:i,platform:s,elements:a}=t,{apply:c=()=>{},...l}=tt(e,t),u=await vn(t,l),d=Ge(r),f=Yt(r),h=qe(r)==="y",{width:g,height:p}=i.floating;let x,v;d==="top"||d==="bottom"?(x=d,v=f===(await(s.isRTL==null?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(v=d,x=f==="end"?"top":"bottom");const m=p-u.top-u.bottom,y=g-u.left-u.right,S=ze(p-u[x],m),$=ze(g-u[v],y),I=!t.middlewareData.shift;let _=S,C=$;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(C=y),(o=t.middlewareData.shift)!=null&&o.enabled.y&&(_=m),I&&!f){const H=Re(u.left,0),j=Re(u.right,0),T=Re(u.top,0),R=Re(u.bottom,0);h?C=g-2*(H!==0||j!==0?H+j:Re(u.left,u.right)):_=p-2*(T!==0||R!==0?T+R:Re(u.top,u.bottom))}await c({...t,availableWidth:C,availableHeight:_});const N=await s.getDimensions(a.floating);return g!==N.width||p!==N.height?{reset:{rects:!0}}:{}}}};function ea(e){const t=Ie(e);let n=parseFloat(t.width)||0,o=parseFloat(t.height)||0;const r=Se(e),i=r?e.offsetWidth:n,s=r?e.offsetHeight:o,a=Fn(n)!==i||Fn(o)!==s;return a&&(n=i,o=s),{width:n,height:o,$:a}}function br(e){return me(e)?e:e.contextElement}function Pt(e){const t=br(e);if(!Se(t))return et(1);const n=t.getBoundingClientRect(),{width:o,height:r,$:i}=ea(t);let s=(i?Fn(n.width):n.width)/o,a=(i?Fn(n.height):n.height)/r;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const af=et(0);function ta(e){const t=Ne(e);return!eo()||!t.visualViewport?af:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function lf(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==Ne(e)?!1:t}function Et(e,t,n,o){t===void 0&&(t=!1),n===void 0&&(n=!1);const r=e.getBoundingClientRect(),i=br(e);let s=et(1);t&&(o?me(o)&&(s=Pt(o)):s=Pt(e));const a=lf(i,n,o)?ta(i):et(0);let c=(r.left+a.x)/s.x,l=(r.top+a.y)/s.y,u=r.width/s.x,d=r.height/s.y;if(i){const f=Ne(i),h=o&&me(o)?Ne(o):o;let g=f,p=Jo(g);for(;p&&o&&h!==g;){const x=Pt(p),v=p.getBoundingClientRect(),m=Ie(p),y=v.left+(p.clientLeft+parseFloat(m.paddingLeft))*x.x,S=v.top+(p.clientTop+parseFloat(m.paddingTop))*x.y;c*=x.x,l*=x.y,u*=x.x,d*=x.y,c+=y,l+=S,g=Ne(p),p=Jo(g)}}return jt({width:u,height:d,x:c,y:l})}function oo(e,t){const n=to(e).scrollLeft;return t?t.left+n:Et(nt(e)).left+n}function na(e,t){const n=e.getBoundingClientRect(),o=n.left+t.scrollLeft-oo(e,n),r=n.top+t.scrollTop;return{x:o,y:r}}function cf(e){let{elements:t,rect:n,offsetParent:o,strategy:r}=e;const i=r==="fixed",s=nt(o),a=t?Qn(t.floating):!1;if(o===s||a&&i)return n;let c={scrollLeft:0,scrollTop:0},l=et(1);const u=et(0),d=Se(o);if((d||!d&&!i)&&((yt(o)!=="body"||xn(s))&&(c=to(o)),Se(o))){const h=Et(o);l=Pt(o),u.x=h.x+o.clientLeft,u.y=h.y+o.clientTop}const f=s&&!d&&!i?na(s,c):et(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x+f.x,y:n.y*l.y-c.scrollTop*l.y+u.y+f.y}}function uf(e){return Array.from(e.getClientRects())}function df(e){const t=nt(e),n=to(e),o=e.ownerDocument.body,r=Re(t.scrollWidth,t.clientWidth,o.scrollWidth,o.clientWidth),i=Re(t.scrollHeight,t.clientHeight,o.scrollHeight,o.clientHeight);let s=-n.scrollLeft+oo(e);const a=-n.scrollTop;return Ie(o).direction==="rtl"&&(s+=Re(t.clientWidth,o.clientWidth)-r),{width:r,height:i,x:s,y:a}}const _i=25;function ff(e,t){const n=Ne(e),o=nt(e),r=n.visualViewport;let i=o.clientWidth,s=o.clientHeight,a=0,c=0;if(r){i=r.width,s=r.height;const u=eo();(!u||u&&t==="fixed")&&(a=r.offsetLeft,c=r.offsetTop)}const l=oo(o);if(l<=0){const u=o.ownerDocument,d=u.body,f=getComputedStyle(d),h=u.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,g=Math.abs(o.clientWidth-d.clientWidth-h);g<=_i&&(i-=g)}else l<=_i&&(i+=l);return{width:i,height:s,x:a,y:c}}const pf=new Set(["absolute","fixed"]);function hf(e,t){const n=Et(e,!0,t==="fixed"),o=n.top+e.clientTop,r=n.left+e.clientLeft,i=Se(e)?Pt(e):et(1),s=e.clientWidth*i.x,a=e.clientHeight*i.y,c=r*i.x,l=o*i.y;return{width:s,height:a,x:c,y:l}}function Pi(e,t,n){let o;if(t==="viewport")o=ff(e,n);else if(t==="document")o=df(nt(e));else if(me(t))o=hf(t,n);else{const r=ta(e);o={x:t.x-r.x,y:t.y-r.y,width:t.width,height:t.height}}return jt(o)}function oa(e,t){const n=lt(e);return n===t||!me(n)||at(n)?!1:Ie(n).position==="fixed"||oa(n,t)}function mf(e,t){const n=t.get(e);if(n)return n;let o=ht(e,[],!1).filter(a=>me(a)&&yt(a)!=="body"),r=null;const i=Ie(e).position==="fixed";let s=i?lt(e):e;for(;me(s)&&!at(s);){const a=Ie(s),c=hr(s);!c&&a.position==="fixed"&&(r=null),(i?!c&&!r:!c&&a.position==="static"&&!!r&&pf.has(r.position)||xn(s)&&!c&&oa(e,s))?o=o.filter(u=>u!==s):r=a,s=lt(s)}return t.set(e,o),o}function gf(e){let{element:t,boundary:n,rootBoundary:o,strategy:r}=e;const s=[...n==="clippingAncestors"?Qn(t)?[]:mf(t,this._c):[].concat(n),o],a=s[0],c=s.reduce((l,u)=>{const d=Pi(t,u,r);return l.top=Re(d.top,l.top),l.right=ze(d.right,l.right),l.bottom=ze(d.bottom,l.bottom),l.left=Re(d.left,l.left),l},Pi(t,a,r));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function yf(e){const{width:t,height:n}=ea(e);return{width:t,height:n}}function vf(e,t,n){const o=Se(t),r=nt(t),i=n==="fixed",s=Et(e,!0,i,t);let a={scrollLeft:0,scrollTop:0};const c=et(0);function l(){c.x=oo(r)}if(o||!o&&!i)if((yt(t)!=="body"||xn(r))&&(a=to(t)),o){const h=Et(t,!0,i,t);c.x=h.x+t.clientLeft,c.y=h.y+t.clientTop}else r&&l();i&&!o&&r&&l();const u=r&&!o&&!i?na(r,a):et(0),d=s.left+a.scrollLeft-c.x-u.x,f=s.top+a.scrollTop-c.y-u.y;return{x:d,y:f,width:s.width,height:s.height}}function jo(e){return Ie(e).position==="static"}function Ni(e,t){if(!Se(e)||Ie(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return nt(e)===n&&(n=n.ownerDocument.body),n}function ra(e,t){const n=Ne(e);if(Qn(e))return n;if(!Se(e)){let r=lt(e);for(;r&&!at(r);){if(me(r)&&!jo(r))return r;r=lt(r)}return n}let o=Ni(e,t);for(;o&&ed(o)&&jo(o);)o=Ni(o,t);return o&&at(o)&&jo(o)&&!hr(o)?n:o||id(e)||n}const bf=async function(e){const t=this.getOffsetParent||ra,n=this.getDimensions,o=await n(e.floating);return{reference:vf(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:o.width,height:o.height}}};function wf(e){return Ie(e).direction==="rtl"}const xf={convertOffsetParentRelativeRectToViewportRelativeRect:cf,getDocumentElement:nt,getClippingRect:gf,getOffsetParent:ra,getElementRects:bf,getClientRects:uf,getDimensions:yf,getScale:Pt,isElement:me,isRTL:wf};function ia(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Ef(e,t){let n=null,o;const r=nt(e);function i(){var a;clearTimeout(o),(a=n)==null||a.disconnect(),n=null}function s(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),i();const l=e.getBoundingClientRect(),{left:u,top:d,width:f,height:h}=l;if(a||t(),!f||!h)return;const g=kn(d),p=kn(r.clientWidth-(u+f)),x=kn(r.clientHeight-(d+h)),v=kn(u),y={rootMargin:-g+"px "+-p+"px "+-x+"px "+-v+"px",threshold:Re(0,ze(1,c))||1};let S=!0;function $(I){const _=I[0].intersectionRatio;if(_!==c){if(!S)return s();_?s(!1,_):o=setTimeout(()=>{s(!1,1e-7)},1e3)}_===1&&!ia(l,e.getBoundingClientRect())&&s(),S=!1}try{n=new IntersectionObserver($,{...y,root:r.ownerDocument})}catch{n=new IntersectionObserver($,y)}n.observe(e)}return s(!0),i}function Af(e,t,n,o){o===void 0&&(o={});const{ancestorScroll:r=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=o,l=br(e),u=r||i?[...l?ht(l):[],...ht(t)]:[];u.forEach(v=>{r&&v.addEventListener("scroll",n,{passive:!0}),i&&v.addEventListener("resize",n)});const d=l&&a?Ef(l,n):null;let f=-1,h=null;s&&(h=new ResizeObserver(v=>{let[m]=v;m&&m.target===l&&h&&(h.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var y;(y=h)==null||y.observe(t)})),n()}),l&&!c&&h.observe(l),h.observe(t));let g,p=c?Et(e):null;c&&x();function x(){const v=Et(e);p&&!ia(p,v)&&n(),p=v,g=requestAnimationFrame(x)}return n(),()=>{var v;u.forEach(m=>{r&&m.removeEventListener("scroll",n),i&&m.removeEventListener("resize",n)}),d==null||d(),(v=h)==null||v.disconnect(),h=null,c&&cancelAnimationFrame(g)}}const Sf=nf,$f=of,Rf=Jd,Tf=sf,Cf=Zd,Ii=Gd,Of=ef,Lf=rf,kf=(e,t,n)=>{const o=new Map,r={platform:xf,...n},i={...r.platform,_c:o};return zd(e,t,{...r,platform:i})};var Mf=typeof document<"u",_f=function(){},Nn=Mf?P.useLayoutEffect:_f;function Wn(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,o,r;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(o=n;o--!==0;)if(!Wn(e[o],t[o]))return!1;return!0}if(r=Object.keys(e),n=r.length,n!==Object.keys(t).length)return!1;for(o=n;o--!==0;)if(!{}.hasOwnProperty.call(t,r[o]))return!1;for(o=n;o--!==0;){const i=r[o];if(!(i==="_owner"&&e.$$typeof)&&!Wn(e[i],t[i]))return!1}return!0}return e!==e&&t!==t}function sa(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Di(e,t){const n=sa(e);return Math.round(t*n)/n}function Ho(e){const t=P.useRef(e);return Nn(()=>{t.current=e}),t}function Pf(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:o=[],platform:r,elements:{reference:i,floating:s}={},transform:a=!0,whileElementsMounted:c,open:l}=e,[u,d]=P.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[f,h]=P.useState(o);Wn(f,o)||h(o);const[g,p]=P.useState(null),[x,v]=P.useState(null),m=P.useCallback(O=>{O!==I.current&&(I.current=O,p(O))},[]),y=P.useCallback(O=>{O!==_.current&&(_.current=O,v(O))},[]),S=i||g,$=s||x,I=P.useRef(null),_=P.useRef(null),C=P.useRef(u),N=c!=null,H=Ho(c),j=Ho(r),T=Ho(l),R=P.useCallback(()=>{if(!I.current||!_.current)return;const O={placement:t,strategy:n,middleware:f};j.current&&(O.platform=j.current),kf(I.current,_.current,O).then(U=>{const w={...U,isPositioned:T.current!==!1};E.current&&!Wn(C.current,w)&&(C.current=w,rr.flushSync(()=>{d(w)}))})},[f,t,n,j,T]);Nn(()=>{l===!1&&C.current.isPositioned&&(C.current.isPositioned=!1,d(O=>({...O,isPositioned:!1})))},[l]);const E=P.useRef(!1);Nn(()=>(E.current=!0,()=>{E.current=!1}),[]),Nn(()=>{if(S&&(I.current=S),$&&(_.current=$),S&&$){if(H.current)return H.current(S,$,R);R()}},[S,$,R,H,N]);const A=P.useMemo(()=>({reference:I,floating:_,setReference:m,setFloating:y}),[m,y]),M=P.useMemo(()=>({reference:S,floating:$}),[S,$]),k=P.useMemo(()=>{const O={position:n,left:0,top:0};if(!M.floating)return O;const U=Di(M.floating,u.x),w=Di(M.floating,u.y);return a?{...O,transform:"translate("+U+"px, "+w+"px)",...sa(M.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:U,top:w}},[n,a,M.floating,u.x,u.y]);return P.useMemo(()=>({...u,update:R,refs:A,elements:M,floatingStyles:k}),[u,R,A,M,k])}const Nf=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:o,padding:r}=typeof e=="function"?e(n):e;return o&&t(o)?o.current!=null?Ii({element:o.current,padding:r}).fn(n):{}:o?Ii({element:o,padding:r}).fn(n):{}}}},If=(e,t)=>({...Sf(e),options:[e,t]}),Df=(e,t)=>({...$f(e),options:[e,t]}),Ep=(e,t)=>({...Lf(e),options:[e,t]}),Bf=(e,t)=>({...Rf(e),options:[e,t]}),Ap=(e,t)=>({...Tf(e),options:[e,t]}),Sp=(e,t)=>({...Cf(e),options:[e,t]}),jf=(e,t)=>({...Of(e),options:[e,t]}),Hf=(e,t)=>({...Nf(e),options:[e,t]}),Uf="data-floating-ui-focusable",Bi="active",ji="selected",Vf={...es};let Hi=!1,Ff=0;const Ui=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+Ff++;function Xf(){const[e,t]=P.useState(()=>Hi?Ui():void 0);return Pe(()=>{e==null&&t(Ui())},[]),P.useEffect(()=>{Hi=!0},[]),e}const Kf=Vf.useId,ro=Kf||Xf,qf=P.forwardRef(function(t,n){const{context:{placement:o,elements:{floating:r},middlewareData:{arrow:i,shift:s}},width:a=14,height:c=7,tipRadius:l=0,strokeWidth:u=0,staticOffset:d,stroke:f,d:h,style:{transform:g,...p}={},...x}=t,v=ro(),[m,y]=P.useState(!1);if(Pe(()=>{if(!r)return;Ie(r).direction==="rtl"&&y(!0)},[r]),!r)return null;const[S,$]=o.split("-"),I=S==="top"||S==="bottom";let _=d;(I&&s!=null&&s.x||!I&&s!=null&&s.y)&&(_=null);const C=u*2,N=C/2,H=a/2*(l/-8+1),j=c/2*l/4,T=!!h,R=_&&$==="end"?"bottom":"top";let E=_&&$==="end"?"right":"left";_&&m&&(E=$==="end"?"left":"right");const A=(i==null?void 0:i.x)!=null?_||i.x:"",M=(i==null?void 0:i.y)!=null?_||i.y:"",k=h||"M0,0"+(" H"+a)+(" L"+(a-H)+","+(c-j))+(" Q"+a/2+","+c+" "+H+","+(c-j))+" Z",O={top:T?"rotate(180deg)":"",left:T?"rotate(90deg)":"rotate(-90deg)",bottom:T?"":"rotate(180deg)",right:T?"rotate(-90deg)":"rotate(90deg)"}[S];return de.jsxs("svg",{...x,"aria-hidden":!0,ref:n,width:T?a:a+C,height:a,viewBox:"0 0 "+a+" "+(c>a?c:a),style:{position:"absolute",pointerEvents:"none",[E]:A,[R]:M,[S]:I||T?"100%":"calc(100% - "+C/2+"px)",transform:[O,g].filter(U=>!!U).join(" "),...p},children:[C>0&&de.jsx("path",{clipPath:"url(#"+v+")",fill:"none",stroke:f,strokeWidth:C+(h?0:1),d:k}),de.jsx("path",{stroke:C&&!h?x.fill:"none",d:k}),de.jsx("clipPath",{id:v,children:de.jsx("rect",{x:-N,y:N*(T?-1:1),width:a+C,height:a})})]})});function Yf(){const e=new Map;return{emit(t,n){var o;(o=e.get(t))==null||o.forEach(r=>r(n))},on(t,n){e.has(t)||e.set(t,new Set),e.get(t).add(n)},off(t,n){var o;(o=e.get(t))==null||o.delete(n)}}}const Wf=P.createContext(null),zf=P.createContext(null),aa=()=>{var e;return((e=P.useContext(Wf))==null?void 0:e.id)||null},wr=()=>P.useContext(zf);function bn(e){return"data-floating-ui-"+e}function Gf(e){e.current!==-1&&(clearTimeout(e.current),e.current=-1)}let Vi=0;function Tt(e,t){t===void 0&&(t={});const{preventScroll:n=!1,cancelPrevious:o=!0,sync:r=!1}=t;o&&cancelAnimationFrame(Vi);const i=()=>e==null?void 0:e.focus({preventScroll:n});r?i():Vi=requestAnimationFrame(i)}function Jf(e){return(e==null?void 0:e.ownerDocument)||document}const Nt={inert:new WeakMap,"aria-hidden":new WeakMap,none:new WeakMap};function Fi(e){return e==="inert"?Nt.inert:e==="aria-hidden"?Nt["aria-hidden"]:Nt.none}let Mn=new WeakSet,_n={},Uo=0;const Zf=()=>typeof HTMLElement<"u"&&"inert"in HTMLElement.prototype,la=e=>e&&(e.host||la(e.parentNode)),Qf=(e,t)=>t.map(n=>{if(e.contains(n))return n;const o=la(n);return e.contains(o)?o:null}).filter(n=>n!=null);function ep(e,t,n,o){const r="data-floating-ui-inert",i=o?"inert":n?"aria-hidden":null,s=Qf(t,e),a=new Set,c=new Set(s),l=[];_n[r]||(_n[r]=new WeakMap);const u=_n[r];s.forEach(d),f(t),a.clear();function d(h){!h||a.has(h)||(a.add(h),h.parentNode&&d(h.parentNode))}function f(h){!h||c.has(h)||[].forEach.call(h.children,g=>{if(yt(g)!=="script")if(a.has(g))f(g);else{const p=i?g.getAttribute(i):null,x=p!==null&&p!=="false",v=Fi(i),m=(v.get(g)||0)+1,y=(u.get(g)||0)+1;v.set(g,m),u.set(g,y),l.push(g),m===1&&x&&Mn.add(g),y===1&&g.setAttribute(r,""),!x&&i&&g.setAttribute(i,i==="inert"?"":"true")}})}return Uo++,()=>{l.forEach(h=>{const g=Fi(i),x=(g.get(h)||0)-1,v=(u.get(h)||0)-1;g.set(h,x),u.set(h,v),x||(!Mn.has(h)&&i&&h.removeAttribute(i),Mn.delete(h)),v||h.removeAttribute(r)}),Uo--,Uo||(Nt.inert=new WeakMap,Nt["aria-hidden"]=new WeakMap,Nt.none=new WeakMap,Mn=new WeakSet,_n={})}}function Xi(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);const o=Jf(e[0]).body;return ep(e.concat(Array.from(o.querySelectorAll('[aria-live],[role="status"],output'))),o,t,n)}const io={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0},zn=P.forwardRef(function(t,n){const[o,r]=P.useState();Pe(()=>{Nd()&&r("button")},[]);const i={ref:n,tabIndex:0,role:o,"aria-hidden":o?void 0:!0,[bn("focus-guard")]:"",style:io};return de.jsx("span",{...t,...i})}),ca=P.createContext(null),Ki=bn("portal");function tp(e){e===void 0&&(e={});const{id:t,root:n}=e,o=ro(),r=ua(),[i,s]=P.useState(null),a=P.useRef(null);return Pe(()=>()=>{i==null||i.remove(),queueMicrotask(()=>{a.current=null})},[i]),Pe(()=>{if(!o||a.current)return;const c=t?document.getElementById(t):null;if(!c)return;const l=document.createElement("div");l.id=o,l.setAttribute(Ki,""),c.appendChild(l),a.current=l,s(l)},[t,o]),Pe(()=>{if(n===null||!o||a.current)return;let c=n||(r==null?void 0:r.portalNode);c&&!pr(c)&&(c=c.current),c=c||document.body;let l=null;t&&(l=document.createElement("div"),l.id=t,c.appendChild(l));const u=document.createElement("div");u.id=o,u.setAttribute(Ki,""),c=l||c,c.appendChild(u),a.current=u,s(u)},[t,n,o,r]),i}function np(e){const{children:t,id:n,root:o,preserveTabOrder:r=!0}=e,i=tp({id:n,root:o}),[s,a]=P.useState(null),c=P.useRef(null),l=P.useRef(null),u=P.useRef(null),d=P.useRef(null),f=s==null?void 0:s.modal,h=s==null?void 0:s.open,g=!!s&&!s.modal&&s.open&&r&&!!(o||i);return P.useEffect(()=>{if(!i||!r||f)return;function p(x){i&&un(x)&&(x.type==="focusin"?Oi:Wd)(i)}return i.addEventListener("focusin",p,!0),i.addEventListener("focusout",p,!0),()=>{i.removeEventListener("focusin",p,!0),i.removeEventListener("focusout",p,!0)}},[i,r,f]),P.useEffect(()=>{i&&(h||Oi(i))},[h,i]),de.jsxs(ca.Provider,{value:P.useMemo(()=>({preserveTabOrder:r,beforeOutsideRef:c,afterOutsideRef:l,beforeInsideRef:u,afterInsideRef:d,portalNode:i,setFocusManagerState:a}),[r,i]),children:[g&&i&&de.jsx(zn,{"data-type":"outside",ref:c,onFocus:p=>{if(un(p,i)){var x;(x=u.current)==null||x.focus()}else{const v=s?s.domReference:null,m=Js(v);m==null||m.focus()}}}),g&&i&&de.jsx("span",{"aria-owns":i.id,style:io}),i&&rr.createPortal(t,i),g&&i&&de.jsx(zn,{"data-type":"outside",ref:l,onFocus:p=>{if(un(p,i)){var x;(x=d.current)==null||x.focus()}else{const v=s?s.domReference:null,m=Gs(v);m==null||m.focus(),s!=null&&s.closeOnFocusOut&&(s==null||s.onOpenChange(!1,p.nativeEvent,"focus-out"))}}})]})}const ua=()=>P.useContext(ca);function qi(e){return P.useMemo(()=>t=>{e.forEach(n=>{n&&(n.current=t)})},e)}const op=20;let ft=[];function xr(){ft=ft.filter(e=>e.isConnected)}function rp(e){xr(),e&&yt(e)!=="body"&&(ft.push(e),ft.length>op&&(ft=ft.slice(-20)))}function Yi(){return xr(),ft[ft.length-1]}function ip(e){const t=En();return Ys(e,t)?e:no(e,t)[0]||e}function Wi(e,t){var n;if(!t.current.includes("floating")&&!((n=e.getAttribute("role"))!=null&&n.includes("dialog")))return;const o=En(),i=_d(e,o).filter(a=>{const c=a.getAttribute("data-tabindex")||"";return Ys(a,o)||a.hasAttribute("data-tabindex")&&!c.startsWith("-")}),s=e.getAttribute("tabindex");t.current.includes("floating")||i.length===0?s!=="0"&&e.setAttribute("tabindex","0"):(s!=="-1"||e.hasAttribute("data-tabindex")&&e.getAttribute("data-tabindex")!=="-1")&&(e.setAttribute("tabindex","-1"),e.setAttribute("data-tabindex","-1"))}const sp=P.forwardRef(function(t,n){return de.jsx("button",{...t,type:"button",ref:n,tabIndex:-1,style:io})});function ap(e){const{context:t,children:n,disabled:o=!1,order:r=["content"],guards:i=!0,initialFocus:s=0,returnFocus:a=!0,restoreFocus:c=!1,modal:l=!0,visuallyHiddenDismiss:u=!1,closeOnFocusOut:d=!0,outsideElementsInert:f=!1,getInsideElements:h=()=>[]}=e,{open:g,onOpenChange:p,events:x,dataRef:v,elements:{domReference:m,floating:y}}=t,S=Ze(()=>{var W;return(W=v.current.floatingContext)==null?void 0:W.nodeId}),$=Ze(h),I=typeof s=="number"&&s<0,_=Ti(m)&&I,C=Zf(),N=C?i:!0,H=!N||C&&f,j=Bo(r),T=Bo(s),R=Bo(a),E=wr(),A=ua(),M=P.useRef(null),k=P.useRef(null),O=P.useRef(!1),U=P.useRef(!1),w=P.useRef(-1),L=P.useRef(-1),B=A!=null,D=or(y),K=Ze(function(W){return W===void 0&&(W=D),W?no(W,En()):[]}),F=Ze(W=>{const ee=K(W);return j.current.map(G=>m&&G==="reference"?m:D&&G==="floating"?D:ee).filter(Boolean).flat()});P.useEffect(()=>{if(o||!l)return;function W(G){if(G.key==="Tab"){_e(D,Lt(Xe(D)))&&K().length===0&&!_&&Do(G);const se=F(),ie=ct(G);j.current[0]==="reference"&&ie===m&&(Do(G),G.shiftKey?Tt(se[se.length-1]):Tt(se[1])),j.current[1]==="floating"&&ie===D&&G.shiftKey&&(Do(G),Tt(se[0]))}}const ee=Xe(D);return ee.addEventListener("keydown",W),()=>{ee.removeEventListener("keydown",W)}},[o,m,D,l,j,_,K,F]),P.useEffect(()=>{if(o||!y)return;function W(ee){const G=ct(ee),ie=K().indexOf(G);ie!==-1&&(w.current=ie)}return y.addEventListener("focusin",W),()=>{y.removeEventListener("focusin",W)}},[o,y,K]),P.useEffect(()=>{if(o||!d)return;function W(){U.current=!0,setTimeout(()=>{U.current=!1})}function ee(ie){const X=ie.relatedTarget,Le=ie.currentTarget,Te=ct(ie);queueMicrotask(()=>{const Y=S(),V=!(_e(m,X)||_e(y,X)||_e(X,y)||_e(A==null?void 0:A.portalNode,X)||X!=null&&X.hasAttribute(bn("focus-guard"))||E&&(_t(E.nodesRef.current,Y).find(ke=>{var Oe,Me;return _e((Oe=ke.context)==null?void 0:Oe.elements.floating,X)||_e((Me=ke.context)==null?void 0:Me.elements.domReference,X)})||Ci(E.nodesRef.current,Y).find(ke=>{var Oe,Me,vt;return[(Oe=ke.context)==null?void 0:Oe.elements.floating,or((Me=ke.context)==null?void 0:Me.elements.floating)].includes(X)||((vt=ke.context)==null?void 0:vt.elements.domReference)===X})));if(Le===m&&D&&Wi(D,j),c&&Le!==m&&!(Te!=null&&Te.isConnected)&&Lt(Xe(D))===Xe(D).body){Se(D)&&D.focus();const ke=w.current,Oe=K(),Me=Oe[ke]||Oe[Oe.length-1]||D;Se(Me)&&Me.focus()}if(v.current.insideReactTree){v.current.insideReactTree=!1;return}(_||!l)&&X&&V&&!U.current&&X!==Yi()&&(O.current=!0,p(!1,ie,"focus-out"))})}const G=!!(!E&&A);function se(){Gf(L),v.current.insideReactTree=!0,L.current=window.setTimeout(()=>{v.current.insideReactTree=!1})}if(y&&Se(m))return m.addEventListener("focusout",ee),m.addEventListener("pointerdown",W),y.addEventListener("focusout",ee),G&&y.addEventListener("focusout",se,!0),()=>{m.removeEventListener("focusout",ee),m.removeEventListener("pointerdown",W),y.removeEventListener("focusout",ee),G&&y.removeEventListener("focusout",se,!0)}},[o,m,y,D,l,E,A,p,d,c,K,_,S,j,v]);const q=P.useRef(null),ae=P.useRef(null),ne=qi([q,A==null?void 0:A.beforeInsideRef]),Ve=qi([ae,A==null?void 0:A.afterInsideRef]);P.useEffect(()=>{var W,ee;if(o||!y)return;const G=Array.from((A==null||(W=A.portalNode)==null?void 0:W.querySelectorAll("["+bn("portal")+"]"))||[]),ie=(ee=(E?Ci(E.nodesRef.current,S()):[]).find(Te=>{var Y;return Ti(((Y=Te.context)==null?void 0:Y.elements.domReference)||null)}))==null||(ee=ee.context)==null?void 0:ee.elements.domReference,X=[y,ie,...G,...$(),M.current,k.current,q.current,ae.current,A==null?void 0:A.beforeOutsideRef.current,A==null?void 0:A.afterOutsideRef.current,j.current.includes("reference")||_?m:null].filter(Te=>Te!=null),Le=l||_?Xi(X,!H,H):Xi(X);return()=>{Le()}},[o,m,y,l,j,A,_,N,H,E,S,$]),Pe(()=>{if(o||!Se(D))return;const W=Xe(D),ee=Lt(W);queueMicrotask(()=>{const G=F(D),se=T.current,ie=(typeof se=="number"?G[se]:se.current)||D,X=_e(D,ee);!I&&!X&&g&&Tt(ie,{preventScroll:ie===D})})},[o,g,D,I,F,T]),Pe(()=>{if(o||!D)return;const W=Xe(D),ee=Lt(W);rp(ee);function G(X){let{reason:Le,event:Te,nested:Y}=X;if(["hover","safe-polygon"].includes(Le)&&Te.type==="mouseleave"&&(O.current=!0),Le==="outside-press")if(Y)O.current=!1;else if(Ud(Te)||Vd(Te))O.current=!1;else{let V=!1;document.createElement("div").focus({get preventScroll(){return V=!0,!1}}),V?O.current=!1:O.current=!0}}x.on("openchange",G);const se=W.createElement("span");se.setAttribute("tabindex","-1"),se.setAttribute("aria-hidden","true"),Object.assign(se.style,io),B&&m&&m.insertAdjacentElement("afterend",se);function ie(){if(typeof R.current=="boolean"){const X=m||Yi();return X&&X.isConnected?X:se}return R.current.current||se}return()=>{x.off("openchange",G);const X=Lt(W),Le=_e(y,X)||E&&_t(E.nodesRef.current,S(),!1).some(Y=>{var V;return _e((V=Y.context)==null?void 0:V.elements.floating,X)}),Te=ie();queueMicrotask(()=>{const Y=ip(Te);R.current&&!O.current&&Se(Y)&&(!(Y!==X&&X!==W.body)||Le)&&Y.focus({preventScroll:!0}),se.remove()})}},[o,y,D,R,v,x,E,B,m,S]),P.useEffect(()=>(queueMicrotask(()=>{O.current=!1}),()=>{queueMicrotask(xr)}),[o]),Pe(()=>{if(!o&&A)return A.setFocusManagerState({modal:l,closeOnFocusOut:d,open:g,onOpenChange:p,domReference:m}),()=>{A.setFocusManagerState(null)}},[o,A,l,g,p,d,m]),Pe(()=>{o||D&&Wi(D,j)},[o,D,j]);function be(W){return o||!u||!l?null:de.jsx(sp,{ref:W==="start"?M:k,onClick:ee=>p(!1,ee.nativeEvent),children:typeof u=="string"?u:"Dismiss"})}const Je=!o&&N&&(l?!_:!0)&&(B||l);return de.jsxs(de.Fragment,{children:[Je&&de.jsx(zn,{"data-type":"inside",ref:ne,onFocus:W=>{if(l){const G=F();Tt(r[0]==="reference"?G[0]:G[G.length-1])}else if(A!=null&&A.preserveTabOrder&&A.portalNode)if(O.current=!1,un(W,A.portalNode)){const G=Gs(m);G==null||G.focus()}else{var ee;(ee=A.beforeOutsideRef.current)==null||ee.focus()}}}),!_&&be("start"),n,be("end"),Je&&de.jsx(zn,{"data-type":"inside",ref:Ve,onFocus:W=>{if(l)Tt(F()[0]);else if(A!=null&&A.preserveTabOrder&&A.portalNode)if(d&&(O.current=!0),un(W,A.portalNode)){const G=Js(m);G==null||G.focus()}else{var ee;(ee=A.afterOutsideRef.current)==null||ee.focus()}}})]})}const lp={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},cp={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},zi=e=>{var t,n;return{escapeKey:typeof e=="boolean"?e:(t=e==null?void 0:e.escapeKey)!=null?t:!1,outsidePress:typeof e=="boolean"?e:(n=e==null?void 0:e.outsidePress)!=null?n:!0}};function up(e,t){t===void 0&&(t={});const{open:n,onOpenChange:o,elements:r,dataRef:i}=e,{enabled:s=!0,escapeKey:a=!0,outsidePress:c=!0,outsidePressEvent:l="pointerdown",referencePress:u=!1,referencePressEvent:d="pointerdown",ancestorScroll:f=!1,bubbles:h,capture:g}=t,p=wr(),x=Ze(typeof c=="function"?c:()=>!1),v=typeof c=="function"?x:c,m=P.useRef(!1),{escapeKey:y,outsidePress:S}=zi(h),{escapeKey:$,outsidePress:I}=zi(g),_=P.useRef(!1),C=Ze(E=>{var A;if(!n||!s||!a||E.key!=="Escape"||_.current)return;const M=(A=i.current.floatingContext)==null?void 0:A.nodeId,k=p?_t(p.nodesRef.current,M):[];if(!y&&(E.stopPropagation(),k.length>0)){let O=!0;if(k.forEach(U=>{var w;if((w=U.context)!=null&&w.open&&!U.context.dataRef.current.__escapeKeyBubbles){O=!1;return}}),!O)return}o(!1,Hd(E)?E.nativeEvent:E,"escape-key")}),N=Ze(E=>{var A;const M=()=>{var k;C(E),(k=ct(E))==null||k.removeEventListener("keydown",M)};(A=ct(E))==null||A.addEventListener("keydown",M)}),H=Ze(E=>{var A;const M=i.current.insideReactTree;i.current.insideReactTree=!1;const k=m.current;if(m.current=!1,l==="click"&&k||M||typeof v=="function"&&!v(E))return;const O=ct(E),U="["+bn("inert")+"]",w=Xe(r.floating).querySelectorAll(U);let L=me(O)?O:null;for(;L&&!at(L);){const F=lt(L);if(at(F)||!me(F))break;L=F}if(w.length&&me(O)&&!Bd(O)&&!_e(O,r.floating)&&Array.from(w).every(F=>!_e(L,F)))return;if(Se(O)&&R){const F=at(O),q=Ie(O),ae=/auto|scroll/,ne=F||ae.test(q.overflowX),Ve=F||ae.test(q.overflowY),be=ne&&O.clientWidth>0&&O.scrollWidth>O.clientWidth,Je=Ve&&O.clientHeight>0&&O.scrollHeight>O.clientHeight,W=q.direction==="rtl",ee=Je&&(W?E.offsetX<=O.offsetWidth-O.clientWidth:E.offsetX>O.clientWidth),G=be&&E.offsetY>O.clientHeight;if(ee||G)return}const B=(A=i.current.floatingContext)==null?void 0:A.nodeId,D=p&&_t(p.nodesRef.current,B).some(F=>{var q;return Io(E,(q=F.context)==null?void 0:q.elements.floating)});if(Io(E,r.floating)||Io(E,r.domReference)||D)return;const K=p?_t(p.nodesRef.current,B):[];if(K.length>0){let F=!0;if(K.forEach(q=>{var ae;if((ae=q.context)!=null&&ae.open&&!q.context.dataRef.current.__outsidePressBubbles){F=!1;return}}),!F)return}o(!1,E,"outside-press")}),j=Ze(E=>{var A;const M=()=>{var k;H(E),(k=ct(E))==null||k.removeEventListener(l,M)};(A=ct(E))==null||A.addEventListener(l,M)});P.useEffect(()=>{if(!n||!s)return;i.current.__escapeKeyBubbles=y,i.current.__outsidePressBubbles=S;let E=-1;function A(w){o(!1,w,"ancestor-scroll")}function M(){window.clearTimeout(E),_.current=!0}function k(){E=window.setTimeout(()=>{_.current=!1},eo()?5:0)}const O=Xe(r.floating);a&&(O.addEventListener("keydown",$?N:C,$),O.addEventListener("compositionstart",M),O.addEventListener("compositionend",k)),v&&O.addEventListener(l,I?j:H,I);let U=[];return f&&(me(r.domReference)&&(U=ht(r.domReference)),me(r.floating)&&(U=U.concat(ht(r.floating))),!me(r.reference)&&r.reference&&r.reference.contextElement&&(U=U.concat(ht(r.reference.contextElement)))),U=U.filter(w=>{var L;return w!==((L=O.defaultView)==null?void 0:L.visualViewport)}),U.forEach(w=>{w.addEventListener("scroll",A,{passive:!0})}),()=>{a&&(O.removeEventListener("keydown",$?N:C,$),O.removeEventListener("compositionstart",M),O.removeEventListener("compositionend",k)),v&&O.removeEventListener(l,I?j:H,I),U.forEach(w=>{w.removeEventListener("scroll",A)}),window.clearTimeout(E)}},[i,r,a,v,l,n,o,f,s,y,S,C,$,N,H,I,j]),P.useEffect(()=>{i.current.insideReactTree=!1},[i,v,l]);const T=P.useMemo(()=>({onKeyDown:C,...u&&{[lp[d]]:E=>{o(!1,E.nativeEvent,"reference-press")},...d!=="click"&&{onClick(E){o(!1,E.nativeEvent,"reference-press")}}}}),[C,o,u,d]),R=P.useMemo(()=>({onKeyDown:C,onMouseDown(){m.current=!0},onMouseUp(){m.current=!0},[cp[l]]:()=>{i.current.insideReactTree=!0}}),[C,l,i]);return P.useMemo(()=>s?{reference:T,floating:R}:{},[s,T,R])}function dp(e){const{open:t=!1,onOpenChange:n,elements:o}=e,r=ro(),i=P.useRef({}),[s]=P.useState(()=>Yf()),a=aa()!=null,[c,l]=P.useState(o.reference),u=Ze((h,g,p)=>{i.current.openEvent=h?g:void 0,s.emit("openchange",{open:h,event:g,reason:p,nested:a}),n==null||n(h,g,p)}),d=P.useMemo(()=>({setPositionReference:l}),[]),f=P.useMemo(()=>({reference:c||o.reference||null,floating:o.floating||null,domReference:o.reference}),[c,o.reference,o.floating]);return P.useMemo(()=>({dataRef:i,open:t,onOpenChange:u,elements:f,events:s,floatingId:r,refs:d}),[t,u,f,s,r,d])}function fp(e){e===void 0&&(e={});const{nodeId:t}=e,n=dp({...e,elements:{reference:null,floating:null,...e.elements}}),o=e.rootContext||n,r=o.elements,[i,s]=P.useState(null),[a,c]=P.useState(null),u=(r==null?void 0:r.domReference)||i,d=P.useRef(null),f=wr();Pe(()=>{u&&(d.current=u)},[u]);const h=Pf({...e,elements:{...r,...a&&{reference:a}}}),g=P.useCallback(y=>{const S=me(y)?{getBoundingClientRect:()=>y.getBoundingClientRect(),getClientRects:()=>y.getClientRects(),contextElement:y}:y;c(S),h.refs.setReference(S)},[h.refs]),p=P.useCallback(y=>{(me(y)||y===null)&&(d.current=y,s(y)),(me(h.refs.reference.current)||h.refs.reference.current===null||y!==null&&!me(y))&&h.refs.setReference(y)},[h.refs]),x=P.useMemo(()=>({...h.refs,setReference:p,setPositionReference:g,domReference:d}),[h.refs,p,g]),v=P.useMemo(()=>({...h.elements,domReference:u}),[h.elements,u]),m=P.useMemo(()=>({...h,...o,refs:x,elements:v,nodeId:t}),[h,x,v,t,o]);return Pe(()=>{o.dataRef.current.floatingContext=m;const y=f==null?void 0:f.nodesRef.current.find(S=>S.id===t);y&&(y.context=m)}),P.useMemo(()=>({...h,context:m,refs:x,elements:v}),[h,x,v,m])}function Vo(e,t,n){const o=new Map,r=n==="item";let i=e;if(r&&e){const{[Bi]:s,[ji]:a,...c}=e;i=c}return{...n==="floating"&&{tabIndex:-1,[Uf]:""},...i,...t.map(s=>{const a=s?s[n]:null;return typeof a=="function"?e?a(e):null:a}).concat(e).reduce((s,a)=>(a&&Object.entries(a).forEach(c=>{let[l,u]=c;if(!(r&&[Bi,ji].includes(l)))if(l.indexOf("on")===0){if(o.has(l)||o.set(l,[]),typeof u=="function"){var d;(d=o.get(l))==null||d.push(u),s[l]=function(){for(var f,h=arguments.length,g=new Array(h),p=0;p<h;p++)g[p]=arguments[p];return(f=o.get(l))==null?void 0:f.map(x=>x(...g)).find(x=>x!==void 0)}}}else s[l]=u}),s),{})}}function pp(e){e===void 0&&(e=[]);const t=e.map(a=>a==null?void 0:a.reference),n=e.map(a=>a==null?void 0:a.floating),o=e.map(a=>a==null?void 0:a.item),r=P.useCallback(a=>Vo(a,e,"reference"),t),i=P.useCallback(a=>Vo(a,e,"floating"),n),s=P.useCallback(a=>Vo(a,e,"item"),o);return P.useMemo(()=>({getReferenceProps:r,getFloatingProps:i,getItemProps:s}),[r,i,s])}const hp=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function mp(e,t){var n,o;t===void 0&&(t={});const{open:r,elements:i,floatingId:s}=e,{enabled:a=!0,role:c="dialog"}=t,l=ro(),u=((n=i.domReference)==null?void 0:n.id)||l,d=P.useMemo(()=>{var m;return((m=or(i.floating))==null?void 0:m.id)||s},[i.floating,s]),f=(o=hp.get(c))!=null?o:c,g=aa()!=null,p=P.useMemo(()=>f==="tooltip"||c==="label"?{["aria-"+(c==="label"?"labelledby":"describedby")]:r?d:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":f==="alertdialog"?"dialog":f,"aria-controls":r?d:void 0,...f==="listbox"&&{role:"combobox"},...f==="menu"&&{id:u},...f==="menu"&&g&&{role:"menuitem"},...c==="select"&&{"aria-autocomplete":"none"},...c==="combobox"&&{"aria-autocomplete":"list"}},[f,d,g,r,u,c]),x=P.useMemo(()=>{const m={id:d,...f&&{role:f}};return f==="tooltip"||c==="label"?m:{...m,...f==="menu"&&{"aria-labelledby":u}}},[f,d,u,c]),v=P.useCallback(m=>{let{active:y,selected:S}=m;const $={role:"option",...y&&{id:d+"-fui-option"}};switch(c){case"select":case"combobox":return{...$,"aria-selected":S}}return{}},[d,c]);return P.useMemo(()=>a?{reference:p,floating:x,item:v}:{},[a,p,x,v])}const $p=e=>{const{children:t,...n}=e,{anno:o,setAnno:r}=P.useContext(Gn),i=P.useCallback(s=>{const a=Bc(Ju(s,n));r(a)},[]);return P.useEffect(()=>{o&&o.setStyle(e.style)},[e.style]),P.useEffect(()=>{o&&o.setFilter(e.filter)},[e.filter]),e.children?de.jsx(de.Fragment,{children:P.Children.toArray(e.children).map(s=>P.cloneElement(s,{onLoad:i}))}):null},Gi=()=>{if(typeof navigator>"u")return!1;var e=navigator.userAgent||navigator.vendor||(window==null?void 0:window.opera);return!!(/android/i.test(e)||/iPad|iPhone/.test(e)&&!window.MSStream)},gp=(e,t={timeout:250})=>{const n=ba(),[o,r]=P.useState(!0);return P.useEffect(()=>{if(!n||!e)return;let i;const s=a=>{const{changes:{updated:c}}=a;c!=null&&c.some(l=>{const{targetUpdated:u}=l;if(u){const{oldTarget:d,newTarget:f}=u;return yp(d,f)}})&&(r(!1),clearTimeout(i),i=setTimeout(()=>r(!0),t.timeout))};return n.observe(s,{annotations:e,ignore:ms.BODY_ONLY,origin:te.LOCAL}),()=>{clearTimeout(i),n.unobserve(s)}},[n,e,t.timeout]),o},yp=(e,t)=>{const{selector:n}=e,o=n.map(({quote:s})=>s),{selector:r}=t,i=r.map(({quote:s})=>s);return o.join()!==i.join()},Ji=(e,t)=>{const{left:n,top:o,right:r,bottom:i}=e,s=t.getBoundingClientRect();return new DOMRect(n+s.left,o+s.top,r-n,i-o)},Rp=e=>{var t;const n=ts(),{selected:o,event:r}=wa(),i=(t=o[0])==null?void 0:t.annotation,s=gp(i==null?void 0:i.id),[a,c]=P.useState((o==null?void 0:o.length)>0),l=P.useRef(!1),u=P.useRef(null),{refs:d,floatingStyles:f,update:h,context:g}=fp({placement:Gi()?"bottom":e.placement||"top",strategy:"absolute",open:a,onOpenChange:(S,$,I)=>{!S&&(I==="escape-key"||I==="focus-out")&&(c(S),n==null||n.cancelSelected())},middleware:[jf(),If(10),Bf({crossAxis:!0}),Df({crossAxis:!0,padding:10}),Hf({element:u})],whileElementsMounted:Af}),p=up(g),x=mp(g,{role:"dialog"}),{getFloatingProps:v}=pp([p,x]);P.useEffect(()=>{if(i!=null&&i.id&&s){const S=n==null?void 0:n.state.store.getAnnotationBounds(i.id);c(!!S)}else c(!1)},[i==null?void 0:i.id,i==null?void 0:i.target.selector,s,n==null?void 0:n.state.store]),P.useEffect(()=>{e.onClose&&(a?l.current=!0:l.current&&(l.current=!1,e.onClose()))},[e.onClose,a]),P.useEffect(()=>{n&&(a&&i!=null&&i.id?d.setPositionReference({getBoundingClientRect:()=>{const S=n.state.store.getAnnotationBounds(i.id);return S?Ji(S,n.element):new DOMRect},getClientRects:()=>{const S=n.state.store.getAnnotationRects(i.id).map($=>Ji($,n.element));return Tu(S)}}):d.setPositionReference(null))},[a,i==null?void 0:i.id,i==null?void 0:i.target,n]);const m=P.useMemo(()=>(r==null?void 0:r.type)==="keyup"||(r==null?void 0:r.type)==="contextmenu"||Gi()?-1:0,[r]),y=()=>n==null?void 0:n.cancelSelected();return a&&i?de.jsx(np,{root:e.asPortal?null:n.element,children:de.jsx(ap,{context:g,modal:!1,closeOnFocusOut:!0,returnFocus:!1,initialFocus:m,children:de.jsxs("div",{className:`a9s-popup r6o-popup annotation-popup r6o-text-popup ${dr}`,ref:d.setFloating,style:f,children:[e.popup({annotation:o[0].annotation,editable:o[0].editable,event:r}),e.arrow&&de.jsx(qf,{ref:u,context:g,...e.arrowProps||{}}),de.jsx("button",{className:"r6o-popup-sr-only","aria-live":"assertive",onClick:y,children:e.ariaCloseWarning||"Click or leave this dialog to close it."})]})})}):null};export{sn as C,vp as L,ya as R,wa as T,ga as a,P as b,es as c,rr as d,xp as e,Bf as f,Zi as g,Ap as h,Hf as i,de as j,Sp as k,Ep as l,Af as m,bp as n,If as o,ts as p,ba as q,Qi as r,Df as s,Rp as t,Pf as u,$p as v};
