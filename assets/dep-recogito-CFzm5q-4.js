function ca(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in t)){const i=Object.getOwnPropertyDescriptor(r,o);i&&Object.defineProperty(t,o,i.get?i:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}function Gi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var nr={exports:{}},Xe={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wo;function ua(){if(wo)return Xe;wo=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,o,i){var s=null;if(i!==void 0&&(s=""+i),o.key!==void 0&&(s=""+o.key),"key"in o){i={};for(var a in o)a!=="key"&&(i[a]=o[a])}else i=o;return o=i.ref,{$$typeof:t,type:r,key:s,ref:o!==void 0?o:null,props:i}}return Xe.Fragment=e,Xe.jsx=n,Xe.jsxs=n,Xe}var xo;function da(){return xo||(xo=1,nr.exports=ua()),nr.exports}var fa=da(),rr={exports:{}},Q={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Eo;function pa(){if(Eo)return Q;Eo=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),s=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),d=Symbol.iterator;function f(w){return w===null||typeof w!="object"?null:(w=d&&w[d]||w["@@iterator"],typeof w=="function"?w:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,h={};function x(w,O,B){this.props=w,this.context=O,this.refs=h,this.updater=B||p}x.prototype.isReactComponent={},x.prototype.setState=function(w,O){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,O,"setState")},x.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function v(){}v.prototype=x.prototype;function g(w,O,B){this.props=w,this.context=O,this.refs=h,this.updater=B||p}var m=g.prototype=new v;m.constructor=g,y(m,x.prototype),m.isPureReactComponent=!0;var S=Array.isArray,$={H:null,A:null,T:null,S:null,V:null},j=Object.prototype.hasOwnProperty;function _(w,O,B,I,X,K){return B=K.ref,{$$typeof:t,type:w,key:O,ref:B!==void 0?B:null,props:K}}function P(w,O){return _(w.type,O,void 0,void 0,void 0,w.props)}function C(w){return typeof w=="object"&&w!==null&&w.$$typeof===t}function D(w){var O={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(B){return O[B]})}var U=/\/+/g;function R(w,O){return typeof w=="object"&&w!==null&&w.key!=null?D(""+w.key):O.toString(36)}function T(){}function E(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(T,T):(w.status="pending",w.then(function(O){w.status==="pending"&&(w.status="fulfilled",w.value=O)},function(O){w.status==="pending"&&(w.status="rejected",w.reason=O)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function A(w,O,B,I,X){var K=typeof w;(K==="undefined"||K==="boolean")&&(w=null);var Y=!1;if(w===null)Y=!0;else switch(K){case"bigint":case"string":case"number":Y=!0;break;case"object":switch(w.$$typeof){case t:case e:Y=!0;break;case u:return Y=w._init,A(Y(w._payload),O,B,I,X)}}if(Y)return X=X(w),Y=I===""?"."+R(w,0):I,S(X)?(B="",Y!=null&&(B=Y.replace(U,"$&/")+"/"),A(X,O,B,"",function(zt){return zt})):X!=null&&(C(X)&&(X=P(X,B+(X.key==null||w&&w.key===X.key?"":(""+X.key).replace(U,"$&/")+"/")+Y)),O.push(X)),1;Y=0;var gt=I===""?".":I+":";if(S(w))for(var ot=0;ot<w.length;ot++)I=w[ot],K=gt+R(I,ot),Y+=A(I,O,B,K,X);else if(ot=f(w),typeof ot=="function")for(w=ot.call(w),ot=0;!(I=w.next()).done;)I=I.value,K=gt+R(I,ot++),Y+=A(I,O,B,K,X);else if(K==="object"){if(typeof w.then=="function")return A(E(w),O,B,I,X);throw O=String(w),Error("Objects are not valid as a React child (found: "+(O==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":O)+"). If you meant to render a collection of children, use an array instead.")}return Y}function M(w,O,B){if(w==null)return w;var I=[],X=0;return A(w,I,"","",function(K){return O.call(B,K,X++)}),I}function L(w){if(w._status===-1){var O=w._result;O=O(),O.then(function(B){(w._status===0||w._status===-1)&&(w._status=1,w._result=B)},function(B){(w._status===0||w._status===-1)&&(w._status=2,w._result=B)}),w._status===-1&&(w._status=0,w._result=O)}if(w._status===1)return w._result.default;throw w._result}var k=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var O=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(O))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)};function V(){}return Q.Children={map:M,forEach:function(w,O,B){M(w,function(){O.apply(this,arguments)},B)},count:function(w){var O=0;return M(w,function(){O++}),O},toArray:function(w){return M(w,function(O){return O})||[]},only:function(w){if(!C(w))throw Error("React.Children.only expected to receive a single React element child.");return w}},Q.Component=x,Q.Fragment=n,Q.Profiler=o,Q.PureComponent=g,Q.StrictMode=r,Q.Suspense=c,Q.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,Q.__COMPILER_RUNTIME={__proto__:null,c:function(w){return $.H.useMemoCache(w)}},Q.cache=function(w){return function(){return w.apply(null,arguments)}},Q.cloneElement=function(w,O,B){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var I=y({},w.props),X=w.key,K=void 0;if(O!=null)for(Y in O.ref!==void 0&&(K=void 0),O.key!==void 0&&(X=""+O.key),O)!j.call(O,Y)||Y==="key"||Y==="__self"||Y==="__source"||Y==="ref"&&O.ref===void 0||(I[Y]=O[Y]);var Y=arguments.length-2;if(Y===1)I.children=B;else if(1<Y){for(var gt=Array(Y),ot=0;ot<Y;ot++)gt[ot]=arguments[ot+2];I.children=gt}return _(w.type,X,void 0,void 0,K,I)},Q.createContext=function(w){return w={$$typeof:s,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:i,_context:w},w},Q.createElement=function(w,O,B){var I,X={},K=null;if(O!=null)for(I in O.key!==void 0&&(K=""+O.key),O)j.call(O,I)&&I!=="key"&&I!=="__self"&&I!=="__source"&&(X[I]=O[I]);var Y=arguments.length-2;if(Y===1)X.children=B;else if(1<Y){for(var gt=Array(Y),ot=0;ot<Y;ot++)gt[ot]=arguments[ot+2];X.children=gt}if(w&&w.defaultProps)for(I in Y=w.defaultProps,Y)X[I]===void 0&&(X[I]=Y[I]);return _(w,K,void 0,void 0,null,X)},Q.createRef=function(){return{current:null}},Q.forwardRef=function(w){return{$$typeof:a,render:w}},Q.isValidElement=C,Q.lazy=function(w){return{$$typeof:u,_payload:{_status:-1,_result:w},_init:L}},Q.memo=function(w,O){return{$$typeof:l,type:w,compare:O===void 0?null:O}},Q.startTransition=function(w){var O=$.T,B={};$.T=B;try{var I=w(),X=$.S;X!==null&&X(B,I),typeof I=="object"&&I!==null&&typeof I.then=="function"&&I.then(V,k)}catch(K){k(K)}finally{$.T=O}},Q.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},Q.use=function(w){return $.H.use(w)},Q.useActionState=function(w,O,B){return $.H.useActionState(w,O,B)},Q.useCallback=function(w,O){return $.H.useCallback(w,O)},Q.useContext=function(w){return $.H.useContext(w)},Q.useDebugValue=function(){},Q.useDeferredValue=function(w,O){return $.H.useDeferredValue(w,O)},Q.useEffect=function(w,O,B){var I=$.H;if(typeof B=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return I.useEffect(w,O)},Q.useId=function(){return $.H.useId()},Q.useImperativeHandle=function(w,O,B){return $.H.useImperativeHandle(w,O,B)},Q.useInsertionEffect=function(w,O){return $.H.useInsertionEffect(w,O)},Q.useLayoutEffect=function(w,O){return $.H.useLayoutEffect(w,O)},Q.useMemo=function(w,O){return $.H.useMemo(w,O)},Q.useOptimistic=function(w,O){return $.H.useOptimistic(w,O)},Q.useReducer=function(w,O,B){return $.H.useReducer(w,O,B)},Q.useRef=function(w){return $.H.useRef(w)},Q.useState=function(w){return $.H.useState(w)},Q.useSyncExternalStore=function(w,O,B){return $.H.useSyncExternalStore(w,O,B)},Q.useTransition=function(){return $.H.useTransition()},Q.version="19.1.1",Q}var Ao;function zi(){return Ao||(Ao=1,rr.exports=pa()),rr.exports}var or={exports:{}},At={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $o;function ha(){if($o)return At;$o=1;var t=zi();function e(c){var l="https://react.dev/errors/"+c;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)l+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+c+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},o=Symbol.for("react.portal");function i(c,l,u){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:d==null?null:""+d,children:c,containerInfo:l,implementation:u}}var s=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(c,l){if(c==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return At.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,At.createPortal=function(c,l){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(e(299));return i(c,l,null,u)},At.flushSync=function(c){var l=s.T,u=r.p;try{if(s.T=null,r.p=2,c)return c()}finally{s.T=l,r.p=u,r.d.f()}},At.preconnect=function(c,l){typeof c=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,r.d.C(c,l))},At.prefetchDNS=function(c){typeof c=="string"&&r.d.D(c)},At.preinit=function(c,l){if(typeof c=="string"&&l&&typeof l.as=="string"){var u=l.as,d=a(u,l.crossOrigin),f=typeof l.integrity=="string"?l.integrity:void 0,p=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;u==="style"?r.d.S(c,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:d,integrity:f,fetchPriority:p}):u==="script"&&r.d.X(c,{crossOrigin:d,integrity:f,fetchPriority:p,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},At.preinitModule=function(c,l){if(typeof c=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var u=a(l.as,l.crossOrigin);r.d.M(c,{crossOrigin:u,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&r.d.M(c)},At.preload=function(c,l){if(typeof c=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var u=l.as,d=a(u,l.crossOrigin);r.d.L(c,u,{crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},At.preloadModule=function(c,l){if(typeof c=="string")if(l){var u=a(l.as,l.crossOrigin);r.d.m(c,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:u,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else r.d.m(c)},At.requestFormReset=function(c){r.d.r(c)},At.unstable_batchedUpdates=function(c,l){return c(l)},At.useFormState=function(c,l,u){return s.H.useFormState(c,l,u)},At.useFormStatus=function(){return s.H.useHostTransitionStatus()},At.version="19.1.1",At}var So;function ga(){if(So)return or.exports;So=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),or.exports=ha(),or.exports}var N=zi();const ma=Gi(N),Ji=ca({__proto__:null,default:ma},[N]),Wn=N.createContext({anno:void 0,setAnno:void 0,annotations:[],selection:{selected:[]}}),ya=(t,e)=>{const{event:n,...r}=t,{event:o,...i}=e;return JSON.stringify(r)!==JSON.stringify(i)?!1:(n==null?void 0:n.timeStamp)===(o==null?void 0:o.timeStamp)},yp=N.forwardRef((t,e)=>{const[n,r]=N.useState(null),[o,i]=N.useState([]),[s,a]=N.useState({selected:[],previous:[]}),c=N.useRef([]);return N.useImperativeHandle(e,()=>n),N.useEffect(()=>{if(n){const{selection:l,store:u}=n.state;u.all().length>0&&i(u.all());const d=()=>i(()=>u.all());u.observe(d);let f;const p=l.subscribe(({selected:y,...h})=>{f&&u.unobserve(f);const x=(y||[]).map(({id:v,editable:g})=>({annotation:u.getAnnotation(v),editable:g}));a(v=>{const g={selected:x,previous:v.selected,...h};return ya(v,g)?v:(c.current=v.selected,g)}),f=v=>{const{updated:g}=v.changes;a(m=>({...m,selected:m.selected.map(({annotation:S,editable:$})=>{const j=g.find(_=>_.oldValue.id===S.id);return j?{annotation:j.newValue,editable:$}:{annotation:S,editable:$}})}))},u.observe(f,{annotations:y.map(({id:v})=>v)})});return()=>{u.unobserve(d),p()}}},[n]),fa.jsx(Wn.Provider,{value:{anno:n,setAnno:r,annotations:o,selection:s},children:t.children})}),Qi=()=>{const{anno:t}=N.useContext(Wn);return t},va=()=>{const t=Qi();return t==null?void 0:t.state.store},ba=()=>{const{selection:t}=N.useContext(Wn);return t};var to=ga();const vp=Gi(to);var wa=Object.defineProperty,xa=(t,e,n)=>e in t?wa(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ro=(t,e,n)=>xa(t,typeof e!="symbol"?e+"":e,n);function me(){}function Br(t,e){for(const n in e)t[n]=e[n];return t}function Zi(t){return t()}function To(){return Object.create(null)}function Ut(t){t.forEach(Zi)}function ht(t){return typeof t=="function"}function De(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Ea(t){return Object.keys(t).length===0}function Aa(t,e,n,r){if(t){const o=ts(t,e,n,r);return t[0](o)}}function ts(t,e,n,r){return t[1]&&r?Br(n.ctx.slice(),t[1](r(e))):n.ctx}function $a(t,e,n,r){if(t[2]&&r){const o=t[2](r(n));if(e.dirty===void 0)return o;if(typeof o=="object"){const i=[],s=Math.max(e.dirty.length,o.length);for(let a=0;a<s;a+=1)i[a]=e.dirty[a]|o[a];return i}return e.dirty|o}return e.dirty}function Sa(t,e,n,r,o,i){if(o){const s=ts(e,n,r,i);t.p(s,o)}}function Ra(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function Co(t){const e={};for(const n in t)n[0]!=="$"&&(e[n]=t[n]);return e}function Oo(t){return t??""}function ct(t,e){t.appendChild(e)}function Z(t,e,n){t.insertBefore(e,n||null)}function z(t){t.parentNode&&t.parentNode.removeChild(t)}function Gn(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function W(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function es(t){return document.createTextNode(t)}function Tt(){return es(" ")}function yn(){return es("")}function nt(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function b(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ta(t){return Array.from(t.childNodes)}function Lo(t,e,n){t.classList.toggle(e,!!n)}function Ca(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}let cn;function nn(t){cn=t}function ns(){if(!cn)throw new Error("Function called outside component initialization");return cn}function rs(t){ns().$$.on_mount.push(t)}function eo(){const t=ns();return(e,n,{cancelable:r=!1}={})=>{const o=t.$$.callbacks[e];if(o){const i=Ca(e,n,{cancelable:r});return o.slice().forEach(s=>{s.call(t,i)}),!i.defaultPrevented}return!0}}function mt(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const $e=[],ko=[];let Ce=[];const Mo=[],os=Promise.resolve();let Ur=!1;function is(){Ur||(Ur=!0,os.then(as))}function ss(){return is(),os}function Hr(t){Ce.push(t)}const ir=new Set;let be=0;function as(){if(be!==0)return;const t=cn;do{try{for(;be<$e.length;){const e=$e[be];be++,nn(e),Oa(e.$$)}}catch(e){throw $e.length=0,be=0,e}for(nn(null),$e.length=0,be=0;ko.length;)ko.pop()();for(let e=0;e<Ce.length;e+=1){const n=Ce[e];ir.has(n)||(ir.add(n),n())}Ce.length=0}while($e.length);for(;Mo.length;)Mo.pop()();Ur=!1,ir.clear(),nn(t)}function Oa(t){if(t.fragment!==null){t.update(),Ut(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Hr)}}function La(t){const e=[],n=[];Ce.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Ce=e}const Mn=new Set;let ge;function ke(){ge={r:0,c:[],p:ge}}function Me(){ge.r||Ut(ge.c),ge=ge.p}function rt(t,e){t&&t.i&&(Mn.delete(t),t.i(e))}function ut(t,e,n,r){if(t&&t.o){if(Mn.has(t))return;Mn.add(t),ge.c.push(()=>{Mn.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function ue(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Ft(t){t&&t.c()}function It(t,e,n){const{fragment:r,after_update:o}=t.$$;r&&r.m(e,n),Hr(()=>{const i=t.$$.on_mount.map(Zi).filter(ht);t.$$.on_destroy?t.$$.on_destroy.push(...i):Ut(i),t.$$.on_mount=[]}),o.forEach(Hr)}function Pt(t,e){const n=t.$$;n.fragment!==null&&(La(n.after_update),Ut(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ka(t,e){t.$$.dirty[0]===-1&&($e.push(t),is(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function je(t,e,n,r,o,i,s=null,a=[-1]){const c=cn;nn(t);const l=t.$$={fragment:null,ctx:[],props:i,update:me,not_equal:o,bound:To(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:To(),dirty:a,skip_bound:!1,root:e.target||c.$$.root};s&&s(l.root);let u=!1;if(l.ctx=n?n(t,e.props||{},(d,f,...p)=>{const y=p.length?p[0]:f;return l.ctx&&o(l.ctx[d],l.ctx[d]=y)&&(!l.skip_bound&&l.bound[d]&&l.bound[d](y),u&&ka(t,d)),f}):[],l.update(),u=!0,Ut(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){const d=Ta(e.target);l.fragment&&l.fragment.l(d),d.forEach(z)}else l.fragment&&l.fragment.c();e.intro&&rt(t.$$.fragment),It(t,e.target,e.anchor),as()}nn(c)}let Be=class{constructor(){Ro(this,"$$"),Ro(this,"$$set")}$destroy(){Pt(this,1),this.$destroy=me}$on(e,n){if(!ht(n))return me;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(e){this.$$set&&!Ea(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};const Ma="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ma);var Kt=(t=>(t.ELLIPSE="ELLIPSE",t.MULTIPOLYGON="MULTIPOLYGON",t.POLYGON="POLYGON",t.POLYLINE="POLYLINE",t.RECTANGLE="RECTANGLE",t.LINE="LINE",t))(Kt||{}),_a={exports:{}};(function(t){(function(){function e(a,c){var l=a.x-c.x,u=a.y-c.y;return l*l+u*u}function n(a,c,l){var u=c.x,d=c.y,f=l.x-u,p=l.y-d;if(f!==0||p!==0){var y=((a.x-u)*f+(a.y-d)*p)/(f*f+p*p);y>1?(u=l.x,d=l.y):y>0&&(u+=f*y,d+=p*y)}return f=a.x-u,p=a.y-d,f*f+p*p}function r(a,c){for(var l=a[0],u=[l],d,f=1,p=a.length;f<p;f++)d=a[f],e(d,l)>c&&(u.push(d),l=d);return l!==d&&u.push(d),u}function o(a,c,l,u,d){for(var f=u,p,y=c+1;y<l;y++){var h=n(a[y],a[c],a[l]);h>f&&(p=y,f=h)}f>u&&(p-c>1&&o(a,c,p,u,d),d.push(a[p]),l-p>1&&o(a,p,l,u,d))}function i(a,c){var l=a.length-1,u=[a[0]];return o(a,0,l,c,u),u.push(a[l]),u}function s(a,c,l){if(a.length<=2)return a;var u=c!==void 0?c*c:1;return a=l?a:r(a,u),a=i(a,u),a}t.exports=s,t.exports.default=s})()})(_a);const Ue=(t,e)=>e,se=t=>{let e=1/0,n=1/0,r=-1/0,o=-1/0;return t.forEach(([i,s])=>{e=Math.min(e,i),n=Math.min(n,s),r=Math.max(r,i),o=Math.max(o,s)}),{minX:e,minY:n,maxX:r,maxY:o}},Nn=t=>{let e=0,n=t.length-1;for(let r=0;r<t.length;r++)e+=(t[n][0]+t[r][0])*(t[n][1]-t[r][1]),n=r;return Math.abs(.5*e)},In=(t,e,n)=>{let r=!1;for(let o=0,i=t.length-1;o<t.length;i=o++){const s=t[o][0],a=t[o][1],c=t[i][0],l=t[i][1];a>n!=l>n&&e<(c-s)*(n-a)/(l-a)+s&&(r=!r)}return r},Na=(t,e=!0)=>{let n="M ";return t.forEach(([r,o],i)=>{i===0?n+=`${r},${o}`:n+=` L ${r},${o}`}),e&&(n+=" Z"),n},Ia=(t,e)=>{const n=Math.abs(e[0]-t[0]),r=Math.abs(e[1]-t[1]);return Math.sqrt(Math.pow(n,2)+Math.pow(r,2))},Pa={area:t=>Math.PI*t.geometry.rx*t.geometry.ry,intersects:(t,e,n)=>{const{cx:r,cy:o,rx:i,ry:s}=t.geometry,a=0,c=Math.cos(a),l=Math.sin(a),u=e-r,d=n-o,f=c*u+l*d,p=l*u-c*d;return f*f/(i*i)+p*p/(s*s)<=1}};Ue(Kt.ELLIPSE,Pa);const Da={area:t=>0,intersects:(t,e,n,r=2)=>{const[[o,i],[s,a]]=t.geometry.points,c=Math.abs((a-i)*e-(s-o)*n+s*i-a*o),l=Ia([o,i],[s,a]);return c/l<=r}};Ue(Kt.LINE,Da);const ja={area:t=>{const{polygons:e}=t.geometry;return e.reduce((n,r)=>{const[o,...i]=r.rings,s=Nn(o.points),a=i.reduce((c,l)=>c+Nn(l.points),0);return n+s-a},0)},intersects:(t,e,n)=>{const{polygons:r}=t.geometry;for(const o of r){const[i,...s]=o.rings;if(In(i.points,e,n)){let a=!1;for(const c of s)if(In(c.points,e,n)){a=!0;break}if(!a)return!0}}return!1}},sr=t=>{const e=t.reduce((n,r)=>[...n,...r.rings[0].points],[]);return se(e)},we=t=>t.rings.map(e=>Na(e.points)).join(" "),Ba=t=>t.polygons.reduce((e,n)=>[...e,...n.rings.reduce((r,o)=>[...r,...o.points],[])],[]);Ue(Kt.MULTIPOLYGON,ja);const Ua={area:t=>{const e=t.geometry.points;return Nn(e)},intersects:(t,e,n)=>{const r=t.geometry.points;return In(r,e,n)}};Ue(Kt.POLYGON,Ua);const Ha={area:t=>{const e=t.geometry;if(!e.closed||e.points.length<3)return 0;const n=_o(e.points,e.closed);return Nn(n)},intersects:(t,e,n,r=2)=>{const o=t.geometry;if(o.closed){const i=_o(o.points,o.closed);return In(i,e,n)}else return Va(o,[e,n],r)}},_o=(t,e=!1)=>{const n=[];for(let r=0;r<t.length;r++){const o=t[r],i=t[(r+1)%t.length];if(n.push(o.point),(r<t.length-1||e)&&(o.type==="CURVE"||i.type=="CURVE")){const s=ls(o.point,o.type==="CURVE"&&o.outHandle||o.point,i.type==="CURVE"&&i.inHandle||i.point,i.point,10);n.push(...s.slice(1))}}return n},ls=(t,e,n,r,o=10)=>{const i=[];for(let s=0;s<=o;s++){const a=s/o,c=Math.pow(1-a,3)*t[0]+3*Math.pow(1-a,2)*a*e[0]+3*(1-a)*Math.pow(a,2)*n[0]+Math.pow(a,3)*r[0],l=Math.pow(1-a,3)*t[1]+3*Math.pow(1-a,2)*a*e[1]+3*(1-a)*Math.pow(a,2)*n[1]+Math.pow(a,3)*r[1];i.push([c,l])}return i},Va=(t,e,n)=>{for(let r=0;r<t.points.length-1;r++){const o=t.points[r],i=t.points[r+1];if(o.type==="CURVE"||i.type==="CURVE"){const s=ls(o.point,o.type==="CURVE"&&o.outHandle||o.point,i.type==="CURVE"&&i.inHandle||i.point,i.point,20);for(let a=0;a<s.length-1;a++)if(No(e,s[a],s[a+1])<=n)return!0}else if(No(e,o.point,i.point)<=n)return!0}return!1},No=(t,e,n)=>{const[r,o]=t,[i,s]=e,[a,c]=n,l=a-i,u=c-s,d=Math.sqrt(l*l+u*u);if(d===0)return Math.sqrt((r-i)*(r-i)+(o-s)*(o-s));const f=((r-i)*l+(o-s)*u)/(d*d);return f<=0?Math.sqrt((r-i)*(r-i)+(o-s)*(o-s)):f>=1?Math.sqrt((r-a)*(r-a)+(o-c)*(o-c)):Math.abs((c-s)*r-(a-i)*o+a*s-c*i)/d};Ue(Kt.POLYLINE,Ha);const Fa={area:t=>t.geometry.w*t.geometry.h,intersects:(t,e,n)=>e>=t.geometry.x&&e<=t.geometry.x+t.geometry.w&&n>=t.geometry.y&&n<=t.geometry.y+t.geometry.h};Ue(Kt.RECTANGLE,Fa);const Xa=[];for(let t=0;t<256;++t)Xa.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const qa=[];for(let t=0;t<256;++t)qa.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Ka="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Ya=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=Ka[n[t]&63];return e};Ya();const no=(t,e=0)=>{const{minX:n,minY:r,maxX:o,maxY:i}=t;return{x:n-e,y:r-e,w:o-n+2*e,h:i-r+2*e}},ce=typeof window>"u"||typeof navigator>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,Wa=t=>({}),Io=t=>({grab:t[0]});function Ga(t){let e,n,r,o;const i=t[8].default,s=Aa(i,t,t[7],Io);return{c(){e=W("g"),s&&s.c(),b(e,"class","a9s-annotation selected")},m(a,c){Z(a,e,c),s&&s.m(e,null),n=!0,r||(o=[nt(e,"pointerup",t[2]),nt(e,"pointermove",t[1])],r=!0)},p(a,[c]){s&&s.p&&(!n||c&128)&&Sa(s,i,a,a[7],n?$a(i,a[7],c,Wa):Ra(a[7]),Io)},i(a){n||(rt(s,a),n=!0)},o(a){ut(s,a),n=!1},d(a){a&&z(e),s&&s.d(a),r=!1,Ut(o)}}}function za(t,e,n){let{$$slots:r={},$$scope:o}=e;const i=eo();let{shape:s}=e,{editor:a}=e,{transform:c}=e,{svgEl:l}=e,u,d,f;const p=x=>v=>{if(u=x,l){const{left:g,top:m}=l.getBoundingClientRect(),S=v.clientX-g,$=v.clientY-m;d=c.elementToImage(S,$)}else{const{offsetX:g,offsetY:m}=v;d=c.elementToImage(g,m)}f=s,v.target.setPointerCapture(v.pointerId),i("grab",v)},y=x=>{if(u){const[v,g]=c.elementToImage(x.offsetX,x.offsetY),m=[v-d[0],g-d[1]];n(3,s=a(f,u,m)),i("change",s)}},h=x=>{x.target.releasePointerCapture(x.pointerId),u=void 0,f=s,i("release",x)};return t.$$set=x=>{"shape"in x&&n(3,s=x.shape),"editor"in x&&n(4,a=x.editor),"transform"in x&&n(5,c=x.transform),"svgEl"in x&&n(6,l=x.svgEl),"$$scope"in x&&n(7,o=x.$$scope)},[p,y,h,s,a,c,l,o,r]}let ro=class extends Be{constructor(e){super(),je(this,e,za,Ga,De,{shape:3,editor:4,transform:5,svgEl:6})}};function Ja(t){let e,n,r,o,i,s,a,c,l=t[3]&&Po(t);return{c(){e=W("g"),n=W("circle"),l&&l.c(),o=W("circle"),b(n,"class","a9s-handle-buffer svelte-qtyc7s"),b(n,"cx",t[0]),b(n,"cy",t[1]),b(n,"r",r=t[5]+6/t[2]),b(n,"role","button"),b(n,"tabindex","0"),b(o,"class",i=Oo(`a9s-handle-dot${t[3]?" selected":""}`)+" svelte-qtyc7s"),b(o,"cx",t[0]),b(o,"cy",t[1]),b(o,"r",t[5]),b(e,"class",s=`a9s-handle ${t[8].class||""}`.trim())},m(u,d){Z(u,e,d),ct(e,n),l&&l.m(e,null),ct(e,o),a||(c=[nt(n,"dblclick",t[12]),nt(n,"pointerenter",t[13]),nt(n,"pointerleave",t[14]),nt(n,"pointerdown",t[15]),nt(n,"pointerdown",t[6]),nt(n,"pointerup",t[16]),nt(n,"pointerup",t[7])],a=!0)},p(u,d){d&1&&b(n,"cx",u[0]),d&2&&b(n,"cy",u[1]),d&36&&r!==(r=u[5]+6/u[2])&&b(n,"r",r),u[3]?l?l.p(u,d):(l=Po(u),l.c(),l.m(e,o)):l&&(l.d(1),l=null),d&8&&i!==(i=Oo(`a9s-handle-dot${u[3]?" selected":""}`)+" svelte-qtyc7s")&&b(o,"class",i),d&1&&b(o,"cx",u[0]),d&2&&b(o,"cy",u[1]),d&32&&b(o,"r",u[5]),d&256&&s!==(s=`a9s-handle ${u[8].class||""}`.trim())&&b(e,"class",s)},d(u){u&&z(e),l&&l.d(),a=!1,Ut(c)}}}function Qa(t){let e,n,r,o,i,s,a,c,l;return{c(){e=W("g"),n=W("circle"),o=W("circle"),s=W("circle"),b(n,"cx",t[0]),b(n,"cy",t[1]),b(n,"r",r=t[5]*10),b(n,"class","a9s-touch-halo"),Lo(n,"touched",t[4]),b(o,"cx",t[0]),b(o,"cy",t[1]),b(o,"r",i=t[5]+10/t[2]),b(o,"class","a9s-handle-buffer svelte-qtyc7s"),b(o,"role","button"),b(o,"tabindex","0"),b(s,"class","a9s-handle-dot"),b(s,"cx",t[0]),b(s,"cy",t[1]),b(s,"r",a=t[5]+2/t[2]),b(e,"class","a9s-touch-handle")},m(u,d){Z(u,e,d),ct(e,n),ct(e,o),ct(e,s),c||(l=[nt(o,"dblclick",t[9]),nt(o,"pointerdown",t[10]),nt(o,"pointerdown",t[6]),nt(o,"pointerup",t[11]),nt(o,"pointerup",t[7])],c=!0)},p(u,d){d&1&&b(n,"cx",u[0]),d&2&&b(n,"cy",u[1]),d&32&&r!==(r=u[5]*10)&&b(n,"r",r),d&16&&Lo(n,"touched",u[4]),d&1&&b(o,"cx",u[0]),d&2&&b(o,"cy",u[1]),d&36&&i!==(i=u[5]+10/u[2])&&b(o,"r",i),d&1&&b(s,"cx",u[0]),d&2&&b(s,"cy",u[1]),d&36&&a!==(a=u[5]+2/u[2])&&b(s,"r",a)},d(u){u&&z(e),c=!1,Ut(l)}}}function Po(t){let e,n;return{c(){e=W("circle"),b(e,"class","a9s-handle-selected"),b(e,"cx",t[0]),b(e,"cy",t[1]),b(e,"r",n=t[5]+8/t[2])},m(r,o){Z(r,e,o)},p(r,o){o&1&&b(e,"cx",r[0]),o&2&&b(e,"cy",r[1]),o&36&&n!==(n=r[5]+8/r[2])&&b(e,"r",n)},d(r){r&&z(e)}}}function Za(t){let e;function n(o,i){return ce?Qa:Ja}let r=n()(t);return{c(){r.c(),e=yn()},m(o,i){r.m(o,i),Z(o,e,i)},p(o,[i]){r.p(o,i)},i:me,o:me,d(o){o&&z(e),r.d(o)}}}function tl(t,e,n){let r,{x:o}=e,{y:i}=e,{scale:s}=e,{selected:a=void 0}=e,c=!1;const l=m=>{m.pointerType==="touch"&&n(4,c=!0)},u=()=>n(4,c=!1);function d(m){mt.call(this,t,m)}function f(m){mt.call(this,t,m)}function p(m){mt.call(this,t,m)}function y(m){mt.call(this,t,m)}function h(m){mt.call(this,t,m)}function x(m){mt.call(this,t,m)}function v(m){mt.call(this,t,m)}function g(m){mt.call(this,t,m)}return t.$$set=m=>{n(8,e=Br(Br({},e),Co(m))),"x"in m&&n(0,o=m.x),"y"in m&&n(1,i=m.y),"scale"in m&&n(2,s=m.scale),"selected"in m&&n(3,a=m.selected)},t.$$.update=()=>{t.$$.dirty&4&&n(5,r=4/s)},e=Co(e),[o,i,s,a,c,r,l,u,e,d,f,p,y,h,x,v,g]}let Te=class extends Be{constructor(e){super(),je(this,e,tl,Za,De,{x:0,y:1,scale:2,selected:3})}};function el(t){let e,n,r,o,i,s,a;return{c(){e=W("g"),n=W("circle"),o=W("circle"),i=W("circle"),b(n,"class","a9s-polygon-midpoint-buffer svelte-12ykj76"),b(n,"cx",t[0]),b(n,"cy",t[1]),b(n,"r",r=1.75*t[2]),b(o,"class","a9s-polygon-midpoint-outer svelte-12ykj76"),b(o,"cx",t[0]),b(o,"cy",t[1]),b(o,"r",t[2]),b(i,"class","a9s-polygon-midpoint-inner svelte-12ykj76"),b(i,"cx",t[0]),b(i,"cy",t[1]),b(i,"r",t[2]),b(e,"class","a9s-polygon-midpoint svelte-12ykj76")},m(c,l){Z(c,e,l),ct(e,n),ct(e,o),ct(e,i),s||(a=[nt(n,"pointerdown",t[5]),nt(n,"pointerdown",t[3])],s=!0)},p(c,l){l&1&&b(n,"cx",c[0]),l&2&&b(n,"cy",c[1]),l&4&&r!==(r=1.75*c[2])&&b(n,"r",r),l&1&&b(o,"cx",c[0]),l&2&&b(o,"cy",c[1]),l&4&&b(o,"r",c[2]),l&1&&b(i,"cx",c[0]),l&2&&b(i,"cy",c[1]),l&4&&b(i,"r",c[2])},d(c){c&&z(e),s=!1,Ut(a)}}}function nl(t){let e;return{c(){e=W("circle"),b(e,"cx",t[0]),b(e,"cy",t[1]),b(e,"r",t[2])},m(n,r){Z(n,e,r)},p(n,r){r&1&&b(e,"cx",n[0]),r&2&&b(e,"cy",n[1]),r&4&&b(e,"r",n[2])},d(n){n&&z(e)}}}function rl(t){let e;function n(o,i){return ce?nl:el}let r=n()(t);return{c(){r.c(),e=yn()},m(o,i){r.m(o,i),Z(o,e,i)},p(o,[i]){r.p(o,i)},i:me,o:me,d(o){o&&z(e),r.d(o)}}}function ol(t,e,n){let r,{x:o}=e,{y:i}=e,{scale:s}=e;const a=l=>{l.pointerType};function c(l){mt.call(this,t,l)}return t.$$set=l=>{"x"in l&&n(0,o=l.x),"y"in l&&n(1,i=l.y),"scale"in l&&n(4,s=l.scale)},t.$$.update=()=>{t.$$.dirty&16&&n(2,r=4/s)},[o,i,r,a,s,c]}let cs=class extends Be{constructor(e){super(),je(this,e,ol,rl,De,{x:0,y:1,scale:4})}};function ar(t){const e=t.slice(),n=e[10][e[6]];return e[28]=n.point,e}function Do(t,e,n){const r=t.slice();return r[28]=e[n],r[30]=n,r}function lr(t){const e=t.slice(),n=e[10][e[6]];return e[28]=n.point,e}function cr(t){const e=t.slice(),n=e[10][e[6]];return e[28]=n.point,e}function jo(t){let e,n,r,o;return{c(){e=W("circle"),b(e,"cx",n=t[28][0]),b(e,"cy",r=t[28][1]),b(e,"r",o=un/t[3]),b(e,"class","svelte-1h2slbm")},m(i,s){Z(i,e,s)},p(i,s){s[0]&1088&&n!==(n=i[28][0])&&b(e,"cx",n),s[0]&1088&&r!==(r=i[28][1])&&b(e,"cy",r),s[0]&8&&o!==(o=un/i[3])&&b(e,"r",o)},d(i){i&&z(e)}}}function Bo(t){let e,n,r,o,i,s,a,c,l,u;return{c(){e=W("mask"),n=W("rect"),a=W("circle"),b(n,"x",r=t[9].x),b(n,"y",o=t[9].y),b(n,"width",i=t[9].w),b(n,"height",s=t[9].h),b(n,"class","svelte-1h2slbm"),b(a,"cx",c=t[28][0]),b(a,"cy",l=t[28][1]),b(a,"r",u=un/t[3]),b(a,"class","svelte-1h2slbm"),b(e,"id",`${t[19]}-inner`),b(e,"class","a9s-polygon-editor-mask svelte-1h2slbm")},m(d,f){Z(d,e,f),ct(e,n),ct(e,a)},p(d,f){f[0]&512&&r!==(r=d[9].x)&&b(n,"x",r),f[0]&512&&o!==(o=d[9].y)&&b(n,"y",o),f[0]&512&&i!==(i=d[9].w)&&b(n,"width",i),f[0]&512&&s!==(s=d[9].h)&&b(n,"height",s),f[0]&1088&&c!==(c=d[28][0])&&b(a,"cx",c),f[0]&1088&&l!==(l=d[28][1])&&b(a,"cy",l),f[0]&8&&u!==(u=un/d[3])&&b(a,"r",u)},d(d){d&&z(e)}}}function Uo(t){let e,n;return e=new Te({props:{class:"a9s-corner-handle",x:t[28][0],y:t[28][1],scale:t[3],selected:t[8].includes(t[30])}}),e.$on("pointerenter",t[11]),e.$on("pointerleave",t[12]),e.$on("pointerdown",t[15]),e.$on("pointerdown",function(){ht(t[27](`HANDLE-${t[30]}`))&&t[27](`HANDLE-${t[30]}`).apply(this,arguments)}),e.$on("pointerup",t[16](t[30])),{c(){Ft(e.$$.fragment)},m(r,o){It(e,r,o),n=!0},p(r,o){t=r;const i={};o[0]&32&&(i.x=t[28][0]),o[0]&32&&(i.y=t[28][1]),o[0]&8&&(i.scale=t[3]),o[0]&256&&(i.selected=t[8].includes(t[30])),e.$set(i)},i(r){n||(rt(e.$$.fragment,r),n=!0)},o(r){ut(e.$$.fragment,r),n=!1},d(r){Pt(e,r)}}}function Ho(t){let e,n;return e=new cs({props:{x:t[28][0],y:t[28][1],scale:t[3]}}),e.$on("pointerdown",function(){ht(t[18](t[6]))&&t[18](t[6]).apply(this,arguments)}),{c(){Ft(e.$$.fragment)},m(r,o){It(e,r,o),n=!0},p(r,o){t=r;const i={};o[0]&1088&&(i.x=t[28][0]),o[0]&1088&&(i.y=t[28][1]),o[0]&8&&(i.scale=t[3]),e.$set(i)},i(r){n||(rt(e.$$.fragment,r),n=!0)},o(r){ut(e.$$.fragment,r),n=!1},d(r){Pt(e,r)}}}function il(t){let e,n,r,o,i,s,a,c,l,u,d,f,p,y,h,x,v,g,m,S,$,j=t[6]!==void 0&&!t[7]&&jo(cr(t)),_=t[6]!==void 0&&!t[7]&&Bo(lr(t)),P=ue(t[5].points),C=[];for(let R=0;R<P.length;R+=1)C[R]=Uo(Do(t,P,R));const D=R=>ut(C[R],1,1,()=>{C[R]=null});let U=t[6]!==void 0&&!t[7]&&Ho(ar(t));return{c(){e=W("defs"),n=W("mask"),r=W("rect"),c=W("polygon"),j&&j.c(),_&&_.c(),u=Tt(),d=W("polygon"),p=Tt(),y=W("polygon"),x=Tt();for(let R=0;R<C.length;R+=1)C[R].c();v=Tt(),U&&U.c(),g=yn(),b(r,"x",o=t[9].x),b(r,"y",i=t[9].y),b(r,"width",s=t[9].w),b(r,"height",a=t[9].h),b(r,"class","svelte-1h2slbm"),b(c,"points",l=t[5].points.map(Vo).join(" ")),b(c,"class","svelte-1h2slbm"),b(n,"id",`${t[19]}-outer`),b(n,"class","a9s-polygon-editor-mask svelte-1h2slbm"),b(d,"class","a9s-outer"),b(d,"mask",`url(#${t[19]}-outer)`),b(d,"points",f=t[5].points.map(Fo).join(" ")),b(y,"class","a9s-inner a9s-shape-handle"),b(y,"mask",`url(#${t[19]}-inner)`),b(y,"style",t[1]),b(y,"points",h=t[5].points.map(Xo).join(" "))},m(R,T){Z(R,e,T),ct(e,n),ct(n,r),ct(n,c),j&&j.m(n,null),_&&_.m(e,null),Z(R,u,T),Z(R,d,T),Z(R,p,T),Z(R,y,T),Z(R,x,T);for(let E=0;E<C.length;E+=1)C[E]&&C[E].m(R,T);Z(R,v,T),U&&U.m(R,T),Z(R,g,T),m=!0,S||($=[nt(d,"pointerup",t[14]),nt(d,"pointerdown",function(){ht(t[27]("SHAPE"))&&t[27]("SHAPE").apply(this,arguments)}),nt(y,"pointermove",t[13]),nt(y,"pointerup",t[14]),nt(y,"pointerdown",function(){ht(t[27]("SHAPE"))&&t[27]("SHAPE").apply(this,arguments)})],S=!0)},p(R,T){if(t=R,(!m||T[0]&512&&o!==(o=t[9].x))&&b(r,"x",o),(!m||T[0]&512&&i!==(i=t[9].y))&&b(r,"y",i),(!m||T[0]&512&&s!==(s=t[9].w))&&b(r,"width",s),(!m||T[0]&512&&a!==(a=t[9].h))&&b(r,"height",a),(!m||T[0]&32&&l!==(l=t[5].points.map(Vo).join(" ")))&&b(c,"points",l),t[6]!==void 0&&!t[7]?j?j.p(cr(t),T):(j=jo(cr(t)),j.c(),j.m(n,null)):j&&(j.d(1),j=null),t[6]!==void 0&&!t[7]?_?_.p(lr(t),T):(_=Bo(lr(t)),_.c(),_.m(e,null)):_&&(_.d(1),_=null),(!m||T[0]&32&&f!==(f=t[5].points.map(Fo).join(" ")))&&b(d,"points",f),(!m||T[0]&2)&&b(y,"style",t[1]),(!m||T[0]&32&&h!==(h=t[5].points.map(Xo).join(" ")))&&b(y,"points",h),T[0]&134322472){P=ue(t[5].points);let E;for(E=0;E<P.length;E+=1){const A=Do(t,P,E);C[E]?(C[E].p(A,T),rt(C[E],1)):(C[E]=Uo(A),C[E].c(),rt(C[E],1),C[E].m(v.parentNode,v))}for(ke(),E=P.length;E<C.length;E+=1)D(E);Me()}t[6]!==void 0&&!t[7]?U?(U.p(ar(t),T),T[0]&192&&rt(U,1)):(U=Ho(ar(t)),U.c(),rt(U,1),U.m(g.parentNode,g)):U&&(ke(),ut(U,1,1,()=>{U=null}),Me())},i(R){if(!m){for(let T=0;T<P.length;T+=1)rt(C[T]);rt(U),m=!0}},o(R){C=C.filter(Boolean);for(let T=0;T<C.length;T+=1)ut(C[T]);ut(U),m=!1},d(R){R&&(z(e),z(u),z(d),z(p),z(y),z(x),z(v),z(g)),j&&j.d(),_&&_.d(),Gn(C,R),U&&U.d(R),S=!1,Ut($)}}}function sl(t){let e,n;return e=new ro({props:{shape:t[0],transform:t[2],editor:t[17],svgEl:t[4],$$slots:{default:[il,({grab:r})=>({27:r}),({grab:r})=>[r?134217728:0]]},$$scope:{ctx:t}}}),e.$on("change",t[20]),e.$on("grab",t[21]),e.$on("release",t[22]),{c(){Ft(e.$$.fragment)},m(r,o){It(e,r,o),n=!0},p(r,o){const i={};o[0]&1&&(i.shape=r[0]),o[0]&4&&(i.transform=r[2]),o[0]&16&&(i.svgEl=r[4]),o[0]&134219754|o[1]&1&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(rt(e.$$.fragment,r),n=!0)},o(r){ut(e.$$.fragment,r),n=!1},d(r){Pt(e,r)}}}const al=250,ll=1e3,cl=12,un=4.5,Vo=t=>t.join(","),Fo=t=>t.join(","),Xo=t=>t.join(",");function ul(t,e,n){let r,o,i;const s=eo();let{shape:a}=e,{computedStyle:c}=e,{transform:l}=e,{viewportScale:u=1}=e,{svgEl:d}=e,f,p=!1,y,h=[];const x=()=>n(7,p=!0),v=()=>n(7,p=!1),g=E=>{if(h.length>0||!o.some(O=>O.visible)){n(6,f=void 0);return}const[A,M]=l.elementToImage(E.offsetX,E.offsetY),L=O=>Math.pow(O[0]-A,2)+Math.pow(O[1]-M,2),k=r.points.reduce((O,B)=>L(B)<L(O)?B:O),V=o.filter(O=>O.visible).reduce((O,B)=>L(B.point)<L(O.point)?B:O),w=Math.pow(ll/u,2);L(k)<w||L(V.point)<w?n(6,f=o.indexOf(V)):n(6,f=void 0)},m=()=>{document.activeElement!==d&&d.focus()},S=()=>{n(8,h=[]),m()},$=E=>{n(7,p=!0),E.preventDefault(),E.stopPropagation(),y=performance.now()},j=E=>A=>{if(!y||ce||performance.now()-y>al)return;const M=h.includes(E);A.metaKey||A.ctrlKey||A.shiftKey?M?n(8,h=h.filter(L=>L!==E)):n(8,h=[...h,E]):M&&h.length>1?n(8,h=[E]):M?n(8,h=[]):n(8,h=[E]),m()},_=(E,A,M)=>{m();let L;const k=E.geometry;h.length>1?L=k.points.map(([w,O],B)=>h.includes(B)?[w+M[0],O+M[1]]:[w,O]):A==="SHAPE"?L=k.points.map(([w,O])=>[w+M[0],O+M[1]]):L=k.points.map(([w,O],B)=>A===`HANDLE-${B}`?[w+M[0],O+M[1]]:[w,O]);const V=se(L);return{...E,geometry:{points:L,bounds:V}}},P=E=>async A=>{A.stopPropagation();const M=[...r.points.slice(0,E+1),o[E].point,...r.points.slice(E+1)],L=se(M);s("change",{...a,geometry:{points:M,bounds:L}}),await ss();const k=[...document.querySelectorAll(".a9s-handle")][E+1];if(k!=null&&k.firstChild){const V=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:A.clientX,clientY:A.clientY,pointerId:A.pointerId,pointerType:A.pointerType,isPrimary:A.isPrimary,buttons:A.buttons});k.firstChild.dispatchEvent(V)}},C=()=>{if(r.points.length-h.length<3)return;const E=r.points.filter((M,L)=>!h.includes(L)),A=se(E);s("change",{...a,geometry:{points:E,bounds:A}}),n(8,h=[])};rs(()=>{if(ce)return;const E=A=>{(A.key==="Delete"||A.key==="Backspace")&&(A.preventDefault(),C())};return d.addEventListener("pointermove",g),d.addEventListener("keydown",E),()=>{d.removeEventListener("pointermove",g),d.removeEventListener("keydown",E)}});const D=`polygon-mask-${Math.random().toString(36).substring(2,12)}`;function U(E){mt.call(this,t,E)}function R(E){mt.call(this,t,E)}function T(E){mt.call(this,t,E)}return t.$$set=E=>{"shape"in E&&n(0,a=E.shape),"computedStyle"in E&&n(1,c=E.computedStyle),"transform"in E&&n(2,l=E.transform),"viewportScale"in E&&n(3,u=E.viewportScale),"svgEl"in E&&n(4,d=E.svgEl)},t.$$.update=()=>{t.$$.dirty[0]&1&&n(5,r=a.geometry),t.$$.dirty[0]&40&&n(10,o=ce?[]:r.points.map((E,A)=>{const M=A===r.points.length-1?r.points[0]:r.points[A+1],L=(E[0]+M[0])/2,k=(E[1]+M[1])/2,V=Math.sqrt(Math.pow(M[0]-L,2)+Math.pow(M[1]-k,2))>cl/u;return{point:[L,k],visible:V}})),t.$$.dirty[0]&40&&n(9,i=no(r.bounds,un/u))},[a,c,l,u,d,r,f,p,h,i,o,x,v,g,S,$,j,_,P,D,U,R,T]}class dl extends Be{constructor(e){super(),je(this,e,ul,sl,De,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}function fl(t){let e,n,r,o,i,s,a,c,l,u,d,f,p,y,h,x,v,g,m,S,$,j,_,P,C,D,U,R,T,E,A,M,L,k,V,w,O,B,I,X,K,Y,gt,ot,zt,St,ie,G,tt,J,st,it,F,Lt,Rt;return St=new Te({props:{class:"a9s-corner-handle-topleft",x:t[5].x,y:t[5].y,scale:t[3]}}),St.$on("pointerdown",function(){ht(t[12]("TOP_LEFT"))&&t[12]("TOP_LEFT").apply(this,arguments)}),G=new Te({props:{class:"a9s-corner-handle-topright",x:t[5].x+t[5].w,y:t[5].y,scale:t[3]}}),G.$on("pointerdown",function(){ht(t[12]("TOP_RIGHT"))&&t[12]("TOP_RIGHT").apply(this,arguments)}),J=new Te({props:{class:"a9s-corner-handle-bottomright",x:t[5].x+t[5].w,y:t[5].y+t[5].h,scale:t[3]}}),J.$on("pointerdown",function(){ht(t[12]("BOTTOM_RIGHT"))&&t[12]("BOTTOM_RIGHT").apply(this,arguments)}),it=new Te({props:{class:"a9s-corner-handle-bottomleft",x:t[5].x,y:t[5].y+t[5].h,scale:t[3]}}),it.$on("pointerdown",function(){ht(t[12]("BOTTOM_LEFT"))&&t[12]("BOTTOM_LEFT").apply(this,arguments)}),{c(){e=W("defs"),n=W("mask"),r=W("rect"),c=W("rect"),p=Tt(),y=W("rect"),m=Tt(),S=W("rect"),C=Tt(),D=W("rect"),E=Tt(),A=W("rect"),V=Tt(),w=W("rect"),X=Tt(),K=W("rect"),zt=Tt(),Ft(St.$$.fragment),ie=Tt(),Ft(G.$$.fragment),tt=Tt(),Ft(J.$$.fragment),st=Tt(),Ft(it.$$.fragment),b(r,"class","rect-mask-bg svelte-1njczvj"),b(r,"x",o=t[6].x),b(r,"y",i=t[6].y),b(r,"width",s=t[6].w),b(r,"height",a=t[6].h),b(c,"class","rect-mask-fg svelte-1njczvj"),b(c,"x",l=t[5].x),b(c,"y",u=t[5].y),b(c,"width",d=t[5].w),b(c,"height",f=t[5].h),b(n,"id",t[8]),b(n,"class","a9s-rectangle-editor-mask svelte-1njczvj"),b(y,"class","a9s-outer"),b(y,"mask",`url(#${t[8]})`),b(y,"x",h=t[5].x),b(y,"y",x=t[5].y),b(y,"width",v=t[5].w),b(y,"height",g=t[5].h),b(S,"class","a9s-inner a9s-shape-handle"),b(S,"style",t[1]),b(S,"x",$=t[5].x),b(S,"y",j=t[5].y),b(S,"width",_=t[5].w),b(S,"height",P=t[5].h),b(D,"class","a9s-edge-handle a9s-edge-handle-top"),b(D,"x",U=t[5].x),b(D,"y",R=t[5].y),b(D,"height",1),b(D,"width",T=t[5].w),b(A,"class","a9s-edge-handle a9s-edge-handle-right"),b(A,"x",M=t[5].x+t[5].w),b(A,"y",L=t[5].y),b(A,"height",k=t[5].h),b(A,"width",1),b(w,"class","a9s-edge-handle a9s-edge-handle-bottom"),b(w,"x",O=t[5].x),b(w,"y",B=t[5].y+t[5].h),b(w,"height",1),b(w,"width",I=t[5].w),b(K,"class","a9s-edge-handle a9s-edge-handle-left"),b(K,"x",Y=t[5].x),b(K,"y",gt=t[5].y),b(K,"height",ot=t[5].h),b(K,"width",1)},m(q,H){Z(q,e,H),ct(e,n),ct(n,r),ct(n,c),Z(q,p,H),Z(q,y,H),Z(q,m,H),Z(q,S,H),Z(q,C,H),Z(q,D,H),Z(q,E,H),Z(q,A,H),Z(q,V,H),Z(q,w,H),Z(q,X,H),Z(q,K,H),Z(q,zt,H),It(St,q,H),Z(q,ie,H),It(G,q,H),Z(q,tt,H),It(J,q,H),Z(q,st,H),It(it,q,H),F=!0,Lt||(Rt=[nt(y,"pointerdown",function(){ht(t[12]("SHAPE"))&&t[12]("SHAPE").apply(this,arguments)}),nt(S,"pointerdown",function(){ht(t[12]("SHAPE"))&&t[12]("SHAPE").apply(this,arguments)}),nt(D,"pointerdown",function(){ht(t[12]("TOP"))&&t[12]("TOP").apply(this,arguments)}),nt(A,"pointerdown",function(){ht(t[12]("RIGHT"))&&t[12]("RIGHT").apply(this,arguments)}),nt(w,"pointerdown",function(){ht(t[12]("BOTTOM"))&&t[12]("BOTTOM").apply(this,arguments)}),nt(K,"pointerdown",function(){ht(t[12]("LEFT"))&&t[12]("LEFT").apply(this,arguments)})],Lt=!0)},p(q,H){t=q,(!F||H&64&&o!==(o=t[6].x))&&b(r,"x",o),(!F||H&64&&i!==(i=t[6].y))&&b(r,"y",i),(!F||H&64&&s!==(s=t[6].w))&&b(r,"width",s),(!F||H&64&&a!==(a=t[6].h))&&b(r,"height",a),(!F||H&32&&l!==(l=t[5].x))&&b(c,"x",l),(!F||H&32&&u!==(u=t[5].y))&&b(c,"y",u),(!F||H&32&&d!==(d=t[5].w))&&b(c,"width",d),(!F||H&32&&f!==(f=t[5].h))&&b(c,"height",f),(!F||H&32&&h!==(h=t[5].x))&&b(y,"x",h),(!F||H&32&&x!==(x=t[5].y))&&b(y,"y",x),(!F||H&32&&v!==(v=t[5].w))&&b(y,"width",v),(!F||H&32&&g!==(g=t[5].h))&&b(y,"height",g),(!F||H&2)&&b(S,"style",t[1]),(!F||H&32&&$!==($=t[5].x))&&b(S,"x",$),(!F||H&32&&j!==(j=t[5].y))&&b(S,"y",j),(!F||H&32&&_!==(_=t[5].w))&&b(S,"width",_),(!F||H&32&&P!==(P=t[5].h))&&b(S,"height",P),(!F||H&32&&U!==(U=t[5].x))&&b(D,"x",U),(!F||H&32&&R!==(R=t[5].y))&&b(D,"y",R),(!F||H&32&&T!==(T=t[5].w))&&b(D,"width",T),(!F||H&32&&M!==(M=t[5].x+t[5].w))&&b(A,"x",M),(!F||H&32&&L!==(L=t[5].y))&&b(A,"y",L),(!F||H&32&&k!==(k=t[5].h))&&b(A,"height",k),(!F||H&32&&O!==(O=t[5].x))&&b(w,"x",O),(!F||H&32&&B!==(B=t[5].y+t[5].h))&&b(w,"y",B),(!F||H&32&&I!==(I=t[5].w))&&b(w,"width",I),(!F||H&32&&Y!==(Y=t[5].x))&&b(K,"x",Y),(!F||H&32&&gt!==(gt=t[5].y))&&b(K,"y",gt),(!F||H&32&&ot!==(ot=t[5].h))&&b(K,"height",ot);const kt={};H&32&&(kt.x=t[5].x),H&32&&(kt.y=t[5].y),H&8&&(kt.scale=t[3]),St.$set(kt);const Ot={};H&32&&(Ot.x=t[5].x+t[5].w),H&32&&(Ot.y=t[5].y),H&8&&(Ot.scale=t[3]),G.$set(Ot);const Mt={};H&32&&(Mt.x=t[5].x+t[5].w),H&32&&(Mt.y=t[5].y+t[5].h),H&8&&(Mt.scale=t[3]),J.$set(Mt);const he={};H&32&&(he.x=t[5].x),H&32&&(he.y=t[5].y+t[5].h),H&8&&(he.scale=t[3]),it.$set(he)},i(q){F||(rt(St.$$.fragment,q),rt(G.$$.fragment,q),rt(J.$$.fragment,q),rt(it.$$.fragment,q),F=!0)},o(q){ut(St.$$.fragment,q),ut(G.$$.fragment,q),ut(J.$$.fragment,q),ut(it.$$.fragment,q),F=!1},d(q){q&&(z(e),z(p),z(y),z(m),z(S),z(C),z(D),z(E),z(A),z(V),z(w),z(X),z(K),z(zt),z(ie),z(tt),z(st)),Pt(St,q),Pt(G,q),Pt(J,q),Pt(it,q),Lt=!1,Ut(Rt)}}}function pl(t){let e,n;return e=new ro({props:{shape:t[0],transform:t[2],editor:t[7],svgEl:t[4],$$slots:{default:[fl,({grab:r})=>({12:r}),({grab:r})=>r?4096:0]},$$scope:{ctx:t}}}),e.$on("grab",t[9]),e.$on("change",t[10]),e.$on("release",t[11]),{c(){Ft(e.$$.fragment)},m(r,o){It(e,r,o),n=!0},p(r,[o]){const i={};o&1&&(i.shape=r[0]),o&4&&(i.transform=r[2]),o&16&&(i.svgEl=r[4]),o&12394&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(rt(e.$$.fragment,r),n=!0)},o(r){ut(e.$$.fragment,r),n=!1},d(r){Pt(e,r)}}}function hl(t,e,n){let r,o,{shape:i}=e,{computedStyle:s}=e,{transform:a}=e,{viewportScale:c=1}=e,{svgEl:l}=e;const u=(h,x,v)=>{const g=h.geometry.bounds;let[m,S]=[g.minX,g.minY],[$,j]=[g.maxX,g.maxY];const[_,P]=v;if(x==="SHAPE")m+=_,$+=_,S+=P,j+=P;else{switch(x){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{S+=P;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{j+=P;break}}switch(x){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{m+=_;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{$+=_;break}}}const C=Math.min(m,$),D=Math.min(S,j),U=Math.abs($-m),R=Math.abs(j-S);return{...h,geometry:{x:C,y:D,w:U,h:R,bounds:{minX:C,minY:D,maxX:C+U,maxY:D+R}}}},d=`rect-mask-${Math.random().toString(36).substring(2,12)}`;function f(h){mt.call(this,t,h)}function p(h){mt.call(this,t,h)}function y(h){mt.call(this,t,h)}return t.$$set=h=>{"shape"in h&&n(0,i=h.shape),"computedStyle"in h&&n(1,s=h.computedStyle),"transform"in h&&n(2,a=h.transform),"viewportScale"in h&&n(3,c=h.viewportScale),"svgEl"in h&&n(4,l=h.svgEl)},t.$$.update=()=>{t.$$.dirty&1&&n(5,r=i.geometry),t.$$.dirty&40&&n(6,o=no(r.bounds,2/c))},[i,s,a,c,l,r,o,u,d,f,p,y]}class gl extends Be{constructor(e){super(),je(this,e,hl,pl,De,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4})}}var qo=Object.prototype.hasOwnProperty;function Vr(t,e){var n,r;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((r=t.length)===e.length)for(;r--&&Vr(t[r],e[r]););return r===-1}if(!n||typeof t=="object"){r=0;for(n in t)if(qo.call(t,n)&&++r&&!qo.call(e,n)||!(n in e)||!Vr(t[n],e[n]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}const ml=12,yl=(t,e)=>t.polygons.reduce((n,r,o)=>{const i=r.rings.reduce((s,a,c)=>{const l=a.points.map((u,d)=>{const f=d===a.points.length-1?a.points[0]:a.points[d+1],p=(u[0]+f[0])/2,y=(u[1]+f[1])/2,h=Math.sqrt(Math.pow(f[0]-p,2)+Math.pow(f[1]-y,2))>ml/e;return{point:[p,y],visible:h,elementIdx:o,ringIdx:c,pointIdx:d}});return[...s,...l]},[]);return[...n,...i]},[]);function ur(t){const e=t.slice(),n=e[10][e[6]];return e[29]=n.point,e}function Ko(t,e,n){const r=t.slice();return r[30]=e[n],r[32]=n,r}function Yo(t,e,n){const r=t.slice();return r[33]=e[n],r[35]=n,r}function Wo(t,e,n){const r=t.slice();return r[29]=e[n],r[37]=n,r}function dr(t){const e=t.slice(),n=e[10][e[6]];return e[29]=n.point,e}function fr(t){const e=t.slice(),n=e[10][e[6]];return e[29]=n.point,e}function Go(t){let e,n,r,o;return{c(){e=W("circle"),b(e,"cx",n=t[29][0]),b(e,"cy",r=t[29][1]),b(e,"r",o=dn/t[3]),b(e,"class","svelte-1vxo6dc")},m(i,s){Z(i,e,s)},p(i,s){s[0]&1088&&n!==(n=i[29][0])&&b(e,"cx",n),s[0]&1088&&r!==(r=i[29][1])&&b(e,"cy",r),s[0]&8&&o!==(o=dn/i[3])&&b(e,"r",o)},d(i){i&&z(e)}}}function zo(t){let e,n,r,o,i,s,a,c,l,u;return{c(){e=W("mask"),n=W("rect"),a=W("circle"),b(n,"x",r=t[9].x),b(n,"y",o=t[9].y),b(n,"width",i=t[9].w),b(n,"height",s=t[9].h),b(n,"class","svelte-1vxo6dc"),b(a,"cx",c=t[29][0]),b(a,"cy",l=t[29][1]),b(a,"r",u=dn/t[3]),b(a,"class","svelte-1vxo6dc"),b(e,"id",`${t[18]}-${t[32]}-inner`),b(e,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc")},m(d,f){Z(d,e,f),ct(e,n),ct(e,a)},p(d,f){f[0]&512&&r!==(r=d[9].x)&&b(n,"x",r),f[0]&512&&o!==(o=d[9].y)&&b(n,"y",o),f[0]&512&&i!==(i=d[9].w)&&b(n,"width",i),f[0]&512&&s!==(s=d[9].h)&&b(n,"height",s),f[0]&1088&&c!==(c=d[29][0])&&b(a,"cx",c),f[0]&1088&&l!==(l=d[29][1])&&b(a,"cy",l),f[0]&8&&u!==(u=dn/d[3])&&b(a,"r",u)},d(d){d&&z(e)}}}function Jo(t){let e,n;function r(...o){return t[19](t[32],t[35],t[37],...o)}return e=new Te({props:{class:"a9s-corner-handle",x:t[29][0],y:t[29][1],scale:t[3],selected:t[8].some(r)}}),e.$on("pointerenter",t[11]),e.$on("pointerleave",t[12]),e.$on("pointerdown",t[14]),e.$on("pointerdown",function(){ht(t[28](`HANDLE-${t[32]}-${t[35]}-${t[37]}`))&&t[28](`HANDLE-${t[32]}-${t[35]}-${t[37]}`).apply(this,arguments)}),e.$on("pointerup",t[15](t[32],t[35],t[37])),{c(){Ft(e.$$.fragment)},m(o,i){It(e,o,i),n=!0},p(o,i){t=o;const s={};i[0]&32&&(s.x=t[29][0]),i[0]&32&&(s.y=t[29][1]),i[0]&8&&(s.scale=t[3]),i[0]&256&&(s.selected=t[8].some(r)),e.$set(s)},i(o){n||(rt(e.$$.fragment,o),n=!0)},o(o){ut(e.$$.fragment,o),n=!1},d(o){Pt(e,o)}}}function Qo(t){let e,n,r=ue(t[33].points),o=[];for(let s=0;s<r.length;s+=1)o[s]=Jo(Wo(t,r,s));const i=s=>ut(o[s],1,1,()=>{o[s]=null});return{c(){for(let s=0;s<o.length;s+=1)o[s].c();e=yn()},m(s,a){for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(s,a);Z(s,e,a),n=!0},p(s,a){if(a[0]&268491048){r=ue(s[33].points);let c;for(c=0;c<r.length;c+=1){const l=Wo(s,r,c);o[c]?(o[c].p(l,a),rt(o[c],1)):(o[c]=Jo(l),o[c].c(),rt(o[c],1),o[c].m(e.parentNode,e))}for(ke(),c=r.length;c<o.length;c+=1)i(c);Me()}},i(s){if(!n){for(let a=0;a<r.length;a+=1)rt(o[a]);n=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)ut(o[a]);n=!1},d(s){s&&z(e),Gn(o,s)}}}function Zo(t){let e,n,r,o,i,s,a,c,l,u,d,f,p,y,h,x,v,g=t[6]!==void 0&&!t[7]&&Go(fr(t)),m=t[6]!==void 0&&!t[7]&&zo(dr(t)),S=ue(t[30].rings),$=[];for(let _=0;_<S.length;_+=1)$[_]=Qo(Yo(t,S,_));const j=_=>ut($[_],1,1,()=>{$[_]=null});return{c(){e=W("g"),n=W("defs"),r=W("mask"),o=W("rect"),l=W("path"),g&&g.c(),m&&m.c(),d=W("path"),p=W("path");for(let _=0;_<$.length;_+=1)$[_].c();b(o,"x",i=t[9].x),b(o,"y",s=t[9].y),b(o,"width",a=t[9].w),b(o,"height",c=t[9].h),b(o,"class","svelte-1vxo6dc"),b(l,"d",u=we(t[30])),b(l,"class","svelte-1vxo6dc"),b(r,"id",`${t[18]}-${t[32]}-outer`),b(r,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc"),b(d,"class","a9s-outer"),b(d,"mask",`url(#${t[18]}-${t[32]}-outer)`),b(d,"fill-rule","evenodd"),b(d,"d",f=we(t[30])),b(p,"class","a9s-inner"),b(p,"mask",`url(#${t[18]}-${t[32]}-inner)`),b(p,"style",t[1]),b(p,"fill-rule","evenodd"),b(p,"d",y=we(t[30]))},m(_,P){Z(_,e,P),ct(e,n),ct(n,r),ct(r,o),ct(r,l),g&&g.m(r,null),m&&m.m(n,null),ct(e,d),ct(e,p);for(let C=0;C<$.length;C+=1)$[C]&&$[C].m(e,null);h=!0,x||(v=[nt(d,"pointerup",t[13]),nt(d,"pointerdown",function(){ht(t[28]("SHAPE"))&&t[28]("SHAPE").apply(this,arguments)}),nt(p,"pointerup",t[13]),nt(p,"pointerdown",function(){ht(t[28]("SHAPE"))&&t[28]("SHAPE").apply(this,arguments)})],x=!0)},p(_,P){if(t=_,(!h||P[0]&512&&i!==(i=t[9].x))&&b(o,"x",i),(!h||P[0]&512&&s!==(s=t[9].y))&&b(o,"y",s),(!h||P[0]&512&&a!==(a=t[9].w))&&b(o,"width",a),(!h||P[0]&512&&c!==(c=t[9].h))&&b(o,"height",c),(!h||P[0]&32&&u!==(u=we(t[30])))&&b(l,"d",u),t[6]!==void 0&&!t[7]?g?g.p(fr(t),P):(g=Go(fr(t)),g.c(),g.m(r,null)):g&&(g.d(1),g=null),t[6]!==void 0&&!t[7]?m?m.p(dr(t),P):(m=zo(dr(t)),m.c(),m.m(n,null)):m&&(m.d(1),m=null),(!h||P[0]&32&&f!==(f=we(t[30])))&&b(d,"d",f),(!h||P[0]&2)&&b(p,"style",t[1]),(!h||P[0]&32&&y!==(y=we(t[30])))&&b(p,"d",y),P[0]&268491048){S=ue(t[30].rings);let C;for(C=0;C<S.length;C+=1){const D=Yo(t,S,C);$[C]?($[C].p(D,P),rt($[C],1)):($[C]=Qo(D),$[C].c(),rt($[C],1),$[C].m(e,null))}for(ke(),C=S.length;C<$.length;C+=1)j(C);Me()}},i(_){if(!h){for(let P=0;P<S.length;P+=1)rt($[P]);h=!0}},o(_){$=$.filter(Boolean);for(let P=0;P<$.length;P+=1)ut($[P]);h=!1},d(_){_&&z(e),g&&g.d(),m&&m.d(),Gn($,_),x=!1,Ut(v)}}}function ti(t){let e,n;return e=new cs({props:{x:t[29][0],y:t[29][1],scale:t[3]}}),e.$on("pointerdown",function(){ht(t[17](t[6]))&&t[17](t[6]).apply(this,arguments)}),{c(){Ft(e.$$.fragment)},m(r,o){It(e,r,o),n=!0},p(r,o){t=r;const i={};o[0]&1088&&(i.x=t[29][0]),o[0]&1088&&(i.y=t[29][1]),o[0]&8&&(i.scale=t[3]),e.$set(i)},i(r){n||(rt(e.$$.fragment,r),n=!0)},o(r){ut(e.$$.fragment,r),n=!1},d(r){Pt(e,r)}}}function vl(t){let e,n,r,o=ue(t[5].polygons),i=[];for(let c=0;c<o.length;c+=1)i[c]=Zo(Ko(t,o,c));const s=c=>ut(i[c],1,1,()=>{i[c]=null});let a=t[6]!==void 0&&!t[7]&&ti(ur(t));return{c(){for(let c=0;c<i.length;c+=1)i[c].c();e=Tt(),a&&a.c(),n=yn()},m(c,l){for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(c,l);Z(c,e,l),a&&a.m(c,l),Z(c,n,l),r=!0},p(c,l){if(l[0]&268763114){o=ue(c[5].polygons);let u;for(u=0;u<o.length;u+=1){const d=Ko(c,o,u);i[u]?(i[u].p(d,l),rt(i[u],1)):(i[u]=Zo(d),i[u].c(),rt(i[u],1),i[u].m(e.parentNode,e))}for(ke(),u=o.length;u<i.length;u+=1)s(u);Me()}c[6]!==void 0&&!c[7]?a?(a.p(ur(c),l),l[0]&192&&rt(a,1)):(a=ti(ur(c)),a.c(),rt(a,1),a.m(n.parentNode,n)):a&&(ke(),ut(a,1,1,()=>{a=null}),Me())},i(c){if(!r){for(let l=0;l<o.length;l+=1)rt(i[l]);rt(a),r=!0}},o(c){i=i.filter(Boolean);for(let l=0;l<i.length;l+=1)ut(i[l]);ut(a),r=!1},d(c){c&&(z(e),z(n)),Gn(i,c),a&&a.d(c)}}}function bl(t){let e,n;return e=new ro({props:{shape:t[0],transform:t[2],editor:t[16],svgEl:t[4],$$slots:{default:[vl,({grab:r})=>({28:r}),({grab:r})=>[r?268435456:0]]},$$scope:{ctx:t}}}),e.$on("change",t[20]),e.$on("grab",t[21]),e.$on("release",t[22]),{c(){Ft(e.$$.fragment)},m(r,o){It(e,r,o),n=!0},p(r,o){const i={};o[0]&1&&(i.shape=r[0]),o[0]&4&&(i.transform=r[2]),o[0]&16&&(i.svgEl=r[4]),o[0]&268437482|o[1]&128&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(rt(e.$$.fragment,r),n=!0)},o(r){ut(e.$$.fragment,r),n=!1},d(r){Pt(e,r)}}}const wl=250,xl=1e3,dn=4.5;function El(t,e,n){let r,o,i;const s=eo();let{shape:a}=e,{computedStyle:c}=e,{transform:l}=e,{viewportScale:u=1}=e,{svgEl:d}=e,f,p=!1,y,h=[];const x=()=>n(7,p=!0),v=()=>n(7,p=!1),g=A=>{if(h.length>0||!o.some(B=>B.visible)){n(6,f=void 0);return}const[M,L]=l.elementToImage(A.offsetX,A.offsetY),k=B=>Math.pow(B[0]-M,2)+Math.pow(B[1]-L,2),V=Ba(r).reduce((B,I)=>k(I)<k(B)?I:B),w=o.filter(B=>B.visible).reduce((B,I)=>k(I.point)<k(B.point)?I:B),O=Math.pow(xl/u,2);k(V)<O||k(w.point)<O?n(6,f=o.indexOf(w)):n(6,f=void 0)},m=()=>{document.activeElement!==d&&d.focus()},S=()=>{n(8,h=[]),m()},$=A=>{n(7,p=!0),A.preventDefault(),A.stopPropagation(),y=performance.now()},j=(A,M,L)=>k=>{if(!y||ce||performance.now()-y>wl)return;const V=O=>O.polygon===A&&O.ring===M&&O.point===L,w=h.some(V);k.metaKey||k.ctrlKey||k.shiftKey?w?n(8,h=h.filter(O=>!V(O))):n(8,h=[...h,{polygon:A,ring:M,point:L}]):w&&h.length>1?n(8,h=[{polygon:A,ring:M,point:L}]):w?n(8,h=[]):n(8,h=[{polygon:A,ring:M,point:L}]),m()},_=(A,M,L)=>{m();const k=A.geometry.polygons;let V;if(M==="SHAPE")V=k.map(w=>{const O=w.rings.map((I,X)=>({points:I.points.map((K,Y)=>[K[0]+L[0],K[1]+L[1]])})),B=se(O[0].points);return{rings:O,bounds:B}});else{const[w,O,B,I]=M.split("-").map(X=>parseInt(X));V=k.map((X,K)=>{if(K===O){const Y=X.rings.map((ot,zt)=>zt===B?{points:ot.points.map((St,ie)=>ie===I?[St[0]+L[0],St[1]+L[1]]:St)}:ot),gt=se(Y[0].points);return{rings:Y,bounds:gt}}else return X})}return{...A,geometry:{polygons:V,bounds:sr(V)}}},P=A=>async M=>{M.stopPropagation();const L=o[A],k=r.polygons.map((w,O)=>{if(O===L.elementIdx){const B=w.rings.map((X,K)=>K===L.ringIdx?{points:[...X.points.slice(0,L.pointIdx+1),L.point,...X.points.slice(L.pointIdx+1)]}:X),I=se(B[0].points);return{rings:B,bounds:I}}else return w});s("change",{...a,geometry:{polygons:k,bounds:sr(k)}}),await ss();const V=[...document.querySelectorAll(".a9s-handle")][A+1];if(V!=null&&V.firstChild){const w=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:M.clientX,clientY:M.clientY,pointerId:M.pointerId,pointerType:M.pointerType,isPrimary:M.isPrimary,buttons:M.buttons});V.firstChild.dispatchEvent(w)}},C=()=>{const A=r.polygons.map((M,L)=>{if(h.some(k=>k.polygon===L)){const k=M.rings.map((w,O)=>{const B=h.filter(I=>I.polygon===L&&I.ring===O);return B.length&&w.points.length-B.length>=3?{points:w.points.filter((I,X)=>!B.some(K=>K.point===X))}:w}),V=se(k[0].points);return{rings:k,bounds:V}}else return M});!Vr(r.polygons,A)&&(s("change",{...a,geometry:{polygons:A,bounds:sr(A)}}),n(8,h=[]))};rs(()=>{if(ce)return;const A=M=>{(M.key==="Delete"||M.key==="Backspace")&&(M.preventDefault(),C())};return d.addEventListener("pointermove",g),d.addEventListener("keydown",A),()=>{d.removeEventListener("pointermove",g),d.removeEventListener("keydown",A)}});const D=`polygon-mask-${Math.random().toString(36).substring(2,12)}`,U=(A,M,L,{polygon:k,ring:V,point:w})=>k===A&&V===M&&w===L;function R(A){mt.call(this,t,A)}function T(A){mt.call(this,t,A)}function E(A){mt.call(this,t,A)}return t.$$set=A=>{"shape"in A&&n(0,a=A.shape),"computedStyle"in A&&n(1,c=A.computedStyle),"transform"in A&&n(2,l=A.transform),"viewportScale"in A&&n(3,u=A.viewportScale),"svgEl"in A&&n(4,d=A.svgEl)},t.$$.update=()=>{t.$$.dirty[0]&1&&n(5,r=a.geometry),t.$$.dirty[0]&40&&n(10,o=ce?[]:yl(r,u)),t.$$.dirty[0]&40&&n(9,i=no(r.bounds,dn/u))},[a,c,l,u,d,r,f,p,h,i,o,x,v,S,$,j,_,P,D,U,R,T,E]}class Al extends Be{constructor(e){super(),je(this,e,El,bl,De,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}Kt.RECTANGLE,Kt.POLYGON,Kt.MULTIPOLYGON;typeof navigator>"u"||navigator.userAgent.indexOf("Mac OS X");const vt=[];for(let t=0;t<256;++t)vt.push((t+256).toString(16).slice(1));function $l(t,e=0){return(vt[t[e+0]]+vt[t[e+1]]+vt[t[e+2]]+vt[t[e+3]]+"-"+vt[t[e+4]]+vt[t[e+5]]+"-"+vt[t[e+6]]+vt[t[e+7]]+"-"+vt[t[e+8]]+vt[t[e+9]]+"-"+vt[t[e+10]]+vt[t[e+11]]+vt[t[e+12]]+vt[t[e+13]]+vt[t[e+14]]+vt[t[e+15]]).toLowerCase()}let pr;const Sl=new Uint8Array(16);function Rl(){if(!pr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");pr=crypto.getRandomValues.bind(crypto)}return pr(Sl)}const Tl=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ei={randomUUID:Tl};function Cl(t,e,n){var r;if(ei.randomUUID&&!t)return ei.randomUUID();t=t||{};const o=t.random??((r=t.rng)==null?void 0:r.call(t))??Rl();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,$l(o)}const Ap=(t,e,n,r)=>({id:Cl(),annotation:typeof t=="string"?t:t.id,created:new Date,creator:r,...e});var us=(t=>(t.BODY_ONLY="BODY_ONLY",t.TARGET_ONLY="TARGET_ONLY",t))(us||{}),ds=(t=>(t.LOCAL="LOCAL",t.REMOTE="REMOTE",t.SILENT="SILENT",t))(ds||{});const Ol="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Ll=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=Ol[n[t]&63];return e};Ll();var hr={exports:{}},qe={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ni;function kl(){if(ni)return qe;ni=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,o,i){var s=null;if(i!==void 0&&(s=""+i),o.key!==void 0&&(s=""+o.key),"key"in o){i={};for(var a in o)a!=="key"&&(i[a]=o[a])}else i=o;return o=i.ref,{$$typeof:t,type:r,key:s,ref:o!==void 0?o:null,props:i}}return qe.Fragment=e,qe.jsx=n,qe.jsxs=n,qe}var ri;function Ml(){return ri||(ri=1,hr.exports=kl()),hr.exports}var dt=Ml();const _l={namespaces:{tei:"http://www.tei-c.org/ns/1.0",teieg:"http://www.tei-c.org/ns/Examples",rng:"http://relaxng.org/ns/structure/1.0"},tei:{eg:["<pre>","</pre>"],ptr:['<a href="$rw@target">$@target</a>'],ref:[["[target]",['<a href="$rw@target">',"</a>"]]],graphic:function(t){let e=t.ownerDocument.createElement("img");return e.src=this.rw(t.getAttribute("url")),t.hasAttribute("width")&&e.setAttribute("width",t.getAttribute("width")),t.hasAttribute("height")&&e.setAttribute("height",t.getAttribute("height")),e},list:[["[type=gloss]",function(t){const e=t.ownerDocument;let n=e.createElement("dl");for(let r of Array.from(t.children))if(r.nodeType==1){if(r.localName=="tei-label"){let o=e.createElement("dt");o.innerHTML=r.innerHTML,n.appendChild(o)}if(r.localName=="tei-item"){let o=e.createElement("dd");o.innerHTML=r.innerHTML,n.appendChild(o)}}return n}]],note:[["[place=end]",function(t){const e=t.ownerDocument;this.noteIndex?this.noteIndex++:this.noteIndex=1;let n="_note_"+this.noteIndex,r=e.createElement("a");r.setAttribute("id","src"+n),r.setAttribute("href","#"+n),r.innerHTML=this.noteIndex;let o=e.createElement("sup");o.appendChild(r);let i=e.querySelector("ol.notes");i||(i=e.createElement("ol"),i.setAttribute("class","notes"),this.dom.appendChild(i));let s=e.createElement("li");return s.id=n,s.innerHTML=t.innerHTML,i.appendChild(s),o}],["_",["(",")"]]],teiHeader:function(t){this.hideContent(t,!1)},title:[["tei-titlestmt>tei-title",function(t){const e=t.ownerDocument;let n=e.createElement("title");n.innerHTML=t.innerText,e.querySelector("head").appendChild(n)}]]},teieg:{egXML:function(t){const e=t.ownerDocument;let n=e.createElement("pre"),r=e.createElement("code");n.appendChild(r);let o=this.serialize(t,!0).replace(/</g,"&lt;"),i=o.match(/^[\t ]+/);return i&&(o=o.replace(new RegExp("^"+i[0],"mg"),"")),r.innerHTML=o,n}}};function Nl(t,e){let n=1,r=t;for(;r&&r.previousElementSibling!==null&&(!e||r.previousElementSibling.localName==e)&&(n++,r=r.previousElementSibling,!!r.previousElementSibling););return n}function fs(t){const e=t.ownerDocument;let n=r=>{let o;switch(r.nodeType){case 1:o=e.createElement(r.nodeName);break;case 9:o=e.implementation.createDocument();break;case 11:o=e.createDocumentFragment();break;default:o=r.cloneNode(!0)}if(r.attributes)for(let i of Array.from(r.attributes))i.name!=="data-processed"&&o.setAttribute(i.name,i.value);for(let i of Array.from(r.childNodes))if(i.nodeType==1)if(i.hasAttribute("data-original")){for(let s of Array.from(i.childNodes)){let a=o.appendChild(n(s));a.nodeType===1&&a.hasAttribute("data-origid")&&(a.setAttribute("id",a.getAttribute("data-origid")),a.removeAttribute("data-origid"))}return o}else i.hasAttribute("data-origname")&&o.appendChild(n(i));else o.appendChild(i.cloneNode());return o};return n(t)}function ps(t){return t.replace(/ .*$/,"")}function hs(t,e=!0){const n=t.ownerDocument;if(t.childNodes.length>0){let r=n.createElement("cetei-original");t.appendChild(r),r.setAttribute("hidden",""),r.setAttribute("data-original",""),r.setAttribute("role","none");for(let o of Array.from(t.childNodes))if(o!==r){if(o.nodeType===1){o.setAttribute("data-processed","");for(let i of o.querySelectorAll("*"))i.setAttribute("data-processed","")}r.appendChild(t.removeChild(o))}if(e)for(let o of Array.from(r.querySelectorAll("*")))o.hasAttribute("id")&&(o.setAttribute("data-origid",o.getAttribute("id")),o.removeAttribute("id"))}}function Il(t){return this.rw(this.first(t))}function Pl(t,e){let n="";for(let r=0;r<e;r++)n+=t;return n}function Dl(t){let e=this.prefixDefs[t.substring(0,t.indexOf(":"))];return t.replace(new RegExp(e.matchPattern),e.replacementPattern)}function jl(t){return this.prefixDefs[t]}function Bl(t){return t.trim().match(/^(?:http|mailto|file|\/|#).*$/)?t:this.base+ps(t.trim())}function Ul(t,e,n){return Pn(fs(t),e,n)}function Pn(t,e,n){let r="";const o=i=>!/[^\t\n\r ]/.test(i);if((t.nodeType===9||t.nodeType===11)&&(r+=`<?xml version="1.0" encoding="UTF-8"?>
`),!e&&t.nodeType==1){typeof n=="string"&&n!==""?r+=`
`+n+"<":r+="<",r+=t.getAttribute("data-origname");let i=t.hasAttribute("data-origatts")?t.getAttribute("data-origatts").split(" "):[];for(let s of Array.from(t.attributes))!s.name.startsWith("data-")&&!s.name.startsWith("tei-")&&!s.name.startsWith("aria-")&&!["id","lang","class"].includes(s.name)&&(r+=" "+i.find(function(a){return a.toLowerCase()==s.name})+'="'+s.value+'"'),s.name=="data-xmlns"&&(r+=' xmlns="'+s.value+'"'),s.name.startsWith("tei-")&&(r+=" "+i.find(function(a){return a.toLowerCase()==s.name.replace("tei-","")})+'="'+s.value+'"');t.childNodes.length>0?r+=">":r+="/>"}for(let i of Array.from(t.childNodes))switch(i.nodeType){case 1:typeof n=="string"?r+=Pn(i,!1,n+"  "):r+=Pn(i,!1,n);break;case 7:r+=`<?${i.nodeName} ${i.nodeValue}?>`,(t.nodeType===9||t.nodeType===11)&&(r+=`
`);break;case 8:r+=`<!--${i.nodeValue}-->`,(t.nodeType===9||t.nodeType===11)&&(r+=`
`);break;default:if(e&&o(i.nodeValue)&&(r+=i.nodeValue.replace(/^\s*\n/,"")),typeof n=="string"&&o(i.nodeValue))break;r+=i.nodeValue}return!e&&t.nodeType==1&&t.childNodes.length>0&&(typeof n=="string"?r+=`
`+n+"</":r+="</",r+=t.getAttribute("data-origname")+">"),(t.nodeType===9||t.nodeType===11)&&(r+=`
`),r}function Fr(t,e,n){const r=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];let o="";const i=s=>!/[^\t\n\r ]/.test(s);if(!e&&t.nodeType==1){typeof n=="string"&&n!==""?o+=`
`+n+"<":o+="<",o+=t.nodeName;for(let s of Array.from(t.attributes))o+=" "+s.name+'="'+s.value+'"';o+=">"}for(let s of Array.from(t.childNodes))switch(s.nodeType){case 1:typeof n=="string"?o+=Fr(s,!1,n+"  "):o+=Fr(s,!1,n);break;case 7:o+=`<?${s.nodeName} ${s.nodeValue}?>`,(t.nodeType===9||t.nodeType===11)&&(o+=`
`);break;case 8:o+=`<!--${s.nodeValue}-->`,(t.nodeType===9||t.nodeType===11)&&(o+=`
`);break;default:if(e&&i(s.nodeValue)&&(o+=s.nodeValue.replace(/^\s*\n/,"")),typeof n=="string"&&i(s.nodeValue))break;o+=s.nodeValue.replace(/</g,"&lt;")}return r.includes(t.nodeName)||!e&&t.nodeType==1&&(typeof n=="string"?o+=`
${n}</`:o+="</",o+=`${t.nodeName}>`),(t.nodeType===9||t.nodeType===11)&&(o+=`
`),o}function Hl(t){return t.replace(/&gt;/,">").replace(/&quot;/,'"').replace(/&apos;/,"'").replace(/&amp;/,"&")}function Dn(t){return t.includes(":"),t.replace(/:/,"-").toLowerCase()}function gs(t,e=null,n=!1){try{window.customElements.define(Dn(t),class extends HTMLElement{constructor(){super(),this.matches(":defined")||e&&(e.call(this),this.setAttribute("data-processed",""))}connectedCallback(){this.hasAttribute("data-processed")||e&&(e.call(this),this.setAttribute("data-processed",""))}})}catch(r){n&&(console.log(Dn(t)+" couldn't be registered or is already registered."),console.log(r))}}const gr=Object.freeze(Object.defineProperty({__proto__:null,copyAndReset:fs,defineCustomElement:gs,first:ps,getOrdinality:Nl,getPrefixDef:jl,hideContent:hs,normalizeURI:Il,repeat:Pl,resetAndSerialize:Ul,resolveURI:Dl,rw:Bl,serialize:Pn,serializeHTML:Fr,tagName:Dn,unEscapeEntities:Hl},Symbol.toStringTag,{value:"Module"}));function Vl(t){if(t.namespaces)for(let e of Object.keys(t.namespaces))!this.namespaces.has(t.namespaces[e])&&!Array.from(this.namespaces.values()).includes(e)&&this.namespaces.set(t.namespaces[e],e);for(let e of this.namespaces.values())if(t[e])for(let n of Object.keys(t[e]))this.behaviors[`${e}:${n}`]=t[e][n];if(t.functions)for(let e of Object.keys(t.functions))this.utilities[e]=t.functions[e].bind(this.utilities);t.handlers&&console.log("Behavior handlers are no longer used."),t.fallbacks&&console.log("Fallback behaviors are no longer used.")}function Fl(t,e,n){let r;if(t===Object(t))for(let o of Object.keys(t))this.namespaces.has(t[o])||(this.namespaces.set(t[o],o),r=o);else r=t;this.behaviors[`${r}:${e}`]=n}function Xl(t,e){let n;if(t===Object(t))for(let r of Object.keys(t))this.namespaces.has(t[r])||(this.namespaces.set(t[r],r),n=r);else n=t;delete this.behaviors[`${n}:${e}`]}function ql(t,e){const n=t.documentElement;let r=1,o=function(s){return e.has(s.namespaceURI?s.namespaceURI:"")||e.set(s.namespaceURI,"ns"+r++),e.get(s.namespaceURI?s.namespaceURI:"")+":"+s.localName};const i=new Set(Array.from(n.querySelectorAll("*"),o));return i.add(o(n)),i}function Kl(t){return new Set(Array.from(t.querySelectorAll("*[data-origname]"),e=>e.localName.replace(/(\w+)-.+/,"$1:")+e.getAttribute("data-origname")))}class rn{constructor(e){this.options=e||{},this.document=this.options.documentObject?this.options.documentObject:void 0,this.document===void 0&&(typeof window<"u"&&window.document?this.document=window.document:typeof global<"u"&&global.document&&(this.document=global.document)),this.addBehaviors=Vl.bind(this),this.addBehavior=Fl.bind(this),this.removeBehavior=Xl.bind(this),this.utilities={};for(const n of Object.keys(gr))["getPrefixDef","rw","resolveURI"].includes(n)?this.utilities[n]=gr[n].bind(this):this.utilities[n]=gr[n];if(this.els=[],this.namespaces=new Map,this.behaviors={},this.hasStyle=!1,this.prefixDefs=[],this.debug=this.options.debug===!0,this.discardContent=this.options.discardContent===!0,this.options.base)this.base=this.options.base;else try{window&&(this.base=window.location.href.replace(/\/[^\/]*$/,"/"))}catch{this.base=""}this.options.omitDefaultBehaviors||this.addBehaviors(_l),this.options.ignoreFragmentId&&window&&window.removeEventListener("ceteiceanload",rn.restorePosition)}async getHTML5(e,n,r){window&&window.location.href.startsWith(this.base)&&e.indexOf("/")>=0&&(this.base=e.replace(/\/[^\/]*$/,"/"));try{const o=await fetch(e);if(o.ok){const i=await o.text();return this.makeHTML5(i,n,r)}else console.log(`Could not get XML file ${e}.
Server returned ${o.status}: ${o.statusText}`)}catch(o){console.log(o)}}makeHTML5(e,n,r){return this.XML_dom=new DOMParser().parseFromString(e,"text/xml"),this.domToHTML5(this.XML_dom,n,r)}preprocess(e,n,r){this.els=ql(e,this.namespaces);let o=i=>{let s;if(this.namespaces.has(i.namespaceURI?i.namespaceURI:"")){let a=this.namespaces.get(i.namespaceURI?i.namespaceURI:"");s=this.document.createElement(`${a}-${i.localName.toLowerCase()}`)}else s=this.document.importNode(i,!1);for(let a of Array.from(i.attributes))a.name=="xmlns"?s.setAttribute("data-xmlns",a.value):["role"].includes(a.name)||s.setAttribute(a.name,a.value),a.name=="xml:id"&&s.setAttribute("id",a.value),a.name=="xml:lang"&&s.setAttribute("lang",a.value),a.name=="rendition"&&s.setAttribute("class",a.value.replace(/#/g,"")),a.name=="role"&&s.setAttribute("tei-role",a.value);if(s.setAttribute("data-origname",i.localName),i.hasAttributes()&&s.setAttribute("data-origatts",i.getAttributeNames().join(" ")),i.childNodes.length==0&&s.setAttribute("data-empty",""),i.localName=="head"&&i.namespaceURI=="http://www.tei-c.org/ns/1.0"){let a=function(c){let l=0,u=c.parentElement;for(;u;){let d=u.children,f=0;for(;f<d.length;){if(d[f].tagName.toLowerCase()==="head"&&d[f].namespaceURI==="http://www.tei-c.org/ns/1.0"){l++;break}f++}u=u.parentElement}return l};s.setAttribute("data-level",a(i))}if(i.localName=="tagsDecl"){let a=this.document.createElement("style");for(let c of Array.from(i.childNodes))if(c.nodeType==1&&c.localName=="rendition"&&c.getAttribute("scheme")=="css"){let l="";c.hasAttribute("selector")?(l+=c.getAttribute("selector").replace(/([^#, >]+\w*)/g,"tei-$1").replace(/#tei-/g,"#")+`{
`,l+=c.textContent):(l+="."+c.getAttribute("xml:id")+`{
`,l+=c.textContent),l+=`
}
`,a.appendChild(this.document.createTextNode(l))}a.childNodes.length>0&&(s.appendChild(a),this.hasStyle=!0)}i.localName=="prefixDef"&&(this.prefixDefs.push(i.getAttribute("ident")),this.prefixDefs[i.getAttribute("ident")]={matchPattern:i.getAttribute("matchPattern"),replacementPattern:i.getAttribute("replacementPattern")}),i.localName=="TEI"&&s.setAttribute("role","main"),["body","front","back","div"].includes(i.localName)&&(s.setAttribute("role","region"),s.setAttribute("aria-label",i.getAttribute("xml:id")||i.getAttribute("n")||i.localName));for(let a of Array.from(i.childNodes))a.nodeType==1?s.appendChild(o(a)):s.appendChild(a.cloneNode());return r&&r(s,i),s};this.dom=this.document.createDocumentFragment();for(let i of Array.from(e.childNodes))i.nodeType==1&&this.dom.appendChild(o(i)),i.nodeType==7&&this.dom.appendChild(this.document.importNode(i,!0)),i.nodeType==8&&this.dom.appendChild(this.document.importNode(i,!0));if(this.utilities.dom=this.dom.firstElementChild,n)n(this.dom,this),window&&window.dispatchEvent(Ke);else return typeof window<"u"&&window.dispatchEvent(Ke),this.dom}domToHTML5(e,n,r){if(this.preprocess(e,null,r),this.applyBehaviors(),this.done=!0,n)n(this.dom,this),window&&window.dispatchEvent(Ke);else return typeof window<"u"&&window.dispatchEvent(Ke),this.dom}processPage(){this.els=Kl(this.document),this.applyBehaviors(),window&&window.dispatchEvent(Ke)}unsetNamespace(e){this.namespaces.delete(e)}setBaseUrl(e){this.base=e}append(e,n){let r=this;if(n&&!n.hasAttribute("data-processed")){let o=e.call(r.utilities,n);o&&r.appendBasic(n,o)}else return function(){if(!this.hasAttribute("data-processed")){let o=e.call(r.utilities,this);o&&r.appendBasic(this,o)}}}appendBasic(e,n){this.discardContent?e.innerHTML="":hs(e,!0),e.appendChild(n)}bName(e){return e.tagName.substring(0,e.tagName.indexOf("-")).toLowerCase()+":"+e.getAttribute("data-origname")}childExists(e,n){return e&&e.nodeName==n?!0:e&&e.nextElementSibling&&this.childExists(e.nextElementSibling,n)}decorator(e){if(Array.isArray(e)&&e.length==0)return function(r){};if(Array.isArray(e)&&!Array.isArray(e[0]))return this.applyDecorator(e);let n=this;return function(r){for(let o of e)if(r.matches(o[0])||o[0]==="_")return Array.isArray(o[1])?n.decorator(o[1]).call(this,r):o[1].call(this,r)}}applyDecorator(e){let n=this;return function(r){let o=[];for(let i=0;i<e.length;i++)o.push(n.template(e[i],r));return n.insert(r,o)}}getFallback(e,n){if(e[n])return e[n]instanceof Function?e[n]:this.decorator(e[n])}getHandler(e,n){if(e[n])return e[n]instanceof Function?this.append(e[n]):this.append(this.decorator(e[n]))}insert(e,n){let r=this.document.createElement("cetei-content");for(let o of Array.from(e.childNodes))o.nodeType===1&&!o.hasAttribute("data-processed")&&this.processElement(o);if(n[0].match("<[^>]+>")&&n[1]&&n[1].match("<[^>]+>"))r.innerHTML=n[0]+e.innerHTML+(n[1]?n[1]:"");else{r.innerHTML=n[0],r.setAttribute("data-before",n[0].replace(/<[^>]+>/g,"").length);for(let o of Array.from(e.childNodes))r.appendChild(o.cloneNode(!0));n.length>1&&(r.innerHTML+=n[1],r.setAttribute("data-after",n[1].replace(/<[^>]+>/g,"").length))}return r.childNodes.length<2?r.firstChild:r}processElement(e){if(e.hasAttribute("data-origname")&&!e.hasAttribute("data-processed")){let n=this.getFallback(this.bName(e));n&&(this.append(n,e),e.setAttribute("data-processed",""))}for(let n of Array.from(e.childNodes))n.nodeType===1&&this.processElement(n)}template(e,n){let r=e;if(e.search(/\$(\w*)(@([a-zA-Z:]+))/)){let o=/\$(\w*)@([a-zA-Z:]+)/g,i;for(;i=o.exec(e);)n.hasAttribute(i[2])?i[1]&&this.utilities[i[1]]?r=r.replace(i[0],this.utilities[i[1]](n.getAttribute(i[2]))):r=r.replace(i[0],n.getAttribute(i[2])):r=r.replace(i[0],"")}return r}applyBehaviors(){typeof window<"u"&&window.customElements?this.define.call(this,this.els):this.fallback.call(this,this.els)}define(e){for(let n of e){const r=this.getHandler(this.behaviors,n);gs(n,r,this.debug)}}fallback(e){for(let n of e){let r=this.getFallback(this.behaviors,n);if(r)for(let o of Array.from((this.dom&&!this.done?this.dom:this.document).querySelectorAll(Dn(n))))o.hasAttribute("data-processed")||(this.append(r,o),o.setAttribute("data-processed",""))}}static savePosition(){window.sessionStorage.setItem(window.location+"-scroll",window.scrollY)}static restorePosition(){if(window.location.hash)setTimeout(function(){let e=this.document.querySelector(window.decodeURI(window.location.hash));e&&e.scrollIntoView()},100);else{let e;(e=window.sessionStorage.getItem(window.location+"-scroll"))&&(window.sessionStorage.removeItem(window.location+"-scroll"),setTimeout(function(){window.scrollTo(0,e)},100))}}}try{if(typeof window<"u"){window.CETEI=rn,window.addEventListener("beforeunload",rn.savePosition);var Ke=new Event("ceteiceanload");window.addEventListener("ceteiceanload",rn.restorePosition)}}catch(t){console.log(t)}const Yl=[];for(let t=0;t<256;++t)Yl.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Wl="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Gl=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=Wl[n[t]&63];return e};Gl();const zl="not-annotatable",ms=`.${zl}`;typeof navigator<"u"&&/mac/i.test(navigator.userAgentData?navigator.userAgentData.platform:navigator.platform);const Jl=t=>{const e=t.cloneContents();return e.querySelectorAll(ms).forEach(n=>n.remove()),e},Ql=t=>t.every(e=>e.range instanceof Range&&!e.range.collapsed),Zl=(t,e,n)=>{const r=document.createRange(),o=e;r.setStart(o,0),r.setEnd(t.startContainer,t.startOffset);const i=Jl(r).textContent,s=t.toString(),a=i.length||0,c=a+s.length;return{quote:s,start:a,end:c,range:t}},tc=(t,e)=>{var n,r;const{start:o,end:i}=t,s=t.offsetReference||e,a=document.createNodeIterator(e,NodeFilter.SHOW_TEXT,f=>{var p;return(p=f.parentElement)!=null&&p.closest(ms)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT});let c=0;const l=document.createRange();let u=a.nextNode();u===null&&console.error("Could not revive annotation target. Content missing.");let d=!s;for(;u!==null;){if(d||(d=typeof(s==null?void 0:s.contains)=="function"?s.contains(u):!1),d){const f=((n=u.textContent)==null?void 0:n.length)||0;if(c+f>o){l.setStart(u,o-c);break}c+=f}u=a.nextNode()}for(;u!==null;){const f=((r=u.textContent)==null?void 0:r.length)||0;if(c+f>=i){l.setEnd(u,i-c);break}c+=f,u=a.nextNode()}return{...t,range:l}},oi=(t,e)=>Ql(t.selector)?t:{...t,selector:t.selector.map(n=>n.range instanceof Range&&!n.range.collapsed?n:tc(n,e))},ec=[];for(let t=0;t<256;++t)ec.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const nc=[];for(let t=0;t<256;++t)nc.push((t+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const rc="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let oc=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=rc[n[t]&63];return e};oc();const mr=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function yr(t,e,n,r){t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on".concat(e),n)}function Ye(t,e,n,r){t.removeEventListener?t.removeEventListener(e,n,r):t.detachEvent&&t.detachEvent("on".concat(e),n)}function ys(t,e){const n=e.slice(0,e.length-1);for(let r=0;r<n.length;r++)n[r]=t[n[r].toLowerCase()];return n}function vs(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function ic(t,e){const n=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let o=!0;for(let i=0;i<n.length;i++)r.indexOf(n[i])===-1&&(o=!1);return o}const fn={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":mr?173:189,"=":mr?61:187,";":mr?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},Xt={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},ze={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},xt={16:!1,18:!1,17:!1,91:!1},ft={};for(let t=1;t<20;t++)fn["f".concat(t)]=111+t;let at=[],on=null,bs="all";const Qt=new Map,He=t=>fn[t.toLowerCase()]||Xt[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),sc=t=>Object.keys(fn).find(e=>fn[e]===t),ac=t=>Object.keys(Xt).find(e=>Xt[e]===t);function ws(t){bs=t||"all"}function pn(){return bs||"all"}function lc(){return at.slice(0)}function cc(){return at.map(t=>sc(t)||ac(t)||String.fromCharCode(t))}function uc(){const t=[];return Object.keys(ft).forEach(e=>{ft[e].forEach(n=>{let{key:r,scope:o,mods:i,shortcut:s}=n;t.push({scope:o,shortcut:s,mods:i,keys:r.split("+").map(a=>He(a))})})}),t}function dc(t){const e=t.target||t.srcElement,{tagName:n}=e;let r=!0;const o=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(o||n==="TEXTAREA"||n==="SELECT")&&!e.readOnly)&&(r=!1),r}function fc(t){return typeof t=="string"&&(t=He(t)),at.indexOf(t)!==-1}function pc(t,e){let n,r;t||(t=pn());for(const o in ft)if(Object.prototype.hasOwnProperty.call(ft,o))for(n=ft[o],r=0;r<n.length;)n[r].scope===t?n.splice(r,1).forEach(i=>{let{element:s}=i;return oo(s)}):r++;pn()===t&&ws(e||"all")}function hc(t){let e=t.keyCode||t.which||t.charCode;t.key&&t.key.toLowerCase()==="capslock"&&(e=He(t.key));const n=at.indexOf(e);if(n>=0&&at.splice(n,1),t.key&&t.key.toLowerCase()==="meta"&&at.splice(0,at.length),(e===93||e===224)&&(e=91),e in xt){xt[e]=!1;for(const r in Xt)Xt[r]===e&&(ae[r]=!1)}}function xs(t){if(typeof t>"u")Object.keys(ft).forEach(o=>{Array.isArray(ft[o])&&ft[o].forEach(i=>xn(i)),delete ft[o]}),oo(null);else if(Array.isArray(t))t.forEach(o=>{o.key&&xn(o)});else if(typeof t=="object")t.key&&xn(t);else if(typeof t=="string"){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];let[o,i]=n;typeof o=="function"&&(i=o,o=""),xn({key:t,scope:o,method:i,splitKey:"+"})}}const xn=t=>{let{key:e,scope:n,method:r,splitKey:o="+"}=t;vs(e).forEach(i=>{const s=i.split(o),a=s.length,c=s[a-1],l=c==="*"?"*":He(c);if(!ft[l])return;n||(n=pn());const u=a>1?ys(Xt,s):[],d=[];ft[l]=ft[l].filter(f=>{const p=(r?f.method===r:!0)&&f.scope===n&&ic(f.mods,u);return p&&d.push(f.element),!p}),d.forEach(f=>oo(f))})};function ii(t,e,n,r){if(e.element!==r)return;let o;if(e.scope===n||e.scope==="all"){o=e.mods.length>0;for(const i in xt)Object.prototype.hasOwnProperty.call(xt,i)&&(!xt[i]&&e.mods.indexOf(+i)>-1||xt[i]&&e.mods.indexOf(+i)===-1)&&(o=!1);(e.mods.length===0&&!xt[16]&&!xt[18]&&!xt[17]&&!xt[91]||o||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(at),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function si(t,e){const n=ft["*"];let r=t.keyCode||t.which||t.charCode;if(t.key&&t.key.toLowerCase()==="capslock"||!ae.filter.call(this,t))return;if((r===93||r===224)&&(r=91),at.indexOf(r)===-1&&r!==229&&at.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const c=ze[a];t[a]&&at.indexOf(c)===-1?at.push(c):!t[a]&&at.indexOf(c)>-1?at.splice(at.indexOf(c),1):a==="metaKey"&&t[a]&&(at=at.filter(l=>l in ze||l===r))}),r in xt){xt[r]=!0;for(const a in Xt)if(Object.prototype.hasOwnProperty.call(Xt,a)){const c=ze[Xt[a]];ae[a]=t[c]}if(!n)return}for(const a in xt)Object.prototype.hasOwnProperty.call(xt,a)&&(xt[a]=t[ze[a]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(at.indexOf(17)===-1&&at.push(17),at.indexOf(18)===-1&&at.push(18),xt[17]=!0,xt[18]=!0);const o=pn();if(n)for(let a=0;a<n.length;a++)n[a].scope===o&&(t.type==="keydown"&&n[a].keydown||t.type==="keyup"&&n[a].keyup)&&ii(t,n[a],o,e);if(!(r in ft))return;const i=ft[r],s=i.length;for(let a=0;a<s;a++)if((t.type==="keydown"&&i[a].keydown||t.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,u=c.key.split(l),d=[];for(let f=0;f<u.length;f++)d.push(He(u[f]));d.sort().join("")===at.sort().join("")&&ii(t,c,o,e)}}function ae(t,e,n){at=[];const r=vs(t);let o=[],i="all",s=document,a=0,c=!1,l=!0,u="+",d=!1,f=!1;for(n===void 0&&typeof e=="function"&&(n=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(i=e.scope),e.element&&(s=e.element),e.keyup&&(c=e.keyup),e.keydown!==void 0&&(l=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(f=!0)),typeof e=="string"&&(i=e),f&&xs(t,i);a<r.length;a++)t=r[a].split(u),o=[],t.length>1&&(o=ys(Xt,t)),t=t[t.length-1],t=t==="*"?"*":He(t),t in ft||(ft[t]=[]),ft[t].push({keyup:c,keydown:l,scope:i,mods:o,shortcut:r[a],method:n,key:r[a],splitKey:u,element:s});if(typeof s<"u"&&window){if(!Qt.has(s)){const p=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return si(h,s)},y=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;si(h,s),hc(h)};Qt.set(s,{keydownListener:p,keyupListenr:y,capture:d}),yr(s,"keydown",p,d),yr(s,"keyup",y,d)}if(!on){const p=()=>{at=[]};on={listener:p,capture:d},yr(window,"focus",p,d)}}}function gc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(ft).forEach(n=>{ft[n].filter(r=>r.scope===e&&r.shortcut===t).forEach(r=>{r&&r.method&&r.method()})})}function oo(t){const e=Object.values(ft).flat();if(e.findIndex(n=>{let{element:r}=n;return r===t})<0){const{keydownListener:n,keyupListenr:r,capture:o}=Qt.get(t)||{};n&&r&&(Ye(t,"keyup",r,o),Ye(t,"keydown",n,o),Qt.delete(t))}if((e.length<=0||Qt.size<=0)&&(Object.keys(Qt).forEach(n=>{const{keydownListener:r,keyupListenr:o,capture:i}=Qt.get(n)||{};r&&o&&(Ye(n,"keyup",o,i),Ye(n,"keydown",r,i),Qt.delete(n))}),Qt.clear(),Object.keys(ft).forEach(n=>delete ft[n]),on)){const{listener:n,capture:r}=on;Ye(window,"focus",n,r),on=null}}const vr={getPressedKeyString:cc,setScope:ws,getScope:pn,deleteScope:pc,getPressedKeyCodes:lc,getAllKeyCodes:uc,isPressed:fc,filter:dc,trigger:gc,unbind:xs,keyMap:fn,modifier:Xt,modifierMap:ze};for(const t in vr)Object.prototype.hasOwnProperty.call(vr,t)&&(ae[t]=vr[t]);if(typeof window<"u"){const t=window.hotkeys;ae.noConflict=e=>(e&&window.hotkeys===ae&&(window.hotkeys=t),ae),window.hotkeys=ae}const mc=(t,e,n)=>{let r=t,o=n;const i=document.createNodeIterator(e,NodeFilter.SHOW_TEXT);let s=i.nextNode(),a=!0;do s instanceof Text&&(s.length<o?o-=s.length:(r=s,a=!1)),s=i.nextNode();while(s&&a);return{node:r,offset:o}},Xr=(t,e=[])=>{let n,r,o;if(t.nodeType===Node.ELEMENT_NODE&&t.hasAttribute("xml:id")?e.push("/"):t.parentNode&&(e=Xr(t.parentNode,e)),t.nodeType===Node.ELEMENT_NODE&&t.nodeName.toLowerCase().startsWith("tei-")){const i=t;i.hasAttribute("xml:id")?o=`[@xml:id='${i.getAttribute("xml:id")}']`:(n=`count(preceding-sibling::${i.localName})`,r=document.evaluate(n,t,null,XPathResult.NUMBER_TYPE,null).numberValue+1,o=`[${r}]`),e.push("/"),e.push(i.getAttribute("data-origname")+o)}return e},yc=(t,e,n)=>{const r=l=>l?l.nodeName.toLowerCase().indexOf("tei-")===0?l:r(l.parentNode):null,o=(l,u,d)=>{const f=document.createRange();return f.setStart(l,0),f.setEnd(u,d),f.toString().length},i=o(r(n.startContainer),n.startContainer,n.startOffset),s=o(r(n.endContainer),n.endContainer,n.endOffset),a=t.join("")+"::"+i,c=e.join("")+"::"+s;return{start:a,end:c}},vc=t=>{var e;const{range:n}=t,r=Xr(n.startContainer),o=Xr(n.endContainer),{start:i,end:s}=yc(r,o,n);return{start:t.start,startSelector:{type:"XPathSelector",value:i},end:t.end,endSelector:{type:"XPathSelector",value:s},quote:(e=t.quote)==null?void 0:e.replace(/\s+/g," "),range:n}},bc=(t,e)=>{var n,r;const o=Array.isArray(t.selector)?t.selector[0]:t.selector;if("start"in o&&"end"in o)return oi(t,e);{const i=(n=o.startSelector)==null?void 0:n.value,s=(r=o.endSelector)==null?void 0:r.value;if(!i||!s)throw console.error(t),"Could not revive TEI target.";const a=v=>{const g=v.indexOf("::");if(g<0)return;const m=v.substring(0,g).replace(/\/([^[/]+)/g,(j,_)=>"/tei-"+_.toLowerCase()).replace(/xml:/g,""),S=document.evaluate("."+m,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,$=parseInt(v.substring(g+2));return[S,$]},[c,l]=a(i),[u,d]=a(s),f=document.createRange(),p=(v,g)=>v.firstChild instanceof Text&&v.firstChild.length>=g?{node:v.firstChild,offset:g}:mc(v.firstChild,v,g),y=p(c,l);f.setStart(y.node,y.offset);const h=p(u,d);f.setEnd(h.node,h.offset);const x=Zl(f,e);return oi({...t,selector:[{...x,...o,range:f}]},e)}},Es=t=>e=>{const n=bc(e,t);return{...e,selector:n.selector.map(vc)}},wc=t=>e=>({...e,target:Es(t)(e.target)}),xc=t=>{const e=t.element,n=wc(e),r=Es(e),o=t.state.store,i=o.addAnnotation;o.addAnnotation=(l,u)=>{const{selector:d}=l.target;try{return"startSelector"in d&&"start"in d?i(l,u):i(n(l),u)}catch(f){console.warn(f),console.warn("Failed to render annotation",l)}};const s=o.bulkAddAnnotations;o.bulkAddAnnotations=(l,u=!0,d)=>{const f=l.map(y=>{const{selector:h}=y.target;try{return"startSelector"in h&&"start"in h?y:n(y)}catch(x){console.warn(x)}}),p=f.filter(Boolean);return f.length!==p.length&&(console.warn(`Failed to render ${f.length-p.length} annotations.`),f.forEach((y,h)=>{y||console.warn(l[h])})),s(p,u,d)};const a=o.updateAnnotation;o.updateAnnotation=(l,u)=>a(n(l),u);const c=o.updateTarget;return o.updateTarget=(l,u)=>c(r(l),u),{...t,state:{...t.state,store:o}}},io="not-annotatable",_e=`.${io}`,Je=t=>{var e;return!!(t instanceof HTMLElement?t.closest(_e):(e=t.parentElement)!=null&&e.closest(_e))},Ec=t=>{const e=t.commonAncestorContainer;return!Je(e)},Ac=t=>t.addEventListener("click",e=>{!e.target.closest(_e)&&!e.target.closest("a")&&e.preventDefault()}),br=t=>({...t,type:t.type,x:t.x,y:t.y,clientX:t.clientX,clientY:t.clientY,offsetX:t.offsetX,offsetY:t.offsetY,screenX:t.screenX,screenY:t.screenY,isPrimary:t.isPrimary,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,button:t.button,buttons:t.buttons,currentTarget:t.currentTarget,target:t.target,defaultPrevented:t.defaultPrevented,detail:t.detail,eventPhase:t.eventPhase,pointerId:t.pointerId,pointerType:t.pointerType,timeStamp:t.timeStamp}),En=t=>({...t,type:t.type,key:t.key,code:t.code,location:t.location,repeat:t.repeat,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,currentTarget:t.currentTarget,target:t.target,defaultPrevented:t.defaultPrevented,detail:t.detail,timeStamp:t.timeStamp}),$c=typeof navigator<"u"&&/mac/i.test(navigator.userAgentData?navigator.userAgentData.platform:navigator.platform),Sc=t=>{!t.hasAttribute("tabindex")&&t.tabIndex<0&&t.setAttribute("tabindex","-1"),t.classList.add("no-focus-outline")},so=(t,e=10)=>{let n;return((...r)=>{clearTimeout(n),n=setTimeout(()=>t.apply(void 0,r),e)})},Rc=function*(t){const e=document.createNodeIterator(t.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,r=>r instanceof HTMLElement&&r.classList.contains(io)&&!r.parentElement.closest(_e)&&t.intersectsNode(r)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP);let n;for(;n=e.nextNode();)n instanceof HTMLElement&&(yield n)},Tc=t=>{if(!Ec(t))return[];const e=[];let n=null;for(const r of Rc(t)){let o;n?(o=document.createRange(),o.setStartAfter(n),o.setEndBefore(r)):(o=t.cloneRange(),o.setEndBefore(r)),o.collapsed||e.push(o),n=r}if(n){const r=t.cloneRange();r.setStartAfter(n),r.collapsed||e.push(r)}return e.length>0?e:[t]},Cc=t=>{const e=t.cloneContents();return e.querySelectorAll(_e).forEach(n=>n.remove()),e},te=t=>t.every(e=>e.range instanceof Range&&!e.range.collapsed),Oc=/^\s*$/,Lc=t=>Oc.test(t.toString()),kc=(t,e)=>{const n=i=>Math.round(i*10)/10,r={top:n(t.top),bottom:n(t.bottom),left:n(t.left),right:n(t.right)},o={top:n(e.top),bottom:n(e.bottom),left:n(e.left),right:n(e.right)};if(Math.abs(r.top-o.top)<.5&&Math.abs(r.bottom-o.bottom)<.5){if(Math.abs(r.left-o.right)<.5||Math.abs(r.right-o.left)<.5)return"inline-adjacent";if(r.left>=o.left&&r.right<=o.right)return"inline-is-contained";if(r.left<=o.left&&r.right>=o.right)return"inline-contains"}else if(r.top<=o.top&&r.bottom>=o.bottom){if(r.left<=o.left&&r.right>=o.right)return"block-contains"}else if(r.top>=o.top&&r.bottom<=o.bottom&&r.left>=o.left&&r.right<=o.right)return"block-is-contained"},Mc=(t,e)=>{const n=Math.min(t.left,e.left),r=Math.max(t.right,e.right),o=Math.min(t.top,e.top),i=Math.max(t.bottom,e.bottom);return new DOMRect(n,o,r-n,i-o)},_c=t=>t.reduce((e,n)=>{if(n.width===0||n.height===0)return e;let r=[...e],o=!1;for(const i of e){const s=kc(n,i);if(s==="inline-adjacent"){r=r.map(a=>a===i?Mc(n,i):a),o=!0;break}else if(s==="inline-contains"){r=r.map(a=>a===i?n:a),o=!0;break}else if(s==="inline-is-contained"){o=!0;break}else if(s==="block-contains"||s==="block-is-contained"){n.width<i.width&&(r=r.map(a=>a===i?n:a)),o=!0;break}}return o?r:[...r,n]},[]),Nc=t=>({length:t.length,item:e=>t[e],[Symbol.iterator]:function*(){for(let e=0;e<this.length;e++)yield this.item(e)}}),Ic=(t,e,n)=>{const r=document.createRange(),o=n?t.startContainer.parentElement.closest(n):e;r.setStart(o,0),r.setEnd(t.startContainer,t.startOffset);const i=Cc(r).textContent,s=t.toString(),a=i.length||0,c=a+s.length;return n?{quote:s,start:a,end:c,range:t,offsetReference:o}:{quote:s,start:a,end:c,range:t}},As=(t,e)=>{var n,r;const{start:o,end:i}=t,s=t.offsetReference||e,a=document.createNodeIterator(e,NodeFilter.SHOW_TEXT,f=>{var p;return(p=f.parentElement)!=null&&p.closest(_e)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT});let c=0;const l=document.createRange();let u=a.nextNode();u===null&&console.error("Could not revive annotation target. Content missing.");let d=!s;for(;u!==null;){if(d||(d=typeof(s==null?void 0:s.contains)=="function"?s.contains(u):!1),d){const f=((n=u.textContent)==null?void 0:n.length)||0;if(c+f>o){l.setStart(u,o-c);break}c+=f}u=a.nextNode()}for(;u!==null;){const f=((r=u.textContent)==null?void 0:r.length)||0;if(c+f>=i){l.setEnd(u,i-c);break}c+=f,u=a.nextNode()}return{...t,range:l}},jn=(t,e)=>te(t.selector)?t:{...t,selector:t.selector.map(n=>n.range instanceof Range&&!n.range.collapsed?n:As(n,e))},wr=(t,e)=>te(t.target.selector)?t:{...t,target:jn(t.target,e)},Pc=(t,e)=>{const n=t.cloneRange();return e.contains(n.startContainer)||n.setStart(e,0),e.contains(n.endContainer)||n.setEnd(e,e.childNodes.length),n},$s=t=>{if(t===null)return document.scrollingElement;const{overflowY:e}=window.getComputedStyle(t);return e!=="visible"&&e!=="hidden"&&t.scrollHeight>t.clientHeight?t:$s(t.parentElement)},Dc=(t,e)=>n=>{const r=typeof n=="string"?n:n.id,o=u=>{const d=i.getBoundingClientRect(),f=i.clientHeight,p=i.clientWidth,y=u.selector[0].range.getBoundingClientRect(),{width:h,height:x}=e.getAnnotationBounds(r),v=y.top-d.top,g=y.left-d.left,m=i.parentElement?i.scrollTop:0,S=i.parentElement?i.scrollLeft:0,$=v+m-(f-x)/2,j=g+S-(p-h)/2;i.scroll({top:$,left:j,behavior:"smooth"})},i=$s(t);if(!i)return console.warn(`The scroll parent is missing for the annotation: ${r}`,{container:t}),!1;const s=e.getAnnotation(r);if(!s)return console.warn(`The annotation is missing in the store: ${r}`),!1;const{range:a}=s.target.selector[0];if(a&&!a.collapsed)return o(s.target),!0;const c=jn(s.target,t),{range:l}=c.selector[0];return l&&!l.collapsed?(o(c),!0):!1},de={fill:"rgb(0, 128, 255)",fillOpacity:.18},Bn={fill:"rgb(0, 128, 255)",fillOpacity:.45},jc=(t,e,n,r,o)=>{var i,s;const a=n?typeof n=="function"?n(t.annotation,t.state,o)||((i=t.state)!=null&&i.selected?Bn:de):n:(s=t.state)!=null&&s.selected?Bn:de;return r&&r.paint(t,e)||a},Bc=t=>{const{top:e,left:n}=t.getBoundingClientRect(),{innerWidth:r,innerHeight:o}=window,i=-n,s=-e,a=r-n,c=o-e;return{top:e,left:n,minX:i,minY:s,maxX:a,maxY:c}},Uc=t=>{let e=new Set;return n=>{const r=n.map(o=>o.id);(e.size!==r.length||r.some(o=>!e.has(o)))&&t.set(r),e=new Set(r)}},ao=(t,e,n,r)=>{const{store:o,selection:i,hover:s}=e;let a,c,l;const u=Uc(n),d=P=>{const{x:C,y:D}=t.getBoundingClientRect(),U=o.getAt(P.clientX-C,P.clientY-D,!1,c);U?s.current!==U.id&&(t.classList.add("hovered"),s.set(U.id)):s.current&&(t.classList.remove("hovered"),s.set(null))};t.addEventListener("pointermove",d);const f=(P=!1)=>{l&&l.clear();const C=Bc(t),{minX:D,minY:U,maxX:R,maxY:T}=C,E=c?o.getIntersecting(D,U,R,T).filter(({annotation:L})=>c(L)):o.getIntersecting(D,U,R,T),A=i.selected.map(({id:L})=>L),M=E.map(({annotation:L,rects:k})=>{const V=A.includes(L.id),w=L.id===s.current;return{annotation:L,rects:k,state:{selected:V,hovered:w}}});r.redraw(M,C,a,l,P),setTimeout(()=>u(E.map(({annotation:L})=>L)),1)},p=P=>{l=P,f()},y=P=>{a=P,f()},h=P=>{c=P,f(!1)},x=()=>f();o.observe(x);const v=i.subscribe(()=>f()),g=s.subscribe(()=>f()),m=()=>f(!0);document.addEventListener("scroll",m,{capture:!0,passive:!0});const S=so(()=>{o.recalculatePositions(),l&&l.reset(),f()});window.addEventListener("resize",S);const $=new ResizeObserver(S);$.observe(t);const j={attributes:!0,childList:!0,subtree:!0},_=new MutationObserver(P=>{P.every(C=>C.target===t||t.contains(C.target))||f(!0)});return _.observe(document.body,j),{destroy:()=>{t.removeEventListener("pointermove",d),r.destroy(),o.unobserve(x),v(),g(),document.removeEventListener("scroll",m),window.removeEventListener("resize",S),$.disconnect(),_.disconnect()},redraw:f,setStyle:y,setFilter:h,setPainter:p,setVisible:r.setVisible}},Hc=()=>{const t=document.createElement("canvas");return t.width=window.innerWidth,t.height=window.innerHeight,t.className="r6o-canvas-highlight-layer bg",t},Vc=(t,e)=>{t.width=window.innerWidth,t.height=window.innerHeight},Fc=t=>{t.classList.add("r6o-annotatable");const e=Hc(),n=e.getContext("2d");document.body.appendChild(e);const r=(i,s,a,c)=>requestAnimationFrame(()=>{const{width:l,height:u}=e;n.clearRect(-.5,-.5,l+1,u+1),c&&c.clear();const{top:d,left:f}=s;[...i].sort((p,y)=>{const{annotation:{target:{created:h}}}=p,{annotation:{target:{created:x}}}=y;return h.getTime()-x.getTime()}).forEach(p=>{var y;const h=a?typeof a=="function"?a(p.annotation,p.state):a:(y=p.state)!=null&&y.selected?Bn:de,x=c&&c.paint(p,s)||h,v=p.rects.map(({x:g,y:m,width:S,height:$})=>({x:g+f,y:m+d,width:S,height:$}));if(n.fillStyle=x.fill,n.globalAlpha=x.fillOpacity||1,v.forEach(({x:g,y:m,width:S,height:$})=>n.fillRect(g,m,S,$)),x.underlineColor){n.globalAlpha=1,n.strokeStyle=x.underlineColor,n.lineWidth=x.underlineThickness??1;const g=x.underlineOffset??0;v.forEach(({x:m,y:S,width:$,height:j})=>{n.beginPath(),n.moveTo(m,S+j+g),n.lineTo(m+$,S+j+g),n.stroke()})}})}),o=so(()=>{Vc(e)});return window.addEventListener("resize",o),{destroy:()=>{e.remove(),window.removeEventListener("resize",o)},setVisible:i=>{console.log("setVisible not implemented on Canvas renderer")},redraw:r}},Xc=(t,e,n)=>ao(t,e,n,Fc(t));var qc={grad:.9,turn:360,rad:360/(2*Math.PI)},Jt=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},yt=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=Math.pow(10,e)),Math.round(n*t)/n+0},Dt=function(t,e,n){return e===void 0&&(e=0),n===void 0&&(n=1),t>n?n:t>e?t:e},Ss=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},ai=function(t){return{r:Dt(t.r,0,255),g:Dt(t.g,0,255),b:Dt(t.b,0,255),a:Dt(t.a)}},xr=function(t){return{r:yt(t.r),g:yt(t.g),b:yt(t.b),a:yt(t.a,3)}},Kc=/^#([0-9a-f]{3,8})$/i,An=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},Rs=function(t){var e=t.r,n=t.g,r=t.b,o=t.a,i=Math.max(e,n,r),s=i-Math.min(e,n,r),a=s?i===e?(n-r)/s:i===n?2+(r-e)/s:4+(e-n)/s:0;return{h:60*(a<0?a+6:a),s:i?s/i*100:0,v:i/255*100,a:o}},Ts=function(t){var e=t.h,n=t.s,r=t.v,o=t.a;e=e/360*6,n/=100,r/=100;var i=Math.floor(e),s=r*(1-n),a=r*(1-(e-i)*n),c=r*(1-(1-e+i)*n),l=i%6;return{r:255*[r,a,s,s,c,r][l],g:255*[c,r,r,a,s,s][l],b:255*[s,s,c,r,r,a][l],a:o}},li=function(t){return{h:Ss(t.h),s:Dt(t.s,0,100),l:Dt(t.l,0,100),a:Dt(t.a)}},ci=function(t){return{h:yt(t.h),s:yt(t.s),l:yt(t.l),a:yt(t.a,3)}},ui=function(t){return Ts((n=(e=t).s,{h:e.h,s:(n*=((r=e.l)<50?r:100-r)/100)>0?2*n/(r+n)*100:0,v:r+n,a:e.a}));var e,n,r},sn=function(t){return{h:(e=Rs(t)).h,s:(o=(200-(n=e.s))*(r=e.v)/100)>0&&o<200?n*r/100/(o<=100?o:200-o)*100:0,l:o/2,a:e.a};var e,n,r,o},Yc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Wc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Gc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,zc=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,di={string:[[function(t){var e=Kc.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?yt(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?yt(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=Gc.exec(t)||zc.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:ai({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=Yc.exec(t)||Wc.exec(t);if(!e)return null;var n,r,o=li({h:(n=e[1],r=e[2],r===void 0&&(r="deg"),Number(n)*(qc[r]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return ui(o)},"hsl"]],object:[[function(t){var e=t.r,n=t.g,r=t.b,o=t.a,i=o===void 0?1:o;return Jt(e)&&Jt(n)&&Jt(r)?ai({r:Number(e),g:Number(n),b:Number(r),a:Number(i)}):null},"rgb"],[function(t){var e=t.h,n=t.s,r=t.l,o=t.a,i=o===void 0?1:o;if(!Jt(e)||!Jt(n)||!Jt(r))return null;var s=li({h:Number(e),s:Number(n),l:Number(r),a:Number(i)});return ui(s)},"hsl"],[function(t){var e=t.h,n=t.s,r=t.v,o=t.a,i=o===void 0?1:o;if(!Jt(e)||!Jt(n)||!Jt(r))return null;var s=(function(a){return{h:Ss(a.h),s:Dt(a.s,0,100),v:Dt(a.v,0,100),a:Dt(a.a)}})({h:Number(e),s:Number(n),v:Number(r),a:Number(i)});return Ts(s)},"hsv"]]},fi=function(t,e){for(var n=0;n<e.length;n++){var r=e[n][0](t);if(r)return[r,e[n][1]]}return[null,void 0]},Jc=function(t){return typeof t=="string"?fi(t.trim(),di.string):typeof t=="object"&&t!==null?fi(t,di.object):[null,void 0]},Er=function(t,e){var n=sn(t);return{h:n.h,s:Dt(n.s+100*e,0,100),l:n.l,a:n.a}},Ar=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},pi=function(t,e){var n=sn(t);return{h:n.h,s:n.s,l:Dt(n.l+100*e,0,100),a:n.a}},hi=(function(){function t(e){this.parsed=Jc(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return yt(Ar(this.rgba),2)},t.prototype.isDark=function(){return Ar(this.rgba)<.5},t.prototype.isLight=function(){return Ar(this.rgba)>=.5},t.prototype.toHex=function(){return e=xr(this.rgba),n=e.r,r=e.g,o=e.b,s=(i=e.a)<1?An(yt(255*i)):"","#"+An(n)+An(r)+An(o)+s;var e,n,r,o,i,s},t.prototype.toRgb=function(){return xr(this.rgba)},t.prototype.toRgbString=function(){return e=xr(this.rgba),n=e.r,r=e.g,o=e.b,(i=e.a)<1?"rgba("+n+", "+r+", "+o+", "+i+")":"rgb("+n+", "+r+", "+o+")";var e,n,r,o,i},t.prototype.toHsl=function(){return ci(sn(this.rgba))},t.prototype.toHslString=function(){return e=ci(sn(this.rgba)),n=e.h,r=e.s,o=e.l,(i=e.a)<1?"hsla("+n+", "+r+"%, "+o+"%, "+i+")":"hsl("+n+", "+r+"%, "+o+"%)";var e,n,r,o,i},t.prototype.toHsv=function(){return e=Rs(this.rgba),{h:yt(e.h),s:yt(e.s),v:yt(e.v),a:yt(e.a,3)};var e},t.prototype.invert=function(){return Vt({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),Vt(Er(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),Vt(Er(this.rgba,-e))},t.prototype.grayscale=function(){return Vt(Er(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),Vt(pi(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),Vt(pi(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?Vt({r:(n=this.rgba).r,g:n.g,b:n.b,a:e}):yt(this.rgba.a,3);var n},t.prototype.hue=function(e){var n=sn(this.rgba);return typeof e=="number"?Vt({h:e,s:n.s,l:n.l,a:n.a}):yt(n.h)},t.prototype.isEqual=function(e){return this.toHex()===Vt(e).toHex()},t})(),Vt=function(t){return t instanceof hi?t:new hi(t)};const Qc=t=>[`background-color:${Vt((t==null?void 0:t.fill)||de.fill).alpha((t==null?void 0:t.fillOpacity)===void 0?de.fillOpacity:t.fillOpacity).toHex()}`,t!=null&&t.underlineThickness?"text-decoration:underline":void 0,t!=null&&t.underlineColor?`text-decoration-color:${t.underlineColor}`:void 0,t!=null&&t.underlineOffset?`text-underline-offset:${t.underlineOffset}px`:void 0,t!=null&&t.underlineThickness?`text-decoration-thickness:${t.underlineThickness}px`:void 0].filter(Boolean).join(";"),Zc=()=>{const t=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(t);let e=new Set;return{destroy:()=>{CSS.highlights.clear(),t.remove()},setVisible:n=>{console.log("setVisible not implemented on CSS Custom Highlights renderer")},redraw:(n,r,o,i)=>{i&&i.clear();const s=new Set(n.map(c=>c.annotation.id));Array.from(e).filter(c=>!s.has(c));const a=n.map(c=>{var l;const u=o?typeof o=="function"?o(c.annotation,c.state):o:(l=c.state)!=null&&l.selected?Bn:de,d=i&&i.paint(c,r)||u;return`::highlight(_${c.annotation.id}) { ${Qc(d)} }`});t.innerHTML=a.join(`
`),CSS.highlights.clear(),n.forEach(({annotation:c})=>{const l=c.target.selector.map(d=>d.range),u=new Highlight(...l);CSS.highlights.set(`_${c.id}`,u)}),e=s}}},tu=(t,e,n)=>ao(t,e,n,Zc());var gi=Object.prototype.hasOwnProperty;function qr(t,e){var n,r;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((r=t.length)===e.length)for(;r--&&qr(t[r],e[r]););return r===-1}if(!n||typeof t=="object"){r=0;for(n in t)if(gi.call(t,n)&&++r&&!gi.call(e,n)||!(n in e)||!qr(t[n],e[n]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}const eu=(t,e)=>{const n=(i,s)=>i.x<=s.x+s.width&&i.x+i.width>=s.x&&i.y<=s.y+s.height&&i.y+i.height>=s.y,r=i=>i.rects.reduce((s,a)=>s+a.width,0),o=e.filter(({rects:i})=>i.some(s=>n(t,s)));return o.sort((i,s)=>r(s)-r(i)),o.findIndex(i=>i.rects.includes(t))},nu=t=>{t.classList.add("r6o-annotatable");const e=document.createElement("div");e.className="r6o-span-highlight-layer",t.insertBefore(e,t.firstChild);let n=[];return{destroy:()=>{e.remove()},redraw:(r,o,i,s,a)=>{const c=!(qr(n,r)&&a);!s&&!c||(c&&(e.innerHTML=""),[...r].sort((l,u)=>{const{annotation:{target:{created:d}}}=l,{annotation:{target:{created:f}}}=u;return d&&f?d.getTime()-f.getTime():0}).forEach(l=>{l.rects.map(u=>{const d=eu(u,r),f=jc(l,o,i,s,d);if(c){const p=document.createElement("span");p.className="r6o-annotation",p.dataset.annotation=l.annotation.id,p.style.left=`${u.x}px`,p.style.top=`${u.y}px`,p.style.width=`${u.width}px`,p.style.height=`${u.height}px`,p.style.backgroundColor=Vt((f==null?void 0:f.fill)||de.fill).alpha((f==null?void 0:f.fillOpacity)===void 0?de.fillOpacity:f.fillOpacity).toHex(),f.underlineStyle&&(p.style.borderStyle=f.underlineStyle),f.underlineColor&&(p.style.borderColor=f.underlineColor),f.underlineThickness&&(p.style.borderBottomWidth=`${f.underlineThickness}px`),f.underlineOffset&&(p.style.paddingBottom=`${f.underlineOffset}px`),e.appendChild(p)}})}),n=r)},setVisible:r=>{r?e.classList.remove("hidden"):e.classList.add("hidden")}}},ru=(t,e,n)=>ao(t,e,n,nu(t)),bt=[];for(let t=0;t<256;++t)bt.push((t+256).toString(16).slice(1));function ou(t,e=0){return(bt[t[e+0]]+bt[t[e+1]]+bt[t[e+2]]+bt[t[e+3]]+"-"+bt[t[e+4]]+bt[t[e+5]]+"-"+bt[t[e+6]]+bt[t[e+7]]+"-"+bt[t[e+8]]+bt[t[e+9]]+"-"+bt[t[e+10]]+bt[t[e+11]]+bt[t[e+12]]+bt[t[e+13]]+bt[t[e+14]]+bt[t[e+15]]).toLowerCase()}let $r;const iu=new Uint8Array(16);function su(){if(!$r){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");$r=crypto.getRandomValues.bind(crypto)}return $r(iu)}const au=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),mi={randomUUID:au};function lu(t,e,n){var r;if(mi.randomUUID&&!t)return mi.randomUUID();t=t||{};const o=t.random??((r=t.rng)==null?void 0:r.call(t))??su();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,ou(o)}var yi=Object.prototype.hasOwnProperty;function ye(t,e){var n,r;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((r=t.length)===e.length)for(;r--&&ye(t[r],e[r]););return r===-1}if(!n||typeof t=="object"){r=0;for(n in t)if(yi.call(t,n)&&++r&&!yi.call(e,n)||!(n in e)||!ye(t[n],e[n]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}function Sr(){}function cu(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}const xe=[];function lo(t,e=Sr){let n;const r=new Set;function o(a){if(cu(t,a)&&(t=a,n)){const c=!xe.length;for(const l of r)l[1](),xe.push(l,t);if(c){for(let l=0;l<xe.length;l+=2)xe[l][0](xe[l+1]);xe.length=0}}}function i(a){o(a(t))}function s(a,c=Sr){const l=[a,c];return r.add(l),r.size===1&&(n=e(o,i)||Sr),a(t),()=>{r.delete(l),r.size===0&&n&&(n(),n=null)}}return{set:o,update:i,subscribe:s}}const uu=t=>{const{subscribe:e,set:n}=lo();let r;return e(o=>r=o),t.observe(({changes:o})=>{if(r){(o.deleted||[]).some(s=>s.id===r)&&n(void 0);const i=(o.updated||[]).find(({oldValue:s})=>s.id===r);i&&n(i.newValue.id)}}),{get current(){return r},subscribe:e,set:n}},$n={selected:[]},du=(t,e,n)=>{const{subscribe:r,set:o}=lo($n);let i=e,s=$n;r(h=>s=h);const a=()=>{ye(s,$n)||o($n)},c=()=>{var h;return((h=s.selected)==null?void 0:h.length)===0},l=h=>{if(c())return!1;const x=typeof h=="string"?h:h.id;return s.selected.some(v=>v.id===x)},u=(h,x)=>{let v;if(Array.isArray(h)){if(v=h.map(m=>t.getAnnotation(m)).filter(Boolean),v.length<h.length){console.warn("Invalid selection: "+h.filter(m=>!v.some(S=>S.id===m)));return}}else{const m=t.getAnnotation(h);if(!m){console.warn("Invalid selection: "+h);return}v=[m]}const g=v.reduce((m,S)=>{const $=y(S);return $==="EDIT"?[...m,{id:S.id,editable:!0}]:$==="SELECT"?[...m,{id:S.id}]:m},[]);o({selected:g,event:x})},d=(h,x)=>{const v=Array.isArray(h)?h:[h],g=v.map(m=>t.getAnnotation(m)).filter(m=>!!m);o({selected:g.map(m=>{const S=x===void 0?y(m)==="EDIT":x;return{id:m.id,editable:S}})}),g.length!==v.length&&console.warn("Invalid selection",h)},f=h=>{if(c())return!1;const{selected:x}=s;x.some(({id:v})=>h.includes(v))&&o({selected:x.filter(({id:v})=>!h.includes(v))})},p=h=>{i=h,d(s.selected.map(({id:x})=>x))},y=h=>fu(h,i,n);return t.observe(({changes:h})=>f((h.deleted||[]).map(x=>x.id))),{get event(){return s?s.event:null},get selected(){return s?[...s.selected]:null},get userSelectAction(){return i},clear:a,evalSelectAction:y,isEmpty:c,isSelected:l,setSelected:d,setUserSelectAction:p,subscribe:r,userSelect:u}},fu=(t,e,n)=>{const r=n?n.serialize(t):t;return typeof e=="function"?e(r):e||"EDIT"},wt=[];for(let t=0;t<256;++t)wt.push((t+256).toString(16).slice(1));function pu(t,e=0){return(wt[t[e+0]]+wt[t[e+1]]+wt[t[e+2]]+wt[t[e+3]]+"-"+wt[t[e+4]]+wt[t[e+5]]+"-"+wt[t[e+6]]+wt[t[e+7]]+"-"+wt[t[e+8]]+wt[t[e+9]]+"-"+wt[t[e+10]]+wt[t[e+11]]+wt[t[e+12]]+wt[t[e+13]]+wt[t[e+14]]+wt[t[e+15]]).toLowerCase()}let Rr;const hu=new Uint8Array(16);function gu(){if(!Rr){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Rr=crypto.getRandomValues.bind(crypto)}return Rr(hu)}const mu=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),vi={randomUUID:mu};function yu(t,e,n){var r;if(vi.randomUUID&&!t)return vi.randomUUID();t=t||{};const o=t.random??((r=t.rng)==null?void 0:r.call(t))??gu();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,pu(o)}const Tr=t=>{const e=n=>{const r={...n};return n.created&&typeof n.created=="string"&&(r.created=new Date(n.created)),n.updated&&typeof n.updated=="string"&&(r.updated=new Date(n.updated)),r};return{...t,bodies:(t.bodies||[]).map(e),target:e(t.target)}},vu=(t,e)=>{const n=new Set(t.bodies.map(r=>r.id));return e.bodies.filter(r=>!n.has(r.id))},bu=(t,e)=>{const n=new Set(e.bodies.map(r=>r.id));return t.bodies.filter(r=>!n.has(r.id))},wu=(t,e)=>e.bodies.map(n=>{const r=t.bodies.find(o=>o.id===n.id);return{newBody:n,oldBody:r&&!ye(r,n)?r:void 0}}).filter(({oldBody:n})=>n).map(({oldBody:n,newBody:r})=>({oldBody:n,newBody:r})),xu=(t,e)=>!ye(t.target,e.target),Cs=(t,e)=>{const n=vu(t,e),r=bu(t,e),o=wu(t,e);return{oldValue:t,newValue:e,bodiesCreated:n.length>0?n:void 0,bodiesDeleted:r.length>0?r:void 0,bodiesUpdated:o.length>0?o:void 0,targetUpdated:xu(t,e)?{oldTarget:t.target,newTarget:e.target}:void 0}};var et=(t=>(t.LOCAL="LOCAL",t.REMOTE="REMOTE",t.SILENT="SILENT",t))(et||{});const Eu=(t,e)=>{var n,r;const{changes:o,origin:i}=e;if(!(t.options.origin?t.options.origin===i:i!=="SILENT"))return!1;if(t.options.ignore){const{ignore:s}=t.options,a=c=>c&&c.length>0;if(!(a(o.created)||a(o.deleted))){const c=(n=o.updated)==null?void 0:n.some(u=>a(u.bodiesCreated)||a(u.bodiesDeleted)||a(u.bodiesUpdated)),l=(r=o.updated)==null?void 0:r.some(u=>u.targetUpdated);if(s==="BODY_ONLY"&&c&&!l||s==="TARGET_ONLY"&&l&&!c)return!1}}if(t.options.annotations){const s=new Set([...(o.created||[]).map(a=>a.id),...(o.deleted||[]).map(a=>a.id),...(o.updated||[]).map(({oldValue:a})=>a.id)]);return!!(Array.isArray(t.options.annotations)?t.options.annotations:[t.options.annotations]).find(a=>s.has(a))}else return!0},Au=(t,e)=>{const n=new Set((t.created||[]).map(d=>d.id)),r=new Set((t.updated||[]).map(({newValue:d})=>d.id)),o=new Set((e.created||[]).map(d=>d.id)),i=new Set((e.deleted||[]).map(d=>d.id)),s=new Set((e.updated||[]).map(({oldValue:d})=>d.id)),a=new Set((e.updated||[]).filter(({oldValue:d})=>n.has(d.id)||r.has(d.id)).map(({oldValue:d})=>d.id)),c=[...(t.created||[]).filter(d=>!i.has(d.id)).map(d=>s.has(d.id)?e.updated.find(({oldValue:f})=>f.id===d.id).newValue:d),...e.created||[]],l=[...(t.deleted||[]).filter(d=>!o.has(d.id)),...(e.deleted||[]).filter(d=>!n.has(d.id))],u=[...(t.updated||[]).filter(({newValue:d})=>!i.has(d.id)).map(d=>{const{oldValue:f,newValue:p}=d;if(s.has(p.id)){const y=e.updated.find(h=>h.oldValue.id===p.id).newValue;return Cs(f,y)}else return d}),...(e.updated||[]).filter(({oldValue:d})=>!a.has(d.id))];return{created:c,deleted:l,updated:u}},Sn=t=>{const e=t.id===void 0?yu():t.id;return{...t,id:e,bodies:t.bodies===void 0?[]:t.bodies.map(n=>({...n,annotation:e})),target:{...t.target,annotation:e}}},$u=t=>t.id!==void 0,Su=()=>{const t=new Map,e=new Map,n=[],r=(R,T={})=>{n.push({onChange:R,options:T})},o=R=>{const T=n.findIndex(E=>E.onChange==R);T>-1&&n.splice(T,1)},i=(R,T)=>{const E={origin:R,changes:{created:T.created||[],updated:T.updated||[],deleted:T.deleted||[]},state:[...t.values()]};n.forEach(A=>{Eu(A,E)&&A.onChange(E)})},s=(R,T=et.LOCAL)=>{if(R.id&&t.get(R.id))throw Error(`Cannot add annotation ${R.id} - exists already`);{const E=Sn(R);t.set(E.id,E),E.bodies.forEach(A=>e.set(A.id,E.id)),i(T,{created:[E]})}},a=(R,T)=>{const E=Sn(typeof R=="string"?T:R),A=typeof R=="string"?R:R.id,M=A&&t.get(A);if(M){const L=Cs(M,E);return A===E.id?t.set(A,E):(t.delete(A),t.set(E.id,E)),M.bodies.forEach(k=>e.delete(k.id)),E.bodies.forEach(k=>e.set(k.id,E.id)),L}else console.warn(`Cannot update annotation ${A} - does not exist`)},c=(R,T=et.LOCAL,E=et.LOCAL)=>{const A=$u(T)?E:T,M=a(R,T);M&&i(A,{updated:[M]})},l=(R,T=et.LOCAL)=>{t.get(R.id)?c(R,T):s(R,T)},u=(R,T=et.LOCAL)=>{const E=R.reduce((A,M)=>{const L=a(M);return L?[...A,L]:A},[]);E.length>0&&i(T,{updated:E})},d=(R,T=et.LOCAL)=>{const E=R.map(Sn),{toAdd:A,toUpdate:M}=E.reduce((k,V)=>t.get(V.id)?{...k,toUpdate:[...k.toUpdate,V]}:{...k,toAdd:[...k.toAdd,V]},{toAdd:[],toUpdate:[]}),L=M.map(k=>a(k,T)).filter(Boolean);A.forEach(k=>{t.set(k.id,k),k.bodies.forEach(V=>e.set(V.id,k.id))}),i(T,{created:A,updated:L})},f=(R,T=et.LOCAL)=>{const E=t.get(R.annotation);if(E){const A={...E,bodies:[...E.bodies,R]};t.set(E.id,A),e.set(R.id,A.id),i(T,{updated:[{oldValue:E,newValue:A,bodiesCreated:[R]}]})}else console.warn(`Attempt to add body to missing annotation: ${R.annotation}`)},p=()=>[...t.values()],y=(R=et.LOCAL)=>{const T=[...t.values()];t.clear(),e.clear(),i(R,{deleted:T})},h=(R,T=!0,E=et.LOCAL)=>{const A=R.map(Sn);if(T){const M=[...t.values()];t.clear(),e.clear(),A.forEach(L=>{t.set(L.id,L),L.bodies.forEach(k=>e.set(k.id,L.id))}),i(E,{created:A,deleted:M})}else{const M=R.reduce((L,k)=>{const V=k.id&&t.get(k.id);return V?[...L,V]:L},[]);if(M.length>0)throw Error(`Bulk insert would overwrite the following annotations: ${M.map(L=>L.id).join(", ")}`);A.forEach(L=>{t.set(L.id,L),L.bodies.forEach(k=>e.set(k.id,L.id))}),i(E,{created:A})}},x=R=>{const T=typeof R=="string"?R:R.id,E=t.get(T);if(E)return t.delete(T),E.bodies.forEach(A=>e.delete(A.id)),E;console.warn(`Attempt to delete missing annotation: ${T}`)},v=(R,T=et.LOCAL)=>{const E=x(R);E&&i(T,{deleted:[E]})},g=(R,T=et.LOCAL)=>{const E=R.reduce((A,M)=>{const L=x(M);return L?[...A,L]:A},[]);E.length>0&&i(T,{deleted:E})},m=R=>{const T=t.get(R.annotation);if(T){const E=T.bodies.find(A=>A.id===R.id);if(E){e.delete(E.id);const A={...T,bodies:T.bodies.filter(M=>M.id!==R.id)};return t.set(T.id,A),{oldValue:T,newValue:A,bodiesDeleted:[E]}}else console.warn(`Attempt to delete missing body ${R.id} from annotation ${R.annotation}`)}else console.warn(`Attempt to delete body from missing annotation ${R.annotation}`)},S=(R,T=et.LOCAL)=>{const E=m(R);E&&i(T,{updated:[E]})},$=(R,T=et.LOCAL)=>{const E=R.map(A=>m(A)).filter(Boolean);E.length>0&&i(T,{updated:E})},j=R=>{const T=t.get(R);return T?{...T}:void 0},_=R=>{const T=e.get(R);if(T){const E=j(T).bodies.find(A=>A.id===R);if(E)return E;console.error(`Store integrity error: body ${R} in index, but not in annotation`)}else console.warn(`Attempt to retrieve missing body: ${R}`)},P=(R,T)=>{if(R.annotation!==T.annotation)throw"Annotation integrity violation: annotation ID must be the same when updating bodies";const E=t.get(R.annotation);if(E){const A=E.bodies.find(L=>L.id===R.id),M={...E,bodies:E.bodies.map(L=>L.id===A.id?T:L)};return t.set(E.id,M),A.id!==T.id&&(e.delete(A.id),e.set(T.id,M.id)),{oldValue:E,newValue:M,bodiesUpdated:[{oldBody:A,newBody:T}]}}else console.warn(`Attempt to add body to missing annotation ${R.annotation}`)},C=(R,T,E=et.LOCAL)=>{const A=P(R,T);A&&i(E,{updated:[A]})},D=(R,T=et.LOCAL)=>{const E=R.map(A=>P({id:A.id,annotation:A.annotation},A)).filter(Boolean);i(T,{updated:E})},U=R=>{const T=t.get(R.annotation);if(T){const E={...T,target:{...T.target,...R}};return t.set(T.id,E),{oldValue:T,newValue:E,targetUpdated:{oldTarget:T.target,newTarget:R}}}else console.warn(`Attempt to update target on missing annotation: ${R.annotation}`)};return{addAnnotation:s,addBody:f,all:p,bulkAddAnnotations:h,bulkDeleteAnnotations:g,bulkDeleteBodies:$,bulkUpdateAnnotations:u,bulkUpdateBodies:D,bulkUpdateTargets:(R,T=et.LOCAL)=>{const E=R.map(A=>U(A)).filter(Boolean);E.length>0&&i(T,{updated:E})},bulkUpsertAnnotations:d,clear:y,deleteAnnotation:v,deleteBody:S,getAnnotation:j,getBody:_,observe:r,unobserve:o,updateAnnotation:c,updateBody:C,updateTarget:(R,T=et.LOCAL)=>{const E=U(R);E&&i(T,{updated:[E]})},upsertAnnotation:l}};let Ru=()=>({emit(t,...e){for(let n=this.events[t]||[],r=0,o=n.length;r<o;r++)n[r](...e)},events:{},on(t,e){var n;return((n=this.events)[t]||(n[t]=[])).push(e),()=>{var r;this.events[t]=(r=this.events[t])==null?void 0:r.filter(o=>e!==o)}}});const Tu=250,Cu=(t,e)=>{const n=Ru(),r=[];let o=-1,i=!1,s=0;const a=y=>{if(!i){const{changes:h}=y,x=performance.now();if(x-s>Tu)r.splice(o+1),r.push(h),o=r.length-1;else{const v=r.length-1;r[v]=Au(r[v],h)}s=x}i=!1};t.observe(a,{origin:et.LOCAL});const c=y=>y&&y.length>0&&t.bulkDeleteAnnotations(y),l=y=>y&&y.length>0&&t.bulkAddAnnotations(y,!1),u=y=>y&&y.length>0&&t.bulkUpdateAnnotations(y.map(({oldValue:h})=>h)),d=y=>y&&y.length>0&&t.bulkUpdateAnnotations(y.map(({newValue:h})=>h)),f=y=>y&&y.length>0&&t.bulkAddAnnotations(y,!1),p=y=>y&&y.length>0&&t.bulkDeleteAnnotations(y);return{canRedo:()=>r.length-1>o,canUndo:()=>o>-1,destroy:()=>t.unobserve(a),getHistory:()=>({changes:[...r],pointer:o}),on:(y,h)=>n.on(y,h),redo:()=>{if(r.length-1>o){i=!0;const{created:y,updated:h,deleted:x}=r[o+1];l(y),d(h),p(x),n.emit("redo",r[o+1]),o+=1}},undo:()=>{if(o>-1){i=!0;const{created:y,updated:h,deleted:x}=r[o];c(y),u(h),f(x),n.emit("undo",r[o]),o-=1}}}},Ou=()=>{const{subscribe:t,set:e}=lo([]);return{subscribe:t,set:e}},Lu=(t,e,n,r)=>{const{hover:o,selection:i,store:s,viewport:a}=t,c=new Map;let l=[],u;const d=(h,x)=>{c.has(h)?c.get(h).push(x):c.set(h,[x])},f=(h,x)=>{const v=c.get(h);if(v){const g=v.indexOf(x);g!==-1&&v.splice(g,1)}},p=(h,x,v)=>{c.has(h)&&setTimeout(()=>{c.get(h).forEach(g=>{if(n){const m=Array.isArray(x)?x.map($=>n.serialize($)):n.serialize(x),S=v?v instanceof PointerEvent?v:n.serialize(v):void 0;g(m,S)}else g(x,v)})},1)};i.subscribe(({selected:h})=>{if(!(l.length===0&&h.length===0)){if(l.length===0&&h.length>0)l=h.map(({id:x})=>s.getAnnotation(x));else if(l.length>0&&h.length===0)l.forEach(x=>{const v=s.getAnnotation(x.id);v&&!ye(v,x)&&p("updateAnnotation",v,x)}),l=[];else{const x=new Set(l.map(g=>g.id)),v=new Set(h.map(({id:g})=>g));l.filter(g=>!v.has(g.id)).forEach(g=>{const m=s.getAnnotation(g.id);m&&!ye(m,g)&&p("updateAnnotation",m,g)}),l=[...l.filter(g=>v.has(g.id)),...h.filter(({id:g})=>!x.has(g)).map(({id:g})=>s.getAnnotation(g))]}p("selectionChanged",l)}}),o.subscribe(h=>{!u&&h?p("mouseEnterAnnotation",s.getAnnotation(h)):u&&!h?p("mouseLeaveAnnotation",s.getAnnotation(u)):u&&h&&(p("mouseLeaveAnnotation",s.getAnnotation(u)),p("mouseEnterAnnotation",s.getAnnotation(h))),u=h}),a==null||a.subscribe(h=>p("viewportIntersect",h.map(x=>s.getAnnotation(x)))),s.observe(h=>{const{created:x,deleted:v}=h.changes;(x||[]).forEach(g=>p("createAnnotation",g)),(v||[]).forEach(g=>p("deleteAnnotation",g)),(h.changes.updated||[]).filter(g=>[...g.bodiesCreated||[],...g.bodiesDeleted||[],...g.bodiesUpdated||[]].length>0).forEach(({oldValue:g,newValue:m})=>{const S=l.find($=>$.id===g.id)||g;l=l.map($=>$.id===g.id?m:$),p("updateAnnotation",m,S)})},{origin:et.LOCAL}),s.observe(h=>{if(l){const x=new Set(l.map(g=>g.id)),v=(h.changes.updated||[]).filter(({newValue:g})=>x.has(g.id)).map(({newValue:g})=>g);v.length>0&&(l=l.map(g=>v.find(m=>m.id===g.id)||g))}},{origin:et.REMOTE});const y=h=>x=>{const{updated:v}=x;h?(v||[]).forEach(g=>p("updateAnnotation",g.oldValue,g.newValue)):(v||[]).forEach(g=>p("updateAnnotation",g.newValue,g.oldValue))};return e.on("undo",y(!0)),e.on("redo",y(!1)),{on:d,off:f,emit:p}},ku=t=>e=>e.reduce((n,r)=>{const{parsed:o,error:i}=t.parse(r);return i?{parsed:n.parsed,failed:[...n.failed,r]}:o?{parsed:[...n.parsed,o],failed:n.failed}:{...n}},{parsed:[],failed:[]}),Mu=(t,e,n)=>{const{store:r,selection:o}=t,i=v=>{if(n){const{parsed:g,error:m}=n.parse(v);g?r.addAnnotation(g,et.REMOTE):console.error(m)}else r.addAnnotation(Tr(v),et.REMOTE)},s=()=>o.clear(),a=()=>r.clear(),c=v=>{const g=r.getAnnotation(v);return n&&g?n.serialize(g):g},l=()=>n?r.all().map(n.serialize):r.all(),u=()=>{var v;const g=(((v=o.selected)==null?void 0:v.map(m=>m.id))||[]).map(m=>r.getAnnotation(m)).filter(Boolean);return n?g.map(n.serialize):g},d=(v,g=!0)=>fetch(v).then(m=>m.json()).then(m=>(p(m,g),m)),f=v=>{if(typeof v=="string"){const g=r.getAnnotation(v);if(r.deleteAnnotation(v),g)return n?n.serialize(g):g}else{const g=n?n.parse(v).parsed:v;if(g)return r.deleteAnnotation(g),v}},p=(v,g=!0)=>{if(n){const m=n.parseAll||ku(n),{parsed:S,failed:$}=m(v);$.length>0&&console.warn(`Discarded ${$.length} invalid annotations`,$),r.bulkAddAnnotations(S,g,et.REMOTE)}else r.bulkAddAnnotations(v.map(Tr),g,et.REMOTE)},y=(v,g)=>{v?o.setSelected(v,g):o.clear()},h=v=>{o.clear(),o.setUserSelectAction(v)},x=v=>{if(n){const g=n.parse(v).parsed,m=n.serialize(r.getAnnotation(g.id));return r.updateAnnotation(g),m}else{const g=r.getAnnotation(v.id);return r.updateAnnotation(Tr(v)),g}};return{addAnnotation:i,cancelSelected:s,canRedo:e.canRedo,canUndo:e.canUndo,clearAnnotations:a,getAnnotationById:c,getAnnotations:l,getHistory:e.getHistory,getSelected:u,loadAnnotations:d,redo:e.redo,removeAnnotation:f,setAnnotations:p,setSelected:y,setUserSelectAction:h,undo:e.undo,updateAnnotation:x}},_u="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Nu=t=>crypto.getRandomValues(new Uint8Array(t)),Iu=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,o=-~(1.6*r*e/t.length);return(i=e)=>{let s="";for(;;){let a=n(o),c=o|0;for(;c--;)if(s+=t[a[c]&r]||"",s.length>=i)return s}}},Pu=(t,e=21)=>Iu(t,e|0,Nu),Du=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=_u[n[t]&63];return e};const ju=()=>({isGuest:!0,id:Pu("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()});Du();function Os(t,e,n=0,r=t.length-1,o=Bu){for(;r>n;){if(r-n>600){const c=r-n+1,l=e-n+1,u=Math.log(c),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(c-d)/c)*(l-c/2<0?-1:1),p=Math.max(n,Math.floor(e-l*d/c+f)),y=Math.min(r,Math.floor(e+(c-l)*d/c+f));Os(t,e,p,y,o)}const i=t[e];let s=n,a=r;for(We(t,n,e),o(t[r],i)>0&&We(t,n,r);s<a;){for(We(t,s,a),s++,a--;o(t[s],i)<0;)s++;for(;o(t[a],i)>0;)a--}o(t[n],i)===0?We(t,n,a):(a++,We(t,a,r)),a<=e&&(n=a+1),e<=a&&(r=a-1)}}function We(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function Bu(t,e){return t<e?-1:t>e?1:0}class Uu{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let n=this.data;const r=[];if(!Tn(e,n))return r;const o=this.toBBox,i=[];for(;n;){for(let s=0;s<n.children.length;s++){const a=n.children[s],c=n.leaf?o(a):a;Tn(e,c)&&(n.leaf?r.push(a):Or(e,c)?this._all(a,r):i.push(a))}n=i.pop()}return r}collides(e){let n=this.data;if(!Tn(e,n))return!1;const r=[];for(;n;){for(let o=0;o<n.children.length;o++){const i=n.children[o],s=n.leaf?this.toBBox(i):i;if(Tn(e,s)){if(n.leaf||Or(e,s))return!0;r.push(i)}}n=r.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let r=0;r<e.length;r++)this.insert(e[r]);return this}let n=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Se([]),this}remove(e,n){if(!e)return this;let r=this.data;const o=this.toBBox(e),i=[],s=[];let a,c,l;for(;r||i.length;){if(r||(r=i.pop(),c=i[i.length-1],a=s.pop(),l=!0),r.leaf){const u=Hu(e,r.children,n);if(u!==-1)return r.children.splice(u,1),i.push(r),this._condense(i),this}!l&&!r.leaf&&Or(r,o)?(i.push(r),s.push(a),a=0,c=r,r=r.children[0]):c?(a++,r=c.children[a],l=!1):r=null}return this}toBBox(e){return e}compareMinX(e,n){return e.minX-n.minX}compareMinY(e,n){return e.minY-n.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,n){const r=[];for(;e;)e.leaf?n.push(...e.children):r.push(...e.children),e=r.pop();return n}_build(e,n,r,o){const i=r-n+1;let s=this._maxEntries,a;if(i<=s)return a=Se(e.slice(n,r+1)),Ee(a,this.toBBox),a;o||(o=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,o-1))),a=Se([]),a.leaf=!1,a.height=o;const c=Math.ceil(i/s),l=c*Math.ceil(Math.sqrt(s));bi(e,n,r,l,this.compareMinX);for(let u=n;u<=r;u+=l){const d=Math.min(u+l-1,r);bi(e,u,d,c,this.compareMinY);for(let f=u;f<=d;f+=c){const p=Math.min(f+c-1,d);a.children.push(this._build(e,f,p,o-1))}}return Ee(a,this.toBBox),a}_chooseSubtree(e,n,r,o){for(;o.push(n),!(n.leaf||o.length-1===r);){let i=1/0,s=1/0,a;for(let c=0;c<n.children.length;c++){const l=n.children[c],u=Cr(l),d=Xu(e,l)-u;d<s?(s=d,i=u<i?u:i,a=l):d===s&&u<i&&(i=u,a=l)}n=a||n.children[0]}return n}_insert(e,n,r){const o=r?e:this.toBBox(e),i=[],s=this._chooseSubtree(o,this.data,n,i);for(s.children.push(e),Ze(s,o);n>=0&&i[n].children.length>this._maxEntries;)this._split(i,n),n--;this._adjustParentBBoxes(o,i,n)}_split(e,n){const r=e[n],o=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,o);const s=this._chooseSplitIndex(r,i,o),a=Se(r.children.splice(s,r.children.length-s));a.height=r.height,a.leaf=r.leaf,Ee(r,this.toBBox),Ee(a,this.toBBox),n?e[n-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,n){this.data=Se([e,n]),this.data.height=e.height+1,this.data.leaf=!1,Ee(this.data,this.toBBox)}_chooseSplitIndex(e,n,r){let o,i=1/0,s=1/0;for(let a=n;a<=r-n;a++){const c=Qe(e,0,a,this.toBBox),l=Qe(e,a,r,this.toBBox),u=qu(c,l),d=Cr(c)+Cr(l);u<i?(i=u,o=a,s=d<s?d:s):u===i&&d<s&&(s=d,o=a)}return o||r-n}_chooseSplitAxis(e,n,r){const o=e.leaf?this.compareMinX:Vu,i=e.leaf?this.compareMinY:Fu,s=this._allDistMargin(e,n,r,o),a=this._allDistMargin(e,n,r,i);s<a&&e.children.sort(o)}_allDistMargin(e,n,r,o){e.children.sort(o);const i=this.toBBox,s=Qe(e,0,n,i),a=Qe(e,r-n,r,i);let c=Rn(s)+Rn(a);for(let l=n;l<r-n;l++){const u=e.children[l];Ze(s,e.leaf?i(u):u),c+=Rn(s)}for(let l=r-n-1;l>=n;l--){const u=e.children[l];Ze(a,e.leaf?i(u):u),c+=Rn(a)}return c}_adjustParentBBoxes(e,n,r){for(let o=r;o>=0;o--)Ze(n[o],e)}_condense(e){for(let n=e.length-1,r;n>=0;n--)e[n].children.length===0?n>0?(r=e[n-1].children,r.splice(r.indexOf(e[n]),1)):this.clear():Ee(e[n],this.toBBox)}}function Hu(t,e,n){if(!n)return e.indexOf(t);for(let r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function Ee(t,e){Qe(t,0,t.children.length,e,t)}function Qe(t,e,n,r,o){o||(o=Se(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let i=e;i<n;i++){const s=t.children[i];Ze(o,t.leaf?r(s):s)}return o}function Ze(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Vu(t,e){return t.minX-e.minX}function Fu(t,e){return t.minY-e.minY}function Cr(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Rn(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Xu(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function qu(t,e){const n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),o=Math.min(t.maxX,e.maxX),i=Math.min(t.maxY,e.maxY);return Math.max(0,o-n)*Math.max(0,i-r)}function Or(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Tn(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Se(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function bi(t,e,n,r,o){const i=[e,n];for(;i.length;){if(n=i.pop(),e=i.pop(),n-e<=r)continue;const s=e+Math.ceil((n-e)/r/2)*r;Os(t,s,e,n,o),i.push(e,s,s,n)}}const Ku=(t,e)=>{const n=new Uu,r=new Map,o=(y,h)=>{const x=y.selector.flatMap(g=>{const m=te([g])?g.range:As(g,e).range;return Array.from(m.getClientRects())}),v=_c(x).map(({left:g,top:m,right:S,bottom:$})=>new DOMRect(g-h.left,m-h.top,S-g,$-m));return v.map(g=>{const{x:m,y:S,width:$,height:j}=g;return{minX:m,minY:S,maxX:m+$,maxY:S+j,annotation:{id:y.annotation,rects:v}}})},i=()=>[...r.values()],s=()=>{n.clear(),r.clear()},a=y=>{const h=o(y,e.getBoundingClientRect());h.length!==0&&(h.forEach(x=>n.insert(x)),r.set(y.annotation,h))},c=y=>{const h=r.get(y.annotation);h&&(h.forEach(x=>n.remove(x)),r.delete(y.annotation))},l=y=>{c(y),a(y)},u=(y,h=!0)=>{h&&s();const x=e.getBoundingClientRect(),v=y.map(m=>({target:m,rects:o(m,x)}));v.forEach(({target:m,rects:S})=>{S.length>0&&r.set(m.annotation,S)});const g=v.flatMap(({rects:m})=>m);n.load(g)},d=(y,h,x=!1)=>{const v=n.search({minX:y,minY:h,maxX:y,maxY:h}),g=m=>m.annotation.rects.reduce((S,$)=>S+$.width*$.height,0);return v.length>0?(v.sort((m,S)=>g(m)-g(S)),x?v.map(m=>m.annotation.id):[v[0].annotation.id]):[]},f=y=>{const h=p(y);if(h.length===0)return;let x=h[0].left,v=h[0].top,g=h[0].right,m=h[0].bottom;for(let S=1;S<h.length;S++){const $=h[S];x=Math.min(x,$.left),v=Math.min(v,$.top),g=Math.max(g,$.right),m=Math.max(m,$.bottom)}return new DOMRect(x,v,g-x,m-v)},p=y=>{const h=r.get(y);return h?h[0].annotation.rects:[]};return{all:i,clear:s,getAt:d,getAnnotationBounds:f,getAnnotationRects:p,getIntersecting:(y,h,x,v)=>{const g=n.search({minX:y,minY:h,maxX:x,maxY:v}),m=new Set(g.map(S=>S.annotation.id));return Array.from(m).map(S=>({annotation:t.getAnnotation(S),rects:p(S)})).filter(S=>!!S.annotation)},insert:a,recalculate:()=>u(t.all().map(y=>y.target),!0),remove:c,set:u,size:()=>n.all().length,update:l}},Yu=(t,e)=>{const n=Su(),r=Ku(n,t),o=du(n,e.userSelectAction,e.adapter),i=uu(n),s=Ou(),a=(v,g=et.LOCAL)=>{const m=wr(v,t),S=te(m.target.selector);return S&&n.addAnnotation(m,g),S},c=(v,g=!0,m=et.LOCAL)=>{const S=v.map(j=>wr(j,t)),$=S.filter(j=>!te(j.target.selector));return n.bulkAddAnnotations(S,g,m),$},l=(v,g=et.LOCAL)=>{const m=v.map($=>wr($,t)),S=m.filter($=>!te($.target.selector));return m.forEach($=>{n.getAnnotation($.id)?n.updateAnnotation($,g):n.addAnnotation($,g)}),S},u=(v,g=et.LOCAL)=>{const m=jn(v,t);n.updateTarget(m,g)},d=(v,g=et.LOCAL)=>{const m=v.map(S=>jn(S,t));n.bulkUpdateTargets(m,g)};function f(v,g,m,S){const $=m||!!S,j=r.getAt(v,g,$).map(P=>n.getAnnotation(P)),_=S?j.filter(S):j;if(_.length!==0)return m?_:_[0]}const p=v=>{if(r.getAnnotationRects(v).length!==0)return r.getAnnotationBounds(v)},y=(v,g,m,S)=>r.getIntersecting(v,g,m,S),h=v=>r.getAnnotationRects(v),x=()=>r.recalculate();return n.observe(({changes:v})=>{const g=(v.deleted||[]).filter($=>te($.target.selector)),m=(v.created||[]).filter($=>te($.target.selector)),S=(v.updated||[]).filter($=>te($.newValue.target.selector));(g==null?void 0:g.length)>0&&g.forEach($=>r.remove($.target)),m.length>0&&r.set(m.map($=>$.target),!1),(S==null?void 0:S.length)>0&&S.forEach(({newValue:$})=>r.update($.target))}),{store:{...n,addAnnotation:a,bulkAddAnnotations:c,bulkUpdateTargets:d,bulkUpsertAnnotations:l,getAnnotationBounds:p,getAnnotationRects:h,getIntersecting:y,getAt:f,recalculatePositions:x,updateTarget:u},selection:o,hover:i,viewport:s}},Wu=()=>{const t=document.createElement("canvas");t.width=2*window.innerWidth,t.height=2*window.innerHeight,t.className="r6o-presence-layer";const e=t.getContext("2d");return e.scale(2,2),e.translate(.5,.5),t},Gu=(t,e={})=>{const n=Wu(),r=n.getContext("2d");document.body.appendChild(n);const o=new Map,i=s=>Array.from(o.entries()).filter(([a,c])=>c.presenceKey===s.presenceKey).map(([a,c])=>a);return t.on("selectionChange",(s,a)=>{i(s).forEach(c=>o.delete(c)),a&&a.forEach(c=>o.set(c,s))}),{clear:()=>{const{width:s,height:a}=n;r.clearRect(-.5,-.5,s+1,a+1)},destroy:()=>{n.remove()},paint:(s,a,c)=>{e.font&&(r.font=e.font);const l=o.get(s.annotation.id);if(l){const{height:u}=s.rects[0],d=s.rects[0].x+a.left,f=s.rects[0].y+a.top;r.fillStyle=l.appearance.color,r.fillRect(d-2,f-2.5,2,u+5);const p=r.measureText(l.appearance.label),y=p.width+6,h=p.actualBoundingBoxAscent+p.actualBoundingBoxDescent+8,x=p.fontBoundingBoxAscent?8:6.5;return r.fillRect(d-2,f-2.5-h,y,h),r.fillStyle="#fff",r.fillText(l.appearance.label,d+1,f-x),{fill:l.appearance.color,fillOpacity:c?.45:.18}}},reset:()=>{n.width=2*window.innerWidth,n.height=2*window.innerHeight;const s=n.getContext("2d");s.scale(2,2),s.translate(.5,.5)}}},Lr=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function kr(t,e,n,r){t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on".concat(e),n)}function Ge(t,e,n,r){t.removeEventListener?t.removeEventListener(e,n,r):t.detachEvent&&t.detachEvent("on".concat(e),n)}function Ls(t,e){const n=e.slice(0,e.length-1);for(let r=0;r<n.length;r++)n[r]=t[n[r].toLowerCase()];return n}function ks(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function zu(t,e){const n=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let o=!0;for(let i=0;i<n.length;i++)r.indexOf(n[i])===-1&&(o=!1);return o}const hn={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":Lr?173:189,"=":Lr?61:187,";":Lr?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},qt={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},tn={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Et={16:!1,18:!1,17:!1,91:!1},pt={};for(let t=1;t<20;t++)hn["f".concat(t)]=111+t;let lt=[],an=null,Ms="all";const Zt=new Map,Ve=t=>hn[t.toLowerCase()]||qt[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),Ju=t=>Object.keys(hn).find(e=>hn[e]===t),Qu=t=>Object.keys(qt).find(e=>qt[e]===t);function _s(t){Ms=t||"all"}function gn(){return Ms||"all"}function Zu(){return lt.slice(0)}function td(){return lt.map(t=>Ju(t)||Qu(t)||String.fromCharCode(t))}function ed(){const t=[];return Object.keys(pt).forEach(e=>{pt[e].forEach(n=>{let{key:r,scope:o,mods:i,shortcut:s}=n;t.push({scope:o,shortcut:s,mods:i,keys:r.split("+").map(a=>Ve(a))})})}),t}function nd(t){const e=t.target||t.srcElement,{tagName:n}=e;let r=!0;const o=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(o||n==="TEXTAREA"||n==="SELECT")&&!e.readOnly)&&(r=!1),r}function rd(t){return typeof t=="string"&&(t=Ve(t)),lt.indexOf(t)!==-1}function od(t,e){let n,r;t||(t=gn());for(const o in pt)if(Object.prototype.hasOwnProperty.call(pt,o))for(n=pt[o],r=0;r<n.length;)n[r].scope===t?n.splice(r,1).forEach(i=>{let{element:s}=i;return co(s)}):r++;gn()===t&&_s(e||"all")}function id(t){let e=t.keyCode||t.which||t.charCode;t.key&&t.key.toLowerCase()==="capslock"&&(e=Ve(t.key));const n=lt.indexOf(e);if(n>=0&&lt.splice(n,1),t.key&&t.key.toLowerCase()==="meta"&&lt.splice(0,lt.length),(e===93||e===224)&&(e=91),e in Et){Et[e]=!1;for(const r in qt)qt[r]===e&&(jt[r]=!1)}}function Ns(t){if(typeof t>"u")Object.keys(pt).forEach(o=>{Array.isArray(pt[o])&&pt[o].forEach(i=>Cn(i)),delete pt[o]}),co(null);else if(Array.isArray(t))t.forEach(o=>{o.key&&Cn(o)});else if(typeof t=="object")t.key&&Cn(t);else if(typeof t=="string"){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];let[o,i]=n;typeof o=="function"&&(i=o,o=""),Cn({key:t,scope:o,method:i,splitKey:"+"})}}const Cn=t=>{let{key:e,scope:n,method:r,splitKey:o="+"}=t;ks(e).forEach(i=>{const s=i.split(o),a=s.length,c=s[a-1],l=c==="*"?"*":Ve(c);if(!pt[l])return;n||(n=gn());const u=a>1?Ls(qt,s):[],d=[];pt[l]=pt[l].filter(f=>{const p=(r?f.method===r:!0)&&f.scope===n&&zu(f.mods,u);return p&&d.push(f.element),!p}),d.forEach(f=>co(f))})};function wi(t,e,n,r){if(e.element!==r)return;let o;if(e.scope===n||e.scope==="all"){o=e.mods.length>0;for(const i in Et)Object.prototype.hasOwnProperty.call(Et,i)&&(!Et[i]&&e.mods.indexOf(+i)>-1||Et[i]&&e.mods.indexOf(+i)===-1)&&(o=!1);(e.mods.length===0&&!Et[16]&&!Et[18]&&!Et[17]&&!Et[91]||o||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(lt),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function xi(t,e){const n=pt["*"];let r=t.keyCode||t.which||t.charCode;if(t.key&&t.key.toLowerCase()==="capslock"||!jt.filter.call(this,t))return;if((r===93||r===224)&&(r=91),lt.indexOf(r)===-1&&r!==229&&lt.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const c=tn[a];t[a]&&lt.indexOf(c)===-1?lt.push(c):!t[a]&&lt.indexOf(c)>-1?lt.splice(lt.indexOf(c),1):a==="metaKey"&&t[a]&&(lt=lt.filter(l=>l in tn||l===r))}),r in Et){Et[r]=!0;for(const a in qt)if(Object.prototype.hasOwnProperty.call(qt,a)){const c=tn[qt[a]];jt[a]=t[c]}if(!n)return}for(const a in Et)Object.prototype.hasOwnProperty.call(Et,a)&&(Et[a]=t[tn[a]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(lt.indexOf(17)===-1&&lt.push(17),lt.indexOf(18)===-1&&lt.push(18),Et[17]=!0,Et[18]=!0);const o=gn();if(n)for(let a=0;a<n.length;a++)n[a].scope===o&&(t.type==="keydown"&&n[a].keydown||t.type==="keyup"&&n[a].keyup)&&wi(t,n[a],o,e);if(!(r in pt))return;const i=pt[r],s=i.length;for(let a=0;a<s;a++)if((t.type==="keydown"&&i[a].keydown||t.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,u=c.key.split(l),d=[];for(let f=0;f<u.length;f++)d.push(Ve(u[f]));d.sort().join("")===lt.sort().join("")&&wi(t,c,o,e)}}function jt(t,e,n){lt=[];const r=ks(t);let o=[],i="all",s=document,a=0,c=!1,l=!0,u="+",d=!1,f=!1;for(n===void 0&&typeof e=="function"&&(n=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(i=e.scope),e.element&&(s=e.element),e.keyup&&(c=e.keyup),e.keydown!==void 0&&(l=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(f=!0)),typeof e=="string"&&(i=e),f&&Ns(t,i);a<r.length;a++)t=r[a].split(u),o=[],t.length>1&&(o=Ls(qt,t)),t=t[t.length-1],t=t==="*"?"*":Ve(t),t in pt||(pt[t]=[]),pt[t].push({keyup:c,keydown:l,scope:i,mods:o,shortcut:r[a],method:n,key:r[a],splitKey:u,element:s});if(typeof s<"u"&&window){if(!Zt.has(s)){const p=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return xi(h,s)},y=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;xi(h,s),id(h)};Zt.set(s,{keydownListener:p,keyupListenr:y,capture:d}),kr(s,"keydown",p,d),kr(s,"keyup",y,d)}if(!an){const p=()=>{lt=[]};an={listener:p,capture:d},kr(window,"focus",p,d)}}}function sd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(pt).forEach(n=>{pt[n].filter(r=>r.scope===e&&r.shortcut===t).forEach(r=>{r&&r.method&&r.method()})})}function co(t){const e=Object.values(pt).flat();if(e.findIndex(n=>{let{element:r}=n;return r===t})<0){const{keydownListener:n,keyupListenr:r,capture:o}=Zt.get(t)||{};n&&r&&(Ge(t,"keyup",r,o),Ge(t,"keydown",n,o),Zt.delete(t))}if((e.length<=0||Zt.size<=0)&&(Object.keys(Zt).forEach(n=>{const{keydownListener:r,keyupListenr:o,capture:i}=Zt.get(n)||{};r&&o&&(Ge(n,"keyup",o,i),Ge(n,"keydown",r,i),Zt.delete(n))}),Zt.clear(),Object.keys(pt).forEach(n=>delete pt[n]),an)){const{listener:n,capture:r}=an;Ge(window,"focus",n,r),an=null}}const Mr={getPressedKeyString:td,setScope:_s,getScope:gn,deleteScope:od,getPressedKeyCodes:Zu,getAllKeyCodes:ed,isPressed:rd,filter:nd,trigger:sd,unbind:Ns,keyMap:hn,modifier:qt,modifierMap:tn};for(const t in Mr)Object.prototype.hasOwnProperty.call(Mr,t)&&(jt[t]=Mr[t]);if(typeof window<"u"){const t=window.hotkeys;jt.noConflict=e=>(e&&window.hotkeys===jt&&(window.hotkeys=t),jt),window.hotkeys=jt}const Ei=300,Is=["up","down","left","right"],Ps=$c?"⌘+a":"ctrl+a",ad=[...Is.map(t=>`shift+${t}`),Ps],ld=(t,e,n)=>{let r;const{annotatingEnabled:o,offsetReferenceSelector:i,selectionMode:s}=n,a=C=>r=C;let c;const l=C=>c=C,{store:u,selection:d}=e;let f,p,y;const h=C=>{const D=C;return D.ctrlKey||D.metaKey},x=C=>{if(p!==!1)if(Je(C.target))f=void 0;else{const{selected:D}=d;if(h({...C,...y})&&D.length===1&&D[0].editable){const U=u.getAnnotation(D[0].id);f={previous:{...U.target},next:{annotation:U.id,selector:[],created:U.target.created,creator:U.target.creator,updated:new Date,updatedBy:r}}}else f={next:{annotation:lu(),selector:[],created:new Date,creator:r}}}},v=so(C=>{const D=document.getSelection();if(!(D!=null&&D.anchorNode))return;if(Je(D.anchorNode)){f=void 0;return}const U=C.timeStamp-((y==null?void 0:y.timeStamp)||C.timeStamp);if((y==null?void 0:y.type)==="pointerdown"&&(U<1e3&&!f||D.isCollapsed&&U<Ei)&&x(y||C),!f)return;if(D.isCollapsed){u.getAnnotation(f.next.annotation)&&!h(y)&&(d.clear(),u.deleteAnnotation(f.next.annotation));return}const R=Array.from(Array(D.rangeCount).keys()).map(E=>D.getRangeAt(E)).map(E=>Pc(E,t));if(R.every(E=>Lc(E)))return;const T=R.flatMap(E=>Tc(E.cloneRange()));(T.length!==f.next.selector.length||T.some((E,A)=>{var M;return E.toString()!==((M=f.next.selector[A])==null?void 0:M.quote)}))&&(f={...f,next:{...f.next,selector:[...f.previous?f.previous.selector:[],...T.map(E=>Ic(E,t,i))],updated:new Date}},u.getAnnotation(f.next.annotation)?u.updateTarget(f.next,et.LOCAL):h(y)||d.clear())}),g=C=>{Je(C.target)||(y=br(C),p=y.button===0)},m=C=>{if(Je(C.target)||!p)return;const D=()=>{const{x:R,y:T}=t.getBoundingClientRect(),E=C.target instanceof Node&&t.contains(C.target)&&u.getAt(C.clientX-R,C.clientY-T,s==="all",c);if(E){const{selected:A}=d,M=new Set(A.map(k=>k.id)),L=Array.isArray(E)?E.map(k=>k.id):[E.id];(M.size!==L.length||!L.every(k=>M.has(k)))&&d.userSelect(L,C)}else h(C)||d.clear()},U=C.timeStamp-y.timeStamp;setTimeout(()=>{const R=document.getSelection();R!=null&&R.isCollapsed&&U<Ei?(f=void 0,D()):f&&f.next.selector.length>0&&(P(),d.userSelect(f.next.annotation,br(C)))})},S=C=>{const D=document.getSelection();D!=null&&D.isCollapsed||((!f||f.next.selector.length===0)&&v(C),f&&(P(),d.userSelect(f.next.annotation,br(C))))},$=C=>{C.key==="Shift"&&f&&(document.getSelection().isCollapsed||(P(),d.userSelect(f.next.annotation,En(C))))},j=C=>{const D=()=>setTimeout(()=>{(f==null?void 0:f.next.selector.length)>0&&(d.clear(),u.addAnnotation({id:f.next.annotation,bodies:[],target:f.next}),d.userSelect(f.next.annotation,En(C))),document.removeEventListener("selectionchange",D)},100);document.addEventListener("selectionchange",D),x(C)};jt(ad.join(","),{element:t,keydown:!0,keyup:!1},C=>{C.repeat||(y=En(C))}),jt(Ps,{keydown:!0,keyup:!1},C=>{y=En(C),j(C)});const _=C=>{C.repeat||C.target!==t&&C.target!==document.body||(f=void 0,d.clear())};jt(Is.join(","),{keydown:!0,keyup:!1},_);const P=()=>{const C=u.getAnnotation(f.next.annotation);if(!C){u.addAnnotation({id:f.next.annotation,bodies:[],target:f.next});return}const{target:{updated:D}}=C,{updated:U}=f.next;(!D||!U||D<U)&&u.updateTarget(f.next)};return t.addEventListener("pointerdown",g),document.addEventListener("pointerup",m),document.addEventListener("contextmenu",S),o&&(t.addEventListener("keyup",$),t.addEventListener("selectstart",x),document.addEventListener("selectionchange",v)),{destroy:()=>{t.removeEventListener("pointerdown",g),document.removeEventListener("pointerup",m),document.removeEventListener("contextmenu",S),t.removeEventListener("keyup",$),t.removeEventListener("selectstart",x),document.removeEventListener("selectionchange",v),jt.unbind()},setFilter:l,setUser:a}},cd=(t,e)=>({...t,annotatingEnabled:t.annotatingEnabled??e.annotatingEnabled,user:t.user||e.user}),Ai="SPANS",ud=(t,e={})=>{Ac(t),Sc(t);const n=cd(e,{annotatingEnabled:!0,user:ju()}),r=Yu(t,n),{selection:o,viewport:i}=r,s=r.store,a=Cu(s),c=Lu(r,a,n.adapter);let l=n.user;const u=n.renderer==="CSS_HIGHLIGHTS"?CSS.highlights?"CSS_HIGHLIGHTS":Ai:n.renderer||Ai,d=u==="SPANS"?ru(t,r,i):u==="CSS_HIGHLIGHTS"?tu(t,r,i):u==="CANVAS"?Xc(t,r,i):void 0;if(!d)throw`Unknown renderer implementation: ${u}`;console.debug(`Using ${u} renderer`),n.style&&d.setStyle(n.style);const f=ld(t,r,n);return f.setUser(l),{...Mu(r,a,n.adapter),destroy:()=>{d.destroy(),f.destroy(),a.destroy()},element:t,getUser:()=>l,setFilter:p=>{d.setFilter(p),f.setFilter(p)},setStyle:p=>d.setStyle(p),setUser:p=>{l=p,f.setUser(p)},setSelected:p=>{p?o.setSelected(p):o.clear()},setPresenceProvider:p=>{p&&(d.setPainter(Gu(p,n.presence)),p.on("selectionChange",()=>d.redraw()))},setVisible:p=>d.setVisible(p),on:c.on,off:c.off,scrollIntoView:Dc(t,s),state:r}},$p=t=>{const{children:e,...n}=t,{anno:r,setAnno:o}=N.useContext(Wn),i=N.useCallback(s=>{const a=xc(ud(s,n));o(a)},[]);return N.useEffect(()=>{r&&r.setStyle(t.style)},[t.style]),N.useEffect(()=>{r&&r.setFilter(t.filter)},[t.filter]),t.children?dt.jsx(dt.Fragment,{children:N.Children.toArray(t.children).map(s=>N.cloneElement(s,{onLoad:i}))}):null};function zn(){return typeof window<"u"}function pe(t){return uo(t)?(t.nodeName||"").toLowerCase():"#document"}function Nt(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Gt(t){var e;return(e=(uo(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function uo(t){return zn()?t instanceof Node||t instanceof Nt(t).Node:!1}function Ct(t){return zn()?t instanceof Element||t instanceof Nt(t).Element:!1}function $t(t){return zn()?t instanceof HTMLElement||t instanceof Nt(t).HTMLElement:!1}function Kr(t){return!zn()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Nt(t).ShadowRoot}const dd=new Set(["inline","contents"]);function vn(t){const{overflow:e,overflowX:n,overflowY:r,display:o}=Bt(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!dd.has(o)}const fd=new Set(["table","td","th"]);function pd(t){return fd.has(pe(t))}const hd=[":popover-open",":modal"];function Jn(t){return hd.some(e=>{try{return t.matches(e)}catch{return!1}})}const gd=["transform","translate","scale","rotate","perspective"],md=["transform","translate","scale","rotate","perspective","filter"],yd=["paint","layout","strict","content"];function fo(t){const e=po(),n=Ct(t)?Bt(t):t;return gd.some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||md.some(r=>(n.willChange||"").includes(r))||yd.some(r=>(n.contain||"").includes(r))}function vd(t){let e=fe(t);for(;$t(e)&&!Ne(e);){if(fo(e))return e;if(Jn(e))return null;e=fe(e)}return null}function po(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const bd=new Set(["html","body","#document"]);function Ne(t){return bd.has(pe(t))}function Bt(t){return Nt(t).getComputedStyle(t)}function Qn(t){return Ct(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function fe(t){if(pe(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Kr(t)&&t.host||Gt(t);return Kr(e)?e.host:e}function Ds(t){const e=fe(t);return Ne(e)?t.ownerDocument?t.ownerDocument.body:t.body:$t(e)&&vn(e)?e:Ds(e)}function mn(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const o=Ds(t),i=o===((r=t.ownerDocument)==null?void 0:r.body),s=Nt(o);if(i){const a=Yr(s);return e.concat(s,s.visualViewport||[],vn(o)?o:[],a&&n?mn(a):[])}return e.concat(o,mn(o,[],n))}function Yr(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var wd=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],Un=wd.join(","),js=typeof Element>"u",Ie=js?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Hn=!js&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},Vn=function t(e,n){var r;n===void 0&&(n=!0);var o=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),i=o===""||o==="true",s=i||n&&e&&t(e.parentNode);return s},xd=function(e){var n,r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"contenteditable");return r===""||r==="true"},Bs=function(e,n,r){if(Vn(e))return[];var o=Array.prototype.slice.apply(e.querySelectorAll(Un));return n&&Ie.call(e,Un)&&o.unshift(e),o=o.filter(r),o},Us=function t(e,n,r){for(var o=[],i=Array.from(e);i.length;){var s=i.shift();if(!Vn(s,!1))if(s.tagName==="SLOT"){var a=s.assignedElements(),c=a.length?a:s.children,l=t(c,!0,r);r.flatten?o.push.apply(o,l):o.push({scopeParent:s,candidates:l})}else{var u=Ie.call(s,Un);u&&r.filter(s)&&(n||!e.includes(s))&&o.push(s);var d=s.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(s),f=!Vn(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(s));if(d&&f){var p=t(d===!0?s.children:d.children,!0,r);r.flatten?o.push.apply(o,p):o.push({scopeParent:s,candidates:p})}else i.unshift.apply(i,s.children)}}return o},Hs=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Vs=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||xd(e))&&!Hs(e)?0:e.tabIndex},Ed=function(e,n){var r=Vs(e);return r<0&&n&&!Hs(e)?0:r},Ad=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},Fs=function(e){return e.tagName==="INPUT"},$d=function(e){return Fs(e)&&e.type==="hidden"},Sd=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return n},Rd=function(e,n){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===n)return e[r]},Td=function(e){if(!e.name)return!0;var n=e.form||Hn(e),r=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},o;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")o=r(window.CSS.escape(e.name));else try{o=r(e.name)}catch(s){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",s.message),!1}var i=Rd(o,e.form);return!i||i===e},Cd=function(e){return Fs(e)&&e.type==="radio"},Od=function(e){return Cd(e)&&!Td(e)},Ld=function(e){var n,r=e&&Hn(e),o=(n=r)===null||n===void 0?void 0:n.host,i=!1;if(r&&r!==e){var s,a,c;for(i=!!((s=o)!==null&&s!==void 0&&(a=s.ownerDocument)!==null&&a!==void 0&&a.contains(o)||e!=null&&(c=e.ownerDocument)!==null&&c!==void 0&&c.contains(e));!i&&o;){var l,u,d;r=Hn(o),o=(l=r)===null||l===void 0?void 0:l.host,i=!!((u=o)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(o))}}return i},$i=function(e){var n=e.getBoundingClientRect(),r=n.width,o=n.height;return r===0&&o===0},kd=function(e,n){var r=n.displayCheck,o=n.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var i=Ie.call(e,"details>summary:first-of-type"),s=i?e.parentElement:e;if(Ie.call(s,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof o=="function"){for(var a=e;e;){var c=e.parentElement,l=Hn(e);if(c&&!c.shadowRoot&&o(c)===!0)return $i(e);e.assignedSlot?e=e.assignedSlot:!c&&l!==e.ownerDocument?e=l.host:e=c}e=a}if(Ld(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return $i(e);return!1},Md=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var r=0;r<n.children.length;r++){var o=n.children.item(r);if(o.tagName==="LEGEND")return Ie.call(n,"fieldset[disabled] *")?!0:!o.contains(e)}return!0}n=n.parentElement}return!1},Wr=function(e,n){return!(n.disabled||Vn(n)||$d(n)||kd(n,e)||Sd(n)||Md(n))},Gr=function(e,n){return!(Od(n)||Vs(n)<0||!Wr(e,n))},_d=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},Nd=function t(e){var n=[],r=[];return e.forEach(function(o,i){var s=!!o.scopeParent,a=s?o.scopeParent:o,c=Ed(a,s),l=s?t(o.candidates):a;c===0?s?n.push.apply(n,l):n.push(a):r.push({documentOrder:i,tabIndex:c,item:o,isScope:s,content:l})}),r.sort(Ad).reduce(function(o,i){return i.isScope?o.push.apply(o,i.content):o.push(i.content),o},[]).concat(n)},Zn=function(e,n){n=n||{};var r;return n.getShadowRoot?r=Us([e],n.includeContainer,{filter:Gr.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:_d}):r=Bs(e,n.includeContainer,Gr.bind(null,n)),Nd(r)},Id=function(e,n){n=n||{};var r;return n.getShadowRoot?r=Us([e],n.includeContainer,{filter:Wr.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):r=Bs(e,n.includeContainer,Wr.bind(null,n)),r},Xs=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return Ie.call(e,Un)===!1?!1:Gr(n,e)};function Pd(){const t=navigator.userAgentData;return t!=null&&t.platform?t.platform:navigator.platform}function qs(){const t=navigator.userAgentData;return t&&Array.isArray(t.brands)?t.brands.map(e=>{let{brand:n,version:r}=e;return n+"/"+r}).join(" "):navigator.userAgent}function Dd(){return/apple/i.test(navigator.vendor)}function zr(){const t=/android/i;return t.test(Pd())||t.test(qs())}function jd(){return qs().includes("jsdom/")}const Si="data-floating-ui-focusable",Bd="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function Re(t){let e=t.activeElement;for(;((n=e)==null||(n=n.shadowRoot)==null?void 0:n.activeElement)!=null;){var n;e=e.shadowRoot.activeElement}return e}function Ht(t,e){if(!t||!e)return!1;const n=e.getRootNode==null?void 0:e.getRootNode();if(t.contains(e))return!0;if(n&&Kr(n)){let r=e;for(;r;){if(t===r)return!0;r=r.parentNode||r.host}}return!1}function _r(t){return"composedPath"in t?t.composedPath()[0]:t.target}function ee(t){return(t==null?void 0:t.ownerDocument)||document}function Ud(t){return $t(t)&&t.matches(Bd)}function Ri(t){return t?t.getAttribute("role")==="combobox"&&Ud(t):!1}function Ti(t){return t?t.hasAttribute(Si)?t:t.querySelector("["+Si+"]")||t:null}function Jr(t,e,n){return n===void 0&&(n=!0),t.filter(o=>{var i;return o.parentId===e&&(!n||((i=o.context)==null?void 0:i.open))}).flatMap(o=>[o,...Jr(t,o.id,n)])}function Ci(t,e){var n;let r=[],o=(n=t.find(i=>i.id===e))==null?void 0:n.parentId;for(;o;){const i=t.find(s=>s.id===o);o=i==null?void 0:i.parentId,i&&(r=r.concat(i))}return r}function Nr(t){t.preventDefault(),t.stopPropagation()}function Hd(t){return t.mozInputSource===0&&t.isTrusted?!0:zr()&&t.pointerType?t.type==="click"&&t.buttons===1:t.detail===0&&!t.pointerType}function Vd(t){return jd()?!1:!zr()&&t.width===0&&t.height===0||zr()&&t.width===1&&t.height===1&&t.pressure===0&&t.detail===0&&t.pointerType==="mouse"||t.width<1&&t.height<1&&t.pressure===0&&t.detail===0&&t.pointerType==="touch"}var Fd=typeof document<"u",Xd=function(){},_t=Fd?N.useLayoutEffect:Xd;const qd={...Ji};function Ir(t){const e=N.useRef(t);return _t(()=>{e.current=t}),e}const Kd=qd.useInsertionEffect,Yd=Kd||(t=>t());function en(t){const e=N.useRef(()=>{});return Yd(()=>{e.current=t}),N.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e.current==null?void 0:e.current(...r)},[])}const bn=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function Ks(t,e){const n=Zn(t,bn()),r=n.length;if(r===0)return;const o=Re(ee(t)),i=n.indexOf(o),s=i===-1?e===1?0:r-1:i+e;return n[s]}function Ys(t){return Ks(ee(t).body,1)||t}function Ws(t){return Ks(ee(t).body,-1)||t}function ln(t,e){const n=e||t.currentTarget,r=t.relatedTarget;return!r||!Ht(n,r)}function Wd(t){Zn(t,bn()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function Oi(t){t.querySelectorAll("[data-tabindex]").forEach(n=>{const r=n.dataset.tabindex;delete n.dataset.tabindex,r?n.setAttribute("tabindex",r):n.removeAttribute("tabindex")})}const re=Math.min,Yt=Math.max,Fn=Math.round,On=Math.floor,Wt=t=>({x:t,y:t}),Gd={left:"right",right:"left",bottom:"top",top:"bottom"},zd={start:"end",end:"start"};function Qr(t,e,n){return Yt(t,re(e,n))}function Fe(t,e){return typeof t=="function"?t(e):t}function oe(t){return t.split("-")[0]}function wn(t){return t.split("-")[1]}function Gs(t){return t==="x"?"y":"x"}function ho(t){return t==="y"?"height":"width"}const Jd=new Set(["top","bottom"]);function ne(t){return Jd.has(oe(t))?"y":"x"}function go(t){return Gs(ne(t))}function Qd(t,e,n){n===void 0&&(n=!1);const r=wn(t),o=go(t),i=ho(o);let s=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(s=Xn(s)),[s,Xn(s)]}function Zd(t){const e=Xn(t);return[Zr(t),e,Zr(e)]}function Zr(t){return t.replace(/start|end/g,e=>zd[e])}const Li=["left","right"],ki=["right","left"],tf=["top","bottom"],ef=["bottom","top"];function nf(t,e,n){switch(t){case"top":case"bottom":return n?e?ki:Li:e?Li:ki;case"left":case"right":return e?tf:ef;default:return[]}}function rf(t,e,n,r){const o=wn(t);let i=nf(oe(t),n==="start",r);return o&&(i=i.map(s=>s+"-"+o),e&&(i=i.concat(i.map(Zr)))),i}function Xn(t){return t.replace(/left|right|bottom|top/g,e=>Gd[e])}function of(t){return{top:0,right:0,bottom:0,left:0,...t}}function mo(t){return typeof t!="number"?of(t):{top:t,right:t,bottom:t,left:t}}function Pe(t){const{x:e,y:n,width:r,height:o}=t;return{width:r,height:o,top:n,left:e,right:e+r,bottom:n+o,x:e,y:n}}function Mi(t,e,n){let{reference:r,floating:o}=t;const i=ne(e),s=go(e),a=ho(s),c=oe(e),l=i==="y",u=r.x+r.width/2-o.width/2,d=r.y+r.height/2-o.height/2,f=r[a]/2-o[a]/2;let p;switch(c){case"top":p={x:u,y:r.y-o.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-o.width,y:d};break;default:p={x:r.x,y:r.y}}switch(wn(e)){case"start":p[s]-=f*(n&&l?-1:1);break;case"end":p[s]+=f*(n&&l?-1:1);break}return p}const sf=async(t,e,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:i=[],platform:s}=n,a=i.filter(Boolean),c=await(s.isRTL==null?void 0:s.isRTL(e));let l=await s.getElementRects({reference:t,floating:e,strategy:o}),{x:u,y:d}=Mi(l,r,c),f=r,p={},y=0;for(let h=0;h<a.length;h++){const{name:x,fn:v}=a[h],{x:g,y:m,data:S,reset:$}=await v({x:u,y:d,initialPlacement:r,placement:f,strategy:o,middlewareData:p,rects:l,platform:s,elements:{reference:t,floating:e}});u=g??u,d=m??d,p={...p,[x]:{...p[x],...S}},$&&y<=50&&(y++,typeof $=="object"&&($.placement&&(f=$.placement),$.rects&&(l=$.rects===!0?await s.getElementRects({reference:t,floating:e,strategy:o}):$.rects),{x:u,y:d}=Mi(l,f,c)),h=-1)}return{x:u,y:d,placement:f,strategy:o,middlewareData:p}};async function zs(t,e){var n;e===void 0&&(e={});const{x:r,y:o,platform:i,rects:s,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:p=0}=Fe(e,t),y=mo(p),x=a[f?d==="floating"?"reference":"floating":d],v=Pe(await i.getClippingRect({element:(n=await(i.isElement==null?void 0:i.isElement(x)))==null||n?x:x.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),g=d==="floating"?{x:r,y:o,width:s.floating.width,height:s.floating.height}:s.reference,m=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),S=await(i.isElement==null?void 0:i.isElement(m))?await(i.getScale==null?void 0:i.getScale(m))||{x:1,y:1}:{x:1,y:1},$=Pe(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:g,offsetParent:m,strategy:c}):g);return{top:(v.top-$.top+y.top)/S.y,bottom:($.bottom-v.bottom+y.bottom)/S.y,left:(v.left-$.left+y.left)/S.x,right:($.right-v.right+y.right)/S.x}}const af=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:o,rects:i,platform:s,elements:a,middlewareData:c}=e,{element:l,padding:u=0}=Fe(t,e)||{};if(l==null)return{};const d=mo(u),f={x:n,y:r},p=go(o),y=ho(p),h=await s.getDimensions(l),x=p==="y",v=x?"top":"left",g=x?"bottom":"right",m=x?"clientHeight":"clientWidth",S=i.reference[y]+i.reference[p]-f[p]-i.floating[y],$=f[p]-i.reference[p],j=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l));let _=j?j[m]:0;(!_||!await(s.isElement==null?void 0:s.isElement(j)))&&(_=a.floating[m]||i.floating[y]);const P=S/2-$/2,C=_/2-h[y]/2-1,D=re(d[v],C),U=re(d[g],C),R=D,T=_-h[y]-U,E=_/2-h[y]/2+P,A=Qr(R,E,T),M=!c.arrow&&wn(o)!=null&&E!==A&&i.reference[y]/2-(E<R?D:U)-h[y]/2<0,L=M?E<R?E-R:E-T:0;return{[p]:f[p]+L,data:{[p]:A,centerOffset:E-A-L,...M&&{alignmentOffset:L}},reset:M}}}),lf=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:o,middlewareData:i,rects:s,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:h=!0,...x}=Fe(t,e);if((n=i.arrow)!=null&&n.alignmentOffset)return{};const v=oe(o),g=ne(a),m=oe(a)===a,S=await(c.isRTL==null?void 0:c.isRTL(l.floating)),$=f||(m||!h?[Xn(a)]:Zd(a)),j=y!=="none";!f&&j&&$.push(...rf(a,h,y,S));const _=[a,...$],P=await zs(e,x),C=[];let D=((r=i.flip)==null?void 0:r.overflows)||[];if(u&&C.push(P[v]),d){const E=Qd(o,s,S);C.push(P[E[0]],P[E[1]])}if(D=[...D,{placement:o,overflows:C}],!C.every(E=>E<=0)){var U,R;const E=(((U=i.flip)==null?void 0:U.index)||0)+1,A=_[E];if(A&&(!(d==="alignment"?g!==ne(A):!1)||D.every(k=>ne(k.placement)===g?k.overflows[0]>0:!0)))return{data:{index:E,overflows:D},reset:{placement:A}};let M=(R=D.filter(L=>L.overflows[0]<=0).sort((L,k)=>L.overflows[1]-k.overflows[1])[0])==null?void 0:R.placement;if(!M)switch(p){case"bestFit":{var T;const L=(T=D.filter(k=>{if(j){const V=ne(k.placement);return V===g||V==="y"}return!0}).map(k=>[k.placement,k.overflows.filter(V=>V>0).reduce((V,w)=>V+w,0)]).sort((k,V)=>k[1]-V[1])[0])==null?void 0:T[0];L&&(M=L);break}case"initialPlacement":M=a;break}if(o!==M)return{reset:{placement:M}}}return{}}}};function Js(t){const e=re(...t.map(i=>i.left)),n=re(...t.map(i=>i.top)),r=Yt(...t.map(i=>i.right)),o=Yt(...t.map(i=>i.bottom));return{x:e,y:n,width:r-e,height:o-n}}function cf(t){const e=t.slice().sort((o,i)=>o.y-i.y),n=[];let r=null;for(let o=0;o<e.length;o++){const i=e[o];!r||i.y-r.y>r.height/2?n.push([i]):n[n.length-1].push(i),r=i}return n.map(o=>Pe(Js(o)))}const uf=function(t){return t===void 0&&(t={}),{name:"inline",options:t,async fn(e){const{placement:n,elements:r,rects:o,platform:i,strategy:s}=e,{padding:a=2,x:c,y:l}=Fe(t,e),u=Array.from(await(i.getClientRects==null?void 0:i.getClientRects(r.reference))||[]),d=cf(u),f=Pe(Js(u)),p=mo(a);function y(){if(d.length===2&&d[0].left>d[1].right&&c!=null&&l!=null)return d.find(x=>c>x.left-p.left&&c<x.right+p.right&&l>x.top-p.top&&l<x.bottom+p.bottom)||f;if(d.length>=2){if(ne(n)==="y"){const D=d[0],U=d[d.length-1],R=oe(n)==="top",T=D.top,E=U.bottom,A=R?D.left:U.left,M=R?D.right:U.right,L=M-A,k=E-T;return{top:T,bottom:E,left:A,right:M,width:L,height:k,x:A,y:T}}const x=oe(n)==="left",v=Yt(...d.map(D=>D.right)),g=re(...d.map(D=>D.left)),m=d.filter(D=>x?D.left===g:D.right===v),S=m[0].top,$=m[m.length-1].bottom,j=g,_=v,P=_-j,C=$-S;return{top:S,bottom:$,left:j,right:_,width:P,height:C,x:j,y:S}}return f}const h=await i.getElementRects({reference:{getBoundingClientRect:y},floating:r.floating,strategy:s});return o.reference.x!==h.reference.x||o.reference.y!==h.reference.y||o.reference.width!==h.reference.width||o.reference.height!==h.reference.height?{reset:{rects:h}}:{}}}},df=new Set(["left","top"]);async function ff(t,e){const{placement:n,platform:r,elements:o}=t,i=await(r.isRTL==null?void 0:r.isRTL(o.floating)),s=oe(n),a=wn(n),c=ne(n)==="y",l=df.has(s)?-1:1,u=i&&c?-1:1,d=Fe(e,t);let{mainAxis:f,crossAxis:p,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof y=="number"&&(p=a==="end"?y*-1:y),c?{x:p*u,y:f*l}:{x:f*l,y:p*u}}const pf=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:o,y:i,placement:s,middlewareData:a}=e,c=await ff(e,t);return s===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:o+c.x,y:i+c.y,data:{...c,placement:s}}}}},hf=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:o}=e,{mainAxis:i=!0,crossAxis:s=!1,limiter:a={fn:x=>{let{x:v,y:g}=x;return{x:v,y:g}}},...c}=Fe(t,e),l={x:n,y:r},u=await zs(e,c),d=ne(oe(o)),f=Gs(d);let p=l[f],y=l[d];if(i){const x=f==="y"?"top":"left",v=f==="y"?"bottom":"right",g=p+u[x],m=p-u[v];p=Qr(g,p,m)}if(s){const x=d==="y"?"top":"left",v=d==="y"?"bottom":"right",g=y+u[x],m=y-u[v];y=Qr(g,y,m)}const h=a.fn({...e,[f]:p,[d]:y});return{...h,data:{x:h.x-n,y:h.y-r,enabled:{[f]:i,[d]:s}}}}}};function Qs(t){const e=Bt(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=$t(t),i=o?t.offsetWidth:n,s=o?t.offsetHeight:r,a=Fn(n)!==i||Fn(r)!==s;return a&&(n=i,r=s),{width:n,height:r,$:a}}function yo(t){return Ct(t)?t:t.contextElement}function Oe(t){const e=yo(t);if(!$t(e))return Wt(1);const n=e.getBoundingClientRect(),{width:r,height:o,$:i}=Qs(e);let s=(i?Fn(n.width):n.width)/r,a=(i?Fn(n.height):n.height)/o;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const gf=Wt(0);function Zs(t){const e=Nt(t);return!po()||!e.visualViewport?gf:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function mf(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Nt(t)?!1:e}function ve(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const o=t.getBoundingClientRect(),i=yo(t);let s=Wt(1);e&&(r?Ct(r)&&(s=Oe(r)):s=Oe(t));const a=mf(i,n,r)?Zs(i):Wt(0);let c=(o.left+a.x)/s.x,l=(o.top+a.y)/s.y,u=o.width/s.x,d=o.height/s.y;if(i){const f=Nt(i),p=r&&Ct(r)?Nt(r):r;let y=f,h=Yr(y);for(;h&&r&&p!==y;){const x=Oe(h),v=h.getBoundingClientRect(),g=Bt(h),m=v.left+(h.clientLeft+parseFloat(g.paddingLeft))*x.x,S=v.top+(h.clientTop+parseFloat(g.paddingTop))*x.y;c*=x.x,l*=x.y,u*=x.x,d*=x.y,c+=m,l+=S,y=Nt(h),h=Yr(y)}}return Pe({width:u,height:d,x:c,y:l})}function tr(t,e){const n=Qn(t).scrollLeft;return e?e.left+n:ve(Gt(t)).left+n}function ta(t,e){const n=t.getBoundingClientRect(),r=n.left+e.scrollLeft-tr(t,n),o=n.top+e.scrollTop;return{x:r,y:o}}function yf(t){let{elements:e,rect:n,offsetParent:r,strategy:o}=t;const i=o==="fixed",s=Gt(r),a=e?Jn(e.floating):!1;if(r===s||a&&i)return n;let c={scrollLeft:0,scrollTop:0},l=Wt(1);const u=Wt(0),d=$t(r);if((d||!d&&!i)&&((pe(r)!=="body"||vn(s))&&(c=Qn(r)),$t(r))){const p=ve(r);l=Oe(r),u.x=p.x+r.clientLeft,u.y=p.y+r.clientTop}const f=s&&!d&&!i?ta(s,c):Wt(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x+f.x,y:n.y*l.y-c.scrollTop*l.y+u.y+f.y}}function vf(t){return Array.from(t.getClientRects())}function bf(t){const e=Gt(t),n=Qn(t),r=t.ownerDocument.body,o=Yt(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),i=Yt(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let s=-n.scrollLeft+tr(t);const a=-n.scrollTop;return Bt(r).direction==="rtl"&&(s+=Yt(e.clientWidth,r.clientWidth)-o),{width:o,height:i,x:s,y:a}}const _i=25;function wf(t,e){const n=Nt(t),r=Gt(t),o=n.visualViewport;let i=r.clientWidth,s=r.clientHeight,a=0,c=0;if(o){i=o.width,s=o.height;const u=po();(!u||u&&e==="fixed")&&(a=o.offsetLeft,c=o.offsetTop)}const l=tr(r);if(l<=0){const u=r.ownerDocument,d=u.body,f=getComputedStyle(d),p=u.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,y=Math.abs(r.clientWidth-d.clientWidth-p);y<=_i&&(i-=y)}else l<=_i&&(i+=l);return{width:i,height:s,x:a,y:c}}const xf=new Set(["absolute","fixed"]);function Ef(t,e){const n=ve(t,!0,e==="fixed"),r=n.top+t.clientTop,o=n.left+t.clientLeft,i=$t(t)?Oe(t):Wt(1),s=t.clientWidth*i.x,a=t.clientHeight*i.y,c=o*i.x,l=r*i.y;return{width:s,height:a,x:c,y:l}}function Ni(t,e,n){let r;if(e==="viewport")r=wf(t,n);else if(e==="document")r=bf(Gt(t));else if(Ct(e))r=Ef(e,n);else{const o=Zs(t);r={x:e.x-o.x,y:e.y-o.y,width:e.width,height:e.height}}return Pe(r)}function ea(t,e){const n=fe(t);return n===e||!Ct(n)||Ne(n)?!1:Bt(n).position==="fixed"||ea(n,e)}function Af(t,e){const n=e.get(t);if(n)return n;let r=mn(t,[],!1).filter(a=>Ct(a)&&pe(a)!=="body"),o=null;const i=Bt(t).position==="fixed";let s=i?fe(t):t;for(;Ct(s)&&!Ne(s);){const a=Bt(s),c=fo(s);!c&&a.position==="fixed"&&(o=null),(i?!c&&!o:!c&&a.position==="static"&&!!o&&xf.has(o.position)||vn(s)&&!c&&ea(t,s))?r=r.filter(u=>u!==s):o=a,s=fe(s)}return e.set(t,r),r}function $f(t){let{element:e,boundary:n,rootBoundary:r,strategy:o}=t;const s=[...n==="clippingAncestors"?Jn(e)?[]:Af(e,this._c):[].concat(n),r],a=s[0],c=s.reduce((l,u)=>{const d=Ni(e,u,o);return l.top=Yt(d.top,l.top),l.right=re(d.right,l.right),l.bottom=re(d.bottom,l.bottom),l.left=Yt(d.left,l.left),l},Ni(e,a,o));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function Sf(t){const{width:e,height:n}=Qs(t);return{width:e,height:n}}function Rf(t,e,n){const r=$t(e),o=Gt(e),i=n==="fixed",s=ve(t,!0,i,e);let a={scrollLeft:0,scrollTop:0};const c=Wt(0);function l(){c.x=tr(o)}if(r||!r&&!i)if((pe(e)!=="body"||vn(o))&&(a=Qn(e)),r){const p=ve(e,!0,i,e);c.x=p.x+e.clientLeft,c.y=p.y+e.clientTop}else o&&l();i&&!r&&o&&l();const u=o&&!r&&!i?ta(o,a):Wt(0),d=s.left+a.scrollLeft-c.x-u.x,f=s.top+a.scrollTop-c.y-u.y;return{x:d,y:f,width:s.width,height:s.height}}function Pr(t){return Bt(t).position==="static"}function Ii(t,e){if(!$t(t)||Bt(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Gt(t)===n&&(n=n.ownerDocument.body),n}function na(t,e){const n=Nt(t);if(Jn(t))return n;if(!$t(t)){let o=fe(t);for(;o&&!Ne(o);){if(Ct(o)&&!Pr(o))return o;o=fe(o)}return n}let r=Ii(t,e);for(;r&&pd(r)&&Pr(r);)r=Ii(r,e);return r&&Ne(r)&&Pr(r)&&!fo(r)?n:r||vd(t)||n}const Tf=async function(t){const e=this.getOffsetParent||na,n=this.getDimensions,r=await n(t.floating);return{reference:Rf(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Cf(t){return Bt(t).direction==="rtl"}const Of={convertOffsetParentRelativeRectToViewportRelativeRect:yf,getDocumentElement:Gt,getClippingRect:$f,getOffsetParent:na,getElementRects:Tf,getClientRects:vf,getDimensions:Sf,getScale:Oe,isElement:Ct,isRTL:Cf};function ra(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Lf(t,e){let n=null,r;const o=Gt(t);function i(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function s(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),i();const l=t.getBoundingClientRect(),{left:u,top:d,width:f,height:p}=l;if(a||e(),!f||!p)return;const y=On(d),h=On(o.clientWidth-(u+f)),x=On(o.clientHeight-(d+p)),v=On(u),m={rootMargin:-y+"px "+-h+"px "+-x+"px "+-v+"px",threshold:Yt(0,re(1,c))||1};let S=!0;function $(j){const _=j[0].intersectionRatio;if(_!==c){if(!S)return s();_?s(!1,_):r=setTimeout(()=>{s(!1,1e-7)},1e3)}_===1&&!ra(l,t.getBoundingClientRect())&&s(),S=!1}try{n=new IntersectionObserver($,{...m,root:o.ownerDocument})}catch{n=new IntersectionObserver($,m)}n.observe(t)}return s(!0),i}function kf(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,l=yo(t),u=o||i?[...l?mn(l):[],...mn(e)]:[];u.forEach(v=>{o&&v.addEventListener("scroll",n,{passive:!0}),i&&v.addEventListener("resize",n)});const d=l&&a?Lf(l,n):null;let f=-1,p=null;s&&(p=new ResizeObserver(v=>{let[g]=v;g&&g.target===l&&p&&(p.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var m;(m=p)==null||m.observe(e)})),n()}),l&&!c&&p.observe(l),p.observe(e));let y,h=c?ve(t):null;c&&x();function x(){const v=ve(t);h&&!ra(h,v)&&n(),h=v,y=requestAnimationFrame(x)}return n(),()=>{var v;u.forEach(g=>{o&&g.removeEventListener("scroll",n),i&&g.removeEventListener("resize",n)}),d==null||d(),(v=p)==null||v.disconnect(),p=null,c&&cancelAnimationFrame(y)}}const Mf=pf,_f=hf,Nf=lf,Pi=af,If=uf,Pf=(t,e,n)=>{const r=new Map,o={platform:Of,...n},i={...o.platform,_c:r};return sf(t,e,{...o,platform:i})};var Df=typeof document<"u",jf=function(){},_n=Df?N.useLayoutEffect:jf;function qn(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,o;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!qn(t[r],e[r]))return!1;return!0}if(o=Object.keys(t),n=o.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,o[r]))return!1;for(r=n;r--!==0;){const i=o[r];if(!(i==="_owner"&&t.$$typeof)&&!qn(t[i],e[i]))return!1}return!0}return t!==t&&e!==e}function oa(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Di(t,e){const n=oa(t);return Math.round(e*n)/n}function Dr(t){const e=N.useRef(t);return _n(()=>{e.current=t}),e}function Bf(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:i,floating:s}={},transform:a=!0,whileElementsMounted:c,open:l}=t,[u,d]=N.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[f,p]=N.useState(r);qn(f,r)||p(r);const[y,h]=N.useState(null),[x,v]=N.useState(null),g=N.useCallback(k=>{k!==j.current&&(j.current=k,h(k))},[]),m=N.useCallback(k=>{k!==_.current&&(_.current=k,v(k))},[]),S=i||y,$=s||x,j=N.useRef(null),_=N.useRef(null),P=N.useRef(u),C=c!=null,D=Dr(c),U=Dr(o),R=Dr(l),T=N.useCallback(()=>{if(!j.current||!_.current)return;const k={placement:e,strategy:n,middleware:f};U.current&&(k.platform=U.current),Pf(j.current,_.current,k).then(V=>{const w={...V,isPositioned:R.current!==!1};E.current&&!qn(P.current,w)&&(P.current=w,to.flushSync(()=>{d(w)}))})},[f,e,n,U,R]);_n(()=>{l===!1&&P.current.isPositioned&&(P.current.isPositioned=!1,d(k=>({...k,isPositioned:!1})))},[l]);const E=N.useRef(!1);_n(()=>(E.current=!0,()=>{E.current=!1}),[]),_n(()=>{if(S&&(j.current=S),$&&(_.current=$),S&&$){if(D.current)return D.current(S,$,T);T()}},[S,$,T,D,C]);const A=N.useMemo(()=>({reference:j,floating:_,setReference:g,setFloating:m}),[g,m]),M=N.useMemo(()=>({reference:S,floating:$}),[S,$]),L=N.useMemo(()=>{const k={position:n,left:0,top:0};if(!M.floating)return k;const V=Di(M.floating,u.x),w=Di(M.floating,u.y);return a?{...k,transform:"translate("+V+"px, "+w+"px)",...oa(M.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:V,top:w}},[n,a,M.floating,u.x,u.y]);return N.useMemo(()=>({...u,update:T,refs:A,elements:M,floatingStyles:L}),[u,T,A,M,L])}const Uf=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:o}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?Pi({element:r.current,padding:o}).fn(n):{}:r?Pi({element:r,padding:o}).fn(n):{}}}},Hf=(t,e)=>({...Mf(t),options:[t,e]}),Vf=(t,e)=>({..._f(t),options:[t,e]}),Ff=(t,e)=>({...Nf(t),options:[t,e]}),Xf=(t,e)=>({...If(t),options:[t,e]}),qf=(t,e)=>({...Uf(t),options:[t,e]}),Kf={...Ji};let ji=!1,Yf=0;const Bi=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+Yf++;function Wf(){const[t,e]=N.useState(()=>ji?Bi():void 0);return _t(()=>{t==null&&e(Bi())},[]),N.useEffect(()=>{ji=!0},[]),t}const Gf=Kf.useId,vo=Gf||Wf,zf=N.forwardRef(function(e,n){const{context:{placement:r,elements:{floating:o},middlewareData:{arrow:i,shift:s}},width:a=14,height:c=7,tipRadius:l=0,strokeWidth:u=0,staticOffset:d,stroke:f,d:p,style:{transform:y,...h}={},...x}=e,v=vo(),[g,m]=N.useState(!1);if(_t(()=>{if(!o)return;Bt(o).direction==="rtl"&&m(!0)},[o]),!o)return null;const[S,$]=r.split("-"),j=S==="top"||S==="bottom";let _=d;(j&&s!=null&&s.x||!j&&s!=null&&s.y)&&(_=null);const P=u*2,C=P/2,D=a/2*(l/-8+1),U=c/2*l/4,R=!!p,T=_&&$==="end"?"bottom":"top";let E=_&&$==="end"?"right":"left";_&&g&&(E=$==="end"?"left":"right");const A=(i==null?void 0:i.x)!=null?_||i.x:"",M=(i==null?void 0:i.y)!=null?_||i.y:"",L=p||"M0,0"+(" H"+a)+(" L"+(a-D)+","+(c-U))+(" Q"+a/2+","+c+" "+D+","+(c-U))+" Z",k={top:R?"rotate(180deg)":"",left:R?"rotate(90deg)":"rotate(-90deg)",bottom:R?"":"rotate(180deg)",right:R?"rotate(-90deg)":"rotate(90deg)"}[S];return dt.jsxs("svg",{...x,"aria-hidden":!0,ref:n,width:R?a:a+P,height:a,viewBox:"0 0 "+a+" "+(c>a?c:a),style:{position:"absolute",pointerEvents:"none",[E]:A,[T]:M,[S]:j||R?"100%":"calc(100% - "+P/2+"px)",transform:[k,y].filter(V=>!!V).join(" "),...h},children:[P>0&&dt.jsx("path",{clipPath:"url(#"+v+")",fill:"none",stroke:f,strokeWidth:P+(p?0:1),d:L}),dt.jsx("path",{stroke:P&&!p?x.fill:"none",d:L}),dt.jsx("clipPath",{id:v,children:dt.jsx("rect",{x:-C,y:C*(R?-1:1),width:a+P,height:a})})]})});function Jf(){const t=new Map;return{emit(e,n){var r;(r=t.get(e))==null||r.forEach(o=>o(n))},on(e,n){t.has(e)||t.set(e,new Set),t.get(e).add(n)},off(e,n){var r;(r=t.get(e))==null||r.delete(n)}}}const Qf=N.createContext(null),Zf=N.createContext(null),tp=()=>{var t;return((t=N.useContext(Qf))==null?void 0:t.id)||null},ia=()=>N.useContext(Zf);function Kn(t){return"data-floating-ui-"+t}function ep(t){t.current!==-1&&(clearTimeout(t.current),t.current=-1)}let Ui=0;function Ae(t,e){e===void 0&&(e={});const{preventScroll:n=!1,cancelPrevious:r=!0,sync:o=!1}=e;r&&cancelAnimationFrame(Ui);const i=()=>t==null?void 0:t.focus({preventScroll:n});o?i():Ui=requestAnimationFrame(i)}function np(t){return(t==null?void 0:t.ownerDocument)||document}const Le={inert:new WeakMap,"aria-hidden":new WeakMap,none:new WeakMap};function Hi(t){return t==="inert"?Le.inert:t==="aria-hidden"?Le["aria-hidden"]:Le.none}let Ln=new WeakSet,kn={},jr=0;const rp=()=>typeof HTMLElement<"u"&&"inert"in HTMLElement.prototype,sa=t=>t&&(t.host||sa(t.parentNode)),op=(t,e)=>e.map(n=>{if(t.contains(n))return n;const r=sa(n);return t.contains(r)?r:null}).filter(n=>n!=null);function ip(t,e,n,r){const o="data-floating-ui-inert",i=r?"inert":n?"aria-hidden":null,s=op(e,t),a=new Set,c=new Set(s),l=[];kn[o]||(kn[o]=new WeakMap);const u=kn[o];s.forEach(d),f(e),a.clear();function d(p){!p||a.has(p)||(a.add(p),p.parentNode&&d(p.parentNode))}function f(p){!p||c.has(p)||[].forEach.call(p.children,y=>{if(pe(y)!=="script")if(a.has(y))f(y);else{const h=i?y.getAttribute(i):null,x=h!==null&&h!=="false",v=Hi(i),g=(v.get(y)||0)+1,m=(u.get(y)||0)+1;v.set(y,g),u.set(y,m),l.push(y),g===1&&x&&Ln.add(y),m===1&&y.setAttribute(o,""),!x&&i&&y.setAttribute(i,i==="inert"?"":"true")}})}return jr++,()=>{l.forEach(p=>{const y=Hi(i),x=(y.get(p)||0)-1,v=(u.get(p)||0)-1;y.set(p,x),u.set(p,v),x||(!Ln.has(p)&&i&&p.removeAttribute(i),Ln.delete(p)),v||p.removeAttribute(o)}),jr--,jr||(Le.inert=new WeakMap,Le["aria-hidden"]=new WeakMap,Le.none=new WeakMap,Ln=new WeakSet,kn={})}}function Vi(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=np(t[0]).body;return ip(t.concat(Array.from(r.querySelectorAll('[aria-live],[role="status"],output'))),r,e,n)}const er={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0},Yn=N.forwardRef(function(e,n){const[r,o]=N.useState();_t(()=>{Dd()&&o("button")},[]);const i={ref:n,tabIndex:0,role:r,"aria-hidden":r?void 0:!0,[Kn("focus-guard")]:"",style:er};return dt.jsx("span",{...e,...i})}),aa=N.createContext(null),Fi=Kn("portal");function sp(t){t===void 0&&(t={});const{id:e,root:n}=t,r=vo(),o=la(),[i,s]=N.useState(null),a=N.useRef(null);return _t(()=>()=>{i==null||i.remove(),queueMicrotask(()=>{a.current=null})},[i]),_t(()=>{if(!r||a.current)return;const c=e?document.getElementById(e):null;if(!c)return;const l=document.createElement("div");l.id=r,l.setAttribute(Fi,""),c.appendChild(l),a.current=l,s(l)},[e,r]),_t(()=>{if(n===null||!r||a.current)return;let c=n||(o==null?void 0:o.portalNode);c&&!uo(c)&&(c=c.current),c=c||document.body;let l=null;e&&(l=document.createElement("div"),l.id=e,c.appendChild(l));const u=document.createElement("div");u.id=r,u.setAttribute(Fi,""),c=l||c,c.appendChild(u),a.current=u,s(u)},[e,n,r,o]),i}function ap(t){const{children:e,id:n,root:r,preserveTabOrder:o=!0}=t,i=sp({id:n,root:r}),[s,a]=N.useState(null),c=N.useRef(null),l=N.useRef(null),u=N.useRef(null),d=N.useRef(null),f=s==null?void 0:s.modal,p=s==null?void 0:s.open,y=!!s&&!s.modal&&s.open&&o&&!!(r||i);return N.useEffect(()=>{if(!i||!o||f)return;function h(x){i&&ln(x)&&(x.type==="focusin"?Oi:Wd)(i)}return i.addEventListener("focusin",h,!0),i.addEventListener("focusout",h,!0),()=>{i.removeEventListener("focusin",h,!0),i.removeEventListener("focusout",h,!0)}},[i,o,f]),N.useEffect(()=>{i&&(p||Oi(i))},[p,i]),dt.jsxs(aa.Provider,{value:N.useMemo(()=>({preserveTabOrder:o,beforeOutsideRef:c,afterOutsideRef:l,beforeInsideRef:u,afterInsideRef:d,portalNode:i,setFocusManagerState:a}),[o,i]),children:[y&&i&&dt.jsx(Yn,{"data-type":"outside",ref:c,onFocus:h=>{if(ln(h,i)){var x;(x=u.current)==null||x.focus()}else{const v=s?s.domReference:null,g=Ws(v);g==null||g.focus()}}}),y&&i&&dt.jsx("span",{"aria-owns":i.id,style:er}),i&&to.createPortal(e,i),y&&i&&dt.jsx(Yn,{"data-type":"outside",ref:l,onFocus:h=>{if(ln(h,i)){var x;(x=d.current)==null||x.focus()}else{const v=s?s.domReference:null,g=Ys(v);g==null||g.focus(),s!=null&&s.closeOnFocusOut&&(s==null||s.onOpenChange(!1,h.nativeEvent,"focus-out"))}}})]})}const la=()=>N.useContext(aa);function Xi(t){return N.useMemo(()=>e=>{t.forEach(n=>{n&&(n.current=e)})},t)}const lp=20;let le=[];function bo(){le=le.filter(t=>t.isConnected)}function cp(t){bo(),t&&pe(t)!=="body"&&(le.push(t),le.length>lp&&(le=le.slice(-20)))}function qi(){return bo(),le[le.length-1]}function up(t){const e=bn();return Xs(t,e)?t:Zn(t,e)[0]||t}function Ki(t,e){var n;if(!e.current.includes("floating")&&!((n=t.getAttribute("role"))!=null&&n.includes("dialog")))return;const r=bn(),i=Id(t,r).filter(a=>{const c=a.getAttribute("data-tabindex")||"";return Xs(a,r)||a.hasAttribute("data-tabindex")&&!c.startsWith("-")}),s=t.getAttribute("tabindex");e.current.includes("floating")||i.length===0?s!=="0"&&t.setAttribute("tabindex","0"):(s!=="-1"||t.hasAttribute("data-tabindex")&&t.getAttribute("data-tabindex")!=="-1")&&(t.setAttribute("tabindex","-1"),t.setAttribute("data-tabindex","-1"))}const dp=N.forwardRef(function(e,n){return dt.jsx("button",{...e,type:"button",ref:n,tabIndex:-1,style:er})});function fp(t){const{context:e,children:n,disabled:r=!1,order:o=["content"],guards:i=!0,initialFocus:s=0,returnFocus:a=!0,restoreFocus:c=!1,modal:l=!0,visuallyHiddenDismiss:u=!1,closeOnFocusOut:d=!0,outsideElementsInert:f=!1,getInsideElements:p=()=>[]}=t,{open:y,onOpenChange:h,events:x,dataRef:v,elements:{domReference:g,floating:m}}=e,S=en(()=>{var G;return(G=v.current.floatingContext)==null?void 0:G.nodeId}),$=en(p),j=typeof s=="number"&&s<0,_=Ri(g)&&j,P=rp(),C=P?i:!0,D=!C||P&&f,U=Ir(o),R=Ir(s),T=Ir(a),E=ia(),A=la(),M=N.useRef(null),L=N.useRef(null),k=N.useRef(!1),V=N.useRef(!1),w=N.useRef(-1),O=N.useRef(-1),B=A!=null,I=Ti(m),X=en(function(G){return G===void 0&&(G=I),G?Zn(G,bn()):[]}),K=en(G=>{const tt=X(G);return U.current.map(J=>g&&J==="reference"?g:I&&J==="floating"?I:tt).filter(Boolean).flat()});N.useEffect(()=>{if(r||!l)return;function G(J){if(J.key==="Tab"){Ht(I,Re(ee(I)))&&X().length===0&&!_&&Nr(J);const st=K(),it=_r(J);U.current[0]==="reference"&&it===g&&(Nr(J),J.shiftKey?Ae(st[st.length-1]):Ae(st[1])),U.current[1]==="floating"&&it===I&&J.shiftKey&&(Nr(J),Ae(st[0]))}}const tt=ee(I);return tt.addEventListener("keydown",G),()=>{tt.removeEventListener("keydown",G)}},[r,g,I,l,U,_,X,K]),N.useEffect(()=>{if(r||!m)return;function G(tt){const J=_r(tt),it=X().indexOf(J);it!==-1&&(w.current=it)}return m.addEventListener("focusin",G),()=>{m.removeEventListener("focusin",G)}},[r,m,X]),N.useEffect(()=>{if(r||!d)return;function G(){V.current=!0,setTimeout(()=>{V.current=!1})}function tt(it){const F=it.relatedTarget,Lt=it.currentTarget,Rt=_r(it);queueMicrotask(()=>{const q=S(),H=!(Ht(g,F)||Ht(m,F)||Ht(F,m)||Ht(A==null?void 0:A.portalNode,F)||F!=null&&F.hasAttribute(Kn("focus-guard"))||E&&(Jr(E.nodesRef.current,q).find(kt=>{var Ot,Mt;return Ht((Ot=kt.context)==null?void 0:Ot.elements.floating,F)||Ht((Mt=kt.context)==null?void 0:Mt.elements.domReference,F)})||Ci(E.nodesRef.current,q).find(kt=>{var Ot,Mt,he;return[(Ot=kt.context)==null?void 0:Ot.elements.floating,Ti((Mt=kt.context)==null?void 0:Mt.elements.floating)].includes(F)||((he=kt.context)==null?void 0:he.elements.domReference)===F})));if(Lt===g&&I&&Ki(I,U),c&&Lt!==g&&!(Rt!=null&&Rt.isConnected)&&Re(ee(I))===ee(I).body){$t(I)&&I.focus();const kt=w.current,Ot=X(),Mt=Ot[kt]||Ot[Ot.length-1]||I;$t(Mt)&&Mt.focus()}if(v.current.insideReactTree){v.current.insideReactTree=!1;return}(_||!l)&&F&&H&&!V.current&&F!==qi()&&(k.current=!0,h(!1,it,"focus-out"))})}const J=!!(!E&&A);function st(){ep(O),v.current.insideReactTree=!0,O.current=window.setTimeout(()=>{v.current.insideReactTree=!1})}if(m&&$t(g))return g.addEventListener("focusout",tt),g.addEventListener("pointerdown",G),m.addEventListener("focusout",tt),J&&m.addEventListener("focusout",st,!0),()=>{g.removeEventListener("focusout",tt),g.removeEventListener("pointerdown",G),m.removeEventListener("focusout",tt),J&&m.removeEventListener("focusout",st,!0)}},[r,g,m,I,l,E,A,h,d,c,X,_,S,U,v]);const Y=N.useRef(null),gt=N.useRef(null),ot=Xi([Y,A==null?void 0:A.beforeInsideRef]),zt=Xi([gt,A==null?void 0:A.afterInsideRef]);N.useEffect(()=>{var G,tt;if(r||!m)return;const J=Array.from((A==null||(G=A.portalNode)==null?void 0:G.querySelectorAll("["+Kn("portal")+"]"))||[]),it=(tt=(E?Ci(E.nodesRef.current,S()):[]).find(Rt=>{var q;return Ri(((q=Rt.context)==null?void 0:q.elements.domReference)||null)}))==null||(tt=tt.context)==null?void 0:tt.elements.domReference,F=[m,it,...J,...$(),M.current,L.current,Y.current,gt.current,A==null?void 0:A.beforeOutsideRef.current,A==null?void 0:A.afterOutsideRef.current,U.current.includes("reference")||_?g:null].filter(Rt=>Rt!=null),Lt=l||_?Vi(F,!D,D):Vi(F);return()=>{Lt()}},[r,g,m,l,U,A,_,C,D,E,S,$]),_t(()=>{if(r||!$t(I))return;const G=ee(I),tt=Re(G);queueMicrotask(()=>{const J=K(I),st=R.current,it=(typeof st=="number"?J[st]:st.current)||I,F=Ht(I,tt);!j&&!F&&y&&Ae(it,{preventScroll:it===I})})},[r,y,I,j,K,R]),_t(()=>{if(r||!I)return;const G=ee(I),tt=Re(G);cp(tt);function J(F){let{reason:Lt,event:Rt,nested:q}=F;if(["hover","safe-polygon"].includes(Lt)&&Rt.type==="mouseleave"&&(k.current=!0),Lt==="outside-press")if(q)k.current=!1;else if(Hd(Rt)||Vd(Rt))k.current=!1;else{let H=!1;document.createElement("div").focus({get preventScroll(){return H=!0,!1}}),H?k.current=!1:k.current=!0}}x.on("openchange",J);const st=G.createElement("span");st.setAttribute("tabindex","-1"),st.setAttribute("aria-hidden","true"),Object.assign(st.style,er),B&&g&&g.insertAdjacentElement("afterend",st);function it(){if(typeof T.current=="boolean"){const F=g||qi();return F&&F.isConnected?F:st}return T.current.current||st}return()=>{x.off("openchange",J);const F=Re(G),Lt=Ht(m,F)||E&&Jr(E.nodesRef.current,S(),!1).some(q=>{var H;return Ht((H=q.context)==null?void 0:H.elements.floating,F)}),Rt=it();queueMicrotask(()=>{const q=up(Rt);T.current&&!k.current&&$t(q)&&(!(q!==F&&F!==G.body)||Lt)&&q.focus({preventScroll:!0}),st.remove()})}},[r,m,I,T,v,x,E,B,g,S]),N.useEffect(()=>(queueMicrotask(()=>{k.current=!1}),()=>{queueMicrotask(bo)}),[r]),_t(()=>{if(!r&&A)return A.setFocusManagerState({modal:l,closeOnFocusOut:d,open:y,onOpenChange:h,domReference:g}),()=>{A.setFocusManagerState(null)}},[r,A,l,y,h,d,g]),_t(()=>{r||I&&Ki(I,U)},[r,I,U]);function St(G){return r||!u||!l?null:dt.jsx(dp,{ref:G==="start"?M:L,onClick:tt=>h(!1,tt.nativeEvent),children:typeof u=="string"?u:"Dismiss"})}const ie=!r&&C&&(l?!_:!0)&&(B||l);return dt.jsxs(dt.Fragment,{children:[ie&&dt.jsx(Yn,{"data-type":"inside",ref:ot,onFocus:G=>{if(l){const J=K();Ae(o[0]==="reference"?J[0]:J[J.length-1])}else if(A!=null&&A.preserveTabOrder&&A.portalNode)if(k.current=!1,ln(G,A.portalNode)){const J=Ys(g);J==null||J.focus()}else{var tt;(tt=A.beforeOutsideRef.current)==null||tt.focus()}}}),!_&&St("start"),n,St("end"),ie&&dt.jsx(Yn,{"data-type":"inside",ref:zt,onFocus:G=>{if(l)Ae(K()[0]);else if(A!=null&&A.preserveTabOrder&&A.portalNode)if(d&&(k.current=!0),ln(G,A.portalNode)){const J=Ws(g);J==null||J.focus()}else{var tt;(tt=A.afterOutsideRef.current)==null||tt.focus()}}})]})}function pp(t){const{open:e=!1,onOpenChange:n,elements:r}=t,o=vo(),i=N.useRef({}),[s]=N.useState(()=>Jf()),a=tp()!=null,[c,l]=N.useState(r.reference),u=en((p,y,h)=>{i.current.openEvent=p?y:void 0,s.emit("openchange",{open:p,event:y,reason:h,nested:a}),n==null||n(p,y,h)}),d=N.useMemo(()=>({setPositionReference:l}),[]),f=N.useMemo(()=>({reference:c||r.reference||null,floating:r.floating||null,domReference:r.reference}),[c,r.reference,r.floating]);return N.useMemo(()=>({dataRef:i,open:e,onOpenChange:u,elements:f,events:s,floatingId:o,refs:d}),[e,u,f,s,o,d])}function hp(t){t===void 0&&(t={});const{nodeId:e}=t,n=pp({...t,elements:{reference:null,floating:null,...t.elements}}),r=t.rootContext||n,o=r.elements,[i,s]=N.useState(null),[a,c]=N.useState(null),u=(o==null?void 0:o.domReference)||i,d=N.useRef(null),f=ia();_t(()=>{u&&(d.current=u)},[u]);const p=Bf({...t,elements:{...o,...a&&{reference:a}}}),y=N.useCallback(m=>{const S=Ct(m)?{getBoundingClientRect:()=>m.getBoundingClientRect(),getClientRects:()=>m.getClientRects(),contextElement:m}:m;c(S),p.refs.setReference(S)},[p.refs]),h=N.useCallback(m=>{(Ct(m)||m===null)&&(d.current=m,s(m)),(Ct(p.refs.reference.current)||p.refs.reference.current===null||m!==null&&!Ct(m))&&p.refs.setReference(m)},[p.refs]),x=N.useMemo(()=>({...p.refs,setReference:h,setPositionReference:y,domReference:d}),[p.refs,h,y]),v=N.useMemo(()=>({...p.elements,domReference:u}),[p.elements,u]),g=N.useMemo(()=>({...p,...r,refs:x,elements:v,nodeId:e}),[p,x,v,e,r]);return _t(()=>{r.dataRef.current.floatingContext=g;const m=f==null?void 0:f.nodesRef.current.find(S=>S.id===e);m&&(m.context=g)}),N.useMemo(()=>({...p,context:g,refs:x,elements:v}),[p,x,v,g])}const Yi=()=>{if(typeof navigator>"u")return!1;var t=navigator.userAgent||navigator.vendor||(window==null?void 0:window.opera);return!!(/android/i.test(t)||/iPad|iPhone/.test(t)&&!window.MSStream)},gp=(t,e={timeout:250})=>{const n=va(),[r,o]=N.useState(!0);return N.useEffect(()=>{if(!n||!t)return;let i;const s=a=>{const{changes:{updated:c}}=a;(c==null?void 0:c.some(u=>{const{targetUpdated:d}=u;if(d){const{oldTarget:f,newTarget:p}=d;return mp(f,p)}}))&&(o(!1),clearTimeout(i),i=setTimeout(()=>o(!0),e.timeout))};return n.observe(s,{annotations:t,ignore:us.BODY_ONLY,origin:ds.LOCAL}),()=>{clearTimeout(i),n.unobserve(s)}},[n,t,e.timeout]),r},mp=(t,e)=>{const{selector:n}=t,r=n.map(({quote:s})=>s),{selector:o}=e,i=o.map(({quote:s})=>s);return r.join()!==i.join()},Wi=(t,e)=>{const{left:n,top:r,right:o,bottom:i}=t,s=e.getBoundingClientRect();return new DOMRect(n+s.left,r+s.top,o-n,i-r)},Sp=t=>{var e;const n=Qi(),{selected:r,event:o}=ba(),i=(e=r[0])==null?void 0:e.annotation,s=gp(i==null?void 0:i.id),[a,c]=N.useState((r==null?void 0:r.length)>0),l=N.useRef(!1),u=N.useRef(null),{refs:d,floatingStyles:f,update:p,context:y}=hp({placement:Yi()?"bottom":t.placement||"top",open:a,onOpenChange:(v,g,m)=>{!v&&(m==="escape-key"||m==="focus-out")&&(c(v),n==null||n.cancelSelected())},middleware:[Xf(),Hf(10),Ff({crossAxis:!0}),Vf({crossAxis:!0,padding:10}),qf({element:u})],whileElementsMounted:kf});N.useEffect(()=>{if(i!=null&&i.id&&s){const v=n==null?void 0:n.state.store.getAnnotationBounds(i.id);c(!!v)}else c(!1)},[i==null?void 0:i.id,i==null?void 0:i.target.selector,s,n==null?void 0:n.state.store]),N.useEffect(()=>{t.onClose&&(a?l.current=!0:l.current&&(l.current=!1,t.onClose()))},[t.onClose,a]),N.useEffect(()=>{n&&(a&&(i!=null&&i.id)?d.setPositionReference({getBoundingClientRect:()=>{const v=n.state.store.getAnnotationBounds(i.id);return v?Wi(v,n.element):new DOMRect},getClientRects:()=>{const g=n.state.store.getAnnotationRects(i.id).map(m=>Wi(m,n.element));return Nc(g)}}):d.setPositionReference(null))},[a,i==null?void 0:i.id,i==null?void 0:i.target,n]),N.useEffect(()=>{const v={attributes:!0,childList:!0,subtree:!0},g=new MutationObserver(()=>p());return g.observe(document.body,v),window.document.addEventListener("scroll",p,!0),()=>{g.disconnect(),window.document.removeEventListener("scroll",p,!0)}},[p]);const h=N.useMemo(()=>(o==null?void 0:o.type)==="keyup"||(o==null?void 0:o.type)==="contextmenu"||Yi()?-1:0,[o]),x=()=>n==null?void 0:n.cancelSelected();return a&&i?dt.jsx(ap,{children:dt.jsx(fp,{context:y,modal:!1,closeOnFocusOut:!0,returnFocus:!1,initialFocus:h,children:dt.jsxs("div",{className:`a9s-popup r6o-popup annotation-popup r6o-text-popup ${io}`,ref:d.setFloating,style:f,children:[t.popup({annotation:r[0].annotation,editable:r[0].editable,event:o}),t.arrow&&dt.jsx(zf,{ref:u,context:y,...t.arrowProps||{}}),dt.jsx("button",{className:"r6o-popup-sr-only","aria-live":"assertive",onClick:x,children:t.ariaCloseWarning||"Click or leave this dialog to close it."})]})})}):null};export{yp as L,ma as R,ba as T,ga as a,N as b,Ji as c,to as d,Ap as e,vp as f,Gi as g,Qi as h,Sp as i,fa as j,$p as k,va as q,zi as r};
