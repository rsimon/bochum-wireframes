function ga(e,t){for(var n=0;n<t.length;n++){const o=t[n];if(typeof o!="string"&&!Array.isArray(o)){for(const r in o)if(r!=="default"&&!(r in e)){const i=Object.getOwnPropertyDescriptor(o,r);i&&Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:()=>o[r]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function ts(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ao={exports:{}},Wt={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $r;function ma(){if($r)return Wt;$r=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(o,r,i){var s=null;if(i!==void 0&&(s=""+i),r.key!==void 0&&(s=""+r.key),"key"in r){i={};for(var a in r)a!=="key"&&(i[a]=r[a])}else i=r;return r=i.ref,{$$typeof:e,type:o,key:s,ref:r!==void 0?r:null,props:i}}return Wt.Fragment=t,Wt.jsx=n,Wt.jsxs=n,Wt}var Rr;function ya(){return Rr||(Rr=1,ao.exports=ma()),ao.exports}var va=ya(),lo={exports:{}},Q={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sr;function ba(){if(Sr)return Q;Sr=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),s=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),d=Symbol.iterator;function f(w){return w===null||typeof w!="object"?null:(w=d&&w[d]||w["@@iterator"],typeof w=="function"?w:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,h={};function E(w,O,j){this.props=w,this.context=O,this.refs=h,this.updater=j||p}E.prototype.isReactComponent={},E.prototype.setState=function(w,O){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,O,"setState")},E.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function v(){}v.prototype=E.prototype;function g(w,O,j){this.props=w,this.context=O,this.refs=h,this.updater=j||p}var m=g.prototype=new v;m.constructor=g,y(m,E.prototype),m.isPureReactComponent=!0;var R=Array.isArray,$={H:null,A:null,T:null,S:null,V:null},N=Object.prototype.hasOwnProperty;function I(w,O,j,D,q,F){return j=F.ref,{$$typeof:e,type:w,key:O,ref:j!==void 0?j:null,props:F}}function k(w,O){return I(w.type,O,void 0,void 0,void 0,w.props)}function P(w){return typeof w=="object"&&w!==null&&w.$$typeof===e}function U(w){var O={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(j){return O[j]})}var B=/\/+/g;function S(w,O){return typeof w=="object"&&w!==null&&w.key!=null?U(""+w.key):O.toString(36)}function T(){}function x(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(T,T):(w.status="pending",w.then(function(O){w.status==="pending"&&(w.status="fulfilled",w.value=O)},function(O){w.status==="pending"&&(w.status="rejected",w.reason=O)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function A(w,O,j,D,q){var F=typeof w;(F==="undefined"||F==="boolean")&&(w=null);var K=!1;if(w===null)K=!0;else switch(F){case"bigint":case"string":case"number":K=!0;break;case"object":switch(w.$$typeof){case e:case t:K=!0;break;case u:return K=w._init,A(K(w._payload),O,j,D,q)}}if(K)return q=q(w),K=D===""?"."+S(w,0):D,R(q)?(j="",K!=null&&(j=K.replace(B,"$&/")+"/"),A(q,O,j,"",function(Ve){return Ve})):q!=null&&(P(q)&&(q=k(q,j+(q.key==null||w&&w.key===q.key?"":(""+q.key).replace(B,"$&/")+"/")+K)),O.push(q)),1;K=0;var ae=D===""?".":D+":";if(R(w))for(var te=0;te<w.length;te++)D=w[te],F=ae+S(D,te),K+=A(D,O,j,F,q);else if(te=f(w),typeof te=="function")for(w=te.call(w),te=0;!(D=w.next()).done;)D=D.value,F=ae+S(D,te++),K+=A(D,O,j,F,q);else if(F==="object"){if(typeof w.then=="function")return A(x(w),O,j,D,q);throw O=String(w),Error("Objects are not valid as a React child (found: "+(O==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":O)+"). If you meant to render a collection of children, use an array instead.")}return K}function _(w,O,j){if(w==null)return w;var D=[],q=0;return A(w,D,"","",function(F){return O.call(j,F,q++)}),D}function L(w){if(w._status===-1){var O=w._result;O=O(),O.then(function(j){(w._status===0||w._status===-1)&&(w._status=1,w._result=j)},function(j){(w._status===0||w._status===-1)&&(w._status=2,w._result=j)}),w._status===-1&&(w._status=0,w._result=O)}if(w._status===1)return w._result.default;throw w._result}var C=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var O=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(O))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)};function H(){}return Q.Children={map:_,forEach:function(w,O,j){_(w,function(){O.apply(this,arguments)},j)},count:function(w){var O=0;return _(w,function(){O++}),O},toArray:function(w){return _(w,function(O){return O})||[]},only:function(w){if(!P(w))throw Error("React.Children.only expected to receive a single React element child.");return w}},Q.Component=E,Q.Fragment=n,Q.Profiler=r,Q.PureComponent=g,Q.StrictMode=o,Q.Suspense=c,Q.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,Q.__COMPILER_RUNTIME={__proto__:null,c:function(w){return $.H.useMemoCache(w)}},Q.cache=function(w){return function(){return w.apply(null,arguments)}},Q.cloneElement=function(w,O,j){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var D=y({},w.props),q=w.key,F=void 0;if(O!=null)for(K in O.ref!==void 0&&(F=void 0),O.key!==void 0&&(q=""+O.key),O)!N.call(O,K)||K==="key"||K==="__self"||K==="__source"||K==="ref"&&O.ref===void 0||(D[K]=O[K]);var K=arguments.length-2;if(K===1)D.children=j;else if(1<K){for(var ae=Array(K),te=0;te<K;te++)ae[te]=arguments[te+2];D.children=ae}return I(w.type,q,void 0,void 0,F,D)},Q.createContext=function(w){return w={$$typeof:s,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:i,_context:w},w},Q.createElement=function(w,O,j){var D,q={},F=null;if(O!=null)for(D in O.key!==void 0&&(F=""+O.key),O)N.call(O,D)&&D!=="key"&&D!=="__self"&&D!=="__source"&&(q[D]=O[D]);var K=arguments.length-2;if(K===1)q.children=j;else if(1<K){for(var ae=Array(K),te=0;te<K;te++)ae[te]=arguments[te+2];q.children=ae}if(w&&w.defaultProps)for(D in K=w.defaultProps,K)q[D]===void 0&&(q[D]=K[D]);return I(w,F,void 0,void 0,null,q)},Q.createRef=function(){return{current:null}},Q.forwardRef=function(w){return{$$typeof:a,render:w}},Q.isValidElement=P,Q.lazy=function(w){return{$$typeof:u,_payload:{_status:-1,_result:w},_init:L}},Q.memo=function(w,O){return{$$typeof:l,type:w,compare:O===void 0?null:O}},Q.startTransition=function(w){var O=$.T,j={};$.T=j;try{var D=w(),q=$.S;q!==null&&q(j,D),typeof D=="object"&&D!==null&&typeof D.then=="function"&&D.then(H,C)}catch(F){C(F)}finally{$.T=O}},Q.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},Q.use=function(w){return $.H.use(w)},Q.useActionState=function(w,O,j){return $.H.useActionState(w,O,j)},Q.useCallback=function(w,O){return $.H.useCallback(w,O)},Q.useContext=function(w){return $.H.useContext(w)},Q.useDebugValue=function(){},Q.useDeferredValue=function(w,O){return $.H.useDeferredValue(w,O)},Q.useEffect=function(w,O,j){var D=$.H;if(typeof j=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return D.useEffect(w,O)},Q.useId=function(){return $.H.useId()},Q.useImperativeHandle=function(w,O,j){return $.H.useImperativeHandle(w,O,j)},Q.useInsertionEffect=function(w,O){return $.H.useInsertionEffect(w,O)},Q.useLayoutEffect=function(w,O){return $.H.useLayoutEffect(w,O)},Q.useMemo=function(w,O){return $.H.useMemo(w,O)},Q.useOptimistic=function(w,O){return $.H.useOptimistic(w,O)},Q.useReducer=function(w,O,j){return $.H.useReducer(w,O,j)},Q.useRef=function(w){return $.H.useRef(w)},Q.useState=function(w){return $.H.useState(w)},Q.useSyncExternalStore=function(w,O,j){return $.H.useSyncExternalStore(w,O,j)},Q.useTransition=function(){return $.H.useTransition()},Q.version="19.1.1",Q}var Tr;function ns(){return Tr||(Tr=1,lo.exports=ba()),lo.exports}var co={exports:{}},Se={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cr;function wa(){if(Cr)return Se;Cr=1;var e=ns();function t(c){var l="https://react.dev/errors/"+c;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)l+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+c+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var o={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},r=Symbol.for("react.portal");function i(c,l,u){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:d==null?null:""+d,children:c,containerInfo:l,implementation:u}}var s=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(c,l){if(c==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return Se.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,Se.createPortal=function(c,l){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(t(299));return i(c,l,null,u)},Se.flushSync=function(c){var l=s.T,u=o.p;try{if(s.T=null,o.p=2,c)return c()}finally{s.T=l,o.p=u,o.d.f()}},Se.preconnect=function(c,l){typeof c=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,o.d.C(c,l))},Se.prefetchDNS=function(c){typeof c=="string"&&o.d.D(c)},Se.preinit=function(c,l){if(typeof c=="string"&&l&&typeof l.as=="string"){var u=l.as,d=a(u,l.crossOrigin),f=typeof l.integrity=="string"?l.integrity:void 0,p=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;u==="style"?o.d.S(c,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:d,integrity:f,fetchPriority:p}):u==="script"&&o.d.X(c,{crossOrigin:d,integrity:f,fetchPriority:p,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},Se.preinitModule=function(c,l){if(typeof c=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var u=a(l.as,l.crossOrigin);o.d.M(c,{crossOrigin:u,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&o.d.M(c)},Se.preload=function(c,l){if(typeof c=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var u=l.as,d=a(u,l.crossOrigin);o.d.L(c,u,{crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},Se.preloadModule=function(c,l){if(typeof c=="string")if(l){var u=a(l.as,l.crossOrigin);o.d.m(c,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:u,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else o.d.m(c)},Se.requestFormReset=function(c){o.d.r(c)},Se.unstable_batchedUpdates=function(c,l){return c(l)},Se.useFormState=function(c,l,u){return s.H.useFormState(c,l,u)},Se.useFormStatus=function(){return s.H.useHostTransitionStatus()},Se.version="19.1.1",Se}var Or;function xa(){if(Or)return co.exports;Or=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),co.exports=wa(),co.exports}var M=ns();const Ea=ts(M),os=ga({__proto__:null,default:Ea},[M]);var ar=xa();const Lp=ts(ar);var uo={exports:{}},Gt={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kr;function Aa(){if(kr)return Gt;kr=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(o,r,i){var s=null;if(i!==void 0&&(s=""+i),r.key!==void 0&&(s=""+r.key),"key"in r){i={};for(var a in r)a!=="key"&&(i[a]=r[a])}else i=r;return r=i.ref,{$$typeof:e,type:o,key:s,ref:r!==void 0?r:null,props:i}}return Gt.Fragment=t,Gt.jsx=n,Gt.jsxs=n,Gt}var Lr;function $a(){return Lr||(Lr=1,uo.exports=Aa()),uo.exports}var fe=$a();const Ra={namespaces:{tei:"http://www.tei-c.org/ns/1.0",teieg:"http://www.tei-c.org/ns/Examples",rng:"http://relaxng.org/ns/structure/1.0"},tei:{eg:["<pre>","</pre>"],ptr:['<a href="$rw@target">$@target</a>'],ref:[["[target]",['<a href="$rw@target">',"</a>"]]],graphic:function(e){let t=e.ownerDocument.createElement("img");return t.src=this.rw(e.getAttribute("url")),e.hasAttribute("width")&&t.setAttribute("width",e.getAttribute("width")),e.hasAttribute("height")&&t.setAttribute("height",e.getAttribute("height")),t},list:[["[type=gloss]",function(e){const t=e.ownerDocument;let n=t.createElement("dl");for(let o of Array.from(e.children))if(o.nodeType==1){if(o.localName=="tei-label"){let r=t.createElement("dt");r.innerHTML=o.innerHTML,n.appendChild(r)}if(o.localName=="tei-item"){let r=t.createElement("dd");r.innerHTML=o.innerHTML,n.appendChild(r)}}return n}]],note:[["[place=end]",function(e){const t=e.ownerDocument;this.noteIndex?this.noteIndex++:this.noteIndex=1;let n="_note_"+this.noteIndex,o=t.createElement("a");o.setAttribute("id","src"+n),o.setAttribute("href","#"+n),o.innerHTML=this.noteIndex;let r=t.createElement("sup");r.appendChild(o);let i=t.querySelector("ol.notes");i||(i=t.createElement("ol"),i.setAttribute("class","notes"),this.dom.appendChild(i));let s=t.createElement("li");return s.id=n,s.innerHTML=e.innerHTML,i.appendChild(s),r}],["_",["(",")"]]],teiHeader:function(e){this.hideContent(e,!1)},title:[["tei-titlestmt>tei-title",function(e){const t=e.ownerDocument;let n=t.createElement("title");n.innerHTML=e.innerText,t.querySelector("head").appendChild(n)}]]},teieg:{egXML:function(e){const t=e.ownerDocument;let n=t.createElement("pre"),o=t.createElement("code");n.appendChild(o);let r=this.serialize(e,!0).replace(/</g,"&lt;"),i=r.match(/^[\t ]+/);return i&&(r=r.replace(new RegExp("^"+i[0],"mg"),"")),o.innerHTML=r,n}}};function Sa(e,t){let n=1,o=e;for(;o&&o.previousElementSibling!==null&&(!t||o.previousElementSibling.localName==t)&&(n++,o=o.previousElementSibling,!!o.previousElementSibling););return n}function rs(e){const t=e.ownerDocument;let n=o=>{let r;switch(o.nodeType){case 1:r=t.createElement(o.nodeName);break;case 9:r=t.implementation.createDocument();break;case 11:r=t.createDocumentFragment();break;default:r=o.cloneNode(!0)}if(o.attributes)for(let i of Array.from(o.attributes))i.name!=="data-processed"&&r.setAttribute(i.name,i.value);for(let i of Array.from(o.childNodes))if(i.nodeType==1)if(i.hasAttribute("data-original")){for(let s of Array.from(i.childNodes)){let a=r.appendChild(n(s));a.nodeType===1&&a.hasAttribute("data-origid")&&(a.setAttribute("id",a.getAttribute("data-origid")),a.removeAttribute("data-origid"))}return r}else i.hasAttribute("data-origname")&&r.appendChild(n(i));else r.appendChild(i.cloneNode());return r};return n(e)}function is(e){return e.replace(/ .*$/,"")}function ss(e,t=!0){const n=e.ownerDocument;if(e.childNodes.length>0){let o=n.createElement("cetei-original");e.appendChild(o),o.setAttribute("hidden",""),o.setAttribute("data-original",""),o.setAttribute("role","none");for(let r of Array.from(e.childNodes))if(r!==o){if(r.nodeType===1){r.setAttribute("data-processed","");for(let i of r.querySelectorAll("*"))i.setAttribute("data-processed","")}o.appendChild(e.removeChild(r))}if(t)for(let r of Array.from(o.querySelectorAll("*")))r.hasAttribute("id")&&(r.setAttribute("data-origid",r.getAttribute("id")),r.removeAttribute("id"))}}function Ta(e){return this.rw(this.first(e))}function Ca(e,t){let n="";for(let o=0;o<t;o++)n+=e;return n}function Oa(e){let t=this.prefixDefs[e.substring(0,e.indexOf(":"))];return e.replace(new RegExp(t.matchPattern),t.replacementPattern)}function ka(e){return this.prefixDefs[e]}function La(e){return e.trim().match(/^(?:http|mailto|file|\/|#).*$/)?e:this.base+is(e.trim())}function _a(e,t,n){return Dn(rs(e),t,n)}function Dn(e,t,n){let o="";const r=i=>!/[^\t\n\r ]/.test(i);if((e.nodeType===9||e.nodeType===11)&&(o+=`<?xml version="1.0" encoding="UTF-8"?>
`),!t&&e.nodeType==1){typeof n=="string"&&n!==""?o+=`
`+n+"<":o+="<",o+=e.getAttribute("data-origname");let i=e.hasAttribute("data-origatts")?e.getAttribute("data-origatts").split(" "):[];for(let s of Array.from(e.attributes))!s.name.startsWith("data-")&&!s.name.startsWith("tei-")&&!s.name.startsWith("aria-")&&!["id","lang","class"].includes(s.name)&&(o+=" "+i.find(function(a){return a.toLowerCase()==s.name})+'="'+s.value+'"'),s.name=="data-xmlns"&&(o+=' xmlns="'+s.value+'"'),s.name.startsWith("tei-")&&(o+=" "+i.find(function(a){return a.toLowerCase()==s.name.replace("tei-","")})+'="'+s.value+'"');e.childNodes.length>0?o+=">":o+="/>"}for(let i of Array.from(e.childNodes))switch(i.nodeType){case 1:typeof n=="string"?o+=Dn(i,!1,n+"  "):o+=Dn(i,!1,n);break;case 7:o+=`<?${i.nodeName} ${i.nodeValue}?>`,(e.nodeType===9||e.nodeType===11)&&(o+=`
`);break;case 8:o+=`<!--${i.nodeValue}-->`,(e.nodeType===9||e.nodeType===11)&&(o+=`
`);break;default:if(t&&r(i.nodeValue)&&(o+=i.nodeValue.replace(/^\s*\n/,"")),typeof n=="string"&&r(i.nodeValue))break;o+=i.nodeValue}return!t&&e.nodeType==1&&e.childNodes.length>0&&(typeof n=="string"?o+=`
`+n+"</":o+="</",o+=e.getAttribute("data-origname")+">"),(e.nodeType===9||e.nodeType===11)&&(o+=`
`),o}function Ko(e,t,n){const o=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];let r="";const i=s=>!/[^\t\n\r ]/.test(s);if(!t&&e.nodeType==1){typeof n=="string"&&n!==""?r+=`
`+n+"<":r+="<",r+=e.nodeName;for(let s of Array.from(e.attributes))r+=" "+s.name+'="'+s.value+'"';r+=">"}for(let s of Array.from(e.childNodes))switch(s.nodeType){case 1:typeof n=="string"?r+=Ko(s,!1,n+"  "):r+=Ko(s,!1,n);break;case 7:r+=`<?${s.nodeName} ${s.nodeValue}?>`,(e.nodeType===9||e.nodeType===11)&&(r+=`
`);break;case 8:r+=`<!--${s.nodeValue}-->`,(e.nodeType===9||e.nodeType===11)&&(r+=`
`);break;default:if(t&&i(s.nodeValue)&&(r+=s.nodeValue.replace(/^\s*\n/,"")),typeof n=="string"&&i(s.nodeValue))break;r+=s.nodeValue.replace(/</g,"&lt;")}return o.includes(e.nodeName)||!t&&e.nodeType==1&&(typeof n=="string"?r+=`
${n}</`:r+="</",r+=`${e.nodeName}>`),(e.nodeType===9||e.nodeType===11)&&(r+=`
`),r}function Ma(e){return e.replace(/&gt;/,">").replace(/&quot;/,'"').replace(/&apos;/,"'").replace(/&amp;/,"&")}function jn(e){return e.includes(":"),e.replace(/:/,"-").toLowerCase()}function as(e,t=null,n=!1){try{window.customElements.define(jn(e),class extends HTMLElement{constructor(){super(),this.matches(":defined")||t&&(t.call(this),this.setAttribute("data-processed",""))}connectedCallback(){this.hasAttribute("data-processed")||t&&(t.call(this),this.setAttribute("data-processed",""))}})}catch(o){n&&(console.log(jn(e)+" couldn't be registered or is already registered."),console.log(o))}}const fo=Object.freeze(Object.defineProperty({__proto__:null,copyAndReset:rs,defineCustomElement:as,first:is,getOrdinality:Sa,getPrefixDef:ka,hideContent:ss,normalizeURI:Ta,repeat:Ca,resetAndSerialize:_a,resolveURI:Oa,rw:La,serialize:Dn,serializeHTML:Ko,tagName:jn,unEscapeEntities:Ma},Symbol.toStringTag,{value:"Module"}));function Ia(e){if(e.namespaces)for(let t of Object.keys(e.namespaces))!this.namespaces.has(e.namespaces[t])&&!Array.from(this.namespaces.values()).includes(t)&&this.namespaces.set(e.namespaces[t],t);for(let t of this.namespaces.values())if(e[t])for(let n of Object.keys(e[t]))this.behaviors[`${t}:${n}`]=e[t][n];if(e.functions)for(let t of Object.keys(e.functions))this.utilities[t]=e.functions[t].bind(this.utilities);e.handlers&&console.log("Behavior handlers are no longer used."),e.fallbacks&&console.log("Fallback behaviors are no longer used.")}function Pa(e,t,n){let o;if(e===Object(e))for(let r of Object.keys(e))this.namespaces.has(e[r])||(this.namespaces.set(e[r],r),o=r);else o=e;this.behaviors[`${o}:${t}`]=n}function Na(e,t){let n;if(e===Object(e))for(let o of Object.keys(e))this.namespaces.has(e[o])||(this.namespaces.set(e[o],o),n=o);else n=e;delete this.behaviors[`${n}:${t}`]}function Da(e,t){const n=e.documentElement;let o=1,r=function(s){return t.has(s.namespaceURI?s.namespaceURI:"")||t.set(s.namespaceURI,"ns"+o++),t.get(s.namespaceURI?s.namespaceURI:"")+":"+s.localName};const i=new Set(Array.from(n.querySelectorAll("*"),r));return i.add(r(n)),i}function ja(e){return new Set(Array.from(e.querySelectorAll("*[data-origname]"),t=>t.localName.replace(/(\w+)-.+/,"$1:")+t.getAttribute("data-origname")))}class sn{constructor(t){this.options=t||{},this.document=this.options.documentObject?this.options.documentObject:void 0,this.document===void 0&&(typeof window<"u"&&window.document?this.document=window.document:typeof global<"u"&&global.document&&(this.document=global.document)),this.addBehaviors=Ia.bind(this),this.addBehavior=Pa.bind(this),this.removeBehavior=Na.bind(this),this.utilities={};for(const n of Object.keys(fo))["getPrefixDef","rw","resolveURI"].includes(n)?this.utilities[n]=fo[n].bind(this):this.utilities[n]=fo[n];if(this.els=[],this.namespaces=new Map,this.behaviors={},this.hasStyle=!1,this.prefixDefs=[],this.debug=this.options.debug===!0,this.discardContent=this.options.discardContent===!0,this.options.base)this.base=this.options.base;else try{window&&(this.base=window.location.href.replace(/\/[^\/]*$/,"/"))}catch{this.base=""}this.options.omitDefaultBehaviors||this.addBehaviors(Ra),this.options.ignoreFragmentId&&window&&window.removeEventListener("ceteiceanload",sn.restorePosition)}async getHTML5(t,n,o){window&&window.location.href.startsWith(this.base)&&t.indexOf("/")>=0&&(this.base=t.replace(/\/[^\/]*$/,"/"));try{const r=await fetch(t);if(r.ok){const i=await r.text();return this.makeHTML5(i,n,o)}else console.log(`Could not get XML file ${t}.
Server returned ${r.status}: ${r.statusText}`)}catch(r){console.log(r)}}makeHTML5(t,n,o){return this.XML_dom=new DOMParser().parseFromString(t,"text/xml"),this.domToHTML5(this.XML_dom,n,o)}preprocess(t,n,o){this.els=Da(t,this.namespaces);let r=i=>{let s;if(this.namespaces.has(i.namespaceURI?i.namespaceURI:"")){let a=this.namespaces.get(i.namespaceURI?i.namespaceURI:"");s=this.document.createElement(`${a}-${i.localName.toLowerCase()}`)}else s=this.document.importNode(i,!1);for(let a of Array.from(i.attributes))a.name=="xmlns"?s.setAttribute("data-xmlns",a.value):["role"].includes(a.name)||s.setAttribute(a.name,a.value),a.name=="xml:id"&&s.setAttribute("id",a.value),a.name=="xml:lang"&&s.setAttribute("lang",a.value),a.name=="rendition"&&s.setAttribute("class",a.value.replace(/#/g,"")),a.name=="role"&&s.setAttribute("tei-role",a.value);if(s.setAttribute("data-origname",i.localName),i.hasAttributes()&&s.setAttribute("data-origatts",i.getAttributeNames().join(" ")),i.childNodes.length==0&&s.setAttribute("data-empty",""),i.localName=="head"&&i.namespaceURI=="http://www.tei-c.org/ns/1.0"){let a=function(c){let l=0,u=c.parentElement;for(;u;){let d=u.children,f=0;for(;f<d.length;){if(d[f].tagName.toLowerCase()==="head"&&d[f].namespaceURI==="http://www.tei-c.org/ns/1.0"){l++;break}f++}u=u.parentElement}return l};s.setAttribute("data-level",a(i))}if(i.localName=="tagsDecl"){let a=this.document.createElement("style");for(let c of Array.from(i.childNodes))if(c.nodeType==1&&c.localName=="rendition"&&c.getAttribute("scheme")=="css"){let l="";c.hasAttribute("selector")?(l+=c.getAttribute("selector").replace(/([^#, >]+\w*)/g,"tei-$1").replace(/#tei-/g,"#")+`{
`,l+=c.textContent):(l+="."+c.getAttribute("xml:id")+`{
`,l+=c.textContent),l+=`
}
`,a.appendChild(this.document.createTextNode(l))}a.childNodes.length>0&&(s.appendChild(a),this.hasStyle=!0)}i.localName=="prefixDef"&&(this.prefixDefs.push(i.getAttribute("ident")),this.prefixDefs[i.getAttribute("ident")]={matchPattern:i.getAttribute("matchPattern"),replacementPattern:i.getAttribute("replacementPattern")}),i.localName=="TEI"&&s.setAttribute("role","main"),["body","front","back","div"].includes(i.localName)&&(s.setAttribute("role","region"),s.setAttribute("aria-label",i.getAttribute("xml:id")||i.getAttribute("n")||i.localName));for(let a of Array.from(i.childNodes))a.nodeType==1?s.appendChild(r(a)):s.appendChild(a.cloneNode());return o&&o(s,i),s};this.dom=this.document.createDocumentFragment();for(let i of Array.from(t.childNodes))i.nodeType==1&&this.dom.appendChild(r(i)),i.nodeType==7&&this.dom.appendChild(this.document.importNode(i,!0)),i.nodeType==8&&this.dom.appendChild(this.document.importNode(i,!0));if(this.utilities.dom=this.dom.firstElementChild,n)n(this.dom,this),window&&window.dispatchEvent(zt);else return typeof window<"u"&&window.dispatchEvent(zt),this.dom}domToHTML5(t,n,o){if(this.preprocess(t,null,o),this.applyBehaviors(),this.done=!0,n)n(this.dom,this),window&&window.dispatchEvent(zt);else return typeof window<"u"&&window.dispatchEvent(zt),this.dom}processPage(){this.els=ja(this.document),this.applyBehaviors(),window&&window.dispatchEvent(zt)}unsetNamespace(t){this.namespaces.delete(t)}setBaseUrl(t){this.base=t}append(t,n){let o=this;if(n&&!n.hasAttribute("data-processed")){let r=t.call(o.utilities,n);r&&o.appendBasic(n,r)}else return function(){if(!this.hasAttribute("data-processed")){let r=t.call(o.utilities,this);r&&o.appendBasic(this,r)}}}appendBasic(t,n){this.discardContent?t.innerHTML="":ss(t,!0),t.appendChild(n)}bName(t){return t.tagName.substring(0,t.tagName.indexOf("-")).toLowerCase()+":"+t.getAttribute("data-origname")}childExists(t,n){return t&&t.nodeName==n?!0:t&&t.nextElementSibling&&this.childExists(t.nextElementSibling,n)}decorator(t){if(Array.isArray(t)&&t.length==0)return function(o){};if(Array.isArray(t)&&!Array.isArray(t[0]))return this.applyDecorator(t);let n=this;return function(o){for(let r of t)if(o.matches(r[0])||r[0]==="_")return Array.isArray(r[1])?n.decorator(r[1]).call(this,o):r[1].call(this,o)}}applyDecorator(t){let n=this;return function(o){let r=[];for(let i=0;i<t.length;i++)r.push(n.template(t[i],o));return n.insert(o,r)}}getFallback(t,n){if(t[n])return t[n]instanceof Function?t[n]:this.decorator(t[n])}getHandler(t,n){if(t[n])return t[n]instanceof Function?this.append(t[n]):this.append(this.decorator(t[n]))}insert(t,n){let o=this.document.createElement("cetei-content");for(let r of Array.from(t.childNodes))r.nodeType===1&&!r.hasAttribute("data-processed")&&this.processElement(r);if(n[0].match("<[^>]+>")&&n[1]&&n[1].match("<[^>]+>"))o.innerHTML=n[0]+t.innerHTML+(n[1]?n[1]:"");else{o.innerHTML=n[0],o.setAttribute("data-before",n[0].replace(/<[^>]+>/g,"").length);for(let r of Array.from(t.childNodes))o.appendChild(r.cloneNode(!0));n.length>1&&(o.innerHTML+=n[1],o.setAttribute("data-after",n[1].replace(/<[^>]+>/g,"").length))}return o.childNodes.length<2?o.firstChild:o}processElement(t){if(t.hasAttribute("data-origname")&&!t.hasAttribute("data-processed")){let n=this.getFallback(this.bName(t));n&&(this.append(n,t),t.setAttribute("data-processed",""))}for(let n of Array.from(t.childNodes))n.nodeType===1&&this.processElement(n)}template(t,n){let o=t;if(t.search(/\$(\w*)(@([a-zA-Z:]+))/)){let r=/\$(\w*)@([a-zA-Z:]+)/g,i;for(;i=r.exec(t);)n.hasAttribute(i[2])?i[1]&&this.utilities[i[1]]?o=o.replace(i[0],this.utilities[i[1]](n.getAttribute(i[2]))):o=o.replace(i[0],n.getAttribute(i[2])):o=o.replace(i[0],"")}return o}applyBehaviors(){typeof window<"u"&&window.customElements?this.define.call(this,this.els):this.fallback.call(this,this.els)}define(t){for(let n of t){const o=this.getHandler(this.behaviors,n);as(n,o,this.debug)}}fallback(t){for(let n of t){let o=this.getFallback(this.behaviors,n);if(o)for(let r of Array.from((this.dom&&!this.done?this.dom:this.document).querySelectorAll(jn(n))))r.hasAttribute("data-processed")||(this.append(o,r),r.setAttribute("data-processed",""))}}static savePosition(){window.sessionStorage.setItem(window.location+"-scroll",window.scrollY)}static restorePosition(){if(window.location.hash)setTimeout(function(){let t=this.document.querySelector(window.decodeURI(window.location.hash));t&&t.scrollIntoView()},100);else{let t;(t=window.sessionStorage.getItem(window.location+"-scroll"))&&(window.sessionStorage.removeItem(window.location+"-scroll"),setTimeout(function(){window.scrollTo(0,t)},100))}}}try{if(typeof window<"u"){window.CETEI=sn,window.addEventListener("beforeunload",sn.savePosition);var zt=new Event("ceteiceanload");window.addEventListener("ceteiceanload",sn.restorePosition)}}catch(e){console.log(e)}const Jn=M.createContext({anno:void 0,setAnno:void 0,annotations:[],selection:{selected:[]}}),Ba=(e,t)=>{const{event:n,...o}=e,{event:r,...i}=t;return JSON.stringify(o)!==JSON.stringify(i)?!1:(n==null?void 0:n.timeStamp)===(r==null?void 0:r.timeStamp)};M.forwardRef((e,t)=>{const[n,o]=M.useState(null),[r,i]=M.useState([]),[s,a]=M.useState({selected:[],previous:[]}),c=M.useRef([]);return M.useImperativeHandle(t,()=>n),M.useEffect(()=>{if(n){const{selection:l,store:u}=n.state;u.all().length>0&&i(u.all());const d=()=>i(()=>u.all());u.observe(d);let f;const p=l.subscribe(({selected:y,...h})=>{f&&u.unobserve(f);const E=(y||[]).map(({id:v,editable:g})=>({annotation:u.getAnnotation(v),editable:g}));a(v=>{const g={selected:E,previous:v.selected,...h};return Ba(v,g)?v:(c.current=v.selected,g)}),f=v=>{const{updated:g}=v.changes;a(m=>({...m,selected:m.selected.map(({annotation:R,editable:$})=>{const N=g.find(I=>I.oldValue.id===R.id);return N?{annotation:N.newValue,editable:$}:{annotation:R,editable:$}})}))},u.observe(f,{annotations:y.map(({id:v})=>v)})});return()=>{u.unobserve(d),p()}}},[n]),va.jsx(Jn.Provider,{value:{anno:n,setAnno:o,annotations:r,selection:s},children:e.children})});const ls=()=>{const{anno:e}=M.useContext(Jn);return e},Ua=()=>{const e=ls();return e==null?void 0:e.state.store},Ha=()=>{const{selection:e}=M.useContext(Jn);return e};var Va=Object.defineProperty,Fa=(e,t,n)=>t in e?Va(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_r=(e,t,n)=>Fa(e,typeof t!="symbol"?t+"":t,n);function wt(){}function Yo(e,t){for(const n in t)e[n]=t[n];return e}function cs(e){return e()}function Mr(){return Object.create(null)}function He(e){e.forEach(cs)}function me(e){return typeof e=="function"}function Ht(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Xa(e){return Object.keys(e).length===0}function qa(e,t,n,o){if(e){const r=us(e,t,n,o);return e[0](r)}}function us(e,t,n,o){return e[1]&&o?Yo(n.ctx.slice(),e[1](o(t))):n.ctx}function Ka(e,t,n,o){if(e[2]&&o){const r=e[2](o(n));if(t.dirty===void 0)return r;if(typeof r=="object"){const i=[],s=Math.max(t.dirty.length,r.length);for(let a=0;a<s;a+=1)i[a]=t.dirty[a]|r[a];return i}return t.dirty|r}return t.dirty}function Ya(e,t,n,o,r,i){if(r){const s=us(t,n,o,i);e.p(s,r)}}function Wa(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let o=0;o<n;o++)t[o]=-1;return t}return-1}function Ir(e){const t={};for(const n in e)n[0]!=="$"&&(t[n]=e[n]);return t}function Pr(e){return e??""}function ue(e,t){e.appendChild(t)}function Z(e,t,n){e.insertBefore(t,n||null)}function J(e){e.parentNode&&e.parentNode.removeChild(e)}function Qn(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function G(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ds(e){return document.createTextNode(e)}function Ce(){return ds(" ")}function wn(){return ds("")}function oe(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function b(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Ga(e){return Array.from(e.childNodes)}function Nr(e,t,n){e.classList.toggle(t,!!n)}function za(e,t,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:o})}let fn;function an(e){fn=e}function fs(){if(!fn)throw new Error("Function called outside component initialization");return fn}function ps(e){fs().$$.on_mount.push(e)}function lr(){const e=fs();return(t,n,{cancelable:o=!1}={})=>{const r=e.$$.callbacks[t];if(r){const i=za(t,n,{cancelable:o});return r.slice().forEach(s=>{s.call(e,i)}),!i.defaultPrevented}return!0}}function ye(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(o=>o.call(this,t))}const Ct=[],Dr=[];let _t=[];const jr=[],hs=Promise.resolve();let Wo=!1;function gs(){Wo||(Wo=!0,hs.then(ys))}function ms(){return gs(),hs}function Go(e){_t.push(e)}const po=new Set;let At=0;function ys(){if(At!==0)return;const e=fn;do{try{for(;At<Ct.length;){const t=Ct[At];At++,an(t),Ja(t.$$)}}catch(t){throw Ct.length=0,At=0,t}for(an(null),Ct.length=0,At=0;Dr.length;)Dr.pop()();for(let t=0;t<_t.length;t+=1){const n=_t[t];po.has(n)||(po.add(n),n())}_t.length=0}while(Ct.length);for(;jr.length;)jr.pop()();Wo=!1,po.clear(),an(e)}function Ja(e){if(e.fragment!==null){e.update(),He(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Go)}}function Qa(e){const t=[],n=[];_t.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),_t=t}const Pn=new Set;let bt;function Nt(){bt={r:0,c:[],p:bt}}function Dt(){bt.r||He(bt.c),bt=bt.p}function re(e,t){e&&e.i&&(Pn.delete(e),e.i(t))}function de(e,t,n,o){if(e&&e.o){if(Pn.has(e))return;Pn.add(e),bt.c.push(()=>{Pn.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function gt(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function qe(e){e&&e.c()}function De(e,t,n){const{fragment:o,after_update:r}=e.$$;o&&o.m(t,n),Go(()=>{const i=e.$$.on_mount.map(cs).filter(me);e.$$.on_destroy?e.$$.on_destroy.push(...i):He(i),e.$$.on_mount=[]}),r.forEach(Go)}function je(e,t){const n=e.$$;n.fragment!==null&&(Qa(n.after_update),He(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Za(e,t){e.$$.dirty[0]===-1&&(Ct.push(e),gs(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Vt(e,t,n,o,r,i,s=null,a=[-1]){const c=fn;an(e);const l=e.$$={fragment:null,ctx:[],props:i,update:wt,not_equal:r,bound:Mr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:Mr(),dirty:a,skip_bound:!1,root:t.target||c.$$.root};s&&s(l.root);let u=!1;if(l.ctx=n?n(e,t.props||{},(d,f,...p)=>{const y=p.length?p[0]:f;return l.ctx&&r(l.ctx[d],l.ctx[d]=y)&&(!l.skip_bound&&l.bound[d]&&l.bound[d](y),u&&Za(e,d)),f}):[],l.update(),u=!0,He(l.before_update),l.fragment=o?o(l.ctx):!1,t.target){if(t.hydrate){const d=Ga(t.target);l.fragment&&l.fragment.l(d),d.forEach(J)}else l.fragment&&l.fragment.c();t.intro&&re(e.$$.fragment),De(e,t.target,t.anchor),ys()}an(c)}let Ft=class{constructor(){_r(this,"$$"),_r(this,"$$set")}$destroy(){je(this,1),this.$destroy=wt}$on(t,n){if(!me(n))return wt;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(t){this.$$set&&!Xa(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};const el="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(el);var ze=(e=>(e.ELLIPSE="ELLIPSE",e.MULTIPOLYGON="MULTIPOLYGON",e.POLYGON="POLYGON",e.POLYLINE="POLYLINE",e.RECTANGLE="RECTANGLE",e.LINE="LINE",e))(ze||{}),tl={exports:{}};(function(e){(function(){function t(a,c){var l=a.x-c.x,u=a.y-c.y;return l*l+u*u}function n(a,c,l){var u=c.x,d=c.y,f=l.x-u,p=l.y-d;if(f!==0||p!==0){var y=((a.x-u)*f+(a.y-d)*p)/(f*f+p*p);y>1?(u=l.x,d=l.y):y>0&&(u+=f*y,d+=p*y)}return f=a.x-u,p=a.y-d,f*f+p*p}function o(a,c){for(var l=a[0],u=[l],d,f=1,p=a.length;f<p;f++)d=a[f],t(d,l)>c&&(u.push(d),l=d);return l!==d&&u.push(d),u}function r(a,c,l,u,d){for(var f=u,p,y=c+1;y<l;y++){var h=n(a[y],a[c],a[l]);h>f&&(p=y,f=h)}f>u&&(p-c>1&&r(a,c,p,u,d),d.push(a[p]),l-p>1&&r(a,p,l,u,d))}function i(a,c){var l=a.length-1,u=[a[0]];return r(a,0,l,c,u),u.push(a[l]),u}function s(a,c,l){if(a.length<=2)return a;var u=c!==void 0?c*c:1;return a=l?a:o(a,u),a=i(a,u),a}e.exports=s,e.exports.default=s})()})(tl);const Xt=(e,t)=>t,ut=e=>{let t=1/0,n=1/0,o=-1/0,r=-1/0;return e.forEach(([i,s])=>{t=Math.min(t,i),n=Math.min(n,s),o=Math.max(o,i),r=Math.max(r,s)}),{minX:t,minY:n,maxX:o,maxY:r}},Bn=e=>{let t=0,n=e.length-1;for(let o=0;o<e.length;o++)t+=(e[n][0]+e[o][0])*(e[n][1]-e[o][1]),n=o;return Math.abs(.5*t)},Un=(e,t,n)=>{let o=!1;for(let r=0,i=e.length-1;r<e.length;i=r++){const s=e[r][0],a=e[r][1],c=e[i][0],l=e[i][1];a>n!=l>n&&t<(c-s)*(n-a)/(l-a)+s&&(o=!o)}return o},nl=(e,t=!0)=>{let n="M ";return e.forEach(([o,r],i)=>{i===0?n+=`${o},${r}`:n+=` L ${o},${r}`}),t&&(n+=" Z"),n},ol=(e,t)=>{const n=Math.abs(t[0]-e[0]),o=Math.abs(t[1]-e[1]);return Math.sqrt(Math.pow(n,2)+Math.pow(o,2))},rl={area:e=>Math.PI*e.geometry.rx*e.geometry.ry,intersects:(e,t,n)=>{const{cx:o,cy:r,rx:i,ry:s}=e.geometry,a=0,c=Math.cos(a),l=Math.sin(a),u=t-o,d=n-r,f=c*u+l*d,p=l*u-c*d;return f*f/(i*i)+p*p/(s*s)<=1}};Xt(ze.ELLIPSE,rl);const il={area:e=>0,intersects:(e,t,n,o=2)=>{const[[r,i],[s,a]]=e.geometry.points,c=Math.abs((a-i)*t-(s-r)*n+s*i-a*r),l=ol([r,i],[s,a]);return c/l<=o}};Xt(ze.LINE,il);const sl={area:e=>{const{polygons:t}=e.geometry;return t.reduce((n,o)=>{const[r,...i]=o.rings,s=Bn(r.points),a=i.reduce((c,l)=>c+Bn(l.points),0);return n+s-a},0)},intersects:(e,t,n)=>{const{polygons:o}=e.geometry;for(const r of o){const[i,...s]=r.rings;if(Un(i.points,t,n)){let a=!1;for(const c of s)if(Un(c.points,t,n)){a=!0;break}if(!a)return!0}}return!1}},ho=e=>{const t=e.reduce((n,o)=>[...n,...o.rings[0].points],[]);return ut(t)},$t=e=>e.rings.map(t=>nl(t.points)).join(" "),al=e=>e.polygons.reduce((t,n)=>[...t,...n.rings.reduce((o,r)=>[...o,...r.points],[])],[]);Xt(ze.MULTIPOLYGON,sl);const ll={area:e=>{const t=e.geometry.points;return Bn(t)},intersects:(e,t,n)=>{const o=e.geometry.points;return Un(o,t,n)}};Xt(ze.POLYGON,ll);const cl={area:e=>{const t=e.geometry;if(!t.closed||t.points.length<3)return 0;const n=Br(t.points,t.closed);return Bn(n)},intersects:(e,t,n,o=2)=>{const r=e.geometry;if(r.closed){const i=Br(r.points,r.closed);return Un(i,t,n)}else return ul(r,[t,n],o)}},Br=(e,t=!1)=>{const n=[];for(let o=0;o<e.length;o++){const r=e[o],i=e[(o+1)%e.length];if(n.push(r.point),(o<e.length-1||t)&&(r.type==="CURVE"||i.type=="CURVE")){const s=vs(r.point,r.type==="CURVE"&&r.outHandle||r.point,i.type==="CURVE"&&i.inHandle||i.point,i.point,10);n.push(...s.slice(1))}}return n},vs=(e,t,n,o,r=10)=>{const i=[];for(let s=0;s<=r;s++){const a=s/r,c=Math.pow(1-a,3)*e[0]+3*Math.pow(1-a,2)*a*t[0]+3*(1-a)*Math.pow(a,2)*n[0]+Math.pow(a,3)*o[0],l=Math.pow(1-a,3)*e[1]+3*Math.pow(1-a,2)*a*t[1]+3*(1-a)*Math.pow(a,2)*n[1]+Math.pow(a,3)*o[1];i.push([c,l])}return i},ul=(e,t,n)=>{for(let o=0;o<e.points.length-1;o++){const r=e.points[o],i=e.points[o+1];if(r.type==="CURVE"||i.type==="CURVE"){const s=vs(r.point,r.type==="CURVE"&&r.outHandle||r.point,i.type==="CURVE"&&i.inHandle||i.point,i.point,20);for(let a=0;a<s.length-1;a++)if(Ur(t,s[a],s[a+1])<=n)return!0}else if(Ur(t,r.point,i.point)<=n)return!0}return!1},Ur=(e,t,n)=>{const[o,r]=e,[i,s]=t,[a,c]=n,l=a-i,u=c-s,d=Math.sqrt(l*l+u*u);if(d===0)return Math.sqrt((o-i)*(o-i)+(r-s)*(r-s));const f=((o-i)*l+(r-s)*u)/(d*d);return f<=0?Math.sqrt((o-i)*(o-i)+(r-s)*(r-s)):f>=1?Math.sqrt((o-a)*(o-a)+(r-c)*(r-c)):Math.abs((c-s)*o-(a-i)*r+a*s-c*i)/d};Xt(ze.POLYLINE,cl);const dl={area:e=>e.geometry.w*e.geometry.h,intersects:(e,t,n)=>t>=e.geometry.x&&t<=e.geometry.x+e.geometry.w&&n>=e.geometry.y&&n<=e.geometry.y+e.geometry.h};Xt(ze.RECTANGLE,dl);const fl=[];for(let e=0;e<256;++e)fl.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const pl=[];for(let e=0;e<256;++e)pl.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const hl="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let gl=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=hl[n[e]&63];return t};gl();const cr=(e,t=0)=>{const{minX:n,minY:o,maxX:r,maxY:i}=e;return{x:n-t,y:o-t,w:r-n+2*t,h:i-o+2*t}},pt=typeof window>"u"||typeof navigator>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,ml=e=>({}),Hr=e=>({grab:e[0]});function yl(e){let t,n,o,r;const i=e[8].default,s=qa(i,e,e[7],Hr);return{c(){t=G("g"),s&&s.c(),b(t,"class","a9s-annotation selected")},m(a,c){Z(a,t,c),s&&s.m(t,null),n=!0,o||(r=[oe(t,"pointerup",e[2]),oe(t,"pointermove",e[1])],o=!0)},p(a,[c]){s&&s.p&&(!n||c&128)&&Ya(s,i,a,a[7],n?Ka(i,a[7],c,ml):Wa(a[7]),Hr)},i(a){n||(re(s,a),n=!0)},o(a){de(s,a),n=!1},d(a){a&&J(t),s&&s.d(a),o=!1,He(r)}}}function vl(e,t,n){let{$$slots:o={},$$scope:r}=t;const i=lr();let{shape:s}=t,{editor:a}=t,{transform:c}=t,{svgEl:l}=t,u,d,f;const p=E=>v=>{if(u=E,l){const{left:g,top:m}=l.getBoundingClientRect(),R=v.clientX-g,$=v.clientY-m;d=c.elementToImage(R,$)}else{const{offsetX:g,offsetY:m}=v;d=c.elementToImage(g,m)}f=s,v.target.setPointerCapture(v.pointerId),i("grab",v)},y=E=>{if(u){const[v,g]=c.elementToImage(E.offsetX,E.offsetY),m=[v-d[0],g-d[1]];n(3,s=a(f,u,m)),i("change",s)}},h=E=>{E.target.releasePointerCapture(E.pointerId),u=void 0,f=s,i("release",E)};return e.$$set=E=>{"shape"in E&&n(3,s=E.shape),"editor"in E&&n(4,a=E.editor),"transform"in E&&n(5,c=E.transform),"svgEl"in E&&n(6,l=E.svgEl),"$$scope"in E&&n(7,r=E.$$scope)},[p,y,h,s,a,c,l,r,o]}let ur=class extends Ft{constructor(t){super(),Vt(this,t,vl,yl,Ht,{shape:3,editor:4,transform:5,svgEl:6})}};function bl(e){let t,n,o,r,i,s,a,c,l=e[3]&&Vr(e);return{c(){t=G("g"),n=G("circle"),l&&l.c(),r=G("circle"),b(n,"class","a9s-handle-buffer svelte-qtyc7s"),b(n,"cx",e[0]),b(n,"cy",e[1]),b(n,"r",o=e[5]+6/e[2]),b(n,"role","button"),b(n,"tabindex","0"),b(r,"class",i=Pr(`a9s-handle-dot${e[3]?" selected":""}`)+" svelte-qtyc7s"),b(r,"cx",e[0]),b(r,"cy",e[1]),b(r,"r",e[5]),b(t,"class",s=`a9s-handle ${e[8].class||""}`.trim())},m(u,d){Z(u,t,d),ue(t,n),l&&l.m(t,null),ue(t,r),a||(c=[oe(n,"dblclick",e[12]),oe(n,"pointerenter",e[13]),oe(n,"pointerleave",e[14]),oe(n,"pointerdown",e[15]),oe(n,"pointerdown",e[6]),oe(n,"pointerup",e[16]),oe(n,"pointerup",e[7])],a=!0)},p(u,d){d&1&&b(n,"cx",u[0]),d&2&&b(n,"cy",u[1]),d&36&&o!==(o=u[5]+6/u[2])&&b(n,"r",o),u[3]?l?l.p(u,d):(l=Vr(u),l.c(),l.m(t,r)):l&&(l.d(1),l=null),d&8&&i!==(i=Pr(`a9s-handle-dot${u[3]?" selected":""}`)+" svelte-qtyc7s")&&b(r,"class",i),d&1&&b(r,"cx",u[0]),d&2&&b(r,"cy",u[1]),d&32&&b(r,"r",u[5]),d&256&&s!==(s=`a9s-handle ${u[8].class||""}`.trim())&&b(t,"class",s)},d(u){u&&J(t),l&&l.d(),a=!1,He(c)}}}function wl(e){let t,n,o,r,i,s,a,c,l;return{c(){t=G("g"),n=G("circle"),r=G("circle"),s=G("circle"),b(n,"cx",e[0]),b(n,"cy",e[1]),b(n,"r",o=e[5]*10),b(n,"class","a9s-touch-halo"),Nr(n,"touched",e[4]),b(r,"cx",e[0]),b(r,"cy",e[1]),b(r,"r",i=e[5]+10/e[2]),b(r,"class","a9s-handle-buffer svelte-qtyc7s"),b(r,"role","button"),b(r,"tabindex","0"),b(s,"class","a9s-handle-dot"),b(s,"cx",e[0]),b(s,"cy",e[1]),b(s,"r",a=e[5]+2/e[2]),b(t,"class","a9s-touch-handle")},m(u,d){Z(u,t,d),ue(t,n),ue(t,r),ue(t,s),c||(l=[oe(r,"dblclick",e[9]),oe(r,"pointerdown",e[10]),oe(r,"pointerdown",e[6]),oe(r,"pointerup",e[11]),oe(r,"pointerup",e[7])],c=!0)},p(u,d){d&1&&b(n,"cx",u[0]),d&2&&b(n,"cy",u[1]),d&32&&o!==(o=u[5]*10)&&b(n,"r",o),d&16&&Nr(n,"touched",u[4]),d&1&&b(r,"cx",u[0]),d&2&&b(r,"cy",u[1]),d&36&&i!==(i=u[5]+10/u[2])&&b(r,"r",i),d&1&&b(s,"cx",u[0]),d&2&&b(s,"cy",u[1]),d&36&&a!==(a=u[5]+2/u[2])&&b(s,"r",a)},d(u){u&&J(t),c=!1,He(l)}}}function Vr(e){let t,n;return{c(){t=G("circle"),b(t,"class","a9s-handle-selected"),b(t,"cx",e[0]),b(t,"cy",e[1]),b(t,"r",n=e[5]+8/e[2])},m(o,r){Z(o,t,r)},p(o,r){r&1&&b(t,"cx",o[0]),r&2&&b(t,"cy",o[1]),r&36&&n!==(n=o[5]+8/o[2])&&b(t,"r",n)},d(o){o&&J(t)}}}function xl(e){let t;function n(r,i){return pt?wl:bl}let o=n()(e);return{c(){o.c(),t=wn()},m(r,i){o.m(r,i),Z(r,t,i)},p(r,[i]){o.p(r,i)},i:wt,o:wt,d(r){r&&J(t),o.d(r)}}}function El(e,t,n){let o,{x:r}=t,{y:i}=t,{scale:s}=t,{selected:a=void 0}=t,c=!1;const l=m=>{m.pointerType==="touch"&&n(4,c=!0)},u=()=>n(4,c=!1);function d(m){ye.call(this,e,m)}function f(m){ye.call(this,e,m)}function p(m){ye.call(this,e,m)}function y(m){ye.call(this,e,m)}function h(m){ye.call(this,e,m)}function E(m){ye.call(this,e,m)}function v(m){ye.call(this,e,m)}function g(m){ye.call(this,e,m)}return e.$$set=m=>{n(8,t=Yo(Yo({},t),Ir(m))),"x"in m&&n(0,r=m.x),"y"in m&&n(1,i=m.y),"scale"in m&&n(2,s=m.scale),"selected"in m&&n(3,a=m.selected)},e.$$.update=()=>{e.$$.dirty&4&&n(5,o=4/s)},t=Ir(t),[r,i,s,a,c,o,l,u,t,d,f,p,y,h,E,v,g]}let Lt=class extends Ft{constructor(t){super(),Vt(this,t,El,xl,Ht,{x:0,y:1,scale:2,selected:3})}};function Al(e){let t,n,o,r,i,s,a;return{c(){t=G("g"),n=G("circle"),r=G("circle"),i=G("circle"),b(n,"class","a9s-polygon-midpoint-buffer svelte-12ykj76"),b(n,"cx",e[0]),b(n,"cy",e[1]),b(n,"r",o=1.75*e[2]),b(r,"class","a9s-polygon-midpoint-outer svelte-12ykj76"),b(r,"cx",e[0]),b(r,"cy",e[1]),b(r,"r",e[2]),b(i,"class","a9s-polygon-midpoint-inner svelte-12ykj76"),b(i,"cx",e[0]),b(i,"cy",e[1]),b(i,"r",e[2]),b(t,"class","a9s-polygon-midpoint svelte-12ykj76")},m(c,l){Z(c,t,l),ue(t,n),ue(t,r),ue(t,i),s||(a=[oe(n,"pointerdown",e[5]),oe(n,"pointerdown",e[3])],s=!0)},p(c,l){l&1&&b(n,"cx",c[0]),l&2&&b(n,"cy",c[1]),l&4&&o!==(o=1.75*c[2])&&b(n,"r",o),l&1&&b(r,"cx",c[0]),l&2&&b(r,"cy",c[1]),l&4&&b(r,"r",c[2]),l&1&&b(i,"cx",c[0]),l&2&&b(i,"cy",c[1]),l&4&&b(i,"r",c[2])},d(c){c&&J(t),s=!1,He(a)}}}function $l(e){let t;return{c(){t=G("circle"),b(t,"cx",e[0]),b(t,"cy",e[1]),b(t,"r",e[2])},m(n,o){Z(n,t,o)},p(n,o){o&1&&b(t,"cx",n[0]),o&2&&b(t,"cy",n[1]),o&4&&b(t,"r",n[2])},d(n){n&&J(t)}}}function Rl(e){let t;function n(r,i){return pt?$l:Al}let o=n()(e);return{c(){o.c(),t=wn()},m(r,i){o.m(r,i),Z(r,t,i)},p(r,[i]){o.p(r,i)},i:wt,o:wt,d(r){r&&J(t),o.d(r)}}}function Sl(e,t,n){let o,{x:r}=t,{y:i}=t,{scale:s}=t;const a=l=>{l.pointerType};function c(l){ye.call(this,e,l)}return e.$$set=l=>{"x"in l&&n(0,r=l.x),"y"in l&&n(1,i=l.y),"scale"in l&&n(4,s=l.scale)},e.$$.update=()=>{e.$$.dirty&16&&n(2,o=4/s)},[r,i,o,a,s,c]}let bs=class extends Ft{constructor(t){super(),Vt(this,t,Sl,Rl,Ht,{x:0,y:1,scale:4})}};function go(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function Fr(e,t,n){const o=e.slice();return o[28]=t[n],o[30]=n,o}function mo(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function yo(e){const t=e.slice(),n=t[10][t[6]];return t[28]=n.point,t}function Xr(e){let t,n,o,r;return{c(){t=G("circle"),b(t,"cx",n=e[28][0]),b(t,"cy",o=e[28][1]),b(t,"r",r=pn/e[3]),b(t,"class","svelte-1h2slbm")},m(i,s){Z(i,t,s)},p(i,s){s[0]&1088&&n!==(n=i[28][0])&&b(t,"cx",n),s[0]&1088&&o!==(o=i[28][1])&&b(t,"cy",o),s[0]&8&&r!==(r=pn/i[3])&&b(t,"r",r)},d(i){i&&J(t)}}}function qr(e){let t,n,o,r,i,s,a,c,l,u;return{c(){t=G("mask"),n=G("rect"),a=G("circle"),b(n,"x",o=e[9].x),b(n,"y",r=e[9].y),b(n,"width",i=e[9].w),b(n,"height",s=e[9].h),b(n,"class","svelte-1h2slbm"),b(a,"cx",c=e[28][0]),b(a,"cy",l=e[28][1]),b(a,"r",u=pn/e[3]),b(a,"class","svelte-1h2slbm"),b(t,"id",`${e[19]}-inner`),b(t,"class","a9s-polygon-editor-mask svelte-1h2slbm")},m(d,f){Z(d,t,f),ue(t,n),ue(t,a)},p(d,f){f[0]&512&&o!==(o=d[9].x)&&b(n,"x",o),f[0]&512&&r!==(r=d[9].y)&&b(n,"y",r),f[0]&512&&i!==(i=d[9].w)&&b(n,"width",i),f[0]&512&&s!==(s=d[9].h)&&b(n,"height",s),f[0]&1088&&c!==(c=d[28][0])&&b(a,"cx",c),f[0]&1088&&l!==(l=d[28][1])&&b(a,"cy",l),f[0]&8&&u!==(u=pn/d[3])&&b(a,"r",u)},d(d){d&&J(t)}}}function Kr(e){let t,n;return t=new Lt({props:{class:"a9s-corner-handle",x:e[28][0],y:e[28][1],scale:e[3],selected:e[8].includes(e[30])}}),t.$on("pointerenter",e[11]),t.$on("pointerleave",e[12]),t.$on("pointerdown",e[15]),t.$on("pointerdown",function(){me(e[27](`HANDLE-${e[30]}`))&&e[27](`HANDLE-${e[30]}`).apply(this,arguments)}),t.$on("pointerup",e[16](e[30])),{c(){qe(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,r){e=o;const i={};r[0]&32&&(i.x=e[28][0]),r[0]&32&&(i.y=e[28][1]),r[0]&8&&(i.scale=e[3]),r[0]&256&&(i.selected=e[8].includes(e[30])),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){de(t.$$.fragment,o),n=!1},d(o){je(t,o)}}}function Yr(e){let t,n;return t=new bs({props:{x:e[28][0],y:e[28][1],scale:e[3]}}),t.$on("pointerdown",function(){me(e[18](e[6]))&&e[18](e[6]).apply(this,arguments)}),{c(){qe(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,r){e=o;const i={};r[0]&1088&&(i.x=e[28][0]),r[0]&1088&&(i.y=e[28][1]),r[0]&8&&(i.scale=e[3]),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){de(t.$$.fragment,o),n=!1},d(o){je(t,o)}}}function Tl(e){let t,n,o,r,i,s,a,c,l,u,d,f,p,y,h,E,v,g,m,R,$,N=e[6]!==void 0&&!e[7]&&Xr(yo(e)),I=e[6]!==void 0&&!e[7]&&qr(mo(e)),k=gt(e[5].points),P=[];for(let S=0;S<k.length;S+=1)P[S]=Kr(Fr(e,k,S));const U=S=>de(P[S],1,1,()=>{P[S]=null});let B=e[6]!==void 0&&!e[7]&&Yr(go(e));return{c(){t=G("defs"),n=G("mask"),o=G("rect"),c=G("polygon"),N&&N.c(),I&&I.c(),u=Ce(),d=G("polygon"),p=Ce(),y=G("polygon"),E=Ce();for(let S=0;S<P.length;S+=1)P[S].c();v=Ce(),B&&B.c(),g=wn(),b(o,"x",r=e[9].x),b(o,"y",i=e[9].y),b(o,"width",s=e[9].w),b(o,"height",a=e[9].h),b(o,"class","svelte-1h2slbm"),b(c,"points",l=e[5].points.map(Wr).join(" ")),b(c,"class","svelte-1h2slbm"),b(n,"id",`${e[19]}-outer`),b(n,"class","a9s-polygon-editor-mask svelte-1h2slbm"),b(d,"class","a9s-outer"),b(d,"mask",`url(#${e[19]}-outer)`),b(d,"points",f=e[5].points.map(Gr).join(" ")),b(y,"class","a9s-inner a9s-shape-handle"),b(y,"mask",`url(#${e[19]}-inner)`),b(y,"style",e[1]),b(y,"points",h=e[5].points.map(zr).join(" "))},m(S,T){Z(S,t,T),ue(t,n),ue(n,o),ue(n,c),N&&N.m(n,null),I&&I.m(t,null),Z(S,u,T),Z(S,d,T),Z(S,p,T),Z(S,y,T),Z(S,E,T);for(let x=0;x<P.length;x+=1)P[x]&&P[x].m(S,T);Z(S,v,T),B&&B.m(S,T),Z(S,g,T),m=!0,R||($=[oe(d,"pointerup",e[14]),oe(d,"pointerdown",function(){me(e[27]("SHAPE"))&&e[27]("SHAPE").apply(this,arguments)}),oe(y,"pointermove",e[13]),oe(y,"pointerup",e[14]),oe(y,"pointerdown",function(){me(e[27]("SHAPE"))&&e[27]("SHAPE").apply(this,arguments)})],R=!0)},p(S,T){if(e=S,(!m||T[0]&512&&r!==(r=e[9].x))&&b(o,"x",r),(!m||T[0]&512&&i!==(i=e[9].y))&&b(o,"y",i),(!m||T[0]&512&&s!==(s=e[9].w))&&b(o,"width",s),(!m||T[0]&512&&a!==(a=e[9].h))&&b(o,"height",a),(!m||T[0]&32&&l!==(l=e[5].points.map(Wr).join(" ")))&&b(c,"points",l),e[6]!==void 0&&!e[7]?N?N.p(yo(e),T):(N=Xr(yo(e)),N.c(),N.m(n,null)):N&&(N.d(1),N=null),e[6]!==void 0&&!e[7]?I?I.p(mo(e),T):(I=qr(mo(e)),I.c(),I.m(t,null)):I&&(I.d(1),I=null),(!m||T[0]&32&&f!==(f=e[5].points.map(Gr).join(" ")))&&b(d,"points",f),(!m||T[0]&2)&&b(y,"style",e[1]),(!m||T[0]&32&&h!==(h=e[5].points.map(zr).join(" ")))&&b(y,"points",h),T[0]&134322472){k=gt(e[5].points);let x;for(x=0;x<k.length;x+=1){const A=Fr(e,k,x);P[x]?(P[x].p(A,T),re(P[x],1)):(P[x]=Kr(A),P[x].c(),re(P[x],1),P[x].m(v.parentNode,v))}for(Nt(),x=k.length;x<P.length;x+=1)U(x);Dt()}e[6]!==void 0&&!e[7]?B?(B.p(go(e),T),T[0]&192&&re(B,1)):(B=Yr(go(e)),B.c(),re(B,1),B.m(g.parentNode,g)):B&&(Nt(),de(B,1,1,()=>{B=null}),Dt())},i(S){if(!m){for(let T=0;T<k.length;T+=1)re(P[T]);re(B),m=!0}},o(S){P=P.filter(Boolean);for(let T=0;T<P.length;T+=1)de(P[T]);de(B),m=!1},d(S){S&&(J(t),J(u),J(d),J(p),J(y),J(E),J(v),J(g)),N&&N.d(),I&&I.d(),Qn(P,S),B&&B.d(S),R=!1,He($)}}}function Cl(e){let t,n;return t=new ur({props:{shape:e[0],transform:e[2],editor:e[17],svgEl:e[4],$$slots:{default:[Tl,({grab:o})=>({27:o}),({grab:o})=>[o?134217728:0]]},$$scope:{ctx:e}}}),t.$on("change",e[20]),t.$on("grab",e[21]),t.$on("release",e[22]),{c(){qe(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,r){const i={};r[0]&1&&(i.shape=o[0]),r[0]&4&&(i.transform=o[2]),r[0]&16&&(i.svgEl=o[4]),r[0]&134219754|r[1]&1&&(i.$$scope={dirty:r,ctx:o}),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){de(t.$$.fragment,o),n=!1},d(o){je(t,o)}}}const Ol=250,kl=1e3,Ll=12,pn=4.5,Wr=e=>e.join(","),Gr=e=>e.join(","),zr=e=>e.join(",");function _l(e,t,n){let o,r,i;const s=lr();let{shape:a}=t,{computedStyle:c}=t,{transform:l}=t,{viewportScale:u=1}=t,{svgEl:d}=t,f,p=!1,y,h=[];const E=()=>n(7,p=!0),v=()=>n(7,p=!1),g=x=>{if(h.length>0||!r.some(O=>O.visible)){n(6,f=void 0);return}const[A,_]=l.elementToImage(x.offsetX,x.offsetY),L=O=>Math.pow(O[0]-A,2)+Math.pow(O[1]-_,2),C=o.points.reduce((O,j)=>L(j)<L(O)?j:O),H=r.filter(O=>O.visible).reduce((O,j)=>L(j.point)<L(O.point)?j:O),w=Math.pow(kl/u,2);L(C)<w||L(H.point)<w?n(6,f=r.indexOf(H)):n(6,f=void 0)},m=()=>{document.activeElement!==d&&d.focus()},R=()=>{n(8,h=[]),m()},$=x=>{n(7,p=!0),x.preventDefault(),x.stopPropagation(),y=performance.now()},N=x=>A=>{if(!y||pt||performance.now()-y>Ol)return;const _=h.includes(x);A.metaKey||A.ctrlKey||A.shiftKey?_?n(8,h=h.filter(L=>L!==x)):n(8,h=[...h,x]):_&&h.length>1?n(8,h=[x]):_?n(8,h=[]):n(8,h=[x]),m()},I=(x,A,_)=>{m();let L;const C=x.geometry;h.length>1?L=C.points.map(([w,O],j)=>h.includes(j)?[w+_[0],O+_[1]]:[w,O]):A==="SHAPE"?L=C.points.map(([w,O])=>[w+_[0],O+_[1]]):L=C.points.map(([w,O],j)=>A===`HANDLE-${j}`?[w+_[0],O+_[1]]:[w,O]);const H=ut(L);return{...x,geometry:{points:L,bounds:H}}},k=x=>async A=>{A.stopPropagation();const _=[...o.points.slice(0,x+1),r[x].point,...o.points.slice(x+1)],L=ut(_);s("change",{...a,geometry:{points:_,bounds:L}}),await ms();const C=[...document.querySelectorAll(".a9s-handle")][x+1];if(C!=null&&C.firstChild){const H=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:A.clientX,clientY:A.clientY,pointerId:A.pointerId,pointerType:A.pointerType,isPrimary:A.isPrimary,buttons:A.buttons});C.firstChild.dispatchEvent(H)}},P=()=>{if(o.points.length-h.length<3)return;const x=o.points.filter((_,L)=>!h.includes(L)),A=ut(x);s("change",{...a,geometry:{points:x,bounds:A}}),n(8,h=[])};ps(()=>{if(pt)return;const x=A=>{(A.key==="Delete"||A.key==="Backspace")&&(A.preventDefault(),P())};return d.addEventListener("pointermove",g),d.addEventListener("keydown",x),()=>{d.removeEventListener("pointermove",g),d.removeEventListener("keydown",x)}});const U=`polygon-mask-${Math.random().toString(36).substring(2,12)}`;function B(x){ye.call(this,e,x)}function S(x){ye.call(this,e,x)}function T(x){ye.call(this,e,x)}return e.$$set=x=>{"shape"in x&&n(0,a=x.shape),"computedStyle"in x&&n(1,c=x.computedStyle),"transform"in x&&n(2,l=x.transform),"viewportScale"in x&&n(3,u=x.viewportScale),"svgEl"in x&&n(4,d=x.svgEl)},e.$$.update=()=>{e.$$.dirty[0]&1&&n(5,o=a.geometry),e.$$.dirty[0]&40&&n(10,r=pt?[]:o.points.map((x,A)=>{const _=A===o.points.length-1?o.points[0]:o.points[A+1],L=(x[0]+_[0])/2,C=(x[1]+_[1])/2,H=Math.sqrt(Math.pow(_[0]-L,2)+Math.pow(_[1]-C,2))>Ll/u;return{point:[L,C],visible:H}})),e.$$.dirty[0]&40&&n(9,i=cr(o.bounds,pn/u))},[a,c,l,u,d,o,f,p,h,i,r,E,v,g,R,$,N,I,k,U,B,S,T]}class Ml extends Ft{constructor(t){super(),Vt(this,t,_l,Cl,Ht,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}function Il(e){let t,n,o,r,i,s,a,c,l,u,d,f,p,y,h,E,v,g,m,R,$,N,I,k,P,U,B,S,T,x,A,_,L,C,H,w,O,j,D,q,F,K,ae,te,Ve,be,We,W,ee,z,se,ie,X,ke,Te;return be=new Lt({props:{class:"a9s-corner-handle-topleft",x:e[5].x,y:e[5].y,scale:e[3]}}),be.$on("pointerdown",function(){me(e[12]("TOP_LEFT"))&&e[12]("TOP_LEFT").apply(this,arguments)}),W=new Lt({props:{class:"a9s-corner-handle-topright",x:e[5].x+e[5].w,y:e[5].y,scale:e[3]}}),W.$on("pointerdown",function(){me(e[12]("TOP_RIGHT"))&&e[12]("TOP_RIGHT").apply(this,arguments)}),z=new Lt({props:{class:"a9s-corner-handle-bottomright",x:e[5].x+e[5].w,y:e[5].y+e[5].h,scale:e[3]}}),z.$on("pointerdown",function(){me(e[12]("BOTTOM_RIGHT"))&&e[12]("BOTTOM_RIGHT").apply(this,arguments)}),ie=new Lt({props:{class:"a9s-corner-handle-bottomleft",x:e[5].x,y:e[5].y+e[5].h,scale:e[3]}}),ie.$on("pointerdown",function(){me(e[12]("BOTTOM_LEFT"))&&e[12]("BOTTOM_LEFT").apply(this,arguments)}),{c(){t=G("defs"),n=G("mask"),o=G("rect"),c=G("rect"),p=Ce(),y=G("rect"),m=Ce(),R=G("rect"),P=Ce(),U=G("rect"),x=Ce(),A=G("rect"),H=Ce(),w=G("rect"),q=Ce(),F=G("rect"),Ve=Ce(),qe(be.$$.fragment),We=Ce(),qe(W.$$.fragment),ee=Ce(),qe(z.$$.fragment),se=Ce(),qe(ie.$$.fragment),b(o,"class","rect-mask-bg svelte-1njczvj"),b(o,"x",r=e[6].x),b(o,"y",i=e[6].y),b(o,"width",s=e[6].w),b(o,"height",a=e[6].h),b(c,"class","rect-mask-fg svelte-1njczvj"),b(c,"x",l=e[5].x),b(c,"y",u=e[5].y),b(c,"width",d=e[5].w),b(c,"height",f=e[5].h),b(n,"id",e[8]),b(n,"class","a9s-rectangle-editor-mask svelte-1njczvj"),b(y,"class","a9s-outer"),b(y,"mask",`url(#${e[8]})`),b(y,"x",h=e[5].x),b(y,"y",E=e[5].y),b(y,"width",v=e[5].w),b(y,"height",g=e[5].h),b(R,"class","a9s-inner a9s-shape-handle"),b(R,"style",e[1]),b(R,"x",$=e[5].x),b(R,"y",N=e[5].y),b(R,"width",I=e[5].w),b(R,"height",k=e[5].h),b(U,"class","a9s-edge-handle a9s-edge-handle-top"),b(U,"x",B=e[5].x),b(U,"y",S=e[5].y),b(U,"height",1),b(U,"width",T=e[5].w),b(A,"class","a9s-edge-handle a9s-edge-handle-right"),b(A,"x",_=e[5].x+e[5].w),b(A,"y",L=e[5].y),b(A,"height",C=e[5].h),b(A,"width",1),b(w,"class","a9s-edge-handle a9s-edge-handle-bottom"),b(w,"x",O=e[5].x),b(w,"y",j=e[5].y+e[5].h),b(w,"height",1),b(w,"width",D=e[5].w),b(F,"class","a9s-edge-handle a9s-edge-handle-left"),b(F,"x",K=e[5].x),b(F,"y",ae=e[5].y),b(F,"height",te=e[5].h),b(F,"width",1)},m(Y,V){Z(Y,t,V),ue(t,n),ue(n,o),ue(n,c),Z(Y,p,V),Z(Y,y,V),Z(Y,m,V),Z(Y,R,V),Z(Y,P,V),Z(Y,U,V),Z(Y,x,V),Z(Y,A,V),Z(Y,H,V),Z(Y,w,V),Z(Y,q,V),Z(Y,F,V),Z(Y,Ve,V),De(be,Y,V),Z(Y,We,V),De(W,Y,V),Z(Y,ee,V),De(z,Y,V),Z(Y,se,V),De(ie,Y,V),X=!0,ke||(Te=[oe(y,"pointerdown",function(){me(e[12]("SHAPE"))&&e[12]("SHAPE").apply(this,arguments)}),oe(R,"pointerdown",function(){me(e[12]("SHAPE"))&&e[12]("SHAPE").apply(this,arguments)}),oe(U,"pointerdown",function(){me(e[12]("TOP"))&&e[12]("TOP").apply(this,arguments)}),oe(A,"pointerdown",function(){me(e[12]("RIGHT"))&&e[12]("RIGHT").apply(this,arguments)}),oe(w,"pointerdown",function(){me(e[12]("BOTTOM"))&&e[12]("BOTTOM").apply(this,arguments)}),oe(F,"pointerdown",function(){me(e[12]("LEFT"))&&e[12]("LEFT").apply(this,arguments)})],ke=!0)},p(Y,V){e=Y,(!X||V&64&&r!==(r=e[6].x))&&b(o,"x",r),(!X||V&64&&i!==(i=e[6].y))&&b(o,"y",i),(!X||V&64&&s!==(s=e[6].w))&&b(o,"width",s),(!X||V&64&&a!==(a=e[6].h))&&b(o,"height",a),(!X||V&32&&l!==(l=e[5].x))&&b(c,"x",l),(!X||V&32&&u!==(u=e[5].y))&&b(c,"y",u),(!X||V&32&&d!==(d=e[5].w))&&b(c,"width",d),(!X||V&32&&f!==(f=e[5].h))&&b(c,"height",f),(!X||V&32&&h!==(h=e[5].x))&&b(y,"x",h),(!X||V&32&&E!==(E=e[5].y))&&b(y,"y",E),(!X||V&32&&v!==(v=e[5].w))&&b(y,"width",v),(!X||V&32&&g!==(g=e[5].h))&&b(y,"height",g),(!X||V&2)&&b(R,"style",e[1]),(!X||V&32&&$!==($=e[5].x))&&b(R,"x",$),(!X||V&32&&N!==(N=e[5].y))&&b(R,"y",N),(!X||V&32&&I!==(I=e[5].w))&&b(R,"width",I),(!X||V&32&&k!==(k=e[5].h))&&b(R,"height",k),(!X||V&32&&B!==(B=e[5].x))&&b(U,"x",B),(!X||V&32&&S!==(S=e[5].y))&&b(U,"y",S),(!X||V&32&&T!==(T=e[5].w))&&b(U,"width",T),(!X||V&32&&_!==(_=e[5].x+e[5].w))&&b(A,"x",_),(!X||V&32&&L!==(L=e[5].y))&&b(A,"y",L),(!X||V&32&&C!==(C=e[5].h))&&b(A,"height",C),(!X||V&32&&O!==(O=e[5].x))&&b(w,"x",O),(!X||V&32&&j!==(j=e[5].y+e[5].h))&&b(w,"y",j),(!X||V&32&&D!==(D=e[5].w))&&b(w,"width",D),(!X||V&32&&K!==(K=e[5].x))&&b(F,"x",K),(!X||V&32&&ae!==(ae=e[5].y))&&b(F,"y",ae),(!X||V&32&&te!==(te=e[5].h))&&b(F,"height",te);const Le={};V&32&&(Le.x=e[5].x),V&32&&(Le.y=e[5].y),V&8&&(Le.scale=e[3]),be.$set(Le);const Oe={};V&32&&(Oe.x=e[5].x+e[5].w),V&32&&(Oe.y=e[5].y),V&8&&(Oe.scale=e[3]),W.$set(Oe);const _e={};V&32&&(_e.x=e[5].x+e[5].w),V&32&&(_e.y=e[5].y+e[5].h),V&8&&(_e.scale=e[3]),z.$set(_e);const vt={};V&32&&(vt.x=e[5].x),V&32&&(vt.y=e[5].y+e[5].h),V&8&&(vt.scale=e[3]),ie.$set(vt)},i(Y){X||(re(be.$$.fragment,Y),re(W.$$.fragment,Y),re(z.$$.fragment,Y),re(ie.$$.fragment,Y),X=!0)},o(Y){de(be.$$.fragment,Y),de(W.$$.fragment,Y),de(z.$$.fragment,Y),de(ie.$$.fragment,Y),X=!1},d(Y){Y&&(J(t),J(p),J(y),J(m),J(R),J(P),J(U),J(x),J(A),J(H),J(w),J(q),J(F),J(Ve),J(We),J(ee),J(se)),je(be,Y),je(W,Y),je(z,Y),je(ie,Y),ke=!1,He(Te)}}}function Pl(e){let t,n;return t=new ur({props:{shape:e[0],transform:e[2],editor:e[7],svgEl:e[4],$$slots:{default:[Il,({grab:o})=>({12:o}),({grab:o})=>o?4096:0]},$$scope:{ctx:e}}}),t.$on("grab",e[9]),t.$on("change",e[10]),t.$on("release",e[11]),{c(){qe(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,[r]){const i={};r&1&&(i.shape=o[0]),r&4&&(i.transform=o[2]),r&16&&(i.svgEl=o[4]),r&12394&&(i.$$scope={dirty:r,ctx:o}),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){de(t.$$.fragment,o),n=!1},d(o){je(t,o)}}}function Nl(e,t,n){let o,r,{shape:i}=t,{computedStyle:s}=t,{transform:a}=t,{viewportScale:c=1}=t,{svgEl:l}=t;const u=(h,E,v)=>{const g=h.geometry.bounds;let[m,R]=[g.minX,g.minY],[$,N]=[g.maxX,g.maxY];const[I,k]=v;if(E==="SHAPE")m+=I,$+=I,R+=k,N+=k;else{switch(E){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{R+=k;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{N+=k;break}}switch(E){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{m+=I;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{$+=I;break}}}const P=Math.min(m,$),U=Math.min(R,N),B=Math.abs($-m),S=Math.abs(N-R);return{...h,geometry:{x:P,y:U,w:B,h:S,bounds:{minX:P,minY:U,maxX:P+B,maxY:U+S}}}},d=`rect-mask-${Math.random().toString(36).substring(2,12)}`;function f(h){ye.call(this,e,h)}function p(h){ye.call(this,e,h)}function y(h){ye.call(this,e,h)}return e.$$set=h=>{"shape"in h&&n(0,i=h.shape),"computedStyle"in h&&n(1,s=h.computedStyle),"transform"in h&&n(2,a=h.transform),"viewportScale"in h&&n(3,c=h.viewportScale),"svgEl"in h&&n(4,l=h.svgEl)},e.$$.update=()=>{e.$$.dirty&1&&n(5,o=i.geometry),e.$$.dirty&40&&n(6,r=cr(o.bounds,2/c))},[i,s,a,c,l,o,r,u,d,f,p,y]}class Dl extends Ft{constructor(t){super(),Vt(this,t,Nl,Pl,Ht,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4})}}var Jr=Object.prototype.hasOwnProperty;function zo(e,t){var n,o;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((o=e.length)===t.length)for(;o--&&zo(e[o],t[o]););return o===-1}if(!n||typeof e=="object"){o=0;for(n in e)if(Jr.call(e,n)&&++o&&!Jr.call(t,n)||!(n in t)||!zo(e[n],t[n]))return!1;return Object.keys(t).length===o}}return e!==e&&t!==t}const jl=12,Bl=(e,t)=>e.polygons.reduce((n,o,r)=>{const i=o.rings.reduce((s,a,c)=>{const l=a.points.map((u,d)=>{const f=d===a.points.length-1?a.points[0]:a.points[d+1],p=(u[0]+f[0])/2,y=(u[1]+f[1])/2,h=Math.sqrt(Math.pow(f[0]-p,2)+Math.pow(f[1]-y,2))>jl/t;return{point:[p,y],visible:h,elementIdx:r,ringIdx:c,pointIdx:d}});return[...s,...l]},[]);return[...n,...i]},[]);function vo(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function Qr(e,t,n){const o=e.slice();return o[30]=t[n],o[32]=n,o}function Zr(e,t,n){const o=e.slice();return o[33]=t[n],o[35]=n,o}function ei(e,t,n){const o=e.slice();return o[29]=t[n],o[37]=n,o}function bo(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function wo(e){const t=e.slice(),n=t[10][t[6]];return t[29]=n.point,t}function ti(e){let t,n,o,r;return{c(){t=G("circle"),b(t,"cx",n=e[29][0]),b(t,"cy",o=e[29][1]),b(t,"r",r=hn/e[3]),b(t,"class","svelte-1vxo6dc")},m(i,s){Z(i,t,s)},p(i,s){s[0]&1088&&n!==(n=i[29][0])&&b(t,"cx",n),s[0]&1088&&o!==(o=i[29][1])&&b(t,"cy",o),s[0]&8&&r!==(r=hn/i[3])&&b(t,"r",r)},d(i){i&&J(t)}}}function ni(e){let t,n,o,r,i,s,a,c,l,u;return{c(){t=G("mask"),n=G("rect"),a=G("circle"),b(n,"x",o=e[9].x),b(n,"y",r=e[9].y),b(n,"width",i=e[9].w),b(n,"height",s=e[9].h),b(n,"class","svelte-1vxo6dc"),b(a,"cx",c=e[29][0]),b(a,"cy",l=e[29][1]),b(a,"r",u=hn/e[3]),b(a,"class","svelte-1vxo6dc"),b(t,"id",`${e[18]}-${e[32]}-inner`),b(t,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc")},m(d,f){Z(d,t,f),ue(t,n),ue(t,a)},p(d,f){f[0]&512&&o!==(o=d[9].x)&&b(n,"x",o),f[0]&512&&r!==(r=d[9].y)&&b(n,"y",r),f[0]&512&&i!==(i=d[9].w)&&b(n,"width",i),f[0]&512&&s!==(s=d[9].h)&&b(n,"height",s),f[0]&1088&&c!==(c=d[29][0])&&b(a,"cx",c),f[0]&1088&&l!==(l=d[29][1])&&b(a,"cy",l),f[0]&8&&u!==(u=hn/d[3])&&b(a,"r",u)},d(d){d&&J(t)}}}function oi(e){let t,n;function o(...r){return e[19](e[32],e[35],e[37],...r)}return t=new Lt({props:{class:"a9s-corner-handle",x:e[29][0],y:e[29][1],scale:e[3],selected:e[8].some(o)}}),t.$on("pointerenter",e[11]),t.$on("pointerleave",e[12]),t.$on("pointerdown",e[14]),t.$on("pointerdown",function(){me(e[28](`HANDLE-${e[32]}-${e[35]}-${e[37]}`))&&e[28](`HANDLE-${e[32]}-${e[35]}-${e[37]}`).apply(this,arguments)}),t.$on("pointerup",e[15](e[32],e[35],e[37])),{c(){qe(t.$$.fragment)},m(r,i){De(t,r,i),n=!0},p(r,i){e=r;const s={};i[0]&32&&(s.x=e[29][0]),i[0]&32&&(s.y=e[29][1]),i[0]&8&&(s.scale=e[3]),i[0]&256&&(s.selected=e[8].some(o)),t.$set(s)},i(r){n||(re(t.$$.fragment,r),n=!0)},o(r){de(t.$$.fragment,r),n=!1},d(r){je(t,r)}}}function ri(e){let t,n,o=gt(e[33].points),r=[];for(let s=0;s<o.length;s+=1)r[s]=oi(ei(e,o,s));const i=s=>de(r[s],1,1,()=>{r[s]=null});return{c(){for(let s=0;s<r.length;s+=1)r[s].c();t=wn()},m(s,a){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(s,a);Z(s,t,a),n=!0},p(s,a){if(a[0]&268491048){o=gt(s[33].points);let c;for(c=0;c<o.length;c+=1){const l=ei(s,o,c);r[c]?(r[c].p(l,a),re(r[c],1)):(r[c]=oi(l),r[c].c(),re(r[c],1),r[c].m(t.parentNode,t))}for(Nt(),c=o.length;c<r.length;c+=1)i(c);Dt()}},i(s){if(!n){for(let a=0;a<o.length;a+=1)re(r[a]);n=!0}},o(s){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)de(r[a]);n=!1},d(s){s&&J(t),Qn(r,s)}}}function ii(e){let t,n,o,r,i,s,a,c,l,u,d,f,p,y,h,E,v,g=e[6]!==void 0&&!e[7]&&ti(wo(e)),m=e[6]!==void 0&&!e[7]&&ni(bo(e)),R=gt(e[30].rings),$=[];for(let I=0;I<R.length;I+=1)$[I]=ri(Zr(e,R,I));const N=I=>de($[I],1,1,()=>{$[I]=null});return{c(){t=G("g"),n=G("defs"),o=G("mask"),r=G("rect"),l=G("path"),g&&g.c(),m&&m.c(),d=G("path"),p=G("path");for(let I=0;I<$.length;I+=1)$[I].c();b(r,"x",i=e[9].x),b(r,"y",s=e[9].y),b(r,"width",a=e[9].w),b(r,"height",c=e[9].h),b(r,"class","svelte-1vxo6dc"),b(l,"d",u=$t(e[30])),b(l,"class","svelte-1vxo6dc"),b(o,"id",`${e[18]}-${e[32]}-outer`),b(o,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc"),b(d,"class","a9s-outer"),b(d,"mask",`url(#${e[18]}-${e[32]}-outer)`),b(d,"fill-rule","evenodd"),b(d,"d",f=$t(e[30])),b(p,"class","a9s-inner"),b(p,"mask",`url(#${e[18]}-${e[32]}-inner)`),b(p,"style",e[1]),b(p,"fill-rule","evenodd"),b(p,"d",y=$t(e[30]))},m(I,k){Z(I,t,k),ue(t,n),ue(n,o),ue(o,r),ue(o,l),g&&g.m(o,null),m&&m.m(n,null),ue(t,d),ue(t,p);for(let P=0;P<$.length;P+=1)$[P]&&$[P].m(t,null);h=!0,E||(v=[oe(d,"pointerup",e[13]),oe(d,"pointerdown",function(){me(e[28]("SHAPE"))&&e[28]("SHAPE").apply(this,arguments)}),oe(p,"pointerup",e[13]),oe(p,"pointerdown",function(){me(e[28]("SHAPE"))&&e[28]("SHAPE").apply(this,arguments)})],E=!0)},p(I,k){if(e=I,(!h||k[0]&512&&i!==(i=e[9].x))&&b(r,"x",i),(!h||k[0]&512&&s!==(s=e[9].y))&&b(r,"y",s),(!h||k[0]&512&&a!==(a=e[9].w))&&b(r,"width",a),(!h||k[0]&512&&c!==(c=e[9].h))&&b(r,"height",c),(!h||k[0]&32&&u!==(u=$t(e[30])))&&b(l,"d",u),e[6]!==void 0&&!e[7]?g?g.p(wo(e),k):(g=ti(wo(e)),g.c(),g.m(o,null)):g&&(g.d(1),g=null),e[6]!==void 0&&!e[7]?m?m.p(bo(e),k):(m=ni(bo(e)),m.c(),m.m(n,null)):m&&(m.d(1),m=null),(!h||k[0]&32&&f!==(f=$t(e[30])))&&b(d,"d",f),(!h||k[0]&2)&&b(p,"style",e[1]),(!h||k[0]&32&&y!==(y=$t(e[30])))&&b(p,"d",y),k[0]&268491048){R=gt(e[30].rings);let P;for(P=0;P<R.length;P+=1){const U=Zr(e,R,P);$[P]?($[P].p(U,k),re($[P],1)):($[P]=ri(U),$[P].c(),re($[P],1),$[P].m(t,null))}for(Nt(),P=R.length;P<$.length;P+=1)N(P);Dt()}},i(I){if(!h){for(let k=0;k<R.length;k+=1)re($[k]);h=!0}},o(I){$=$.filter(Boolean);for(let k=0;k<$.length;k+=1)de($[k]);h=!1},d(I){I&&J(t),g&&g.d(),m&&m.d(),Qn($,I),E=!1,He(v)}}}function si(e){let t,n;return t=new bs({props:{x:e[29][0],y:e[29][1],scale:e[3]}}),t.$on("pointerdown",function(){me(e[17](e[6]))&&e[17](e[6]).apply(this,arguments)}),{c(){qe(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,r){e=o;const i={};r[0]&1088&&(i.x=e[29][0]),r[0]&1088&&(i.y=e[29][1]),r[0]&8&&(i.scale=e[3]),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){de(t.$$.fragment,o),n=!1},d(o){je(t,o)}}}function Ul(e){let t,n,o,r=gt(e[5].polygons),i=[];for(let c=0;c<r.length;c+=1)i[c]=ii(Qr(e,r,c));const s=c=>de(i[c],1,1,()=>{i[c]=null});let a=e[6]!==void 0&&!e[7]&&si(vo(e));return{c(){for(let c=0;c<i.length;c+=1)i[c].c();t=Ce(),a&&a.c(),n=wn()},m(c,l){for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(c,l);Z(c,t,l),a&&a.m(c,l),Z(c,n,l),o=!0},p(c,l){if(l[0]&268763114){r=gt(c[5].polygons);let u;for(u=0;u<r.length;u+=1){const d=Qr(c,r,u);i[u]?(i[u].p(d,l),re(i[u],1)):(i[u]=ii(d),i[u].c(),re(i[u],1),i[u].m(t.parentNode,t))}for(Nt(),u=r.length;u<i.length;u+=1)s(u);Dt()}c[6]!==void 0&&!c[7]?a?(a.p(vo(c),l),l[0]&192&&re(a,1)):(a=si(vo(c)),a.c(),re(a,1),a.m(n.parentNode,n)):a&&(Nt(),de(a,1,1,()=>{a=null}),Dt())},i(c){if(!o){for(let l=0;l<r.length;l+=1)re(i[l]);re(a),o=!0}},o(c){i=i.filter(Boolean);for(let l=0;l<i.length;l+=1)de(i[l]);de(a),o=!1},d(c){c&&(J(t),J(n)),Qn(i,c),a&&a.d(c)}}}function Hl(e){let t,n;return t=new ur({props:{shape:e[0],transform:e[2],editor:e[16],svgEl:e[4],$$slots:{default:[Ul,({grab:o})=>({28:o}),({grab:o})=>[o?268435456:0]]},$$scope:{ctx:e}}}),t.$on("change",e[20]),t.$on("grab",e[21]),t.$on("release",e[22]),{c(){qe(t.$$.fragment)},m(o,r){De(t,o,r),n=!0},p(o,r){const i={};r[0]&1&&(i.shape=o[0]),r[0]&4&&(i.transform=o[2]),r[0]&16&&(i.svgEl=o[4]),r[0]&268437482|r[1]&128&&(i.$$scope={dirty:r,ctx:o}),t.$set(i)},i(o){n||(re(t.$$.fragment,o),n=!0)},o(o){de(t.$$.fragment,o),n=!1},d(o){je(t,o)}}}const Vl=250,Fl=1e3,hn=4.5;function Xl(e,t,n){let o,r,i;const s=lr();let{shape:a}=t,{computedStyle:c}=t,{transform:l}=t,{viewportScale:u=1}=t,{svgEl:d}=t,f,p=!1,y,h=[];const E=()=>n(7,p=!0),v=()=>n(7,p=!1),g=A=>{if(h.length>0||!r.some(j=>j.visible)){n(6,f=void 0);return}const[_,L]=l.elementToImage(A.offsetX,A.offsetY),C=j=>Math.pow(j[0]-_,2)+Math.pow(j[1]-L,2),H=al(o).reduce((j,D)=>C(D)<C(j)?D:j),w=r.filter(j=>j.visible).reduce((j,D)=>C(D.point)<C(j.point)?D:j),O=Math.pow(Fl/u,2);C(H)<O||C(w.point)<O?n(6,f=r.indexOf(w)):n(6,f=void 0)},m=()=>{document.activeElement!==d&&d.focus()},R=()=>{n(8,h=[]),m()},$=A=>{n(7,p=!0),A.preventDefault(),A.stopPropagation(),y=performance.now()},N=(A,_,L)=>C=>{if(!y||pt||performance.now()-y>Vl)return;const H=O=>O.polygon===A&&O.ring===_&&O.point===L,w=h.some(H);C.metaKey||C.ctrlKey||C.shiftKey?w?n(8,h=h.filter(O=>!H(O))):n(8,h=[...h,{polygon:A,ring:_,point:L}]):w&&h.length>1?n(8,h=[{polygon:A,ring:_,point:L}]):w?n(8,h=[]):n(8,h=[{polygon:A,ring:_,point:L}]),m()},I=(A,_,L)=>{m();const C=A.geometry.polygons;let H;if(_==="SHAPE")H=C.map(w=>{const O=w.rings.map((D,q)=>({points:D.points.map((F,K)=>[F[0]+L[0],F[1]+L[1]])})),j=ut(O[0].points);return{rings:O,bounds:j}});else{const[w,O,j,D]=_.split("-").map(q=>parseInt(q));H=C.map((q,F)=>{if(F===O){const K=q.rings.map((te,Ve)=>Ve===j?{points:te.points.map((be,We)=>We===D?[be[0]+L[0],be[1]+L[1]]:be)}:te),ae=ut(K[0].points);return{rings:K,bounds:ae}}else return q})}return{...A,geometry:{polygons:H,bounds:ho(H)}}},k=A=>async _=>{_.stopPropagation();const L=r[A],C=o.polygons.map((w,O)=>{if(O===L.elementIdx){const j=w.rings.map((q,F)=>F===L.ringIdx?{points:[...q.points.slice(0,L.pointIdx+1),L.point,...q.points.slice(L.pointIdx+1)]}:q),D=ut(j[0].points);return{rings:j,bounds:D}}else return w});s("change",{...a,geometry:{polygons:C,bounds:ho(C)}}),await ms();const H=[...document.querySelectorAll(".a9s-handle")][A+1];if(H!=null&&H.firstChild){const w=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:_.clientX,clientY:_.clientY,pointerId:_.pointerId,pointerType:_.pointerType,isPrimary:_.isPrimary,buttons:_.buttons});H.firstChild.dispatchEvent(w)}},P=()=>{const A=o.polygons.map((_,L)=>{if(h.some(C=>C.polygon===L)){const C=_.rings.map((w,O)=>{const j=h.filter(D=>D.polygon===L&&D.ring===O);return j.length&&w.points.length-j.length>=3?{points:w.points.filter((D,q)=>!j.some(F=>F.point===q))}:w}),H=ut(C[0].points);return{rings:C,bounds:H}}else return _});!zo(o.polygons,A)&&(s("change",{...a,geometry:{polygons:A,bounds:ho(A)}}),n(8,h=[]))};ps(()=>{if(pt)return;const A=_=>{(_.key==="Delete"||_.key==="Backspace")&&(_.preventDefault(),P())};return d.addEventListener("pointermove",g),d.addEventListener("keydown",A),()=>{d.removeEventListener("pointermove",g),d.removeEventListener("keydown",A)}});const U=`polygon-mask-${Math.random().toString(36).substring(2,12)}`,B=(A,_,L,{polygon:C,ring:H,point:w})=>C===A&&H===_&&w===L;function S(A){ye.call(this,e,A)}function T(A){ye.call(this,e,A)}function x(A){ye.call(this,e,A)}return e.$$set=A=>{"shape"in A&&n(0,a=A.shape),"computedStyle"in A&&n(1,c=A.computedStyle),"transform"in A&&n(2,l=A.transform),"viewportScale"in A&&n(3,u=A.viewportScale),"svgEl"in A&&n(4,d=A.svgEl)},e.$$.update=()=>{e.$$.dirty[0]&1&&n(5,o=a.geometry),e.$$.dirty[0]&40&&n(10,r=pt?[]:Bl(o,u)),e.$$.dirty[0]&40&&n(9,i=cr(o.bounds,hn/u))},[a,c,l,u,d,o,f,p,h,i,r,E,v,R,$,N,I,k,U,B,S,T,x]}class ql extends Ft{constructor(t){super(),Vt(this,t,Xl,Hl,Ht,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}ze.RECTANGLE,ze.POLYGON,ze.MULTIPOLYGON;typeof navigator>"u"||navigator.userAgent.indexOf("Mac OS X");const we=[];for(let e=0;e<256;++e)we.push((e+256).toString(16).slice(1));function Kl(e,t=0){return(we[e[t+0]]+we[e[t+1]]+we[e[t+2]]+we[e[t+3]]+"-"+we[e[t+4]]+we[e[t+5]]+"-"+we[e[t+6]]+we[e[t+7]]+"-"+we[e[t+8]]+we[e[t+9]]+"-"+we[e[t+10]]+we[e[t+11]]+we[e[t+12]]+we[e[t+13]]+we[e[t+14]]+we[e[t+15]]).toLowerCase()}let xo;const Yl=new Uint8Array(16);function Wl(){if(!xo){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");xo=crypto.getRandomValues.bind(crypto)}return xo(Yl)}const Gl=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ai={randomUUID:Gl};function zl(e,t,n){var o;if(ai.randomUUID&&!e)return ai.randomUUID();e=e||{};const r=e.random??((o=e.rng)==null?void 0:o.call(e))??Wl();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Kl(r)}const Np=(e,t,n,o)=>({id:zl(),annotation:typeof e=="string"?e:e.id,created:new Date,creator:o,...t});var ws=(e=>(e.BODY_ONLY="BODY_ONLY",e.TARGET_ONLY="TARGET_ONLY",e))(ws||{}),xs=(e=>(e.LOCAL="LOCAL",e.REMOTE="REMOTE",e.SILENT="SILENT",e))(xs||{});const Jl="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Ql=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=Jl[n[e]&63];return t};Ql();const Zl=[];for(let e=0;e<256;++e)Zl.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const ec="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let tc=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=ec[n[e]&63];return t};tc();const nc="not-annotatable",Es=`.${nc}`;typeof navigator<"u"&&/mac/i.test(navigator.userAgentData?navigator.userAgentData.platform:navigator.platform);const oc=e=>{const t=e.cloneContents();return t.querySelectorAll(Es).forEach(n=>n.remove()),t},rc=e=>e.every(t=>t.range instanceof Range&&!t.range.collapsed),ic=(e,t,n)=>{const o=document.createRange(),r=t;o.setStart(r,0),o.setEnd(e.startContainer,e.startOffset);const i=oc(o).textContent,s=e.toString(),a=i.length||0,c=a+s.length;return{quote:s,start:a,end:c,range:e}},sc=(e,t)=>{var n,o;const{start:r,end:i}=e,s=e.offsetReference||t,a=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,f=>{var p;return(p=f.parentElement)!=null&&p.closest(Es)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT});let c=0;const l=document.createRange();let u=a.nextNode();u===null&&console.error("Could not revive annotation target. Content missing.");let d=!s;for(;u!==null;){if(d||(d=typeof(s==null?void 0:s.contains)=="function"?s.contains(u):!1),d){const f=((n=u.textContent)==null?void 0:n.length)||0;if(c+f>r){l.setStart(u,r-c);break}c+=f}u=a.nextNode()}for(;u!==null;){const f=((o=u.textContent)==null?void 0:o.length)||0;if(c+f>=i){l.setEnd(u,i-c);break}c+=f,u=a.nextNode()}return{...e,range:l}},li=(e,t)=>rc(e.selector)?e:{...e,selector:e.selector.map(n=>n.range instanceof Range&&!n.range.collapsed?n:sc(n,t))},ac=[];for(let e=0;e<256;++e)ac.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const lc=[];for(let e=0;e<256;++e)lc.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const cc="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let uc=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=cc[n[e]&63];return t};uc();const Eo=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Ao(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on".concat(t),n)}function Jt(e,t,n,o){e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on".concat(t),n)}function As(e,t){const n=t.slice(0,t.length-1);for(let o=0;o<n.length;o++)n[o]=e[n[o].toLowerCase()];return n}function $s(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function dc(e,t){const n=e.length>=t.length?e:t,o=e.length>=t.length?t:e;let r=!0;for(let i=0;i<n.length;i++)o.indexOf(n[i])===-1&&(r=!1);return r}const gn={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":Eo?173:189,"=":Eo?61:187,";":Eo?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},Ke={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},en={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Ae={16:!1,18:!1,17:!1,91:!1},pe={};for(let e=1;e<20;e++)gn["f".concat(e)]=111+e;let le=[],ln=null,Rs="all";const tt=new Map,qt=e=>gn[e.toLowerCase()]||Ke[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),fc=e=>Object.keys(gn).find(t=>gn[t]===e),pc=e=>Object.keys(Ke).find(t=>Ke[t]===e);function Ss(e){Rs=e||"all"}function mn(){return Rs||"all"}function hc(){return le.slice(0)}function gc(){return le.map(e=>fc(e)||pc(e)||String.fromCharCode(e))}function mc(){const e=[];return Object.keys(pe).forEach(t=>{pe[t].forEach(n=>{let{key:o,scope:r,mods:i,shortcut:s}=n;e.push({scope:r,shortcut:s,mods:i,keys:o.split("+").map(a=>qt(a))})})}),e}function yc(e){const t=e.target||e.srcElement,{tagName:n}=t;let o=!0;const r=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(r||n==="TEXTAREA"||n==="SELECT")&&!t.readOnly)&&(o=!1),o}function vc(e){return typeof e=="string"&&(e=qt(e)),le.indexOf(e)!==-1}function bc(e,t){let n,o;e||(e=mn());for(const r in pe)if(Object.prototype.hasOwnProperty.call(pe,r))for(n=pe[r],o=0;o<n.length;)n[o].scope===e?n.splice(o,1).forEach(i=>{let{element:s}=i;return dr(s)}):o++;mn()===e&&Ss(t||"all")}function wc(e){let t=e.keyCode||e.which||e.charCode;e.key&&e.key.toLowerCase()==="capslock"&&(t=qt(e.key));const n=le.indexOf(t);if(n>=0&&le.splice(n,1),e.key&&e.key.toLowerCase()==="meta"&&le.splice(0,le.length),(t===93||t===224)&&(t=91),t in Ae){Ae[t]=!1;for(const o in Ke)Ke[o]===t&&(dt[o]=!1)}}function Ts(e){if(typeof e>"u")Object.keys(pe).forEach(r=>{Array.isArray(pe[r])&&pe[r].forEach(i=>$n(i)),delete pe[r]}),dr(null);else if(Array.isArray(e))e.forEach(r=>{r.key&&$n(r)});else if(typeof e=="object")e.key&&$n(e);else if(typeof e=="string"){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];let[r,i]=n;typeof r=="function"&&(i=r,r=""),$n({key:e,scope:r,method:i,splitKey:"+"})}}const $n=e=>{let{key:t,scope:n,method:o,splitKey:r="+"}=e;$s(t).forEach(i=>{const s=i.split(r),a=s.length,c=s[a-1],l=c==="*"?"*":qt(c);if(!pe[l])return;n||(n=mn());const u=a>1?As(Ke,s):[],d=[];pe[l]=pe[l].filter(f=>{const p=(o?f.method===o:!0)&&f.scope===n&&dc(f.mods,u);return p&&d.push(f.element),!p}),d.forEach(f=>dr(f))})};function ci(e,t,n,o){if(t.element!==o)return;let r;if(t.scope===n||t.scope==="all"){r=t.mods.length>0;for(const i in Ae)Object.prototype.hasOwnProperty.call(Ae,i)&&(!Ae[i]&&t.mods.indexOf(+i)>-1||Ae[i]&&t.mods.indexOf(+i)===-1)&&(r=!1);(t.mods.length===0&&!Ae[16]&&!Ae[18]&&!Ae[17]&&!Ae[91]||r||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(le),t.method(e,t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function ui(e,t){const n=pe["*"];let o=e.keyCode||e.which||e.charCode;if(e.key&&e.key.toLowerCase()==="capslock"||!dt.filter.call(this,e))return;if((o===93||o===224)&&(o=91),le.indexOf(o)===-1&&o!==229&&le.push(o),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const c=en[a];e[a]&&le.indexOf(c)===-1?le.push(c):!e[a]&&le.indexOf(c)>-1?le.splice(le.indexOf(c),1):a==="metaKey"&&e[a]&&(le=le.filter(l=>l in en||l===o))}),o in Ae){Ae[o]=!0;for(const a in Ke)if(Object.prototype.hasOwnProperty.call(Ke,a)){const c=en[Ke[a]];dt[a]=e[c]}if(!n)return}for(const a in Ae)Object.prototype.hasOwnProperty.call(Ae,a)&&(Ae[a]=e[en[a]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(le.indexOf(17)===-1&&le.push(17),le.indexOf(18)===-1&&le.push(18),Ae[17]=!0,Ae[18]=!0);const r=mn();if(n)for(let a=0;a<n.length;a++)n[a].scope===r&&(e.type==="keydown"&&n[a].keydown||e.type==="keyup"&&n[a].keyup)&&ci(e,n[a],r,t);if(!(o in pe))return;const i=pe[o],s=i.length;for(let a=0;a<s;a++)if((e.type==="keydown"&&i[a].keydown||e.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,u=c.key.split(l),d=[];for(let f=0;f<u.length;f++)d.push(qt(u[f]));d.sort().join("")===le.sort().join("")&&ci(e,c,r,t)}}function dt(e,t,n){le=[];const o=$s(e);let r=[],i="all",s=document,a=0,c=!1,l=!0,u="+",d=!1,f=!1;for(n===void 0&&typeof t=="function"&&(n=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(i=t.scope),t.element&&(s=t.element),t.keyup&&(c=t.keyup),t.keydown!==void 0&&(l=t.keydown),t.capture!==void 0&&(d=t.capture),typeof t.splitKey=="string"&&(u=t.splitKey),t.single===!0&&(f=!0)),typeof t=="string"&&(i=t),f&&Ts(e,i);a<o.length;a++)e=o[a].split(u),r=[],e.length>1&&(r=As(Ke,e)),e=e[e.length-1],e=e==="*"?"*":qt(e),e in pe||(pe[e]=[]),pe[e].push({keyup:c,keydown:l,scope:i,mods:r,shortcut:o[a],method:n,key:o[a],splitKey:u,element:s});if(typeof s<"u"&&window){if(!tt.has(s)){const p=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return ui(h,s)},y=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;ui(h,s),wc(h)};tt.set(s,{keydownListener:p,keyupListenr:y,capture:d}),Ao(s,"keydown",p,d),Ao(s,"keyup",y,d)}if(!ln){const p=()=>{le=[]};ln={listener:p,capture:d},Ao(window,"focus",p,d)}}}function xc(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(pe).forEach(n=>{pe[n].filter(o=>o.scope===t&&o.shortcut===e).forEach(o=>{o&&o.method&&o.method()})})}function dr(e){const t=Object.values(pe).flat();if(t.findIndex(n=>{let{element:o}=n;return o===e})<0){const{keydownListener:n,keyupListenr:o,capture:r}=tt.get(e)||{};n&&o&&(Jt(e,"keyup",o,r),Jt(e,"keydown",n,r),tt.delete(e))}if((t.length<=0||tt.size<=0)&&(Object.keys(tt).forEach(n=>{const{keydownListener:o,keyupListenr:r,capture:i}=tt.get(n)||{};o&&r&&(Jt(n,"keyup",r,i),Jt(n,"keydown",o,i),tt.delete(n))}),tt.clear(),Object.keys(pe).forEach(n=>delete pe[n]),ln)){const{listener:n,capture:o}=ln;Jt(window,"focus",n,o),ln=null}}const $o={getPressedKeyString:gc,setScope:Ss,getScope:mn,deleteScope:bc,getPressedKeyCodes:hc,getAllKeyCodes:mc,isPressed:vc,filter:yc,trigger:xc,unbind:Ts,keyMap:gn,modifier:Ke,modifierMap:en};for(const e in $o)Object.prototype.hasOwnProperty.call($o,e)&&(dt[e]=$o[e]);if(typeof window<"u"){const e=window.hotkeys;dt.noConflict=t=>(t&&window.hotkeys===dt&&(window.hotkeys=e),dt),window.hotkeys=dt}const Ec=(e,t,n)=>{let o=e,r=n;const i=document.createNodeIterator(t,NodeFilter.SHOW_TEXT);let s=i.nextNode(),a=!0;do s instanceof Text&&(s.length<r?r-=s.length:(o=s,a=!1)),s=i.nextNode();while(s&&a);return{node:o,offset:r}},Jo=(e,t=[])=>{let n,o,r;if(e.nodeType===Node.ELEMENT_NODE&&e.hasAttribute("xml:id")?t.push("/"):e.parentNode&&(t=Jo(e.parentNode,t)),e.nodeType===Node.ELEMENT_NODE&&e.nodeName.toLowerCase().startsWith("tei-")){const i=e;i.hasAttribute("xml:id")?r=`[@xml:id='${i.getAttribute("xml:id")}']`:(n=`count(preceding-sibling::${i.localName})`,o=document.evaluate(n,e,null,XPathResult.NUMBER_TYPE,null).numberValue+1,r=`[${o}]`),t.push("/"),t.push(i.getAttribute("data-origname")+r)}return t},Ac=(e,t,n)=>{const o=l=>l?l.nodeName.toLowerCase().indexOf("tei-")===0?l:o(l.parentNode):null,r=(l,u,d)=>{const f=document.createRange();return f.setStart(l,0),f.setEnd(u,d),f.toString().length},i=r(o(n.startContainer),n.startContainer,n.startOffset),s=r(o(n.endContainer),n.endContainer,n.endOffset),a=e.join("")+"::"+i,c=t.join("")+"::"+s;return{start:a,end:c}},$c=e=>{var t;const{range:n}=e,o=Jo(n.startContainer),r=Jo(n.endContainer),{start:i,end:s}=Ac(o,r,n);return{start:e.start,startSelector:{type:"XPathSelector",value:i},end:e.end,endSelector:{type:"XPathSelector",value:s},quote:(t=e.quote)==null?void 0:t.replace(/\s+/g," "),range:n}},Rc=(e,t)=>{var n,o;const r=Array.isArray(e.selector)?e.selector[0]:e.selector;if("start"in r&&"end"in r)return li(e,t);{const i=(n=r.startSelector)==null?void 0:n.value,s=(o=r.endSelector)==null?void 0:o.value;if(!i||!s)throw console.error(e),"Could not revive TEI target.";const a=v=>{const g=v.indexOf("::");if(g<0)return;const m=v.substring(0,g).replace(/\/([^[/]+)/g,(N,I)=>"/tei-"+I.toLowerCase()).replace(/xml:/g,""),R=document.evaluate("."+m,t,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,$=parseInt(v.substring(g+2));return[R,$]},[c,l]=a(i),[u,d]=a(s),f=document.createRange(),p=(v,g)=>v.firstChild instanceof Text&&v.firstChild.length>=g?{node:v.firstChild,offset:g}:Ec(v.firstChild,v,g),y=p(c,l);f.setStart(y.node,y.offset);const h=p(u,d);f.setEnd(h.node,h.offset);const E=ic(f,t);return li({...e,selector:[{...E,...r,range:f}]},t)}},Cs=e=>t=>{const n=Rc(t,e);return{...t,selector:n.selector.map($c)}},Sc=e=>t=>({...t,target:Cs(e)(t.target)}),Tc=e=>{const t=e.element,n=Sc(t),o=Cs(t),r=e.state.store,i=r.addAnnotation;r.addAnnotation=(l,u)=>{const{selector:d}=l.target;try{return"startSelector"in d&&"start"in d?i(l,u):i(n(l),u)}catch(f){console.warn(f),console.warn("Failed to render annotation",l)}};const s=r.bulkAddAnnotations;r.bulkAddAnnotations=(l,u=!0,d)=>{const f=l.map(y=>{const{selector:h}=y.target;try{return"startSelector"in h&&"start"in h?y:n(y)}catch(E){console.warn(E)}}),p=f.filter(Boolean);return f.length!==p.length&&(console.warn(`Failed to render ${f.length-p.length} annotations.`),f.forEach((y,h)=>{y||console.warn(l[h])})),s(p,u,d)};const a=r.updateAnnotation;r.updateAnnotation=(l,u)=>a(n(l),u);const c=r.updateTarget;return r.updateTarget=(l,u)=>c(o(l),u),{...e,state:{...e.state,store:r}}},fr="not-annotatable",jt=`.${fr}`,tn=(e,t)=>{var n;return e.contains(t)?!!(t instanceof HTMLElement?t.closest(jt):(n=t.parentElement)!=null&&n.closest(jt)):!0},Cc=(e,t)=>{const n=t.commonAncestorContainer;return!tn(e,n)},Oc=e=>e.addEventListener("click",t=>{!t.target.closest(jt)&&!t.target.closest("a")&&t.preventDefault()}),Ro=e=>({...e,type:e.type,x:e.x,y:e.y,clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY,screenX:e.screenX,screenY:e.screenY,isPrimary:e.isPrimary,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,button:e.button,buttons:e.buttons,currentTarget:e.currentTarget,target:e.target,defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,pointerId:e.pointerId,pointerType:e.pointerType,timeStamp:e.timeStamp}),Rn=e=>({...e,type:e.type,key:e.key,code:e.code,location:e.location,repeat:e.repeat,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,currentTarget:e.currentTarget,target:e.target,defaultPrevented:e.defaultPrevented,detail:e.detail,timeStamp:e.timeStamp}),kc=typeof navigator<"u"&&/mac/i.test(navigator.userAgentData?navigator.userAgentData.platform:navigator.platform),Lc=e=>{!e.hasAttribute("tabindex")&&e.tabIndex<0&&e.setAttribute("tabindex","-1"),e.classList.add("no-focus-outline")},Hn=(e,t=10)=>{let n;return((...o)=>{clearTimeout(n),n=setTimeout(()=>e.apply(void 0,o),t)})},_c=function*(e){const t=document.createNodeIterator(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT,o=>o instanceof HTMLElement&&o.classList.contains(fr)&&!o.parentElement.closest(jt)&&e.intersectsNode(o)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP);let n;for(;n=t.nextNode();)n instanceof HTMLElement&&(yield n)},Mc=(e,t)=>{if(!Cc(e,t))return[];const n=[];let o=null;for(const r of _c(t)){let i;o?(i=document.createRange(),i.setStartAfter(o),i.setEndBefore(r)):(i=t.cloneRange(),i.setEndBefore(r)),i.collapsed||n.push(i),o=r}if(o){const r=t.cloneRange();r.setStartAfter(o),r.collapsed||n.push(r)}return n.length>0?n:[t]},Ic=e=>{const t=e.cloneContents();return t.querySelectorAll(jt).forEach(n=>n.remove()),t},ot=e=>e.every(t=>t.range instanceof Range&&!t.range.collapsed),Pc=/^\s*$/,Nc=e=>Pc.test(e.toString()),Dc=(e,t)=>{const n=i=>Math.round(i*10)/10,o={top:n(e.top),bottom:n(e.bottom),left:n(e.left),right:n(e.right)},r={top:n(t.top),bottom:n(t.bottom),left:n(t.left),right:n(t.right)};if(Math.abs(o.top-r.top)<.5&&Math.abs(o.bottom-r.bottom)<.5){if(Math.abs(o.left-r.right)<.5||Math.abs(o.right-r.left)<.5)return"inline-adjacent";if(o.left>=r.left&&o.right<=r.right)return"inline-is-contained";if(o.left<=r.left&&o.right>=r.right)return"inline-contains"}else if(o.top<=r.top&&o.bottom>=r.bottom){if(o.left<=r.left&&o.right>=r.right)return"block-contains"}else if(o.top>=r.top&&o.bottom<=r.bottom&&o.left>=r.left&&o.right<=r.right)return"block-is-contained"},jc=(e,t)=>{const n=Math.min(e.left,t.left),o=Math.max(e.right,t.right),r=Math.min(e.top,t.top),i=Math.max(e.bottom,t.bottom);return new DOMRect(n,r,o-n,i-r)},Bc=e=>e.reduce((t,n)=>{if(n.width===0||n.height===0)return t;let o=[...t],r=!1;for(const i of t){const s=Dc(n,i);if(s==="inline-adjacent"){o=o.map(a=>a===i?jc(n,i):a),r=!0;break}else if(s==="inline-contains"){o=o.map(a=>a===i?n:a),r=!0;break}else if(s==="inline-is-contained"){r=!0;break}else if(s==="block-contains"||s==="block-is-contained"){n.width<i.width&&(o=o.map(a=>a===i?n:a)),r=!0;break}}return r?o:[...o,n]},[]),Uc=e=>({length:e.length,item:t=>e[t],[Symbol.iterator]:function*(){for(let t=0;t<this.length;t++)yield this.item(t)}}),Hc=(e,t,n)=>{const o=document.createRange(),r=n?e.startContainer.parentElement.closest(n):t;o.setStart(r,0),o.setEnd(e.startContainer,e.startOffset);const i=Ic(o).textContent,s=e.toString(),a=i.length||0,c=a+s.length;return n?{quote:s,start:a,end:c,range:e,offsetReference:r}:{quote:s,start:a,end:c,range:e}},Os=(e,t)=>{var n,o;const{start:r,end:i}=e,s=e.offsetReference||t,a=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,f=>{var p;return(p=f.parentElement)!=null&&p.closest(jt)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT});let c=0;const l=document.createRange();let u=a.nextNode();u===null&&console.error("Could not revive annotation target. Content missing.");let d=!s;for(;u!==null;){if(d||(d=typeof(s==null?void 0:s.contains)=="function"?s.contains(u):!1),d){const f=((n=u.textContent)==null?void 0:n.length)||0;if(c+f>r){l.setStart(u,r-c);break}c+=f}u=a.nextNode()}for(;u!==null;){const f=((o=u.textContent)==null?void 0:o.length)||0;if(c+f>=i){l.setEnd(u,i-c);break}c+=f,u=a.nextNode()}return{...e,range:l}},Vn=(e,t)=>ot(e.selector)?e:{...e,selector:e.selector.map(n=>n.range instanceof Range&&!n.range.collapsed?n:Os(n,t))},So=(e,t)=>ot(e.target.selector)?e:{...e,target:Vn(e.target,t)},Vc=(e,t)=>{const n=e.cloneRange();return t.contains(n.startContainer)||n.setStart(t,0),t.contains(n.endContainer)||n.setEnd(t,t.childNodes.length),n},ks=e=>{if(e===null)return document.scrollingElement;const{overflowY:t}=window.getComputedStyle(e);return t!=="visible"&&t!=="hidden"&&e.scrollHeight>e.clientHeight?e:ks(e.parentElement)},Fc=(e,t)=>n=>{const o=typeof n=="string"?n:n.id,r=u=>{const d=i.getBoundingClientRect(),f=i.clientHeight,p=i.clientWidth,y=u.selector[0].range.getBoundingClientRect(),{width:h,height:E}=t.getAnnotationBounds(o),v=y.top-d.top,g=y.left-d.left,m=i.parentElement?i.scrollTop:0,R=i.parentElement?i.scrollLeft:0,$=v+m-(f-E)/2,N=g+R-(p-h)/2;i.scroll({top:$,left:N,behavior:"smooth"})},i=ks(e);if(!i)return console.warn(`The scroll parent is missing for the annotation: ${o}`,{container:e}),!1;const s=t.getAnnotation(o);if(!s)return console.warn(`The annotation is missing in the store: ${o}`),!1;const{range:a}=s.target.selector[0];if(a&&!a.collapsed)return r(s.target),!0;const c=Vn(s.target,e),{range:l}=c.selector[0];return l&&!l.collapsed?(r(c),!0):!1},mt={fill:"rgb(0, 128, 255)",fillOpacity:.18},Fn={fill:"rgb(0, 128, 255)",fillOpacity:.45},Xc=(e,t,n,o,r)=>{var i,s;const a=n?typeof n=="function"?n(e.annotation,e.state,r)||((i=e.state)!=null&&i.selected?Fn:mt):n:(s=e.state)!=null&&s.selected?Fn:mt;return o&&o.paint(e,t)||a},qc=e=>{const{top:t,left:n}=e.getBoundingClientRect(),{innerWidth:o,innerHeight:r}=window,i=-n,s=-t,a=o-n,c=r-t;return{top:t,left:n,minX:i,minY:s,maxX:a,maxY:c}},Kc=e=>{let t=new Set;return n=>{const o=n.map(r=>r.id);(t.size!==o.length||o.some(r=>!t.has(r)))&&e.set(o),t=new Set(o)}},pr=(e,t,n,o)=>{const{store:r,selection:i,hover:s}=t;let a,c,l;const u=Kc(n),d=k=>{const{x:P,y:U}=e.getBoundingClientRect(),B=r.getAt(k.clientX-P,k.clientY-U,!1,c);B?s.current!==B.id&&(e.classList.add("hovered"),s.set(B.id)):s.current&&(e.classList.remove("hovered"),s.set(null))};e.addEventListener("pointermove",d);const f=(k=!1)=>{l&&l.clear();const P=qc(e),{minX:U,minY:B,maxX:S,maxY:T}=P,x=c?r.getIntersecting(U,B,S,T).filter(({annotation:L})=>c(L)):r.getIntersecting(U,B,S,T),A=i.selected.map(({id:L})=>L),_=x.map(({annotation:L,rects:C})=>{const H=A.includes(L.id),w=L.id===s.current;return{annotation:L,rects:C,state:{selected:H,hovered:w}}});o.redraw(_,P,a,l,k),setTimeout(()=>u(x.map(({annotation:L})=>L)),1)},p=k=>{l=k,f()},y=k=>{a=k,f()},h=k=>{c=k,f(!1)},E=()=>f();r.observe(E);const v=i.subscribe(()=>f()),g=s.subscribe(()=>f()),m=()=>f(!0);document.addEventListener("scroll",m,{capture:!0,passive:!0});const R=Hn(()=>{r.recalculatePositions(),l&&l.reset(),f()});window.addEventListener("resize",R);const $=new ResizeObserver(R);$.observe(e);const N={attributes:!0,childList:!0,subtree:!0},I=new MutationObserver(Hn(k=>{k.every(P=>P.target===e||e.contains(P.target))||f(!0)},150));return I.observe(document.body,N),{destroy:()=>{e.removeEventListener("pointermove",d),o.destroy(),r.unobserve(E),v(),g(),document.removeEventListener("scroll",m),window.removeEventListener("resize",R),$.disconnect(),I.disconnect()},redraw:f,setStyle:y,setFilter:h,setPainter:p,setVisible:o.setVisible}},Yc=()=>{const e=document.createElement("canvas");return e.width=window.innerWidth,e.height=window.innerHeight,e.className="r6o-canvas-highlight-layer bg",e},Wc=(e,t)=>{e.width=window.innerWidth,e.height=window.innerHeight},Gc=e=>{e.classList.add("r6o-annotatable");const t=Yc(),n=t.getContext("2d");document.body.appendChild(t);const o=(i,s,a,c)=>requestAnimationFrame(()=>{const{width:l,height:u}=t;n.clearRect(-.5,-.5,l+1,u+1),c&&c.clear();const{top:d,left:f}=s;[...i].sort((p,y)=>{const{annotation:{target:{created:h}}}=p,{annotation:{target:{created:E}}}=y;return h.getTime()-E.getTime()}).forEach(p=>{var y;const h=a?typeof a=="function"?a(p.annotation,p.state):a:(y=p.state)!=null&&y.selected?Fn:mt,E=c&&c.paint(p,s)||h,v=p.rects.map(({x:g,y:m,width:R,height:$})=>({x:g+f,y:m+d,width:R,height:$}));if(n.fillStyle=E.fill,n.globalAlpha=E.fillOpacity||1,v.forEach(({x:g,y:m,width:R,height:$})=>n.fillRect(g,m,R,$)),E.underlineColor){n.globalAlpha=1,n.strokeStyle=E.underlineColor,n.lineWidth=E.underlineThickness??1;const g=E.underlineOffset??0;v.forEach(({x:m,y:R,width:$,height:N})=>{n.beginPath(),n.moveTo(m,R+N+g),n.lineTo(m+$,R+N+g),n.stroke()})}})}),r=Hn(()=>{Wc(t)});return window.addEventListener("resize",r),{destroy:()=>{t.remove(),window.removeEventListener("resize",r)},setVisible:i=>{console.log("setVisible not implemented on Canvas renderer")},redraw:o}},zc=(e,t,n)=>pr(e,t,n,Gc(e));var Jc={grad:.9,turn:360,rad:360/(2*Math.PI)},et=function(e){return typeof e=="string"?e.length>0:typeof e=="number"},ve=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=Math.pow(10,t)),Math.round(n*e)/n+0},Be=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1),e>n?n:e>t?e:t},Ls=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},di=function(e){return{r:Be(e.r,0,255),g:Be(e.g,0,255),b:Be(e.b,0,255),a:Be(e.a)}},To=function(e){return{r:ve(e.r),g:ve(e.g),b:ve(e.b),a:ve(e.a,3)}},Qc=/^#([0-9a-f]{3,8})$/i,Sn=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},_s=function(e){var t=e.r,n=e.g,o=e.b,r=e.a,i=Math.max(t,n,o),s=i-Math.min(t,n,o),a=s?i===t?(n-o)/s:i===n?2+(o-t)/s:4+(t-n)/s:0;return{h:60*(a<0?a+6:a),s:i?s/i*100:0,v:i/255*100,a:r}},Ms=function(e){var t=e.h,n=e.s,o=e.v,r=e.a;t=t/360*6,n/=100,o/=100;var i=Math.floor(t),s=o*(1-n),a=o*(1-(t-i)*n),c=o*(1-(1-t+i)*n),l=i%6;return{r:255*[o,a,s,s,c,o][l],g:255*[c,o,o,a,s,s][l],b:255*[s,s,c,o,o,a][l],a:r}},fi=function(e){return{h:Ls(e.h),s:Be(e.s,0,100),l:Be(e.l,0,100),a:Be(e.a)}},pi=function(e){return{h:ve(e.h),s:ve(e.s),l:ve(e.l),a:ve(e.a,3)}},hi=function(e){return Ms((n=(t=e).s,{h:t.h,s:(n*=((o=t.l)<50?o:100-o)/100)>0?2*n/(o+n)*100:0,v:o+n,a:t.a}));var t,n,o},cn=function(e){return{h:(t=_s(e)).h,s:(r=(200-(n=t.s))*(o=t.v)/100)>0&&r<200?n*o/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,n,o,r},Zc=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,eu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,tu=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,nu=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,gi={string:[[function(e){var t=Qc.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?ve(parseInt(e[3]+e[3],16)/255,2):1}:e.length===6||e.length===8?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:e.length===8?ve(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=tu.exec(e)||nu.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:di({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=Zc.exec(e)||eu.exec(e);if(!t)return null;var n,o,r=fi({h:(n=t[1],o=t[2],o===void 0&&(o="deg"),Number(n)*(Jc[o]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return hi(r)},"hsl"]],object:[[function(e){var t=e.r,n=e.g,o=e.b,r=e.a,i=r===void 0?1:r;return et(t)&&et(n)&&et(o)?di({r:Number(t),g:Number(n),b:Number(o),a:Number(i)}):null},"rgb"],[function(e){var t=e.h,n=e.s,o=e.l,r=e.a,i=r===void 0?1:r;if(!et(t)||!et(n)||!et(o))return null;var s=fi({h:Number(t),s:Number(n),l:Number(o),a:Number(i)});return hi(s)},"hsl"],[function(e){var t=e.h,n=e.s,o=e.v,r=e.a,i=r===void 0?1:r;if(!et(t)||!et(n)||!et(o))return null;var s=(function(a){return{h:Ls(a.h),s:Be(a.s,0,100),v:Be(a.v,0,100),a:Be(a.a)}})({h:Number(t),s:Number(n),v:Number(o),a:Number(i)});return Ms(s)},"hsv"]]},mi=function(e,t){for(var n=0;n<t.length;n++){var o=t[n][0](e);if(o)return[o,t[n][1]]}return[null,void 0]},ou=function(e){return typeof e=="string"?mi(e.trim(),gi.string):typeof e=="object"&&e!==null?mi(e,gi.object):[null,void 0]},Co=function(e,t){var n=cn(e);return{h:n.h,s:Be(n.s+100*t,0,100),l:n.l,a:n.a}},Oo=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},yi=function(e,t){var n=cn(e);return{h:n.h,s:n.s,l:Be(n.l+100*t,0,100),a:n.a}},vi=(function(){function e(t){this.parsed=ou(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return this.parsed!==null},e.prototype.brightness=function(){return ve(Oo(this.rgba),2)},e.prototype.isDark=function(){return Oo(this.rgba)<.5},e.prototype.isLight=function(){return Oo(this.rgba)>=.5},e.prototype.toHex=function(){return t=To(this.rgba),n=t.r,o=t.g,r=t.b,s=(i=t.a)<1?Sn(ve(255*i)):"","#"+Sn(n)+Sn(o)+Sn(r)+s;var t,n,o,r,i,s},e.prototype.toRgb=function(){return To(this.rgba)},e.prototype.toRgbString=function(){return t=To(this.rgba),n=t.r,o=t.g,r=t.b,(i=t.a)<1?"rgba("+n+", "+o+", "+r+", "+i+")":"rgb("+n+", "+o+", "+r+")";var t,n,o,r,i},e.prototype.toHsl=function(){return pi(cn(this.rgba))},e.prototype.toHslString=function(){return t=pi(cn(this.rgba)),n=t.h,o=t.s,r=t.l,(i=t.a)<1?"hsla("+n+", "+o+"%, "+r+"%, "+i+")":"hsl("+n+", "+o+"%, "+r+"%)";var t,n,o,r,i},e.prototype.toHsv=function(){return t=_s(this.rgba),{h:ve(t.h),s:ve(t.s),v:ve(t.v),a:ve(t.a,3)};var t},e.prototype.invert=function(){return Fe({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},e.prototype.saturate=function(t){return t===void 0&&(t=.1),Fe(Co(this.rgba,t))},e.prototype.desaturate=function(t){return t===void 0&&(t=.1),Fe(Co(this.rgba,-t))},e.prototype.grayscale=function(){return Fe(Co(this.rgba,-1))},e.prototype.lighten=function(t){return t===void 0&&(t=.1),Fe(yi(this.rgba,t))},e.prototype.darken=function(t){return t===void 0&&(t=.1),Fe(yi(this.rgba,-t))},e.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},e.prototype.alpha=function(t){return typeof t=="number"?Fe({r:(n=this.rgba).r,g:n.g,b:n.b,a:t}):ve(this.rgba.a,3);var n},e.prototype.hue=function(t){var n=cn(this.rgba);return typeof t=="number"?Fe({h:t,s:n.s,l:n.l,a:n.a}):ve(n.h)},e.prototype.isEqual=function(t){return this.toHex()===Fe(t).toHex()},e})(),Fe=function(e){return e instanceof vi?e:new vi(e)};const ru=e=>[`background-color:${Fe((e==null?void 0:e.fill)||mt.fill).alpha((e==null?void 0:e.fillOpacity)===void 0?mt.fillOpacity:e.fillOpacity).toHex()}`,e!=null&&e.underlineThickness?"text-decoration:underline":void 0,e!=null&&e.underlineColor?`text-decoration-color:${e.underlineColor}`:void 0,e!=null&&e.underlineOffset?`text-underline-offset:${e.underlineOffset}px`:void 0,e!=null&&e.underlineThickness?`text-decoration-thickness:${e.underlineThickness}px`:void 0].filter(Boolean).join(";"),iu=()=>{const e=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(e);let t=new Set;return{destroy:()=>{CSS.highlights.clear(),e.remove()},setVisible:n=>{console.log("setVisible not implemented on CSS Custom Highlights renderer")},redraw:(n,o,r,i)=>{i&&i.clear();const s=new Set(n.map(c=>c.annotation.id));Array.from(t).filter(c=>!s.has(c));const a=n.map(c=>{var l;const u=r?typeof r=="function"?r(c.annotation,c.state):r:(l=c.state)!=null&&l.selected?Fn:mt,d=i&&i.paint(c,o)||u;return`::highlight(_${c.annotation.id}) { ${ru(d)} }`});e.innerHTML=a.join(`
`),CSS.highlights.clear(),n.forEach(({annotation:c})=>{const l=c.target.selector.map(d=>d.range),u=new Highlight(...l);CSS.highlights.set(`_${c.id}`,u)}),t=s}}},su=(e,t,n)=>pr(e,t,n,iu());var bi=Object.prototype.hasOwnProperty;function Qo(e,t){var n,o;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((o=e.length)===t.length)for(;o--&&Qo(e[o],t[o]););return o===-1}if(!n||typeof e=="object"){o=0;for(n in e)if(bi.call(e,n)&&++o&&!bi.call(t,n)||!(n in t)||!Qo(e[n],t[n]))return!1;return Object.keys(t).length===o}}return e!==e&&t!==t}const au=(e,t)=>{const n=(i,s)=>i.x<=s.x+s.width&&i.x+i.width>=s.x&&i.y<=s.y+s.height&&i.y+i.height>=s.y,o=i=>i.rects.reduce((s,a)=>s+a.width,0),r=t.filter(({rects:i})=>i.some(s=>n(e,s)));return r.sort((i,s)=>o(s)-o(i)),r.findIndex(i=>i.rects.includes(e))},lu=e=>{e.classList.add("r6o-annotatable");const t=document.createElement("div");t.className="r6o-span-highlight-layer",e.insertBefore(t,e.firstChild);let n=[];return{destroy:()=>{t.remove()},redraw:(o,r,i,s,a)=>{const c=!(Qo(n,o)&&a);!s&&!c||(c&&(t.innerHTML=""),[...o].sort((l,u)=>{const{annotation:{target:{created:d}}}=l,{annotation:{target:{created:f}}}=u;return d&&f?d.getTime()-f.getTime():0}).forEach(l=>{l.rects.map(u=>{const d=au(u,o),f=Xc(l,r,i,s,d);if(c){const p=document.createElement("span");p.className="r6o-annotation",p.dataset.annotation=l.annotation.id,p.style.left=`${u.x}px`,p.style.top=`${u.y}px`,p.style.width=`${u.width}px`,p.style.height=`${u.height}px`,p.style.backgroundColor=Fe((f==null?void 0:f.fill)||mt.fill).alpha((f==null?void 0:f.fillOpacity)===void 0?mt.fillOpacity:f.fillOpacity).toHex(),f.underlineStyle&&(p.style.borderStyle=f.underlineStyle),f.underlineColor&&(p.style.borderColor=f.underlineColor),f.underlineThickness&&(p.style.borderBottomWidth=`${f.underlineThickness}px`),f.underlineOffset&&(p.style.paddingBottom=`${f.underlineOffset}px`),t.appendChild(p)}})}),n=o)},setVisible:o=>{o?t.classList.remove("hidden"):t.classList.add("hidden")}}},cu=(e,t,n)=>pr(e,t,n,lu(e)),xe=[];for(let e=0;e<256;++e)xe.push((e+256).toString(16).slice(1));function uu(e,t=0){return(xe[e[t+0]]+xe[e[t+1]]+xe[e[t+2]]+xe[e[t+3]]+"-"+xe[e[t+4]]+xe[e[t+5]]+"-"+xe[e[t+6]]+xe[e[t+7]]+"-"+xe[e[t+8]]+xe[e[t+9]]+"-"+xe[e[t+10]]+xe[e[t+11]]+xe[e[t+12]]+xe[e[t+13]]+xe[e[t+14]]+xe[e[t+15]]).toLowerCase()}let ko;const du=new Uint8Array(16);function fu(){if(!ko){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ko=crypto.getRandomValues.bind(crypto)}return ko(du)}const pu=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),wi={randomUUID:pu};function hu(e,t,n){var o;if(wi.randomUUID&&!e)return wi.randomUUID();e=e||{};const r=e.random??((o=e.rng)==null?void 0:o.call(e))??fu();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,uu(r)}var xi=Object.prototype.hasOwnProperty;function xt(e,t){var n,o;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((o=e.length)===t.length)for(;o--&&xt(e[o],t[o]););return o===-1}if(!n||typeof e=="object"){o=0;for(n in e)if(xi.call(e,n)&&++o&&!xi.call(t,n)||!(n in t)||!xt(e[n],t[n]))return!1;return Object.keys(t).length===o}}return e!==e&&t!==t}function Lo(){}function gu(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}const Rt=[];function hr(e,t=Lo){let n;const o=new Set;function r(a){if(gu(e,a)&&(e=a,n)){const c=!Rt.length;for(const l of o)l[1](),Rt.push(l,e);if(c){for(let l=0;l<Rt.length;l+=2)Rt[l][0](Rt[l+1]);Rt.length=0}}}function i(a){r(a(e))}function s(a,c=Lo){const l=[a,c];return o.add(l),o.size===1&&(n=t(r,i)||Lo),a(e),()=>{o.delete(l),o.size===0&&n&&(n(),n=null)}}return{set:r,update:i,subscribe:s}}const mu=e=>{const{subscribe:t,set:n}=hr();let o;return t(r=>o=r),e.observe(({changes:r})=>{if(o){(r.deleted||[]).some(s=>s.id===o)&&n(void 0);const i=(r.updated||[]).find(({oldValue:s})=>s.id===o);i&&n(i.newValue.id)}}),{get current(){return o},subscribe:t,set:n}},Tn={selected:[]},yu=(e,t,n)=>{const{subscribe:o,set:r}=hr(Tn);let i=t,s=Tn;o(h=>s=h);const a=()=>{xt(s,Tn)||r(Tn)},c=()=>{var h;return((h=s.selected)==null?void 0:h.length)===0},l=h=>{if(c())return!1;const E=typeof h=="string"?h:h.id;return s.selected.some(v=>v.id===E)},u=(h,E)=>{let v;if(Array.isArray(h)){if(v=h.map(m=>e.getAnnotation(m)).filter(Boolean),v.length<h.length){console.warn("Invalid selection: "+h.filter(m=>!v.some(R=>R.id===m)));return}}else{const m=e.getAnnotation(h);if(!m){console.warn("Invalid selection: "+h);return}v=[m]}const g=v.reduce((m,R)=>{const $=y(R);return $==="EDIT"?[...m,{id:R.id,editable:!0}]:$==="SELECT"?[...m,{id:R.id}]:m},[]);r({selected:g,event:E})},d=(h,E)=>{const v=Array.isArray(h)?h:[h],g=v.map(m=>e.getAnnotation(m)).filter(m=>!!m);r({selected:g.map(m=>{const R=E===void 0?y(m)==="EDIT":E;return{id:m.id,editable:R}})}),g.length!==v.length&&console.warn("Invalid selection",h)},f=h=>{if(c())return!1;const{selected:E}=s;E.some(({id:v})=>h.includes(v))&&r({selected:E.filter(({id:v})=>!h.includes(v))})},p=h=>{i=h,d(s.selected.map(({id:E})=>E))},y=h=>vu(h,i,n);return e.observe(({changes:h})=>f((h.deleted||[]).map(E=>E.id))),{get event(){return s?s.event:null},get selected(){return s?[...s.selected]:null},get userSelectAction(){return i},clear:a,evalSelectAction:y,isEmpty:c,isSelected:l,setSelected:d,setUserSelectAction:p,subscribe:o,userSelect:u}},vu=(e,t,n)=>{const o=n?n.serialize(e):e;return typeof t=="function"?t(o):t||"EDIT"},Ee=[];for(let e=0;e<256;++e)Ee.push((e+256).toString(16).slice(1));function bu(e,t=0){return(Ee[e[t+0]]+Ee[e[t+1]]+Ee[e[t+2]]+Ee[e[t+3]]+"-"+Ee[e[t+4]]+Ee[e[t+5]]+"-"+Ee[e[t+6]]+Ee[e[t+7]]+"-"+Ee[e[t+8]]+Ee[e[t+9]]+"-"+Ee[e[t+10]]+Ee[e[t+11]]+Ee[e[t+12]]+Ee[e[t+13]]+Ee[e[t+14]]+Ee[e[t+15]]).toLowerCase()}let _o;const wu=new Uint8Array(16);function xu(){if(!_o){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");_o=crypto.getRandomValues.bind(crypto)}return _o(wu)}const Eu=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ei={randomUUID:Eu};function Au(e,t,n){var o;if(Ei.randomUUID&&!e)return Ei.randomUUID();e=e||{};const r=e.random??((o=e.rng)==null?void 0:o.call(e))??xu();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,bu(r)}const Mo=e=>{const t=n=>{const o={...n};return n.created&&typeof n.created=="string"&&(o.created=new Date(n.created)),n.updated&&typeof n.updated=="string"&&(o.updated=new Date(n.updated)),o};return{...e,bodies:(e.bodies||[]).map(t),target:t(e.target)}},$u=(e,t)=>{const n=new Set(e.bodies.map(o=>o.id));return t.bodies.filter(o=>!n.has(o.id))},Ru=(e,t)=>{const n=new Set(t.bodies.map(o=>o.id));return e.bodies.filter(o=>!n.has(o.id))},Su=(e,t)=>t.bodies.map(n=>{const o=e.bodies.find(r=>r.id===n.id);return{newBody:n,oldBody:o&&!xt(o,n)?o:void 0}}).filter(({oldBody:n})=>n).map(({oldBody:n,newBody:o})=>({oldBody:n,newBody:o})),Tu=(e,t)=>!xt(e.target,t.target),Is=(e,t)=>{const n=$u(e,t),o=Ru(e,t),r=Su(e,t);return{oldValue:e,newValue:t,bodiesCreated:n.length>0?n:void 0,bodiesDeleted:o.length>0?o:void 0,bodiesUpdated:r.length>0?r:void 0,targetUpdated:Tu(e,t)?{oldTarget:e.target,newTarget:t.target}:void 0}};var ne=(e=>(e.LOCAL="LOCAL",e.REMOTE="REMOTE",e.SILENT="SILENT",e))(ne||{});const Cu=(e,t)=>{var n,o;const{changes:r,origin:i}=t;if(!(e.options.origin?e.options.origin===i:i!=="SILENT"))return!1;if(e.options.ignore){const{ignore:s}=e.options,a=c=>c&&c.length>0;if(!(a(r.created)||a(r.deleted))){const c=(n=r.updated)==null?void 0:n.some(u=>a(u.bodiesCreated)||a(u.bodiesDeleted)||a(u.bodiesUpdated)),l=(o=r.updated)==null?void 0:o.some(u=>u.targetUpdated);if(s==="BODY_ONLY"&&c&&!l||s==="TARGET_ONLY"&&l&&!c)return!1}}if(e.options.annotations){const s=new Set([...(r.created||[]).map(a=>a.id),...(r.deleted||[]).map(a=>a.id),...(r.updated||[]).map(({oldValue:a})=>a.id)]);return!!(Array.isArray(e.options.annotations)?e.options.annotations:[e.options.annotations]).find(a=>s.has(a))}else return!0},Ou=(e,t)=>{const n=new Set((e.created||[]).map(d=>d.id)),o=new Set((e.updated||[]).map(({newValue:d})=>d.id)),r=new Set((t.created||[]).map(d=>d.id)),i=new Set((t.deleted||[]).map(d=>d.id)),s=new Set((t.updated||[]).map(({oldValue:d})=>d.id)),a=new Set((t.updated||[]).filter(({oldValue:d})=>n.has(d.id)||o.has(d.id)).map(({oldValue:d})=>d.id)),c=[...(e.created||[]).filter(d=>!i.has(d.id)).map(d=>s.has(d.id)?t.updated.find(({oldValue:f})=>f.id===d.id).newValue:d),...t.created||[]],l=[...(e.deleted||[]).filter(d=>!r.has(d.id)),...(t.deleted||[]).filter(d=>!n.has(d.id))],u=[...(e.updated||[]).filter(({newValue:d})=>!i.has(d.id)).map(d=>{const{oldValue:f,newValue:p}=d;if(s.has(p.id)){const y=t.updated.find(h=>h.oldValue.id===p.id).newValue;return Is(f,y)}else return d}),...(t.updated||[]).filter(({oldValue:d})=>!a.has(d.id))];return{created:c,deleted:l,updated:u}},Cn=e=>{const t=e.id===void 0?Au():e.id;return{...e,id:t,bodies:e.bodies===void 0?[]:e.bodies.map(n=>({...n,annotation:t})),target:{...e.target,annotation:t}}},ku=e=>e.id!==void 0,Lu=()=>{const e=new Map,t=new Map,n=[],o=(S,T={})=>{n.push({onChange:S,options:T})},r=S=>{const T=n.findIndex(x=>x.onChange==S);T>-1&&n.splice(T,1)},i=(S,T)=>{const x={origin:S,changes:{created:T.created||[],updated:T.updated||[],deleted:T.deleted||[]},state:[...e.values()]};n.forEach(A=>{Cu(A,x)&&A.onChange(x)})},s=(S,T=ne.LOCAL)=>{if(S.id&&e.get(S.id))throw Error(`Cannot add annotation ${S.id} - exists already`);{const x=Cn(S);e.set(x.id,x),x.bodies.forEach(A=>t.set(A.id,x.id)),i(T,{created:[x]})}},a=(S,T)=>{const x=Cn(typeof S=="string"?T:S),A=typeof S=="string"?S:S.id,_=A&&e.get(A);if(_){const L=Is(_,x);return A===x.id?e.set(A,x):(e.delete(A),e.set(x.id,x)),_.bodies.forEach(C=>t.delete(C.id)),x.bodies.forEach(C=>t.set(C.id,x.id)),L}else console.warn(`Cannot update annotation ${A} - does not exist`)},c=(S,T=ne.LOCAL,x=ne.LOCAL)=>{const A=ku(T)?x:T,_=a(S,T);_&&i(A,{updated:[_]})},l=(S,T=ne.LOCAL)=>{e.get(S.id)?c(S,T):s(S,T)},u=(S,T=ne.LOCAL)=>{const x=S.reduce((A,_)=>{const L=a(_);return L?[...A,L]:A},[]);x.length>0&&i(T,{updated:x})},d=(S,T=ne.LOCAL)=>{const x=S.map(Cn),{toAdd:A,toUpdate:_}=x.reduce((C,H)=>e.get(H.id)?{...C,toUpdate:[...C.toUpdate,H]}:{...C,toAdd:[...C.toAdd,H]},{toAdd:[],toUpdate:[]}),L=_.map(C=>a(C,T)).filter(Boolean);A.forEach(C=>{e.set(C.id,C),C.bodies.forEach(H=>t.set(H.id,C.id))}),i(T,{created:A,updated:L})},f=(S,T=ne.LOCAL)=>{const x=e.get(S.annotation);if(x){const A={...x,bodies:[...x.bodies,S]};e.set(x.id,A),t.set(S.id,A.id),i(T,{updated:[{oldValue:x,newValue:A,bodiesCreated:[S]}]})}else console.warn(`Attempt to add body to missing annotation: ${S.annotation}`)},p=()=>[...e.values()],y=(S=ne.LOCAL)=>{const T=[...e.values()];e.clear(),t.clear(),i(S,{deleted:T})},h=(S,T=!0,x=ne.LOCAL)=>{const A=S.map(Cn);if(T){const _=[...e.values()];e.clear(),t.clear(),A.forEach(L=>{e.set(L.id,L),L.bodies.forEach(C=>t.set(C.id,L.id))}),i(x,{created:A,deleted:_})}else{const _=S.reduce((L,C)=>{const H=C.id&&e.get(C.id);return H?[...L,H]:L},[]);if(_.length>0)throw Error(`Bulk insert would overwrite the following annotations: ${_.map(L=>L.id).join(", ")}`);A.forEach(L=>{e.set(L.id,L),L.bodies.forEach(C=>t.set(C.id,L.id))}),i(x,{created:A})}},E=S=>{const T=typeof S=="string"?S:S.id,x=e.get(T);if(x)return e.delete(T),x.bodies.forEach(A=>t.delete(A.id)),x;console.warn(`Attempt to delete missing annotation: ${T}`)},v=(S,T=ne.LOCAL)=>{const x=E(S);x&&i(T,{deleted:[x]})},g=(S,T=ne.LOCAL)=>{const x=S.reduce((A,_)=>{const L=E(_);return L?[...A,L]:A},[]);x.length>0&&i(T,{deleted:x})},m=S=>{const T=e.get(S.annotation);if(T){const x=T.bodies.find(A=>A.id===S.id);if(x){t.delete(x.id);const A={...T,bodies:T.bodies.filter(_=>_.id!==S.id)};return e.set(T.id,A),{oldValue:T,newValue:A,bodiesDeleted:[x]}}else console.warn(`Attempt to delete missing body ${S.id} from annotation ${S.annotation}`)}else console.warn(`Attempt to delete body from missing annotation ${S.annotation}`)},R=(S,T=ne.LOCAL)=>{const x=m(S);x&&i(T,{updated:[x]})},$=(S,T=ne.LOCAL)=>{const x=S.map(A=>m(A)).filter(Boolean);x.length>0&&i(T,{updated:x})},N=S=>{const T=e.get(S);return T?{...T}:void 0},I=S=>{const T=t.get(S);if(T){const x=N(T).bodies.find(A=>A.id===S);if(x)return x;console.error(`Store integrity error: body ${S} in index, but not in annotation`)}else console.warn(`Attempt to retrieve missing body: ${S}`)},k=(S,T)=>{if(S.annotation!==T.annotation)throw"Annotation integrity violation: annotation ID must be the same when updating bodies";const x=e.get(S.annotation);if(x){const A=x.bodies.find(L=>L.id===S.id),_={...x,bodies:x.bodies.map(L=>L.id===A.id?T:L)};return e.set(x.id,_),A.id!==T.id&&(t.delete(A.id),t.set(T.id,_.id)),{oldValue:x,newValue:_,bodiesUpdated:[{oldBody:A,newBody:T}]}}else console.warn(`Attempt to add body to missing annotation ${S.annotation}`)},P=(S,T,x=ne.LOCAL)=>{const A=k(S,T);A&&i(x,{updated:[A]})},U=(S,T=ne.LOCAL)=>{const x=S.map(A=>k({id:A.id,annotation:A.annotation},A)).filter(Boolean);i(T,{updated:x})},B=S=>{const T=e.get(S.annotation);if(T){const x={...T,target:{...T.target,...S}};return e.set(T.id,x),{oldValue:T,newValue:x,targetUpdated:{oldTarget:T.target,newTarget:S}}}else console.warn(`Attempt to update target on missing annotation: ${S.annotation}`)};return{addAnnotation:s,addBody:f,all:p,bulkAddAnnotations:h,bulkDeleteAnnotations:g,bulkDeleteBodies:$,bulkUpdateAnnotations:u,bulkUpdateBodies:U,bulkUpdateTargets:(S,T=ne.LOCAL)=>{const x=S.map(A=>B(A)).filter(Boolean);x.length>0&&i(T,{updated:x})},bulkUpsertAnnotations:d,clear:y,deleteAnnotation:v,deleteBody:R,getAnnotation:N,getBody:I,observe:o,unobserve:r,updateAnnotation:c,updateBody:P,updateTarget:(S,T=ne.LOCAL)=>{const x=B(S);x&&i(T,{updated:[x]})},upsertAnnotation:l}};let _u=()=>({emit(e,...t){for(let n=this.events[e]||[],o=0,r=n.length;o<r;o++)n[o](...t)},events:{},on(e,t){var n;return((n=this.events)[e]||(n[e]=[])).push(t),()=>{var o;this.events[e]=(o=this.events[e])==null?void 0:o.filter(r=>t!==r)}}});const Mu=250,Iu=(e,t)=>{const n=_u(),o=[];let r=-1,i=!1,s=0;const a=y=>{if(!i){const{changes:h}=y,E=performance.now();if(E-s>Mu)o.splice(r+1),o.push(h),r=o.length-1;else{const v=o.length-1;o[v]=Ou(o[v],h)}s=E}i=!1};e.observe(a,{origin:ne.LOCAL});const c=y=>y&&y.length>0&&e.bulkDeleteAnnotations(y),l=y=>y&&y.length>0&&e.bulkAddAnnotations(y,!1),u=y=>y&&y.length>0&&e.bulkUpdateAnnotations(y.map(({oldValue:h})=>h)),d=y=>y&&y.length>0&&e.bulkUpdateAnnotations(y.map(({newValue:h})=>h)),f=y=>y&&y.length>0&&e.bulkAddAnnotations(y,!1),p=y=>y&&y.length>0&&e.bulkDeleteAnnotations(y);return{canRedo:()=>o.length-1>r,canUndo:()=>r>-1,destroy:()=>e.unobserve(a),getHistory:()=>({changes:[...o],pointer:r}),on:(y,h)=>n.on(y,h),redo:()=>{if(o.length-1>r){i=!0;const{created:y,updated:h,deleted:E}=o[r+1];l(y),d(h),p(E),n.emit("redo",o[r+1]),r+=1}},undo:()=>{if(r>-1){i=!0;const{created:y,updated:h,deleted:E}=o[r];c(y),u(h),f(E),n.emit("undo",o[r]),r-=1}}}},Pu=()=>{const{subscribe:e,set:t}=hr([]);return{subscribe:e,set:t}},Nu=(e,t,n,o)=>{const{hover:r,selection:i,store:s,viewport:a}=e,c=new Map;let l=[],u;const d=(h,E)=>{c.has(h)?c.get(h).push(E):c.set(h,[E])},f=(h,E)=>{const v=c.get(h);if(v){const g=v.indexOf(E);g!==-1&&v.splice(g,1)}},p=(h,E,v)=>{c.has(h)&&setTimeout(()=>{c.get(h).forEach(g=>{if(n){const m=Array.isArray(E)?E.map($=>n.serialize($)):n.serialize(E),R=v?v instanceof PointerEvent?v:n.serialize(v):void 0;g(m,R)}else g(E,v)})},1)};i.subscribe(({selected:h})=>{if(!(l.length===0&&h.length===0)){if(l.length===0&&h.length>0)l=h.map(({id:E})=>s.getAnnotation(E));else if(l.length>0&&h.length===0)l.forEach(E=>{const v=s.getAnnotation(E.id);v&&!xt(v,E)&&p("updateAnnotation",v,E)}),l=[];else{const E=new Set(l.map(g=>g.id)),v=new Set(h.map(({id:g})=>g));l.filter(g=>!v.has(g.id)).forEach(g=>{const m=s.getAnnotation(g.id);m&&!xt(m,g)&&p("updateAnnotation",m,g)}),l=[...l.filter(g=>v.has(g.id)),...h.filter(({id:g})=>!E.has(g)).map(({id:g})=>s.getAnnotation(g))]}p("selectionChanged",l)}}),r.subscribe(h=>{!u&&h?p("mouseEnterAnnotation",s.getAnnotation(h)):u&&!h?p("mouseLeaveAnnotation",s.getAnnotation(u)):u&&h&&(p("mouseLeaveAnnotation",s.getAnnotation(u)),p("mouseEnterAnnotation",s.getAnnotation(h))),u=h}),a==null||a.subscribe(h=>p("viewportIntersect",h.map(E=>s.getAnnotation(E)))),s.observe(h=>{const{created:E,deleted:v}=h.changes;(E||[]).forEach(g=>p("createAnnotation",g)),(v||[]).forEach(g=>p("deleteAnnotation",g)),(h.changes.updated||[]).filter(g=>[...g.bodiesCreated||[],...g.bodiesDeleted||[],...g.bodiesUpdated||[]].length>0).forEach(({oldValue:g,newValue:m})=>{const R=l.find($=>$.id===g.id)||g;l=l.map($=>$.id===g.id?m:$),p("updateAnnotation",m,R)})},{origin:ne.LOCAL}),s.observe(h=>{if(l){const E=new Set(l.map(g=>g.id)),v=(h.changes.updated||[]).filter(({newValue:g})=>E.has(g.id)).map(({newValue:g})=>g);v.length>0&&(l=l.map(g=>v.find(m=>m.id===g.id)||g))}},{origin:ne.REMOTE});const y=h=>E=>{const{updated:v}=E;h?(v||[]).forEach(g=>p("updateAnnotation",g.oldValue,g.newValue)):(v||[]).forEach(g=>p("updateAnnotation",g.newValue,g.oldValue))};return t.on("undo",y(!0)),t.on("redo",y(!1)),{on:d,off:f,emit:p}},Du=e=>t=>t.reduce((n,o)=>{const{parsed:r,error:i}=e.parse(o);return i?{parsed:n.parsed,failed:[...n.failed,o]}:r?{parsed:[...n.parsed,r],failed:n.failed}:{...n}},{parsed:[],failed:[]}),ju=(e,t,n)=>{const{store:o,selection:r}=e,i=v=>{if(n){const{parsed:g,error:m}=n.parse(v);g?o.addAnnotation(g,ne.REMOTE):console.error(m)}else o.addAnnotation(Mo(v),ne.REMOTE)},s=()=>r.clear(),a=()=>o.clear(),c=v=>{const g=o.getAnnotation(v);return n&&g?n.serialize(g):g},l=()=>n?o.all().map(n.serialize):o.all(),u=()=>{var v;const g=(((v=r.selected)==null?void 0:v.map(m=>m.id))||[]).map(m=>o.getAnnotation(m)).filter(Boolean);return n?g.map(n.serialize):g},d=(v,g=!0)=>fetch(v).then(m=>m.json()).then(m=>(p(m,g),m)),f=v=>{if(typeof v=="string"){const g=o.getAnnotation(v);if(o.deleteAnnotation(v),g)return n?n.serialize(g):g}else{const g=n?n.parse(v).parsed:v;if(g)return o.deleteAnnotation(g),v}},p=(v,g=!0)=>{if(n){const m=n.parseAll||Du(n),{parsed:R,failed:$}=m(v);$.length>0&&console.warn(`Discarded ${$.length} invalid annotations`,$),o.bulkAddAnnotations(R,g,ne.REMOTE)}else o.bulkAddAnnotations(v.map(Mo),g,ne.REMOTE)},y=(v,g)=>{v?r.setSelected(v,g):r.clear()},h=v=>{r.clear(),r.setUserSelectAction(v)},E=v=>{if(n){const g=n.parse(v).parsed,m=n.serialize(o.getAnnotation(g.id));return o.updateAnnotation(g),m}else{const g=o.getAnnotation(v.id);return o.updateAnnotation(Mo(v)),g}};return{addAnnotation:i,cancelSelected:s,canRedo:t.canRedo,canUndo:t.canUndo,clearAnnotations:a,getAnnotationById:c,getAnnotations:l,getHistory:t.getHistory,getSelected:u,loadAnnotations:d,redo:t.redo,removeAnnotation:f,setAnnotations:p,setSelected:y,setUserSelectAction:h,undo:t.undo,updateAnnotation:E}},Bu="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Uu=e=>crypto.getRandomValues(new Uint8Array(e)),Hu=(e,t,n)=>{let o=(2<<Math.log2(e.length-1))-1,r=-~(1.6*o*t/e.length);return(i=t)=>{let s="";for(;;){let a=n(r),c=r|0;for(;c--;)if(s+=e[a[c]&o]||"",s.length>=i)return s}}},Vu=(e,t=21)=>Hu(e,t|0,Uu),Fu=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=Bu[n[e]&63];return t};const Xu=()=>({isGuest:!0,id:Vu("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()});Fu();function Ps(e,t,n=0,o=e.length-1,r=qu){for(;o>n;){if(o-n>600){const c=o-n+1,l=t-n+1,u=Math.log(c),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(c-d)/c)*(l-c/2<0?-1:1),p=Math.max(n,Math.floor(t-l*d/c+f)),y=Math.min(o,Math.floor(t+(c-l)*d/c+f));Ps(e,t,p,y,r)}const i=e[t];let s=n,a=o;for(Qt(e,n,t),r(e[o],i)>0&&Qt(e,n,o);s<a;){for(Qt(e,s,a),s++,a--;r(e[s],i)<0;)s++;for(;r(e[a],i)>0;)a--}r(e[n],i)===0?Qt(e,n,a):(a++,Qt(e,a,o)),a<=t&&(n=a+1),t<=a&&(o=a-1)}}function Qt(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}function qu(e,t){return e<t?-1:e>t?1:0}class Ku{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let n=this.data;const o=[];if(!kn(t,n))return o;const r=this.toBBox,i=[];for(;n;){for(let s=0;s<n.children.length;s++){const a=n.children[s],c=n.leaf?r(a):a;kn(t,c)&&(n.leaf?o.push(a):Po(t,c)?this._all(a,o):i.push(a))}n=i.pop()}return o}collides(t){let n=this.data;if(!kn(t,n))return!1;const o=[];for(;n;){for(let r=0;r<n.children.length;r++){const i=n.children[r],s=n.leaf?this.toBBox(i):i;if(kn(t,s)){if(n.leaf||Po(t,s))return!0;o.push(i)}}n=o.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let o=0;o<t.length;o++)this.insert(t[o]);return this}let n=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const o=this.data;this.data=n,n=o}this._insert(n,this.data.height-n.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Ot([]),this}remove(t,n){if(!t)return this;let o=this.data;const r=this.toBBox(t),i=[],s=[];let a,c,l;for(;o||i.length;){if(o||(o=i.pop(),c=i[i.length-1],a=s.pop(),l=!0),o.leaf){const u=Yu(t,o.children,n);if(u!==-1)return o.children.splice(u,1),i.push(o),this._condense(i),this}!l&&!o.leaf&&Po(o,r)?(i.push(o),s.push(a),a=0,c=o,o=o.children[0]):c?(a++,o=c.children[a],l=!1):o=null}return this}toBBox(t){return t}compareMinX(t,n){return t.minX-n.minX}compareMinY(t,n){return t.minY-n.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,n){const o=[];for(;t;)t.leaf?n.push(...t.children):o.push(...t.children),t=o.pop();return n}_build(t,n,o,r){const i=o-n+1;let s=this._maxEntries,a;if(i<=s)return a=Ot(t.slice(n,o+1)),St(a,this.toBBox),a;r||(r=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,r-1))),a=Ot([]),a.leaf=!1,a.height=r;const c=Math.ceil(i/s),l=c*Math.ceil(Math.sqrt(s));Ai(t,n,o,l,this.compareMinX);for(let u=n;u<=o;u+=l){const d=Math.min(u+l-1,o);Ai(t,u,d,c,this.compareMinY);for(let f=u;f<=d;f+=c){const p=Math.min(f+c-1,d);a.children.push(this._build(t,f,p,r-1))}}return St(a,this.toBBox),a}_chooseSubtree(t,n,o,r){for(;r.push(n),!(n.leaf||r.length-1===o);){let i=1/0,s=1/0,a;for(let c=0;c<n.children.length;c++){const l=n.children[c],u=Io(l),d=zu(t,l)-u;d<s?(s=d,i=u<i?u:i,a=l):d===s&&u<i&&(i=u,a=l)}n=a||n.children[0]}return n}_insert(t,n,o){const r=o?t:this.toBBox(t),i=[],s=this._chooseSubtree(r,this.data,n,i);for(s.children.push(t),on(s,r);n>=0&&i[n].children.length>this._maxEntries;)this._split(i,n),n--;this._adjustParentBBoxes(r,i,n)}_split(t,n){const o=t[n],r=o.children.length,i=this._minEntries;this._chooseSplitAxis(o,i,r);const s=this._chooseSplitIndex(o,i,r),a=Ot(o.children.splice(s,o.children.length-s));a.height=o.height,a.leaf=o.leaf,St(o,this.toBBox),St(a,this.toBBox),n?t[n-1].children.push(a):this._splitRoot(o,a)}_splitRoot(t,n){this.data=Ot([t,n]),this.data.height=t.height+1,this.data.leaf=!1,St(this.data,this.toBBox)}_chooseSplitIndex(t,n,o){let r,i=1/0,s=1/0;for(let a=n;a<=o-n;a++){const c=nn(t,0,a,this.toBBox),l=nn(t,a,o,this.toBBox),u=Ju(c,l),d=Io(c)+Io(l);u<i?(i=u,r=a,s=d<s?d:s):u===i&&d<s&&(s=d,r=a)}return r||o-n}_chooseSplitAxis(t,n,o){const r=t.leaf?this.compareMinX:Wu,i=t.leaf?this.compareMinY:Gu,s=this._allDistMargin(t,n,o,r),a=this._allDistMargin(t,n,o,i);s<a&&t.children.sort(r)}_allDistMargin(t,n,o,r){t.children.sort(r);const i=this.toBBox,s=nn(t,0,n,i),a=nn(t,o-n,o,i);let c=On(s)+On(a);for(let l=n;l<o-n;l++){const u=t.children[l];on(s,t.leaf?i(u):u),c+=On(s)}for(let l=o-n-1;l>=n;l--){const u=t.children[l];on(a,t.leaf?i(u):u),c+=On(a)}return c}_adjustParentBBoxes(t,n,o){for(let r=o;r>=0;r--)on(n[r],t)}_condense(t){for(let n=t.length-1,o;n>=0;n--)t[n].children.length===0?n>0?(o=t[n-1].children,o.splice(o.indexOf(t[n]),1)):this.clear():St(t[n],this.toBBox)}}function Yu(e,t,n){if(!n)return t.indexOf(e);for(let o=0;o<t.length;o++)if(n(e,t[o]))return o;return-1}function St(e,t){nn(e,0,e.children.length,t,e)}function nn(e,t,n,o,r){r||(r=Ot(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let i=t;i<n;i++){const s=e.children[i];on(r,e.leaf?o(s):s)}return r}function on(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Wu(e,t){return e.minX-t.minX}function Gu(e,t){return e.minY-t.minY}function Io(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function On(e){return e.maxX-e.minX+(e.maxY-e.minY)}function zu(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function Ju(e,t){const n=Math.max(e.minX,t.minX),o=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),i=Math.min(e.maxY,t.maxY);return Math.max(0,r-n)*Math.max(0,i-o)}function Po(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function kn(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Ot(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ai(e,t,n,o,r){const i=[t,n];for(;i.length;){if(n=i.pop(),t=i.pop(),n-t<=o)continue;const s=t+Math.ceil((n-t)/o/2)*o;Ps(e,s,t,n,r),i.push(t,s,s,n)}}const Qu=(e,t)=>{const n=new Ku,o=new Map,r=(y,h)=>{const E=y.selector.flatMap(g=>{const m=ot([g])?g.range:Os(g,t).range;return Array.from(m.getClientRects())}),v=Bc(E).map(({left:g,top:m,right:R,bottom:$})=>new DOMRect(g-h.left,m-h.top,R-g,$-m));return v.map(g=>{const{x:m,y:R,width:$,height:N}=g;return{minX:m,minY:R,maxX:m+$,maxY:R+N,annotation:{id:y.annotation,rects:v}}})},i=()=>[...o.values()],s=()=>{n.clear(),o.clear()},a=y=>{const h=r(y,t.getBoundingClientRect());h.length!==0&&(h.forEach(E=>n.insert(E)),o.set(y.annotation,h))},c=y=>{const h=o.get(y.annotation);h&&(h.forEach(E=>n.remove(E)),o.delete(y.annotation))},l=y=>{c(y),a(y)},u=(y,h=!0)=>{h&&s();const E=t.getBoundingClientRect(),v=y.map(m=>({target:m,rects:r(m,E)}));v.forEach(({target:m,rects:R})=>{R.length>0&&o.set(m.annotation,R)});const g=v.flatMap(({rects:m})=>m);n.load(g)},d=(y,h,E=!1)=>{const v=n.search({minX:y,minY:h,maxX:y,maxY:h}),g=m=>m.annotation.rects.reduce((R,$)=>R+$.width*$.height,0);return v.length>0?(v.sort((m,R)=>g(m)-g(R)),E?v.map(m=>m.annotation.id):[v[0].annotation.id]):[]},f=y=>{const h=p(y);if(h.length===0)return;let E=h[0].left,v=h[0].top,g=h[0].right,m=h[0].bottom;for(let R=1;R<h.length;R++){const $=h[R];E=Math.min(E,$.left),v=Math.min(v,$.top),g=Math.max(g,$.right),m=Math.max(m,$.bottom)}return new DOMRect(E,v,g-E,m-v)},p=y=>{const h=o.get(y);return h?h[0].annotation.rects:[]};return{all:i,clear:s,getAt:d,getAnnotationBounds:f,getAnnotationRects:p,getIntersecting:(y,h,E,v)=>{const g=n.search({minX:y,minY:h,maxX:E,maxY:v}),m=new Set(g.map(R=>R.annotation.id));return Array.from(m).map(R=>({annotation:e.getAnnotation(R),rects:p(R)})).filter(R=>!!R.annotation)},insert:a,recalculate:()=>u(e.all().map(y=>y.target),!0),remove:c,set:u,size:()=>n.all().length,update:l}},Zu=(e,t)=>{const n=Lu(),o=Qu(n,e),r=yu(n,t.userSelectAction,t.adapter),i=mu(n),s=Pu(),a=(v,g=ne.LOCAL)=>{const m=So(v,e),R=ot(m.target.selector);return R&&n.addAnnotation(m,g),R},c=(v,g=!0,m=ne.LOCAL)=>{const R=v.map(N=>So(N,e)),$=R.filter(N=>!ot(N.target.selector));return n.bulkAddAnnotations(R,g,m),$},l=(v,g=ne.LOCAL)=>{const m=v.map($=>So($,e)),R=m.filter($=>!ot($.target.selector));return m.forEach($=>{n.getAnnotation($.id)?n.updateAnnotation($,g):n.addAnnotation($,g)}),R},u=(v,g=ne.LOCAL)=>{const m=Vn(v,e);n.updateTarget(m,g)},d=(v,g=ne.LOCAL)=>{const m=v.map(R=>Vn(R,e));n.bulkUpdateTargets(m,g)};function f(v,g,m,R){const $=m||!!R,N=o.getAt(v,g,$).map(k=>n.getAnnotation(k)),I=R?N.filter(R):N;if(I.length!==0)return m?I:I[0]}const p=v=>{if(o.getAnnotationRects(v).length!==0)return o.getAnnotationBounds(v)},y=(v,g,m,R)=>o.getIntersecting(v,g,m,R),h=v=>o.getAnnotationRects(v),E=()=>o.recalculate();return n.observe(({changes:v})=>{const g=(v.deleted||[]).filter($=>ot($.target.selector)),m=(v.created||[]).filter($=>ot($.target.selector)),R=(v.updated||[]).filter($=>ot($.newValue.target.selector));(g==null?void 0:g.length)>0&&g.forEach($=>o.remove($.target)),m.length>0&&o.set(m.map($=>$.target),!1),(R==null?void 0:R.length)>0&&R.forEach(({newValue:$})=>o.update($.target))}),{store:{...n,addAnnotation:a,bulkAddAnnotations:c,bulkUpdateTargets:d,bulkUpsertAnnotations:l,getAnnotationBounds:p,getAnnotationRects:h,getIntersecting:y,getAt:f,recalculatePositions:E,updateTarget:u},selection:r,hover:i,viewport:s}},ed=()=>{const e=document.createElement("canvas");e.width=2*window.innerWidth,e.height=2*window.innerHeight,e.className="r6o-presence-layer";const t=e.getContext("2d");return t.scale(2,2),t.translate(.5,.5),e},td=(e,t={})=>{const n=ed(),o=n.getContext("2d");document.body.appendChild(n);const r=new Map,i=s=>Array.from(r.entries()).filter(([a,c])=>c.presenceKey===s.presenceKey).map(([a,c])=>a);return e.on("selectionChange",(s,a)=>{i(s).forEach(c=>r.delete(c)),a&&a.forEach(c=>r.set(c,s))}),{clear:()=>{const{width:s,height:a}=n;o.clearRect(-.5,-.5,s+1,a+1)},destroy:()=>{n.remove()},paint:(s,a,c)=>{t.font&&(o.font=t.font);const l=r.get(s.annotation.id);if(l){const{height:u}=s.rects[0],d=s.rects[0].x+a.left,f=s.rects[0].y+a.top;o.fillStyle=l.appearance.color,o.fillRect(d-2,f-2.5,2,u+5);const p=o.measureText(l.appearance.label),y=p.width+6,h=p.actualBoundingBoxAscent+p.actualBoundingBoxDescent+8,E=p.fontBoundingBoxAscent?8:6.5;return o.fillRect(d-2,f-2.5-h,y,h),o.fillStyle="#fff",o.fillText(l.appearance.label,d+1,f-E),{fill:l.appearance.color,fillOpacity:c?.45:.18}}},reset:()=>{n.width=2*window.innerWidth,n.height=2*window.innerHeight;const s=n.getContext("2d");s.scale(2,2),s.translate(.5,.5)}}},No=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Do(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on".concat(t),n)}function Zt(e,t,n,o){e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on".concat(t),n)}function Ns(e,t){const n=t.slice(0,t.length-1);for(let o=0;o<n.length;o++)n[o]=e[n[o].toLowerCase()];return n}function Ds(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function nd(e,t){const n=e.length>=t.length?e:t,o=e.length>=t.length?t:e;let r=!0;for(let i=0;i<n.length;i++)o.indexOf(n[i])===-1&&(r=!1);return r}const yn={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":No?173:189,"=":No?61:187,";":No?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},Ye={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},rn={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},$e={16:!1,18:!1,17:!1,91:!1},he={};for(let e=1;e<20;e++)yn["f".concat(e)]=111+e;let ce=[],un=null,js="all";const nt=new Map,Kt=e=>yn[e.toLowerCase()]||Ye[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),od=e=>Object.keys(yn).find(t=>yn[t]===e),rd=e=>Object.keys(Ye).find(t=>Ye[t]===e);function Bs(e){js=e||"all"}function vn(){return js||"all"}function id(){return ce.slice(0)}function sd(){return ce.map(e=>od(e)||rd(e)||String.fromCharCode(e))}function ad(){const e=[];return Object.keys(he).forEach(t=>{he[t].forEach(n=>{let{key:o,scope:r,mods:i,shortcut:s}=n;e.push({scope:r,shortcut:s,mods:i,keys:o.split("+").map(a=>Kt(a))})})}),e}function ld(e){const t=e.target||e.srcElement,{tagName:n}=t;let o=!0;const r=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(r||n==="TEXTAREA"||n==="SELECT")&&!t.readOnly)&&(o=!1),o}function cd(e){return typeof e=="string"&&(e=Kt(e)),ce.indexOf(e)!==-1}function ud(e,t){let n,o;e||(e=vn());for(const r in he)if(Object.prototype.hasOwnProperty.call(he,r))for(n=he[r],o=0;o<n.length;)n[o].scope===e?n.splice(o,1).forEach(i=>{let{element:s}=i;return gr(s)}):o++;vn()===e&&Bs(t||"all")}function dd(e){let t=e.keyCode||e.which||e.charCode;e.key&&e.key.toLowerCase()==="capslock"&&(t=Kt(e.key));const n=ce.indexOf(t);if(n>=0&&ce.splice(n,1),e.key&&e.key.toLowerCase()==="meta"&&ce.splice(0,ce.length),(t===93||t===224)&&(t=91),t in $e){$e[t]=!1;for(const o in Ye)Ye[o]===t&&(Ue[o]=!1)}}function Us(e){if(typeof e>"u")Object.keys(he).forEach(r=>{Array.isArray(he[r])&&he[r].forEach(i=>Ln(i)),delete he[r]}),gr(null);else if(Array.isArray(e))e.forEach(r=>{r.key&&Ln(r)});else if(typeof e=="object")e.key&&Ln(e);else if(typeof e=="string"){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];let[r,i]=n;typeof r=="function"&&(i=r,r=""),Ln({key:e,scope:r,method:i,splitKey:"+"})}}const Ln=e=>{let{key:t,scope:n,method:o,splitKey:r="+"}=e;Ds(t).forEach(i=>{const s=i.split(r),a=s.length,c=s[a-1],l=c==="*"?"*":Kt(c);if(!he[l])return;n||(n=vn());const u=a>1?Ns(Ye,s):[],d=[];he[l]=he[l].filter(f=>{const p=(o?f.method===o:!0)&&f.scope===n&&nd(f.mods,u);return p&&d.push(f.element),!p}),d.forEach(f=>gr(f))})};function $i(e,t,n,o){if(t.element!==o)return;let r;if(t.scope===n||t.scope==="all"){r=t.mods.length>0;for(const i in $e)Object.prototype.hasOwnProperty.call($e,i)&&(!$e[i]&&t.mods.indexOf(+i)>-1||$e[i]&&t.mods.indexOf(+i)===-1)&&(r=!1);(t.mods.length===0&&!$e[16]&&!$e[18]&&!$e[17]&&!$e[91]||r||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(ce),t.method(e,t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function Ri(e,t){const n=he["*"];let o=e.keyCode||e.which||e.charCode;if(e.key&&e.key.toLowerCase()==="capslock"||!Ue.filter.call(this,e))return;if((o===93||o===224)&&(o=91),ce.indexOf(o)===-1&&o!==229&&ce.push(o),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const c=rn[a];e[a]&&ce.indexOf(c)===-1?ce.push(c):!e[a]&&ce.indexOf(c)>-1?ce.splice(ce.indexOf(c),1):a==="metaKey"&&e[a]&&(ce=ce.filter(l=>l in rn||l===o))}),o in $e){$e[o]=!0;for(const a in Ye)if(Object.prototype.hasOwnProperty.call(Ye,a)){const c=rn[Ye[a]];Ue[a]=e[c]}if(!n)return}for(const a in $e)Object.prototype.hasOwnProperty.call($e,a)&&($e[a]=e[rn[a]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(ce.indexOf(17)===-1&&ce.push(17),ce.indexOf(18)===-1&&ce.push(18),$e[17]=!0,$e[18]=!0);const r=vn();if(n)for(let a=0;a<n.length;a++)n[a].scope===r&&(e.type==="keydown"&&n[a].keydown||e.type==="keyup"&&n[a].keyup)&&$i(e,n[a],r,t);if(!(o in he))return;const i=he[o],s=i.length;for(let a=0;a<s;a++)if((e.type==="keydown"&&i[a].keydown||e.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,u=c.key.split(l),d=[];for(let f=0;f<u.length;f++)d.push(Kt(u[f]));d.sort().join("")===ce.sort().join("")&&$i(e,c,r,t)}}function Ue(e,t,n){ce=[];const o=Ds(e);let r=[],i="all",s=document,a=0,c=!1,l=!0,u="+",d=!1,f=!1;for(n===void 0&&typeof t=="function"&&(n=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(i=t.scope),t.element&&(s=t.element),t.keyup&&(c=t.keyup),t.keydown!==void 0&&(l=t.keydown),t.capture!==void 0&&(d=t.capture),typeof t.splitKey=="string"&&(u=t.splitKey),t.single===!0&&(f=!0)),typeof t=="string"&&(i=t),f&&Us(e,i);a<o.length;a++)e=o[a].split(u),r=[],e.length>1&&(r=Ns(Ye,e)),e=e[e.length-1],e=e==="*"?"*":Kt(e),e in he||(he[e]=[]),he[e].push({keyup:c,keydown:l,scope:i,mods:r,shortcut:o[a],method:n,key:o[a],splitKey:u,element:s});if(typeof s<"u"&&window){if(!nt.has(s)){const p=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return Ri(h,s)},y=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;Ri(h,s),dd(h)};nt.set(s,{keydownListener:p,keyupListenr:y,capture:d}),Do(s,"keydown",p,d),Do(s,"keyup",y,d)}if(!un){const p=()=>{ce=[]};un={listener:p,capture:d},Do(window,"focus",p,d)}}}function fd(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(he).forEach(n=>{he[n].filter(o=>o.scope===t&&o.shortcut===e).forEach(o=>{o&&o.method&&o.method()})})}function gr(e){const t=Object.values(he).flat();if(t.findIndex(n=>{let{element:o}=n;return o===e})<0){const{keydownListener:n,keyupListenr:o,capture:r}=nt.get(e)||{};n&&o&&(Zt(e,"keyup",o,r),Zt(e,"keydown",n,r),nt.delete(e))}if((t.length<=0||nt.size<=0)&&(Object.keys(nt).forEach(n=>{const{keydownListener:o,keyupListenr:r,capture:i}=nt.get(n)||{};o&&r&&(Zt(n,"keyup",r,i),Zt(n,"keydown",o,i),nt.delete(n))}),nt.clear(),Object.keys(he).forEach(n=>delete he[n]),un)){const{listener:n,capture:o}=un;Zt(window,"focus",n,o),un=null}}const jo={getPressedKeyString:sd,setScope:Bs,getScope:vn,deleteScope:ud,getPressedKeyCodes:id,getAllKeyCodes:ad,isPressed:cd,filter:ld,trigger:fd,unbind:Us,keyMap:yn,modifier:Ye,modifierMap:rn};for(const e in jo)Object.prototype.hasOwnProperty.call(jo,e)&&(Ue[e]=jo[e]);if(typeof window<"u"){const e=window.hotkeys;Ue.noConflict=t=>(t&&window.hotkeys===Ue&&(window.hotkeys=e),Ue),window.hotkeys=Ue}const Si=300,Hs=["up","down","left","right"],Vs=kc?"⌘+a":"ctrl+a",pd=[...Hs.map(e=>`shift+${e}`),Vs],hd=(e,t,n)=>{let o;const{annotatingEnabled:r,offsetReferenceSelector:i,selectionMode:s}=n,a=k=>o=k;let c;const l=k=>c=k,{store:u,selection:d}=t;let f,p,y;const h=k=>{p!==!1&&(f=tn(e,k.target)?void 0:{annotation:hu(),selector:[],creator:o,created:new Date})},E=Hn(k=>{const P=document.getSelection();if(!(P!=null&&P.anchorNode))return;if(tn(e,P.anchorNode)){f=void 0;return}const U=k.timeStamp-((y==null?void 0:y.timeStamp)||k.timeStamp);if((y==null?void 0:y.type)==="pointerdown"&&(U<1e3&&!f||P.isCollapsed&&U<Si)&&h(y||k),!f)return;if(P.isCollapsed){u.getAnnotation(f.annotation)&&(d.clear(),u.deleteAnnotation(f.annotation));return}const B=P.getRangeAt(0),S=Vc(B,e);if(Nc(S))return;const T=Mc(e,S.cloneRange());(T.length!==f.selector.length||T.some((x,A)=>{var _;return x.toString()!==((_=f.selector[A])==null?void 0:_.quote)}))&&(f={...f,selector:T.map(x=>Hc(x,e,i)),updated:new Date},u.getAnnotation(f.annotation)?u.updateTarget(f,ne.LOCAL):d.clear())}),v=k=>{tn(e,k.target)||(y=Ro(k),p=y.button===0)},g=k=>{if(!p)return;if(tn(e,k.target)){n.dismissOnClickOutside&&d.clear();return}const P=()=>{const{x:B,y:S}=e.getBoundingClientRect(),T=k.target instanceof Node&&e.contains(k.target)&&u.getAt(k.clientX-B,k.clientY-S,s==="all",c);if(T){const{selected:x}=d,A=new Set(x.map(L=>L.id)),_=Array.isArray(T)?T.map(L=>L.id):[T.id];(A.size!==_.length||!_.every(L=>A.has(L)))&&d.userSelect(_,k)}else d.clear()},U=k.timeStamp-y.timeStamp;setTimeout(()=>{const B=document.getSelection();B!=null&&B.isCollapsed&&U<Si?(f=void 0,P()):f&&f.selector.length>0&&(I(),d.userSelect(f.annotation,Ro(k)))})},m=k=>{const P=document.getSelection();P!=null&&P.isCollapsed||((!f||f.selector.length===0)&&E(k),f&&(I(),d.userSelect(f.annotation,Ro(k))))},R=k=>{k.key==="Shift"&&f&&(document.getSelection().isCollapsed||(I(),d.userSelect(f.annotation,Rn(k))))},$=k=>{const P=()=>setTimeout(()=>{(f==null?void 0:f.selector.length)>0&&(d.clear(),u.addAnnotation({id:f.annotation,bodies:[],target:f}),d.userSelect(f.annotation,Rn(k))),document.removeEventListener("selectionchange",P)},100);document.addEventListener("selectionchange",P),h(k)};Ue(pd.join(","),{element:e,keydown:!0,keyup:!1},k=>{k.repeat||(y=Rn(k))}),Ue(Vs,{keydown:!0,keyup:!1},k=>{y=Rn(k),$(k)});const N=k=>{k.repeat||k.target!==e&&k.target!==document.body||(f=void 0,d.clear())};Ue(Hs.join(","),{keydown:!0,keyup:!1},N);const I=()=>{const k=u.getAnnotation(f.annotation);if(!k){u.addAnnotation({id:f.annotation,bodies:[],target:f});return}const{target:{updated:P}}=k,{updated:U}=f;(!P||!U||P<U)&&u.updateTarget(f)};return e.addEventListener("pointerdown",v),document.addEventListener("pointerup",g),document.addEventListener("contextmenu",m),r&&(e.addEventListener("keyup",R),e.addEventListener("selectstart",h),document.addEventListener("selectionchange",E)),{destroy:()=>{e.removeEventListener("pointerdown",v),document.removeEventListener("pointerup",g),document.removeEventListener("contextmenu",m),e.removeEventListener("keyup",R),e.removeEventListener("selectstart",h),document.removeEventListener("selectionchange",E),Ue.unbind()},setFilter:l,setUser:a}},gd=(e,t)=>({...e,annotatingEnabled:e.annotatingEnabled??t.annotatingEnabled,user:e.user||t.user}),Ti="SPANS",md=(e,t={})=>{Oc(e),Lc(e);const n=gd(t,{annotatingEnabled:!0,user:Xu()}),o=Zu(e,n),{selection:r,viewport:i}=o,s=o.store,a=Iu(s),c=Nu(o,a,n.adapter);let l=n.user;const u=n.renderer==="CSS_HIGHLIGHTS"?CSS.highlights?"CSS_HIGHLIGHTS":Ti:n.renderer||Ti,d=u==="SPANS"?cu(e,o,i):u==="CSS_HIGHLIGHTS"?su(e,o,i):u==="CANVAS"?zc(e,o,i):void 0;if(!d)throw`Unknown renderer implementation: ${u}`;console.debug(`Using ${u} renderer`),n.style&&d.setStyle(n.style);const f=hd(e,o,n);return f.setUser(l),{...ju(o,a,n.adapter),destroy:()=>{d.destroy(),f.destroy(),a.destroy()},element:e,getUser:()=>l,setFilter:p=>{d.setFilter(p),f.setFilter(p)},setStyle:p=>d.setStyle(p),setUser:p=>{l=p,f.setUser(p)},setSelected:p=>{p?r.setSelected(p):r.clear()},setPresenceProvider:p=>{p&&(d.setPainter(td(p,n.presence)),p.on("selectionChange",()=>d.redraw()))},setVisible:p=>d.setVisible(p),on:c.on,off:c.off,scrollIntoView:Fc(e,s),state:o}},Dp=e=>{const{children:t,...n}=e,{anno:o,setAnno:r}=M.useContext(Jn),i=M.useCallback(s=>{const a=Tc(md(s,n));r(a)},[]);return M.useEffect(()=>{o&&o.setStyle(e.style)},[e.style]),M.useEffect(()=>{o&&o.setFilter(e.filter)},[e.filter]),e.children?fe.jsx(fe.Fragment,{children:M.Children.toArray(e.children).map(s=>M.cloneElement(s,{onLoad:i}))}):null};function Zn(){return typeof window<"u"}function yt(e){return mr(e)?(e.nodeName||"").toLowerCase():"#document"}function Pe(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Ze(e){var t;return(t=(mr(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function mr(e){return Zn()?e instanceof Node||e instanceof Pe(e).Node:!1}function ge(e){return Zn()?e instanceof Element||e instanceof Pe(e).Element:!1}function Re(e){return Zn()?e instanceof HTMLElement||e instanceof Pe(e).HTMLElement:!1}function Zo(e){return!Zn()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Pe(e).ShadowRoot}const yd=new Set(["inline","contents"]);function xn(e){const{overflow:t,overflowX:n,overflowY:o,display:r}=Ne(e);return/auto|scroll|overlay|hidden|clip/.test(t+o+n)&&!yd.has(r)}const vd=new Set(["table","td","th"]);function bd(e){return vd.has(yt(e))}const wd=[":popover-open",":modal"];function eo(e){return wd.some(t=>{try{return e.matches(t)}catch{return!1}})}const xd=["transform","translate","scale","rotate","perspective"],Ed=["transform","translate","scale","rotate","perspective","filter"],Ad=["paint","layout","strict","content"];function yr(e){const t=to(),n=ge(e)?Ne(e):e;return xd.some(o=>n[o]?n[o]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||Ed.some(o=>(n.willChange||"").includes(o))||Ad.some(o=>(n.contain||"").includes(o))}function $d(e){let t=st(e);for(;Re(t)&&!it(t);){if(yr(t))return t;if(eo(t))return null;t=st(t)}return null}function to(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Rd=new Set(["html","body","#document"]);function it(e){return Rd.has(yt(e))}function Ne(e){return Pe(e).getComputedStyle(e)}function no(e){return ge(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function st(e){if(yt(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Zo(e)&&e.host||Ze(e);return Zo(t)?t.host:t}function Fs(e){const t=st(e);return it(t)?e.ownerDocument?e.ownerDocument.body:e.body:Re(t)&&xn(t)?t:Fs(t)}function ht(e,t,n){var o;t===void 0&&(t=[]),n===void 0&&(n=!0);const r=Fs(e),i=r===((o=e.ownerDocument)==null?void 0:o.body),s=Pe(r);if(i){const a=er(s);return t.concat(s,s.visualViewport||[],xn(r)?r:[],a&&n?ht(a):[])}return t.concat(r,ht(r,[],n))}function er(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var Sd=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],Xn=Sd.join(","),Xs=typeof Element>"u",Bt=Xs?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,qn=!Xs&&Element.prototype.getRootNode?function(e){var t;return e==null||(t=e.getRootNode)===null||t===void 0?void 0:t.call(e)}:function(e){return e==null?void 0:e.ownerDocument},Kn=function e(t,n){var o;n===void 0&&(n=!0);var r=t==null||(o=t.getAttribute)===null||o===void 0?void 0:o.call(t,"inert"),i=r===""||r==="true",s=i||n&&t&&e(t.parentNode);return s},Td=function(t){var n,o=t==null||(n=t.getAttribute)===null||n===void 0?void 0:n.call(t,"contenteditable");return o===""||o==="true"},qs=function(t,n,o){if(Kn(t))return[];var r=Array.prototype.slice.apply(t.querySelectorAll(Xn));return n&&Bt.call(t,Xn)&&r.unshift(t),r=r.filter(o),r},Ks=function e(t,n,o){for(var r=[],i=Array.from(t);i.length;){var s=i.shift();if(!Kn(s,!1))if(s.tagName==="SLOT"){var a=s.assignedElements(),c=a.length?a:s.children,l=e(c,!0,o);o.flatten?r.push.apply(r,l):r.push({scopeParent:s,candidates:l})}else{var u=Bt.call(s,Xn);u&&o.filter(s)&&(n||!t.includes(s))&&r.push(s);var d=s.shadowRoot||typeof o.getShadowRoot=="function"&&o.getShadowRoot(s),f=!Kn(d,!1)&&(!o.shadowRootFilter||o.shadowRootFilter(s));if(d&&f){var p=e(d===!0?s.children:d.children,!0,o);o.flatten?r.push.apply(r,p):r.push({scopeParent:s,candidates:p})}else i.unshift.apply(i,s.children)}}return r},Ys=function(t){return!isNaN(parseInt(t.getAttribute("tabindex"),10))},Ws=function(t){if(!t)throw new Error("No node provided");return t.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||Td(t))&&!Ys(t)?0:t.tabIndex},Cd=function(t,n){var o=Ws(t);return o<0&&n&&!Ys(t)?0:o},Od=function(t,n){return t.tabIndex===n.tabIndex?t.documentOrder-n.documentOrder:t.tabIndex-n.tabIndex},Gs=function(t){return t.tagName==="INPUT"},kd=function(t){return Gs(t)&&t.type==="hidden"},Ld=function(t){var n=t.tagName==="DETAILS"&&Array.prototype.slice.apply(t.children).some(function(o){return o.tagName==="SUMMARY"});return n},_d=function(t,n){for(var o=0;o<t.length;o++)if(t[o].checked&&t[o].form===n)return t[o]},Md=function(t){if(!t.name)return!0;var n=t.form||qn(t),o=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},r;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")r=o(window.CSS.escape(t.name));else try{r=o(t.name)}catch(s){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",s.message),!1}var i=_d(r,t.form);return!i||i===t},Id=function(t){return Gs(t)&&t.type==="radio"},Pd=function(t){return Id(t)&&!Md(t)},Nd=function(t){var n,o=t&&qn(t),r=(n=o)===null||n===void 0?void 0:n.host,i=!1;if(o&&o!==t){var s,a,c;for(i=!!((s=r)!==null&&s!==void 0&&(a=s.ownerDocument)!==null&&a!==void 0&&a.contains(r)||t!=null&&(c=t.ownerDocument)!==null&&c!==void 0&&c.contains(t));!i&&r;){var l,u,d;o=qn(r),r=(l=o)===null||l===void 0?void 0:l.host,i=!!((u=r)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(r))}}return i},Ci=function(t){var n=t.getBoundingClientRect(),o=n.width,r=n.height;return o===0&&r===0},Dd=function(t,n){var o=n.displayCheck,r=n.getShadowRoot;if(getComputedStyle(t).visibility==="hidden")return!0;var i=Bt.call(t,"details>summary:first-of-type"),s=i?t.parentElement:t;if(Bt.call(s,"details:not([open]) *"))return!0;if(!o||o==="full"||o==="legacy-full"){if(typeof r=="function"){for(var a=t;t;){var c=t.parentElement,l=qn(t);if(c&&!c.shadowRoot&&r(c)===!0)return Ci(t);t.assignedSlot?t=t.assignedSlot:!c&&l!==t.ownerDocument?t=l.host:t=c}t=a}if(Nd(t))return!t.getClientRects().length;if(o!=="legacy-full")return!0}else if(o==="non-zero-area")return Ci(t);return!1},jd=function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var n=t.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var o=0;o<n.children.length;o++){var r=n.children.item(o);if(r.tagName==="LEGEND")return Bt.call(n,"fieldset[disabled] *")?!0:!r.contains(t)}return!0}n=n.parentElement}return!1},tr=function(t,n){return!(n.disabled||Kn(n)||kd(n)||Dd(n,t)||Ld(n)||jd(n))},nr=function(t,n){return!(Pd(n)||Ws(n)<0||!tr(t,n))},Bd=function(t){var n=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},Ud=function e(t){var n=[],o=[];return t.forEach(function(r,i){var s=!!r.scopeParent,a=s?r.scopeParent:r,c=Cd(a,s),l=s?e(r.candidates):a;c===0?s?n.push.apply(n,l):n.push(a):o.push({documentOrder:i,tabIndex:c,item:r,isScope:s,content:l})}),o.sort(Od).reduce(function(r,i){return i.isScope?r.push.apply(r,i.content):r.push(i.content),r},[]).concat(n)},oo=function(t,n){n=n||{};var o;return n.getShadowRoot?o=Ks([t],n.includeContainer,{filter:nr.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:Bd}):o=qs(t,n.includeContainer,nr.bind(null,n)),Ud(o)},Hd=function(t,n){n=n||{};var o;return n.getShadowRoot?o=Ks([t],n.includeContainer,{filter:tr.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):o=qs(t,n.includeContainer,tr.bind(null,n)),o},zs=function(t,n){if(n=n||{},!t)throw new Error("No node provided");return Bt.call(t,Xn)===!1?!1:nr(n,t)};function Vd(){const e=navigator.userAgentData;return e!=null&&e.platform?e.platform:navigator.platform}function Js(){const e=navigator.userAgentData;return e&&Array.isArray(e.brands)?e.brands.map(t=>{let{brand:n,version:o}=t;return n+"/"+o}).join(" "):navigator.userAgent}function Fd(){return/apple/i.test(navigator.vendor)}function or(){const e=/android/i;return e.test(Vd())||e.test(Js())}function Xd(){return Js().includes("jsdom/")}const Oi="data-floating-ui-focusable",qd="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function kt(e){let t=e.activeElement;for(;((n=t)==null||(n=n.shadowRoot)==null?void 0:n.activeElement)!=null;){var n;t=t.shadowRoot.activeElement}return t}function Me(e,t){if(!e||!t)return!1;const n=t.getRootNode==null?void 0:t.getRootNode();if(e.contains(t))return!0;if(n&&Zo(n)){let o=t;for(;o;){if(e===o)return!0;o=o.parentNode||o.host}}return!1}function ct(e){return"composedPath"in e?e.composedPath()[0]:e.target}function Bo(e,t){if(t==null)return!1;if("composedPath"in e)return e.composedPath().includes(t);const n=e;return n.target!=null&&t.contains(n.target)}function Kd(e){return e.matches("html,body")}function Xe(e){return(e==null?void 0:e.ownerDocument)||document}function Yd(e){return Re(e)&&e.matches(qd)}function ki(e){return e?e.getAttribute("role")==="combobox"&&Yd(e):!1}function rr(e){return e?e.hasAttribute(Oi)?e:e.querySelector("["+Oi+"]")||e:null}function Mt(e,t,n){return n===void 0&&(n=!0),e.filter(r=>{var i;return r.parentId===t&&(!n||((i=r.context)==null?void 0:i.open))}).flatMap(r=>[r,...Mt(e,r.id,n)])}function Li(e,t){var n;let o=[],r=(n=e.find(i=>i.id===t))==null?void 0:n.parentId;for(;r;){const i=e.find(s=>s.id===r);r=i==null?void 0:i.parentId,i&&(o=o.concat(i))}return o}function Uo(e){e.preventDefault(),e.stopPropagation()}function Wd(e){return"nativeEvent"in e}function Gd(e){return e.mozInputSource===0&&e.isTrusted?!0:or()&&e.pointerType?e.type==="click"&&e.buttons===1:e.detail===0&&!e.pointerType}function zd(e){return Xd()?!1:!or()&&e.width===0&&e.height===0||or()&&e.width===1&&e.height===1&&e.pressure===0&&e.detail===0&&e.pointerType==="mouse"||e.width<1&&e.height<1&&e.pressure===0&&e.detail===0&&e.pointerType==="touch"}var Jd=typeof document<"u",Qd=function(){},Ie=Jd?M.useLayoutEffect:Qd;const Zd={...os};function Ho(e){const t=M.useRef(e);return Ie(()=>{t.current=e}),t}const ef=Zd.useInsertionEffect,tf=ef||(e=>e());function Ge(e){const t=M.useRef(()=>{});return tf(()=>{t.current=e}),M.useCallback(function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return t.current==null?void 0:t.current(...o)},[])}const En=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function Qs(e,t){const n=oo(e,En()),o=n.length;if(o===0)return;const r=kt(Xe(e)),i=n.indexOf(r),s=i===-1?t===1?0:o-1:i+t;return n[s]}function Zs(e){return Qs(Xe(e).body,1)||e}function ea(e){return Qs(Xe(e).body,-1)||e}function dn(e,t){const n=t||e.currentTarget,o=e.relatedTarget;return!o||!Me(n,o)}function nf(e){oo(e,En()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function _i(e){e.querySelectorAll("[data-tabindex]").forEach(n=>{const o=n.dataset.tabindex;delete n.dataset.tabindex,o?n.setAttribute("tabindex",o):n.removeAttribute("tabindex")})}const at=Math.min,Je=Math.max,Yn=Math.round,_n=Math.floor,Qe=e=>({x:e,y:e}),of={left:"right",right:"left",bottom:"top",top:"bottom"},rf={start:"end",end:"start"};function ir(e,t,n){return Je(e,at(t,n))}function Yt(e,t){return typeof e=="function"?e(t):e}function lt(e){return e.split("-")[0]}function An(e){return e.split("-")[1]}function ta(e){return e==="x"?"y":"x"}function vr(e){return e==="y"?"height":"width"}const sf=new Set(["top","bottom"]);function rt(e){return sf.has(lt(e))?"y":"x"}function br(e){return ta(rt(e))}function af(e,t,n){n===void 0&&(n=!1);const o=An(e),r=br(e),i=vr(r);let s=r==="x"?o===(n?"end":"start")?"right":"left":o==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(s=Wn(s)),[s,Wn(s)]}function lf(e){const t=Wn(e);return[sr(e),t,sr(t)]}function sr(e){return e.replace(/start|end/g,t=>rf[t])}const Mi=["left","right"],Ii=["right","left"],cf=["top","bottom"],uf=["bottom","top"];function df(e,t,n){switch(e){case"top":case"bottom":return n?t?Ii:Mi:t?Mi:Ii;case"left":case"right":return t?cf:uf;default:return[]}}function ff(e,t,n,o){const r=An(e);let i=df(lt(e),n==="start",o);return r&&(i=i.map(s=>s+"-"+r),t&&(i=i.concat(i.map(sr)))),i}function Wn(e){return e.replace(/left|right|bottom|top/g,t=>of[t])}function pf(e){return{top:0,right:0,bottom:0,left:0,...e}}function wr(e){return typeof e!="number"?pf(e):{top:e,right:e,bottom:e,left:e}}function Ut(e){const{x:t,y:n,width:o,height:r}=e;return{width:o,height:r,top:n,left:t,right:t+o,bottom:n+r,x:t,y:n}}function Pi(e,t,n){let{reference:o,floating:r}=e;const i=rt(t),s=br(t),a=vr(s),c=lt(t),l=i==="y",u=o.x+o.width/2-r.width/2,d=o.y+o.height/2-r.height/2,f=o[a]/2-r[a]/2;let p;switch(c){case"top":p={x:u,y:o.y-r.height};break;case"bottom":p={x:u,y:o.y+o.height};break;case"right":p={x:o.x+o.width,y:d};break;case"left":p={x:o.x-r.width,y:d};break;default:p={x:o.x,y:o.y}}switch(An(t)){case"start":p[s]-=f*(n&&l?-1:1);break;case"end":p[s]+=f*(n&&l?-1:1);break}return p}const hf=async(e,t,n)=>{const{placement:o="bottom",strategy:r="absolute",middleware:i=[],platform:s}=n,a=i.filter(Boolean),c=await(s.isRTL==null?void 0:s.isRTL(t));let l=await s.getElementRects({reference:e,floating:t,strategy:r}),{x:u,y:d}=Pi(l,o,c),f=o,p={},y=0;for(let h=0;h<a.length;h++){const{name:E,fn:v}=a[h],{x:g,y:m,data:R,reset:$}=await v({x:u,y:d,initialPlacement:o,placement:f,strategy:r,middlewareData:p,rects:l,platform:s,elements:{reference:e,floating:t}});u=g??u,d=m??d,p={...p,[E]:{...p[E],...R}},$&&y<=50&&(y++,typeof $=="object"&&($.placement&&(f=$.placement),$.rects&&(l=$.rects===!0?await s.getElementRects({reference:e,floating:t,strategy:r}):$.rects),{x:u,y:d}=Pi(l,f,c)),h=-1)}return{x:u,y:d,placement:f,strategy:r,middlewareData:p}};async function na(e,t){var n;t===void 0&&(t={});const{x:o,y:r,platform:i,rects:s,elements:a,strategy:c}=e,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:p=0}=Yt(t,e),y=wr(p),E=a[f?d==="floating"?"reference":"floating":d],v=Ut(await i.getClippingRect({element:(n=await(i.isElement==null?void 0:i.isElement(E)))==null||n?E:E.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),g=d==="floating"?{x:o,y:r,width:s.floating.width,height:s.floating.height}:s.reference,m=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),R=await(i.isElement==null?void 0:i.isElement(m))?await(i.getScale==null?void 0:i.getScale(m))||{x:1,y:1}:{x:1,y:1},$=Ut(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:g,offsetParent:m,strategy:c}):g);return{top:(v.top-$.top+y.top)/R.y,bottom:($.bottom-v.bottom+y.bottom)/R.y,left:(v.left-$.left+y.left)/R.x,right:($.right-v.right+y.right)/R.x}}const gf=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:o,placement:r,rects:i,platform:s,elements:a,middlewareData:c}=t,{element:l,padding:u=0}=Yt(e,t)||{};if(l==null)return{};const d=wr(u),f={x:n,y:o},p=br(r),y=vr(p),h=await s.getDimensions(l),E=p==="y",v=E?"top":"left",g=E?"bottom":"right",m=E?"clientHeight":"clientWidth",R=i.reference[y]+i.reference[p]-f[p]-i.floating[y],$=f[p]-i.reference[p],N=await(s.getOffsetParent==null?void 0:s.getOffsetParent(l));let I=N?N[m]:0;(!I||!await(s.isElement==null?void 0:s.isElement(N)))&&(I=a.floating[m]||i.floating[y]);const k=R/2-$/2,P=I/2-h[y]/2-1,U=at(d[v],P),B=at(d[g],P),S=U,T=I-h[y]-B,x=I/2-h[y]/2+k,A=ir(S,x,T),_=!c.arrow&&An(r)!=null&&x!==A&&i.reference[y]/2-(x<S?U:B)-h[y]/2<0,L=_?x<S?x-S:x-T:0;return{[p]:f[p]+L,data:{[p]:A,centerOffset:x-A-L,..._&&{alignmentOffset:L}},reset:_}}}),mf=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,o;const{placement:r,middlewareData:i,rects:s,initialPlacement:a,platform:c,elements:l}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:h=!0,...E}=Yt(e,t);if((n=i.arrow)!=null&&n.alignmentOffset)return{};const v=lt(r),g=rt(a),m=lt(a)===a,R=await(c.isRTL==null?void 0:c.isRTL(l.floating)),$=f||(m||!h?[Wn(a)]:lf(a)),N=y!=="none";!f&&N&&$.push(...ff(a,h,y,R));const I=[a,...$],k=await na(t,E),P=[];let U=((o=i.flip)==null?void 0:o.overflows)||[];if(u&&P.push(k[v]),d){const x=af(r,s,R);P.push(k[x[0]],k[x[1]])}if(U=[...U,{placement:r,overflows:P}],!P.every(x=>x<=0)){var B,S;const x=(((B=i.flip)==null?void 0:B.index)||0)+1,A=I[x];if(A&&(!(d==="alignment"?g!==rt(A):!1)||U.every(C=>rt(C.placement)===g?C.overflows[0]>0:!0)))return{data:{index:x,overflows:U},reset:{placement:A}};let _=(S=U.filter(L=>L.overflows[0]<=0).sort((L,C)=>L.overflows[1]-C.overflows[1])[0])==null?void 0:S.placement;if(!_)switch(p){case"bestFit":{var T;const L=(T=U.filter(C=>{if(N){const H=rt(C.placement);return H===g||H==="y"}return!0}).map(C=>[C.placement,C.overflows.filter(H=>H>0).reduce((H,w)=>H+w,0)]).sort((C,H)=>C[1]-H[1])[0])==null?void 0:T[0];L&&(_=L);break}case"initialPlacement":_=a;break}if(r!==_)return{reset:{placement:_}}}return{}}}};function oa(e){const t=at(...e.map(i=>i.left)),n=at(...e.map(i=>i.top)),o=Je(...e.map(i=>i.right)),r=Je(...e.map(i=>i.bottom));return{x:t,y:n,width:o-t,height:r-n}}function yf(e){const t=e.slice().sort((r,i)=>r.y-i.y),n=[];let o=null;for(let r=0;r<t.length;r++){const i=t[r];!o||i.y-o.y>o.height/2?n.push([i]):n[n.length-1].push(i),o=i}return n.map(r=>Ut(oa(r)))}const vf=function(e){return e===void 0&&(e={}),{name:"inline",options:e,async fn(t){const{placement:n,elements:o,rects:r,platform:i,strategy:s}=t,{padding:a=2,x:c,y:l}=Yt(e,t),u=Array.from(await(i.getClientRects==null?void 0:i.getClientRects(o.reference))||[]),d=yf(u),f=Ut(oa(u)),p=wr(a);function y(){if(d.length===2&&d[0].left>d[1].right&&c!=null&&l!=null)return d.find(E=>c>E.left-p.left&&c<E.right+p.right&&l>E.top-p.top&&l<E.bottom+p.bottom)||f;if(d.length>=2){if(rt(n)==="y"){const U=d[0],B=d[d.length-1],S=lt(n)==="top",T=U.top,x=B.bottom,A=S?U.left:B.left,_=S?U.right:B.right,L=_-A,C=x-T;return{top:T,bottom:x,left:A,right:_,width:L,height:C,x:A,y:T}}const E=lt(n)==="left",v=Je(...d.map(U=>U.right)),g=at(...d.map(U=>U.left)),m=d.filter(U=>E?U.left===g:U.right===v),R=m[0].top,$=m[m.length-1].bottom,N=g,I=v,k=I-N,P=$-R;return{top:R,bottom:$,left:N,right:I,width:k,height:P,x:N,y:R}}return f}const h=await i.getElementRects({reference:{getBoundingClientRect:y},floating:o.floating,strategy:s});return r.reference.x!==h.reference.x||r.reference.y!==h.reference.y||r.reference.width!==h.reference.width||r.reference.height!==h.reference.height?{reset:{rects:h}}:{}}}},bf=new Set(["left","top"]);async function wf(e,t){const{placement:n,platform:o,elements:r}=e,i=await(o.isRTL==null?void 0:o.isRTL(r.floating)),s=lt(n),a=An(n),c=rt(n)==="y",l=bf.has(s)?-1:1,u=i&&c?-1:1,d=Yt(t,e);let{mainAxis:f,crossAxis:p,alignmentAxis:y}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof y=="number"&&(p=a==="end"?y*-1:y),c?{x:p*u,y:f*l}:{x:f*l,y:p*u}}const xf=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,o;const{x:r,y:i,placement:s,middlewareData:a}=t,c=await wf(t,e);return s===((n=a.offset)==null?void 0:n.placement)&&(o=a.arrow)!=null&&o.alignmentOffset?{}:{x:r+c.x,y:i+c.y,data:{...c,placement:s}}}}},Ef=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:o,placement:r}=t,{mainAxis:i=!0,crossAxis:s=!1,limiter:a={fn:E=>{let{x:v,y:g}=E;return{x:v,y:g}}},...c}=Yt(e,t),l={x:n,y:o},u=await na(t,c),d=rt(lt(r)),f=ta(d);let p=l[f],y=l[d];if(i){const E=f==="y"?"top":"left",v=f==="y"?"bottom":"right",g=p+u[E],m=p-u[v];p=ir(g,p,m)}if(s){const E=d==="y"?"top":"left",v=d==="y"?"bottom":"right",g=y+u[E],m=y-u[v];y=ir(g,y,m)}const h=a.fn({...t,[f]:p,[d]:y});return{...h,data:{x:h.x-n,y:h.y-o,enabled:{[f]:i,[d]:s}}}}}};function ra(e){const t=Ne(e);let n=parseFloat(t.width)||0,o=parseFloat(t.height)||0;const r=Re(e),i=r?e.offsetWidth:n,s=r?e.offsetHeight:o,a=Yn(n)!==i||Yn(o)!==s;return a&&(n=i,o=s),{width:n,height:o,$:a}}function xr(e){return ge(e)?e:e.contextElement}function It(e){const t=xr(e);if(!Re(t))return Qe(1);const n=t.getBoundingClientRect(),{width:o,height:r,$:i}=ra(t);let s=(i?Yn(n.width):n.width)/o,a=(i?Yn(n.height):n.height)/r;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const Af=Qe(0);function ia(e){const t=Pe(e);return!to()||!t.visualViewport?Af:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function $f(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==Pe(e)?!1:t}function Et(e,t,n,o){t===void 0&&(t=!1),n===void 0&&(n=!1);const r=e.getBoundingClientRect(),i=xr(e);let s=Qe(1);t&&(o?ge(o)&&(s=It(o)):s=It(e));const a=$f(i,n,o)?ia(i):Qe(0);let c=(r.left+a.x)/s.x,l=(r.top+a.y)/s.y,u=r.width/s.x,d=r.height/s.y;if(i){const f=Pe(i),p=o&&ge(o)?Pe(o):o;let y=f,h=er(y);for(;h&&o&&p!==y;){const E=It(h),v=h.getBoundingClientRect(),g=Ne(h),m=v.left+(h.clientLeft+parseFloat(g.paddingLeft))*E.x,R=v.top+(h.clientTop+parseFloat(g.paddingTop))*E.y;c*=E.x,l*=E.y,u*=E.x,d*=E.y,c+=m,l+=R,y=Pe(h),h=er(y)}}return Ut({width:u,height:d,x:c,y:l})}function ro(e,t){const n=no(e).scrollLeft;return t?t.left+n:Et(Ze(e)).left+n}function sa(e,t){const n=e.getBoundingClientRect(),o=n.left+t.scrollLeft-ro(e,n),r=n.top+t.scrollTop;return{x:o,y:r}}function Rf(e){let{elements:t,rect:n,offsetParent:o,strategy:r}=e;const i=r==="fixed",s=Ze(o),a=t?eo(t.floating):!1;if(o===s||a&&i)return n;let c={scrollLeft:0,scrollTop:0},l=Qe(1);const u=Qe(0),d=Re(o);if((d||!d&&!i)&&((yt(o)!=="body"||xn(s))&&(c=no(o)),Re(o))){const p=Et(o);l=It(o),u.x=p.x+o.clientLeft,u.y=p.y+o.clientTop}const f=s&&!d&&!i?sa(s,c):Qe(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x+f.x,y:n.y*l.y-c.scrollTop*l.y+u.y+f.y}}function Sf(e){return Array.from(e.getClientRects())}function Tf(e){const t=Ze(e),n=no(e),o=e.ownerDocument.body,r=Je(t.scrollWidth,t.clientWidth,o.scrollWidth,o.clientWidth),i=Je(t.scrollHeight,t.clientHeight,o.scrollHeight,o.clientHeight);let s=-n.scrollLeft+ro(e);const a=-n.scrollTop;return Ne(o).direction==="rtl"&&(s+=Je(t.clientWidth,o.clientWidth)-r),{width:r,height:i,x:s,y:a}}const Ni=25;function Cf(e,t){const n=Pe(e),o=Ze(e),r=n.visualViewport;let i=o.clientWidth,s=o.clientHeight,a=0,c=0;if(r){i=r.width,s=r.height;const u=to();(!u||u&&t==="fixed")&&(a=r.offsetLeft,c=r.offsetTop)}const l=ro(o);if(l<=0){const u=o.ownerDocument,d=u.body,f=getComputedStyle(d),p=u.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,y=Math.abs(o.clientWidth-d.clientWidth-p);y<=Ni&&(i-=y)}else l<=Ni&&(i+=l);return{width:i,height:s,x:a,y:c}}const Of=new Set(["absolute","fixed"]);function kf(e,t){const n=Et(e,!0,t==="fixed"),o=n.top+e.clientTop,r=n.left+e.clientLeft,i=Re(e)?It(e):Qe(1),s=e.clientWidth*i.x,a=e.clientHeight*i.y,c=r*i.x,l=o*i.y;return{width:s,height:a,x:c,y:l}}function Di(e,t,n){let o;if(t==="viewport")o=Cf(e,n);else if(t==="document")o=Tf(Ze(e));else if(ge(t))o=kf(t,n);else{const r=ia(e);o={x:t.x-r.x,y:t.y-r.y,width:t.width,height:t.height}}return Ut(o)}function aa(e,t){const n=st(e);return n===t||!ge(n)||it(n)?!1:Ne(n).position==="fixed"||aa(n,t)}function Lf(e,t){const n=t.get(e);if(n)return n;let o=ht(e,[],!1).filter(a=>ge(a)&&yt(a)!=="body"),r=null;const i=Ne(e).position==="fixed";let s=i?st(e):e;for(;ge(s)&&!it(s);){const a=Ne(s),c=yr(s);!c&&a.position==="fixed"&&(r=null),(i?!c&&!r:!c&&a.position==="static"&&!!r&&Of.has(r.position)||xn(s)&&!c&&aa(e,s))?o=o.filter(u=>u!==s):r=a,s=st(s)}return t.set(e,o),o}function _f(e){let{element:t,boundary:n,rootBoundary:o,strategy:r}=e;const s=[...n==="clippingAncestors"?eo(t)?[]:Lf(t,this._c):[].concat(n),o],a=s[0],c=s.reduce((l,u)=>{const d=Di(t,u,r);return l.top=Je(d.top,l.top),l.right=at(d.right,l.right),l.bottom=at(d.bottom,l.bottom),l.left=Je(d.left,l.left),l},Di(t,a,r));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function Mf(e){const{width:t,height:n}=ra(e);return{width:t,height:n}}function If(e,t,n){const o=Re(t),r=Ze(t),i=n==="fixed",s=Et(e,!0,i,t);let a={scrollLeft:0,scrollTop:0};const c=Qe(0);function l(){c.x=ro(r)}if(o||!o&&!i)if((yt(t)!=="body"||xn(r))&&(a=no(t)),o){const p=Et(t,!0,i,t);c.x=p.x+t.clientLeft,c.y=p.y+t.clientTop}else r&&l();i&&!o&&r&&l();const u=r&&!o&&!i?sa(r,a):Qe(0),d=s.left+a.scrollLeft-c.x-u.x,f=s.top+a.scrollTop-c.y-u.y;return{x:d,y:f,width:s.width,height:s.height}}function Vo(e){return Ne(e).position==="static"}function ji(e,t){if(!Re(e)||Ne(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return Ze(e)===n&&(n=n.ownerDocument.body),n}function la(e,t){const n=Pe(e);if(eo(e))return n;if(!Re(e)){let r=st(e);for(;r&&!it(r);){if(ge(r)&&!Vo(r))return r;r=st(r)}return n}let o=ji(e,t);for(;o&&bd(o)&&Vo(o);)o=ji(o,t);return o&&it(o)&&Vo(o)&&!yr(o)?n:o||$d(e)||n}const Pf=async function(e){const t=this.getOffsetParent||la,n=this.getDimensions,o=await n(e.floating);return{reference:If(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:o.width,height:o.height}}};function Nf(e){return Ne(e).direction==="rtl"}const Df={convertOffsetParentRelativeRectToViewportRelativeRect:Rf,getDocumentElement:Ze,getClippingRect:_f,getOffsetParent:la,getElementRects:Pf,getClientRects:Sf,getDimensions:Mf,getScale:It,isElement:ge,isRTL:Nf};function ca(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function jf(e,t){let n=null,o;const r=Ze(e);function i(){var a;clearTimeout(o),(a=n)==null||a.disconnect(),n=null}function s(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),i();const l=e.getBoundingClientRect(),{left:u,top:d,width:f,height:p}=l;if(a||t(),!f||!p)return;const y=_n(d),h=_n(r.clientWidth-(u+f)),E=_n(r.clientHeight-(d+p)),v=_n(u),m={rootMargin:-y+"px "+-h+"px "+-E+"px "+-v+"px",threshold:Je(0,at(1,c))||1};let R=!0;function $(N){const I=N[0].intersectionRatio;if(I!==c){if(!R)return s();I?s(!1,I):o=setTimeout(()=>{s(!1,1e-7)},1e3)}I===1&&!ca(l,e.getBoundingClientRect())&&s(),R=!1}try{n=new IntersectionObserver($,{...m,root:r.ownerDocument})}catch{n=new IntersectionObserver($,m)}n.observe(e)}return s(!0),i}function Bf(e,t,n,o){o===void 0&&(o={});const{ancestorScroll:r=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=o,l=xr(e),u=r||i?[...l?ht(l):[],...ht(t)]:[];u.forEach(v=>{r&&v.addEventListener("scroll",n,{passive:!0}),i&&v.addEventListener("resize",n)});const d=l&&a?jf(l,n):null;let f=-1,p=null;s&&(p=new ResizeObserver(v=>{let[g]=v;g&&g.target===l&&p&&(p.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var m;(m=p)==null||m.observe(t)})),n()}),l&&!c&&p.observe(l),p.observe(t));let y,h=c?Et(e):null;c&&E();function E(){const v=Et(e);h&&!ca(h,v)&&n(),h=v,y=requestAnimationFrame(E)}return n(),()=>{var v;u.forEach(g=>{r&&g.removeEventListener("scroll",n),i&&g.removeEventListener("resize",n)}),d==null||d(),(v=p)==null||v.disconnect(),p=null,c&&cancelAnimationFrame(y)}}const Uf=xf,Hf=Ef,Vf=mf,Bi=gf,Ff=vf,Xf=(e,t,n)=>{const o=new Map,r={platform:Df,...n},i={...r.platform,_c:o};return hf(e,t,{...r,platform:i})};var qf=typeof document<"u",Kf=function(){},Nn=qf?M.useLayoutEffect:Kf;function Gn(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,o,r;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(o=n;o--!==0;)if(!Gn(e[o],t[o]))return!1;return!0}if(r=Object.keys(e),n=r.length,n!==Object.keys(t).length)return!1;for(o=n;o--!==0;)if(!{}.hasOwnProperty.call(t,r[o]))return!1;for(o=n;o--!==0;){const i=r[o];if(!(i==="_owner"&&e.$$typeof)&&!Gn(e[i],t[i]))return!1}return!0}return e!==e&&t!==t}function ua(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Ui(e,t){const n=ua(e);return Math.round(t*n)/n}function Fo(e){const t=M.useRef(e);return Nn(()=>{t.current=e}),t}function Yf(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:o=[],platform:r,elements:{reference:i,floating:s}={},transform:a=!0,whileElementsMounted:c,open:l}=e,[u,d]=M.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[f,p]=M.useState(o);Gn(f,o)||p(o);const[y,h]=M.useState(null),[E,v]=M.useState(null),g=M.useCallback(C=>{C!==N.current&&(N.current=C,h(C))},[]),m=M.useCallback(C=>{C!==I.current&&(I.current=C,v(C))},[]),R=i||y,$=s||E,N=M.useRef(null),I=M.useRef(null),k=M.useRef(u),P=c!=null,U=Fo(c),B=Fo(r),S=Fo(l),T=M.useCallback(()=>{if(!N.current||!I.current)return;const C={placement:t,strategy:n,middleware:f};B.current&&(C.platform=B.current),Xf(N.current,I.current,C).then(H=>{const w={...H,isPositioned:S.current!==!1};x.current&&!Gn(k.current,w)&&(k.current=w,ar.flushSync(()=>{d(w)}))})},[f,t,n,B,S]);Nn(()=>{l===!1&&k.current.isPositioned&&(k.current.isPositioned=!1,d(C=>({...C,isPositioned:!1})))},[l]);const x=M.useRef(!1);Nn(()=>(x.current=!0,()=>{x.current=!1}),[]),Nn(()=>{if(R&&(N.current=R),$&&(I.current=$),R&&$){if(U.current)return U.current(R,$,T);T()}},[R,$,T,U,P]);const A=M.useMemo(()=>({reference:N,floating:I,setReference:g,setFloating:m}),[g,m]),_=M.useMemo(()=>({reference:R,floating:$}),[R,$]),L=M.useMemo(()=>{const C={position:n,left:0,top:0};if(!_.floating)return C;const H=Ui(_.floating,u.x),w=Ui(_.floating,u.y);return a?{...C,transform:"translate("+H+"px, "+w+"px)",...ua(_.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:H,top:w}},[n,a,_.floating,u.x,u.y]);return M.useMemo(()=>({...u,update:T,refs:A,elements:_,floatingStyles:L}),[u,T,A,_,L])}const Wf=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:o,padding:r}=typeof e=="function"?e(n):e;return o&&t(o)?o.current!=null?Bi({element:o.current,padding:r}).fn(n):{}:o?Bi({element:o,padding:r}).fn(n):{}}}},Gf=(e,t)=>({...Uf(e),options:[e,t]}),zf=(e,t)=>({...Hf(e),options:[e,t]}),Jf=(e,t)=>({...Vf(e),options:[e,t]}),Qf=(e,t)=>({...Ff(e),options:[e,t]}),Zf=(e,t)=>({...Wf(e),options:[e,t]}),ep="data-floating-ui-focusable",Hi="active",Vi="selected",tp={...os};let Fi=!1,np=0;const Xi=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+np++;function op(){const[e,t]=M.useState(()=>Fi?Xi():void 0);return Ie(()=>{e==null&&t(Xi())},[]),M.useEffect(()=>{Fi=!0},[]),e}const rp=tp.useId,io=rp||op,ip=M.forwardRef(function(t,n){const{context:{placement:o,elements:{floating:r},middlewareData:{arrow:i,shift:s}},width:a=14,height:c=7,tipRadius:l=0,strokeWidth:u=0,staticOffset:d,stroke:f,d:p,style:{transform:y,...h}={},...E}=t,v=io(),[g,m]=M.useState(!1);if(Ie(()=>{if(!r)return;Ne(r).direction==="rtl"&&m(!0)},[r]),!r)return null;const[R,$]=o.split("-"),N=R==="top"||R==="bottom";let I=d;(N&&s!=null&&s.x||!N&&s!=null&&s.y)&&(I=null);const k=u*2,P=k/2,U=a/2*(l/-8+1),B=c/2*l/4,S=!!p,T=I&&$==="end"?"bottom":"top";let x=I&&$==="end"?"right":"left";I&&g&&(x=$==="end"?"left":"right");const A=(i==null?void 0:i.x)!=null?I||i.x:"",_=(i==null?void 0:i.y)!=null?I||i.y:"",L=p||"M0,0"+(" H"+a)+(" L"+(a-U)+","+(c-B))+(" Q"+a/2+","+c+" "+U+","+(c-B))+" Z",C={top:S?"rotate(180deg)":"",left:S?"rotate(90deg)":"rotate(-90deg)",bottom:S?"":"rotate(180deg)",right:S?"rotate(-90deg)":"rotate(90deg)"}[R];return fe.jsxs("svg",{...E,"aria-hidden":!0,ref:n,width:S?a:a+k,height:a,viewBox:"0 0 "+a+" "+(c>a?c:a),style:{position:"absolute",pointerEvents:"none",[x]:A,[T]:_,[R]:N||S?"100%":"calc(100% - "+k/2+"px)",transform:[C,y].filter(H=>!!H).join(" "),...h},children:[k>0&&fe.jsx("path",{clipPath:"url(#"+v+")",fill:"none",stroke:f,strokeWidth:k+(p?0:1),d:L}),fe.jsx("path",{stroke:k&&!p?E.fill:"none",d:L}),fe.jsx("clipPath",{id:v,children:fe.jsx("rect",{x:-P,y:P*(S?-1:1),width:a+k,height:a})})]})});function sp(){const e=new Map;return{emit(t,n){var o;(o=e.get(t))==null||o.forEach(r=>r(n))},on(t,n){e.has(t)||e.set(t,new Set),e.get(t).add(n)},off(t,n){var o;(o=e.get(t))==null||o.delete(n)}}}const ap=M.createContext(null),lp=M.createContext(null),da=()=>{var e;return((e=M.useContext(ap))==null?void 0:e.id)||null},Er=()=>M.useContext(lp);function bn(e){return"data-floating-ui-"+e}function cp(e){e.current!==-1&&(clearTimeout(e.current),e.current=-1)}let qi=0;function Tt(e,t){t===void 0&&(t={});const{preventScroll:n=!1,cancelPrevious:o=!0,sync:r=!1}=t;o&&cancelAnimationFrame(qi);const i=()=>e==null?void 0:e.focus({preventScroll:n});r?i():qi=requestAnimationFrame(i)}function up(e){return(e==null?void 0:e.ownerDocument)||document}const Pt={inert:new WeakMap,"aria-hidden":new WeakMap,none:new WeakMap};function Ki(e){return e==="inert"?Pt.inert:e==="aria-hidden"?Pt["aria-hidden"]:Pt.none}let Mn=new WeakSet,In={},Xo=0;const dp=()=>typeof HTMLElement<"u"&&"inert"in HTMLElement.prototype,fa=e=>e&&(e.host||fa(e.parentNode)),fp=(e,t)=>t.map(n=>{if(e.contains(n))return n;const o=fa(n);return e.contains(o)?o:null}).filter(n=>n!=null);function pp(e,t,n,o){const r="data-floating-ui-inert",i=o?"inert":n?"aria-hidden":null,s=fp(t,e),a=new Set,c=new Set(s),l=[];In[r]||(In[r]=new WeakMap);const u=In[r];s.forEach(d),f(t),a.clear();function d(p){!p||a.has(p)||(a.add(p),p.parentNode&&d(p.parentNode))}function f(p){!p||c.has(p)||[].forEach.call(p.children,y=>{if(yt(y)!=="script")if(a.has(y))f(y);else{const h=i?y.getAttribute(i):null,E=h!==null&&h!=="false",v=Ki(i),g=(v.get(y)||0)+1,m=(u.get(y)||0)+1;v.set(y,g),u.set(y,m),l.push(y),g===1&&E&&Mn.add(y),m===1&&y.setAttribute(r,""),!E&&i&&y.setAttribute(i,i==="inert"?"":"true")}})}return Xo++,()=>{l.forEach(p=>{const y=Ki(i),E=(y.get(p)||0)-1,v=(u.get(p)||0)-1;y.set(p,E),u.set(p,v),E||(!Mn.has(p)&&i&&p.removeAttribute(i),Mn.delete(p)),v||p.removeAttribute(r)}),Xo--,Xo||(Pt.inert=new WeakMap,Pt["aria-hidden"]=new WeakMap,Pt.none=new WeakMap,Mn=new WeakSet,In={})}}function Yi(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);const o=up(e[0]).body;return pp(e.concat(Array.from(o.querySelectorAll('[aria-live],[role="status"],output'))),o,t,n)}const so={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0},zn=M.forwardRef(function(t,n){const[o,r]=M.useState();Ie(()=>{Fd()&&r("button")},[]);const i={ref:n,tabIndex:0,role:o,"aria-hidden":o?void 0:!0,[bn("focus-guard")]:"",style:so};return fe.jsx("span",{...t,...i})}),pa=M.createContext(null),Wi=bn("portal");function hp(e){e===void 0&&(e={});const{id:t,root:n}=e,o=io(),r=ha(),[i,s]=M.useState(null),a=M.useRef(null);return Ie(()=>()=>{i==null||i.remove(),queueMicrotask(()=>{a.current=null})},[i]),Ie(()=>{if(!o||a.current)return;const c=t?document.getElementById(t):null;if(!c)return;const l=document.createElement("div");l.id=o,l.setAttribute(Wi,""),c.appendChild(l),a.current=l,s(l)},[t,o]),Ie(()=>{if(n===null||!o||a.current)return;let c=n||(r==null?void 0:r.portalNode);c&&!mr(c)&&(c=c.current),c=c||document.body;let l=null;t&&(l=document.createElement("div"),l.id=t,c.appendChild(l));const u=document.createElement("div");u.id=o,u.setAttribute(Wi,""),c=l||c,c.appendChild(u),a.current=u,s(u)},[t,n,o,r]),i}function gp(e){const{children:t,id:n,root:o,preserveTabOrder:r=!0}=e,i=hp({id:n,root:o}),[s,a]=M.useState(null),c=M.useRef(null),l=M.useRef(null),u=M.useRef(null),d=M.useRef(null),f=s==null?void 0:s.modal,p=s==null?void 0:s.open,y=!!s&&!s.modal&&s.open&&r&&!!(o||i);return M.useEffect(()=>{if(!i||!r||f)return;function h(E){i&&dn(E)&&(E.type==="focusin"?_i:nf)(i)}return i.addEventListener("focusin",h,!0),i.addEventListener("focusout",h,!0),()=>{i.removeEventListener("focusin",h,!0),i.removeEventListener("focusout",h,!0)}},[i,r,f]),M.useEffect(()=>{i&&(p||_i(i))},[p,i]),fe.jsxs(pa.Provider,{value:M.useMemo(()=>({preserveTabOrder:r,beforeOutsideRef:c,afterOutsideRef:l,beforeInsideRef:u,afterInsideRef:d,portalNode:i,setFocusManagerState:a}),[r,i]),children:[y&&i&&fe.jsx(zn,{"data-type":"outside",ref:c,onFocus:h=>{if(dn(h,i)){var E;(E=u.current)==null||E.focus()}else{const v=s?s.domReference:null,g=ea(v);g==null||g.focus()}}}),y&&i&&fe.jsx("span",{"aria-owns":i.id,style:so}),i&&ar.createPortal(t,i),y&&i&&fe.jsx(zn,{"data-type":"outside",ref:l,onFocus:h=>{if(dn(h,i)){var E;(E=d.current)==null||E.focus()}else{const v=s?s.domReference:null,g=Zs(v);g==null||g.focus(),s!=null&&s.closeOnFocusOut&&(s==null||s.onOpenChange(!1,h.nativeEvent,"focus-out"))}}})]})}const ha=()=>M.useContext(pa);function Gi(e){return M.useMemo(()=>t=>{e.forEach(n=>{n&&(n.current=t)})},e)}const mp=20;let ft=[];function Ar(){ft=ft.filter(e=>e.isConnected)}function yp(e){Ar(),e&&yt(e)!=="body"&&(ft.push(e),ft.length>mp&&(ft=ft.slice(-20)))}function zi(){return Ar(),ft[ft.length-1]}function vp(e){const t=En();return zs(e,t)?e:oo(e,t)[0]||e}function Ji(e,t){var n;if(!t.current.includes("floating")&&!((n=e.getAttribute("role"))!=null&&n.includes("dialog")))return;const o=En(),i=Hd(e,o).filter(a=>{const c=a.getAttribute("data-tabindex")||"";return zs(a,o)||a.hasAttribute("data-tabindex")&&!c.startsWith("-")}),s=e.getAttribute("tabindex");t.current.includes("floating")||i.length===0?s!=="0"&&e.setAttribute("tabindex","0"):(s!=="-1"||e.hasAttribute("data-tabindex")&&e.getAttribute("data-tabindex")!=="-1")&&(e.setAttribute("tabindex","-1"),e.setAttribute("data-tabindex","-1"))}const bp=M.forwardRef(function(t,n){return fe.jsx("button",{...t,type:"button",ref:n,tabIndex:-1,style:so})});function wp(e){const{context:t,children:n,disabled:o=!1,order:r=["content"],guards:i=!0,initialFocus:s=0,returnFocus:a=!0,restoreFocus:c=!1,modal:l=!0,visuallyHiddenDismiss:u=!1,closeOnFocusOut:d=!0,outsideElementsInert:f=!1,getInsideElements:p=()=>[]}=e,{open:y,onOpenChange:h,events:E,dataRef:v,elements:{domReference:g,floating:m}}=t,R=Ge(()=>{var W;return(W=v.current.floatingContext)==null?void 0:W.nodeId}),$=Ge(p),N=typeof s=="number"&&s<0,I=ki(g)&&N,k=dp(),P=k?i:!0,U=!P||k&&f,B=Ho(r),S=Ho(s),T=Ho(a),x=Er(),A=ha(),_=M.useRef(null),L=M.useRef(null),C=M.useRef(!1),H=M.useRef(!1),w=M.useRef(-1),O=M.useRef(-1),j=A!=null,D=rr(m),q=Ge(function(W){return W===void 0&&(W=D),W?oo(W,En()):[]}),F=Ge(W=>{const ee=q(W);return B.current.map(z=>g&&z==="reference"?g:D&&z==="floating"?D:ee).filter(Boolean).flat()});M.useEffect(()=>{if(o||!l)return;function W(z){if(z.key==="Tab"){Me(D,kt(Xe(D)))&&q().length===0&&!I&&Uo(z);const se=F(),ie=ct(z);B.current[0]==="reference"&&ie===g&&(Uo(z),z.shiftKey?Tt(se[se.length-1]):Tt(se[1])),B.current[1]==="floating"&&ie===D&&z.shiftKey&&(Uo(z),Tt(se[0]))}}const ee=Xe(D);return ee.addEventListener("keydown",W),()=>{ee.removeEventListener("keydown",W)}},[o,g,D,l,B,I,q,F]),M.useEffect(()=>{if(o||!m)return;function W(ee){const z=ct(ee),ie=q().indexOf(z);ie!==-1&&(w.current=ie)}return m.addEventListener("focusin",W),()=>{m.removeEventListener("focusin",W)}},[o,m,q]),M.useEffect(()=>{if(o||!d)return;function W(){H.current=!0,setTimeout(()=>{H.current=!1})}function ee(ie){const X=ie.relatedTarget,ke=ie.currentTarget,Te=ct(ie);queueMicrotask(()=>{const Y=R(),V=!(Me(g,X)||Me(m,X)||Me(X,m)||Me(A==null?void 0:A.portalNode,X)||X!=null&&X.hasAttribute(bn("focus-guard"))||x&&(Mt(x.nodesRef.current,Y).find(Le=>{var Oe,_e;return Me((Oe=Le.context)==null?void 0:Oe.elements.floating,X)||Me((_e=Le.context)==null?void 0:_e.elements.domReference,X)})||Li(x.nodesRef.current,Y).find(Le=>{var Oe,_e,vt;return[(Oe=Le.context)==null?void 0:Oe.elements.floating,rr((_e=Le.context)==null?void 0:_e.elements.floating)].includes(X)||((vt=Le.context)==null?void 0:vt.elements.domReference)===X})));if(ke===g&&D&&Ji(D,B),c&&ke!==g&&!(Te!=null&&Te.isConnected)&&kt(Xe(D))===Xe(D).body){Re(D)&&D.focus();const Le=w.current,Oe=q(),_e=Oe[Le]||Oe[Oe.length-1]||D;Re(_e)&&_e.focus()}if(v.current.insideReactTree){v.current.insideReactTree=!1;return}(I||!l)&&X&&V&&!H.current&&X!==zi()&&(C.current=!0,h(!1,ie,"focus-out"))})}const z=!!(!x&&A);function se(){cp(O),v.current.insideReactTree=!0,O.current=window.setTimeout(()=>{v.current.insideReactTree=!1})}if(m&&Re(g))return g.addEventListener("focusout",ee),g.addEventListener("pointerdown",W),m.addEventListener("focusout",ee),z&&m.addEventListener("focusout",se,!0),()=>{g.removeEventListener("focusout",ee),g.removeEventListener("pointerdown",W),m.removeEventListener("focusout",ee),z&&m.removeEventListener("focusout",se,!0)}},[o,g,m,D,l,x,A,h,d,c,q,I,R,B,v]);const K=M.useRef(null),ae=M.useRef(null),te=Gi([K,A==null?void 0:A.beforeInsideRef]),Ve=Gi([ae,A==null?void 0:A.afterInsideRef]);M.useEffect(()=>{var W,ee;if(o||!m)return;const z=Array.from((A==null||(W=A.portalNode)==null?void 0:W.querySelectorAll("["+bn("portal")+"]"))||[]),ie=(ee=(x?Li(x.nodesRef.current,R()):[]).find(Te=>{var Y;return ki(((Y=Te.context)==null?void 0:Y.elements.domReference)||null)}))==null||(ee=ee.context)==null?void 0:ee.elements.domReference,X=[m,ie,...z,...$(),_.current,L.current,K.current,ae.current,A==null?void 0:A.beforeOutsideRef.current,A==null?void 0:A.afterOutsideRef.current,B.current.includes("reference")||I?g:null].filter(Te=>Te!=null),ke=l||I?Yi(X,!U,U):Yi(X);return()=>{ke()}},[o,g,m,l,B,A,I,P,U,x,R,$]),Ie(()=>{if(o||!Re(D))return;const W=Xe(D),ee=kt(W);queueMicrotask(()=>{const z=F(D),se=S.current,ie=(typeof se=="number"?z[se]:se.current)||D,X=Me(D,ee);!N&&!X&&y&&Tt(ie,{preventScroll:ie===D})})},[o,y,D,N,F,S]),Ie(()=>{if(o||!D)return;const W=Xe(D),ee=kt(W);yp(ee);function z(X){let{reason:ke,event:Te,nested:Y}=X;if(["hover","safe-polygon"].includes(ke)&&Te.type==="mouseleave"&&(C.current=!0),ke==="outside-press")if(Y)C.current=!1;else if(Gd(Te)||zd(Te))C.current=!1;else{let V=!1;document.createElement("div").focus({get preventScroll(){return V=!0,!1}}),V?C.current=!1:C.current=!0}}E.on("openchange",z);const se=W.createElement("span");se.setAttribute("tabindex","-1"),se.setAttribute("aria-hidden","true"),Object.assign(se.style,so),j&&g&&g.insertAdjacentElement("afterend",se);function ie(){if(typeof T.current=="boolean"){const X=g||zi();return X&&X.isConnected?X:se}return T.current.current||se}return()=>{E.off("openchange",z);const X=kt(W),ke=Me(m,X)||x&&Mt(x.nodesRef.current,R(),!1).some(Y=>{var V;return Me((V=Y.context)==null?void 0:V.elements.floating,X)}),Te=ie();queueMicrotask(()=>{const Y=vp(Te);T.current&&!C.current&&Re(Y)&&(!(Y!==X&&X!==W.body)||ke)&&Y.focus({preventScroll:!0}),se.remove()})}},[o,m,D,T,v,E,x,j,g,R]),M.useEffect(()=>(queueMicrotask(()=>{C.current=!1}),()=>{queueMicrotask(Ar)}),[o]),Ie(()=>{if(!o&&A)return A.setFocusManagerState({modal:l,closeOnFocusOut:d,open:y,onOpenChange:h,domReference:g}),()=>{A.setFocusManagerState(null)}},[o,A,l,y,h,d,g]),Ie(()=>{o||D&&Ji(D,B)},[o,D,B]);function be(W){return o||!u||!l?null:fe.jsx(bp,{ref:W==="start"?_:L,onClick:ee=>h(!1,ee.nativeEvent),children:typeof u=="string"?u:"Dismiss"})}const We=!o&&P&&(l?!I:!0)&&(j||l);return fe.jsxs(fe.Fragment,{children:[We&&fe.jsx(zn,{"data-type":"inside",ref:te,onFocus:W=>{if(l){const z=F();Tt(r[0]==="reference"?z[0]:z[z.length-1])}else if(A!=null&&A.preserveTabOrder&&A.portalNode)if(C.current=!1,dn(W,A.portalNode)){const z=Zs(g);z==null||z.focus()}else{var ee;(ee=A.beforeOutsideRef.current)==null||ee.focus()}}}),!I&&be("start"),n,be("end"),We&&fe.jsx(zn,{"data-type":"inside",ref:Ve,onFocus:W=>{if(l)Tt(F()[0]);else if(A!=null&&A.preserveTabOrder&&A.portalNode)if(d&&(C.current=!0),dn(W,A.portalNode)){const z=ea(g);z==null||z.focus()}else{var ee;(ee=A.afterOutsideRef.current)==null||ee.focus()}}})]})}const xp={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},Ep={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},Qi=e=>{var t,n;return{escapeKey:typeof e=="boolean"?e:(t=e==null?void 0:e.escapeKey)!=null?t:!1,outsidePress:typeof e=="boolean"?e:(n=e==null?void 0:e.outsidePress)!=null?n:!0}};function Ap(e,t){t===void 0&&(t={});const{open:n,onOpenChange:o,elements:r,dataRef:i}=e,{enabled:s=!0,escapeKey:a=!0,outsidePress:c=!0,outsidePressEvent:l="pointerdown",referencePress:u=!1,referencePressEvent:d="pointerdown",ancestorScroll:f=!1,bubbles:p,capture:y}=t,h=Er(),E=Ge(typeof c=="function"?c:()=>!1),v=typeof c=="function"?E:c,g=M.useRef(!1),{escapeKey:m,outsidePress:R}=Qi(p),{escapeKey:$,outsidePress:N}=Qi(y),I=M.useRef(!1),k=Ge(x=>{var A;if(!n||!s||!a||x.key!=="Escape"||I.current)return;const _=(A=i.current.floatingContext)==null?void 0:A.nodeId,L=h?Mt(h.nodesRef.current,_):[];if(!m&&(x.stopPropagation(),L.length>0)){let C=!0;if(L.forEach(H=>{var w;if((w=H.context)!=null&&w.open&&!H.context.dataRef.current.__escapeKeyBubbles){C=!1;return}}),!C)return}o(!1,Wd(x)?x.nativeEvent:x,"escape-key")}),P=Ge(x=>{var A;const _=()=>{var L;k(x),(L=ct(x))==null||L.removeEventListener("keydown",_)};(A=ct(x))==null||A.addEventListener("keydown",_)}),U=Ge(x=>{var A;const _=i.current.insideReactTree;i.current.insideReactTree=!1;const L=g.current;if(g.current=!1,l==="click"&&L||_||typeof v=="function"&&!v(x))return;const C=ct(x),H="["+bn("inert")+"]",w=Xe(r.floating).querySelectorAll(H);let O=ge(C)?C:null;for(;O&&!it(O);){const F=st(O);if(it(F)||!ge(F))break;O=F}if(w.length&&ge(C)&&!Kd(C)&&!Me(C,r.floating)&&Array.from(w).every(F=>!Me(O,F)))return;if(Re(C)&&T){const F=it(C),K=Ne(C),ae=/auto|scroll/,te=F||ae.test(K.overflowX),Ve=F||ae.test(K.overflowY),be=te&&C.clientWidth>0&&C.scrollWidth>C.clientWidth,We=Ve&&C.clientHeight>0&&C.scrollHeight>C.clientHeight,W=K.direction==="rtl",ee=We&&(W?x.offsetX<=C.offsetWidth-C.clientWidth:x.offsetX>C.clientWidth),z=be&&x.offsetY>C.clientHeight;if(ee||z)return}const j=(A=i.current.floatingContext)==null?void 0:A.nodeId,D=h&&Mt(h.nodesRef.current,j).some(F=>{var K;return Bo(x,(K=F.context)==null?void 0:K.elements.floating)});if(Bo(x,r.floating)||Bo(x,r.domReference)||D)return;const q=h?Mt(h.nodesRef.current,j):[];if(q.length>0){let F=!0;if(q.forEach(K=>{var ae;if((ae=K.context)!=null&&ae.open&&!K.context.dataRef.current.__outsidePressBubbles){F=!1;return}}),!F)return}o(!1,x,"outside-press")}),B=Ge(x=>{var A;const _=()=>{var L;U(x),(L=ct(x))==null||L.removeEventListener(l,_)};(A=ct(x))==null||A.addEventListener(l,_)});M.useEffect(()=>{if(!n||!s)return;i.current.__escapeKeyBubbles=m,i.current.__outsidePressBubbles=R;let x=-1;function A(w){o(!1,w,"ancestor-scroll")}function _(){window.clearTimeout(x),I.current=!0}function L(){x=window.setTimeout(()=>{I.current=!1},to()?5:0)}const C=Xe(r.floating);a&&(C.addEventListener("keydown",$?P:k,$),C.addEventListener("compositionstart",_),C.addEventListener("compositionend",L)),v&&C.addEventListener(l,N?B:U,N);let H=[];return f&&(ge(r.domReference)&&(H=ht(r.domReference)),ge(r.floating)&&(H=H.concat(ht(r.floating))),!ge(r.reference)&&r.reference&&r.reference.contextElement&&(H=H.concat(ht(r.reference.contextElement)))),H=H.filter(w=>{var O;return w!==((O=C.defaultView)==null?void 0:O.visualViewport)}),H.forEach(w=>{w.addEventListener("scroll",A,{passive:!0})}),()=>{a&&(C.removeEventListener("keydown",$?P:k,$),C.removeEventListener("compositionstart",_),C.removeEventListener("compositionend",L)),v&&C.removeEventListener(l,N?B:U,N),H.forEach(w=>{w.removeEventListener("scroll",A)}),window.clearTimeout(x)}},[i,r,a,v,l,n,o,f,s,m,R,k,$,P,U,N,B]),M.useEffect(()=>{i.current.insideReactTree=!1},[i,v,l]);const S=M.useMemo(()=>({onKeyDown:k,...u&&{[xp[d]]:x=>{o(!1,x.nativeEvent,"reference-press")},...d!=="click"&&{onClick(x){o(!1,x.nativeEvent,"reference-press")}}}}),[k,o,u,d]),T=M.useMemo(()=>({onKeyDown:k,onMouseDown(){g.current=!0},onMouseUp(){g.current=!0},[Ep[l]]:()=>{i.current.insideReactTree=!0}}),[k,l,i]);return M.useMemo(()=>s?{reference:S,floating:T}:{},[s,S,T])}function $p(e){const{open:t=!1,onOpenChange:n,elements:o}=e,r=io(),i=M.useRef({}),[s]=M.useState(()=>sp()),a=da()!=null,[c,l]=M.useState(o.reference),u=Ge((p,y,h)=>{i.current.openEvent=p?y:void 0,s.emit("openchange",{open:p,event:y,reason:h,nested:a}),n==null||n(p,y,h)}),d=M.useMemo(()=>({setPositionReference:l}),[]),f=M.useMemo(()=>({reference:c||o.reference||null,floating:o.floating||null,domReference:o.reference}),[c,o.reference,o.floating]);return M.useMemo(()=>({dataRef:i,open:t,onOpenChange:u,elements:f,events:s,floatingId:r,refs:d}),[t,u,f,s,r,d])}function Rp(e){e===void 0&&(e={});const{nodeId:t}=e,n=$p({...e,elements:{reference:null,floating:null,...e.elements}}),o=e.rootContext||n,r=o.elements,[i,s]=M.useState(null),[a,c]=M.useState(null),u=(r==null?void 0:r.domReference)||i,d=M.useRef(null),f=Er();Ie(()=>{u&&(d.current=u)},[u]);const p=Yf({...e,elements:{...r,...a&&{reference:a}}}),y=M.useCallback(m=>{const R=ge(m)?{getBoundingClientRect:()=>m.getBoundingClientRect(),getClientRects:()=>m.getClientRects(),contextElement:m}:m;c(R),p.refs.setReference(R)},[p.refs]),h=M.useCallback(m=>{(ge(m)||m===null)&&(d.current=m,s(m)),(ge(p.refs.reference.current)||p.refs.reference.current===null||m!==null&&!ge(m))&&p.refs.setReference(m)},[p.refs]),E=M.useMemo(()=>({...p.refs,setReference:h,setPositionReference:y,domReference:d}),[p.refs,h,y]),v=M.useMemo(()=>({...p.elements,domReference:u}),[p.elements,u]),g=M.useMemo(()=>({...p,...o,refs:E,elements:v,nodeId:t}),[p,E,v,t,o]);return Ie(()=>{o.dataRef.current.floatingContext=g;const m=f==null?void 0:f.nodesRef.current.find(R=>R.id===t);m&&(m.context=g)}),M.useMemo(()=>({...p,context:g,refs:E,elements:v}),[p,E,v,g])}function qo(e,t,n){const o=new Map,r=n==="item";let i=e;if(r&&e){const{[Hi]:s,[Vi]:a,...c}=e;i=c}return{...n==="floating"&&{tabIndex:-1,[ep]:""},...i,...t.map(s=>{const a=s?s[n]:null;return typeof a=="function"?e?a(e):null:a}).concat(e).reduce((s,a)=>(a&&Object.entries(a).forEach(c=>{let[l,u]=c;if(!(r&&[Hi,Vi].includes(l)))if(l.indexOf("on")===0){if(o.has(l)||o.set(l,[]),typeof u=="function"){var d;(d=o.get(l))==null||d.push(u),s[l]=function(){for(var f,p=arguments.length,y=new Array(p),h=0;h<p;h++)y[h]=arguments[h];return(f=o.get(l))==null?void 0:f.map(E=>E(...y)).find(E=>E!==void 0)}}}else s[l]=u}),s),{})}}function Sp(e){e===void 0&&(e=[]);const t=e.map(a=>a==null?void 0:a.reference),n=e.map(a=>a==null?void 0:a.floating),o=e.map(a=>a==null?void 0:a.item),r=M.useCallback(a=>qo(a,e,"reference"),t),i=M.useCallback(a=>qo(a,e,"floating"),n),s=M.useCallback(a=>qo(a,e,"item"),o);return M.useMemo(()=>({getReferenceProps:r,getFloatingProps:i,getItemProps:s}),[r,i,s])}const Tp=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function Cp(e,t){var n,o;t===void 0&&(t={});const{open:r,elements:i,floatingId:s}=e,{enabled:a=!0,role:c="dialog"}=t,l=io(),u=((n=i.domReference)==null?void 0:n.id)||l,d=M.useMemo(()=>{var g;return((g=rr(i.floating))==null?void 0:g.id)||s},[i.floating,s]),f=(o=Tp.get(c))!=null?o:c,y=da()!=null,h=M.useMemo(()=>f==="tooltip"||c==="label"?{["aria-"+(c==="label"?"labelledby":"describedby")]:r?d:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":f==="alertdialog"?"dialog":f,"aria-controls":r?d:void 0,...f==="listbox"&&{role:"combobox"},...f==="menu"&&{id:u},...f==="menu"&&y&&{role:"menuitem"},...c==="select"&&{"aria-autocomplete":"none"},...c==="combobox"&&{"aria-autocomplete":"list"}},[f,d,y,r,u,c]),E=M.useMemo(()=>{const g={id:d,...f&&{role:f}};return f==="tooltip"||c==="label"?g:{...g,...f==="menu"&&{"aria-labelledby":u}}},[f,d,u,c]),v=M.useCallback(g=>{let{active:m,selected:R}=g;const $={role:"option",...m&&{id:d+"-fui-option"}};switch(c){case"select":case"combobox":return{...$,"aria-selected":R}}return{}},[d,c]);return M.useMemo(()=>a?{reference:h,floating:E,item:v}:{},[a,h,E,v])}const Zi=()=>{if(typeof navigator>"u")return!1;var e=navigator.userAgent||navigator.vendor||(window==null?void 0:window.opera);return!!(/android/i.test(e)||/iPad|iPhone/.test(e)&&!window.MSStream)},Op=(e,t={timeout:250})=>{const n=Ua(),[o,r]=M.useState(!0);return M.useEffect(()=>{if(!n||!e)return;let i;const s=a=>{const{changes:{updated:c}}=a;(c==null?void 0:c.some(u=>{const{targetUpdated:d}=u;if(d){const{oldTarget:f,newTarget:p}=d;return kp(f,p)}}))&&(r(!1),clearTimeout(i),i=setTimeout(()=>r(!0),t.timeout))};return n.observe(s,{annotations:e,ignore:ws.BODY_ONLY,origin:xs.LOCAL}),()=>{clearTimeout(i),n.unobserve(s)}},[n,e,t.timeout]),o},kp=(e,t)=>{const{selector:n}=e,o=n.map(({quote:s})=>s),{selector:r}=t,i=r.map(({quote:s})=>s);return o.join()!==i.join()},es=(e,t)=>{const{left:n,top:o,right:r,bottom:i}=e,s=t.getBoundingClientRect();return new DOMRect(n+s.left,o+s.top,r-n,i-o)},jp=e=>{var t;const n=ls(),{selected:o,event:r}=Ha(),i=(t=o[0])==null?void 0:t.annotation,s=Op(i==null?void 0:i.id),[a,c]=M.useState((o==null?void 0:o.length)>0),l=M.useRef(!1),u=M.useRef(null),{refs:d,floatingStyles:f,update:p,context:y}=Rp({placement:Zi()?"bottom":e.placement||"top",open:a,onOpenChange:(R,$,N)=>{!R&&(N==="escape-key"||N==="focus-out")&&(c(R),n==null||n.cancelSelected())},middleware:[Qf(),Gf(10),Jf({crossAxis:!0}),zf({crossAxis:!0,padding:10}),Zf({element:u})],whileElementsMounted:Bf}),h=Ap(y),E=Cp(y,{role:"dialog"}),{getFloatingProps:v}=Sp([h,E]);M.useEffect(()=>{if(i!=null&&i.id&&s){const R=n==null?void 0:n.state.store.getAnnotationBounds(i.id);c(!!R)}else c(!1)},[i==null?void 0:i.id,i==null?void 0:i.target.selector,s,n==null?void 0:n.state.store]),M.useEffect(()=>{e.onClose&&(a?l.current=!0:l.current&&(l.current=!1,e.onClose()))},[e.onClose,a]),M.useEffect(()=>{n&&(a&&(i!=null&&i.id)?d.setPositionReference({getBoundingClientRect:()=>{const R=n.state.store.getAnnotationBounds(i.id);return R?es(R,n.element):new DOMRect},getClientRects:()=>{const $=n.state.store.getAnnotationRects(i.id).map(N=>es(N,n.element));return Uc($)}}):d.setPositionReference(null))},[a,i==null?void 0:i.id,i==null?void 0:i.target,n]),M.useEffect(()=>{const R={attributes:!0,childList:!0,subtree:!0},$=new MutationObserver(()=>p());return $.observe(document.body,R),window.document.addEventListener("scroll",p,!0),()=>{$.disconnect(),window.document.removeEventListener("scroll",p,!0)}},[p]);const g=M.useMemo(()=>(r==null?void 0:r.type)==="keyup"||(r==null?void 0:r.type)==="contextmenu"||Zi()?-1:0,[r]),m=()=>n==null?void 0:n.cancelSelected();return a&&i?fe.jsx(gp,{root:e.asPortal?null:n.element,children:fe.jsx(wp,{context:y,modal:!1,closeOnFocusOut:!0,returnFocus:!1,initialFocus:g,children:fe.jsxs("div",{className:`a9s-popup r6o-popup annotation-popup r6o-text-popup ${fr}`,ref:d.setFloating,style:f,children:[e.popup({annotation:o[0].annotation,editable:o[0].editable,event:r}),e.arrow&&fe.jsx(ip,{ref:u,context:y,...e.arrowProps||{}}),fe.jsx("button",{className:"r6o-popup-sr-only","aria-live":"assertive",onClick:m,children:e.ariaCloseWarning||"Click or leave this dialog to close it."})]})})}):null};export{Ea as R,jp as T,xa as a,M as b,os as c,ar as d,Np as e,Lp as f,ts as g,Dp as h,va as j,ns as r};
